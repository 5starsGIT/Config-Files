!function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=27)}([function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=function(){function e(){o(this,e)}return i(e,[{key:"getPublicFunctions",value:function(){return Object.keys(this)}},{key:"handle",value:function(e){var t=e.data.map(function(e){return e});return this[e.method].apply(null,t)}}]),e}();t.a=r},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=null,a=function(){function e(){return o(this,e),r||(r=this),r}return i(e,null,[{key:"getInstance",value:function(){return r||(r=new e),r}},{key:"setWebGL",value:function(t){e.getInstance().view=t}},{key:"callWebGL",value:function(t,n,o){e.getInstance().view.contentWindow.postMessage({target:t,method:n,data:o},"*")}},{key:"callUnity",value:function(t,n,o){e.getInstance().view.contentWindow.postMessage({sender:t,target:"unity",method:n,data:o},"*")}},{key:"sendDataToUnity",value:function(t,n,o,i){e.getInstance().view.contentWindow.postMessage({target:"sendUnityData",data:t,metadata:n,transferID:o,unityCallback:i||"JSArrayBufferReady"},"*")}},{key:"requestDataFromUnity",value:function(t,n,o,i){e.getInstance().view.contentWindow.postMessage({target:"requestUnityData",transferID:t,sender:n,metadata:i,callbackName:o},"*")}}]),e}();t.a=a},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=null,a=function(){function e(){return o(this,e),r||(r=this),r}return i(e,[{key:"handle",value:function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];e.forward(n.target,n.method,n.data)}}],[{key:"setAppWindow",value:function(e){r.appWindow=e}},{key:"setAppOrigin",value:function(e){r.appOrigin=e}},{key:"getAppWindow",value:function(){return r.appWindow}},{key:"getAppOrigin",value:function(){return r.appOrigin}},{key:"forward",value:function(t,n,o){e.getAppOrigin()&&e.getAppWindow()&&e.getAppWindow().postMessage({sender:"unity",target:n,method:t,data:o},e.getAppOrigin())}}]),e}();t.a=a},,function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=n(1),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.isSavingFile=function(){return e.savingFile},e.showFilePicker=function(t,n){var o=[{mimeTypes:[t]}];chrome.fileSystem.chooseEntry({type:"openFile",accepts:o},function(o){if(o){if(chrome.runtime.lastError)return void console.warn("showFilePicker - chooseEntry error: ",chrome.runtime.lastError.message);e.currentFileEntry=o;var i=o.name.split("."),r=i[i.length-1];e.currentFileEntry.file(function(o){var i=n+"."+r,a="uniwebview://FileSelectedFromPicker?FilePath="+i+"&MimeType="+t;e.saveFileToIndexDB(i,o,a)})}})},e.saveFile=function(t,n,o,i){e.savingFile=!0;var r={type:"saveFile",suggestedName:"untitled."+n,accepts:[{extensions:[""+n]}]};chrome.fileSystem.chooseEntry(r,function(n){return chrome.runtime.lastError?(console.warn("saveFile - chooseEntry error: ",chrome.runtime.lastError.message),i(chrome.runtime.lastError.message),void(e.savingFile=!1)):n?void n.createWriter(function(n){n.onerror=function(t){i(t),e.savingFile=!1},n.onwriteend=function(t){t.loaded>0&&t.total>0&&t.loaded===t.total&&(o(),e.savingFile=!1)},n.truncate(t.size),e.waitForIO(n,function(){n.seek(0),n.write(t)})},function(t){i(t),e.savingFile=!1}):(i(chrome.runtime.lastError.message),void(e.savingFile=!1))})},e.saveFileToIndexDB=function(e,t,n){s.a.callWebGL("emscriptenFSHandler","saveFile",[{filePath:e,fileBlob:t,dataURL:n}])},e.currentFileEntry=null,e.savingFile=!1,e}return r(t,e),c(t,[{key:"waitForIO",value:function(e,t){var n=Date.now(),o=function o(){if(e.readyState===e.WRITING&&Date.now()-n<4e3)return void setTimeout(o,100);e.readyState===e.WRITING?e.abort():t()};setTimeout(o,100)}}]),t}(a.a);t.a=l},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function e(t,n,i){o(this,e),this.message=t||"undefined",this.code=n||0,this.reason=i||""};t.a=i},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=(n(2),n(1)),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=function(){function e(t,n){o(this,e),this.addProfilingUtils(),this.webgl=null,this.$logger=t,this.$window=n,this.listeners={}}return r(e,[{key:"addProfilingUtils",value:function(){window.profileBegin=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];Array.prototype.unshift.call(n,"<A-"+e+"> "),console.log.apply(console,n)},window.profileEnd=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];Array.prototype.unshift.call(n,"<B-"+e+"> "),console.log.apply(console,n)}}}]),r(e,[{key:"initialize",value:function(){var e=this;return new Promise(function(t){e.$logger.debug("[CoreChromeApp] Initialize");var n=function(){e.$window.addEventListener("message",function(t){e.handleMessage.call(e,t)}),e.webgl=e.attachListeners("webgl",function(n){e.sendHelloMessage(n),i.a.setWebGL(n),t()})};"complete"===e.$window.document.readyState?n():e.$window.addEventListener("load",n)})}},{key:"register",value:function(e,t){this.listeners[e]=t,this.webgl.contentWindow.postMessage({type:"register",name:e,methods:t.getPublicFunctions()},"*")}},{key:"remove",value:function(e){delete this.listeners[e]}},{key:"sendHelloMessage",value:function(e){e.contentWindow.postMessage({sender:"hello"},"*"),this.$logger.debug("Sent hello message to "+e.id)}},{key:"attachListeners",value:function(e,t){var n=this,o=document.getElementById(e);return o.addEventListener("dialog",function(t){n.$logger.debug("["+e+"] dialog of type "+t.messageType+" : "+t.messageText),t.dialog.ok("")}),o.addEventListener("consolemessage",function(t){n.$logger.debug("["+e+"] "+t.message)}),o.addEventListener("contentload",function(){n.$logger.debug("Finished loading "+e),t&&t(o)}),o.addEventListener("message",function(t){n.$logger.debug("["+e+"] - EVENT[message] - ",t)}),o}},{key:"handleMessage",value:function(e){this.$window.listeners=this.listeners;try{this.listeners[e.data.target].handle(e.data)}catch(e){this.$logger.error("ChromeApp - handleMessage - No listener registered!",e)}}}]),e}();t.a=a},,function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments[2];o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.runOnApprovedOS=function(e){var t=a,n=e;chrome.runtime.getPlatformInfo(function(e){if(t.isSupportedOS(e.os)||t.inDevelopmentMode())n&&"function"==typeof n&&n();else{console.log("Unsupported OS and not configured for development mode"),document.documentElement.className="unsupported";var o=document.createElement("div");o.id="unsupported",o.appendChild(document.createTextNode(chrome.i18n.getMessage("unsupportedOSMessage")));var i=document.createElement("a");i.appendChild(document.createTextNode(chrome.i18n.getMessage("closeApp"))),i.className="close-button",i.onclick=function(){window.close()},o.appendChild(i),t.parentElementId?document.getElementById(t.parentElementId).appendChild(o):document.body.appendChild(o)}})},a.inDevelopmentMode=function(){return a.allowDevelopmentMode&&!!chrome.runtime.getManifest().developmentMode},a.isSupportedOS=function(e){return-1!==a.approvedList.indexOf(e)},a.approvedList=e,a.allowDevelopmentMode=n,a.parentElementId=r,a}return r(t,e),t}(a.a);t.a=s},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=n(1),c=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.mainElement=function(){return n.splashscreenElement||(n.splashscreenElement=document.getElementById(n.splashscreenTagId)),n.splashscreenElement},n.barElement=function(){return n.loadingBar||(n.loadingBar=document.getElementById(n.loadingBarId)),n.loadingBar},n.hide=function(){console.debug("[CoreSplashScreen] Invoking hide()"),n.mainElement().style.display="none"},n.show=function(){console.debug("[CoreSplashScreen] Invoking show()");var e=n.mainElement().style||{};e.removeProperty?e.removeProperty("display"):e.display="",n.mainElement().style=e},n.unityDoneLoading=function(){console.debug("[CoreSplashScreen] Unity done message"),n.unityProgress=1,n.unityDone=!0,n.updateTotalProgress()},n.updateProgress=function(e){console.debug("[CoreSplashScreen] Updating unity progress",e),n.unityProgress=e,n.updateTotalProgress()},n.updateSyncProgress=function(e){console.debug("[CoreSplashScreen] Updating sync progress",e),n.syncProgress=e,n.updateTotalProgress()},n.updateTotalProgress=function(){var e=(n.unityProgress+n.syncProgress)/2;n.currentProgress=Math.max(n.currentProgress,e),console.log("[CoreSplashScreen] Updating total progress",n.currentProgress);var t=100*n.currentProgress;n.barElement()&&(n.loadingBar.style.width=t+"%"),1===n.syncProgress&&n.unityDone&&(console.log("[CoreSplashScreen] Both sync and unity is ready"),s.a.callUnity(null,"JSFinishedLoading"))},n.onBoundsChanged=function(){},e=e||{},n.splashscreenTagId=e.splashscreenTagId||"splashscreen",n.loadingBarId=e.loadingBarId||"loadingBar",n.imageWidth=e.imageWidth||2048,n.currentProgress=e.initialProgress||.05,chrome.app.window.current().onBoundsChanged.addListener(n.onBoundsChanged.bind(n)),n.onBoundsChanged(),n.unityProgress=0,n.syncProgress=0,n.unityDone=!1,n}return r(t,e),t}(a.a);t.a=c},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=n(1),c=n(23),l=n(5),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();window.GD_RESUMABLE_UPLOAD_SIZE_THRESHOLD=524288;var d=function(e){function t(e,n){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.initializeFileSystem=function(){r.syncMetadata||(profileEnd("SyncRequest","Sync request received"),profileBegin("ReadMetadata","Start reading metadata for syncfs"),r.idbfsReverseFlush().then(function(){return r.readSyncMetadata()}).then(function(e){r._debugLog("Done reading sync metadata"),r.syncMetadata=e,profileEnd("ReadMetadata","Metadata received"),r._completeInitializationStep()}))},r.initGoogleDrive=function(){var e=r;return new Promise(function(t,n){r._debugLog("Initializing Google Drive API");var o=new c.a(r.timestamp);o.initialize(e).then(function(){e.googleDrive=o,t()},function(t){e.googleDrive=o,n(t)})})},r.reauthenticate=function(){r.reauthenticating||(r.reauthenticating=!0,r._debugLog("Reauthenticating with Google Drive"),r.googleDrive.reauthenticate().then(function(){r._debugLog("Successfully reauthenticated with Google Drive"),r.solveStatusReason("manual_unauth"),s.a.callUnity("SyncFS","JSReauthenticateResult",!0)}).catch(function(e){r._debugLog("Failed to reauthenticate with Google Drive"),s.a.callUnity("SyncFS","JSReauthenticateResult",!1)}).then(function(){r.reauthenticating=!1}))},r.requestStatusUpdate=function(){r.sendStatus()},r.solveStatusReason=function(e){var t=r.status.reasons.indexOf(e);-1!=t&&(r.status.reasons[t]=r.status.reasons[r.status.reasons.length-1],r.status.reasons.pop(),0==r.status.reasons.length?("failed_big_sync"==r.status.state&&r.attemptStatusChange("big_sync_recovered"),"offline"==r.status.state&&(r.attemptStatusChange("synchronizing"),r.pushNextChange())):r.sendStatus())},r.pauseFileSync=function(){r.fileSyncIsPaused=!0},r.resumeFileSync=function(){r.fileSyncIsPaused=!1,r.pushNextChange()},r.sendStatus=function(){s.a.callUnity("SyncFS","JSSyncStatusChanged",JSON.stringify(r.status))},r.addIOAction=function(e,t){if("writeFile"!==e&&"deleteFile"!==e)return void r._debugLog("Unrecognized sync action type "+e+"!");var n=r._getFileID(t[0]);if("deleteFile"===e&&(r.removePendingWriteActions(t[0]),!n))return void r._debugLog("Canceling remote delete action for file "+t[0]+" - the file does not exist on Google Drive thus the request would have resulted in 403/404");var o,i=r.syncMetadata.pendingLocalChanges;if("writeFile"===e)for(var a=i.length-1;a>=0;--a)if(a!=r.pushingChangeIdx&&i[a].paths[0]===t[0]){"writeFile"===i[a].type&&(i[a].timestamp=r.timestamp(),o=i[a]);break}return o||(o={type:e,paths:t,timestamp:r.timestamp(),fileId:n},i.push(o),r._debugLog("Added IO action: "+o.type+" "+o.paths[0]+" "+o.paths[1]+" "+o.timestamp,r.syncMetadata.pendingLocalChanges)),r.writeSyncMetadata(r.syncMetadata),-1!=r.pushingChangeIdx||r.fileSyncIsPaused||r.pushNextChange(),r.signalFlushRequired(),r.ensureStateIsFlushed(),o},r.removePendingWriteActions=function(e){var t;-1!=r.pushingChangeIdx&&(t=r.syncMetadata.pendingLocalChanges[r.pushingChangeIdx]),r.syncMetadata.pendingLocalChanges=r.syncMetadata.pendingLocalChanges.filter(function(n){return"writeFile"!==n.type||(n==t||(n.paths[0]!==e||(r._debugLog("Removing pending write action (file deleted): "+n.paths[0]+", "+n.timestamp),!1)))}),t&&(r.pushingChangeIdx=r.syncMetadata.pendingLocalChanges.indexOf(t))},r.saveFile=function(e){if(r._initializationCheck()){e=r.removeIdbfsFromPath(r._normalizePath(e));var t=r.addIOAction("writeFile",[e]);r.updateFileModifiedTime(e,t.timestamp,!0)}},r.updateFileModifiedTime=function(e,t,n){var o=r.syncMetadata.files[e];o||(o={name:e},r.syncMetadata.files[e]=o),o.modifiedTime=t,n&&r.writeSyncMetadata(r.syncMetadata),r._debugLog("Updated modified time of file "+e+" to "+t)},r.createDirectoryTree=function(e){},r.deleteFile=function(e){r._initializationCheck()&&(e=r.removeIdbfsFromPath(r._normalizePath(e)),r._deleteFile(e),r.writeSyncMetadata(r.syncMetadata))},r.copyFile=function(e,t){r._initializationCheck()&&(e=r.removeIdbfsFromPath(r._normalizePath(e)),t=r.removeIdbfsFromPath(r._normalizePath(t)),r._copyFile(e,t,!0))},r.moveFile=function(e,t){r._initializationCheck()&&(e=r.removeIdbfsFromPath(r._normalizePath(e)),t=r.removeIdbfsFromPath(r._normalizePath(t)),r._moveFile(e,t,!0))},r.deleteDirectory=function(e){if(r._initializationCheck()){e=r.removeIdbfsFromPath(r._normalizePath(e))+"/";for(var t=Object.keys(r.syncMetadata.files),n=0;n<t.length;++n){var o=t[n];o.startsWith(e)&&r._deleteFile(o)}r.writeSyncMetadata(r.syncMetadata)}},r.copyDirectory=function(e,t){if(r._initializationCheck()){e=r.removeIdbfsFromPath(r._normalizePath(e))+"/",t=r.removeIdbfsFromPath(r._normalizePath(t))+"/";for(var n=e.length,o=Object.keys(r.syncMetadata.files),i=0;i<o.length;++i){var a=o[i];if(a.startsWith(e)){var s=t+a.substr(n);r._copyFile(a,s,!1)}}r.writeSyncMetadata(r.syncMetadata)}},r.moveDirectory=function(e,t){if(r._initializationCheck()){e=r.removeIdbfsFromPath(r._normalizePath(e))+"/",t=r.removeIdbfsFromPath(r._normalizePath(t))+"/";for(var n=e.length,o=Object.keys(r.syncMetadata.files),i=0;i<o.length;++i){var a=o[i];if(a.startsWith(e)){var s=t+a.substr(n);r._moveFile(a,s,!1)}}r.writeSyncMetadata(r.syncMetadata)}},r._debugLog=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log(Array.from(t).map(function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return e}}))},r._initializationCheck=function(){return!!r.initialized||(r._debugLog("Google Drive API is not initialized yet! Ignoring the call."),!1)},r._normalizePath=function(e){return"string"!=typeof e?e:(e=("/"+e).replace(/[\\\/]+/g,"/"),e=e.replace(/\/$/,""))},r._getFileID=function(e){return r.syncMetadata.files[e]?r.syncMetadata.files[e].id:void 0},r.fetchRemoteFileList=function(){return new Promise(function(e,t){r._debugLog("Fetching remote file list"),r.googleDrive.getFileList("").then(function(t){var n={};t.forEach(function(e){e&&(n[e.name]=e)}),e(n)},function(e){r._debugLog("Failed to fetch remote file list: "+e),t(e)})})},r._deleteFile=function(e){r.addIOAction("deleteFile",[e]),delete r.syncMetadata.files[e]},r._copyFile=function(e,t,n){var o=r.addIOAction("writeFile",[t]);r.updateFileModifiedTime(t,o.timestamp,n)},r._moveFile=function(e,t,n){r.addIOAction("deleteFile",[e]);var o=r.addIOAction("writeFile",[t]);r.syncMetadata.files[t]=r.syncMetadata.files[e],delete r.syncMetadata.files[e],r.syncMetadata.files[t].name=t,delete r.syncMetadata.files[t].id,r.updateFileModifiedTime(t,o.timestamp,n)},r._GD_writeFile=function(e,t,n){return new Promise(function(t,o){r.idbfsReadRawFile(n).then(function(t){var o=r._getFileID(n);return t.byteLength<window.GD_RESUMABLE_UPLOAD_SIZE_THRESHOLD?(window.ENABLE_DEBUG&&r._debugLog("_GD_writeFile :: Uploading file "+n+" ("+t.byteLength+" bytes) as multipart upload"),r.googleDrive.uploadFile(o,n,t,e)):(window.ENABLE_DEBUG&&r._debugLog("_GD_writeFile :: Uploading file "+n+" ("+t.byteLength+" bytes) as resumable upload"),r.googleDrive.uploadFileResumable(o,n,t,e))}).then(function(e){r._debugLog("Uploaded file "+n,e),r.syncMetadata.files[n]=e,r.writeSyncMetadata(r.syncMetadata),t(e)}).catch(function(e){r._debugLog("Failed to upload file "+n,e),o(e)})})},r._GD_deleteFile=function(e,t,n){return new Promise(function(e,o){r._debugLog("Delete GD file: ",n,t),r.googleDrive.deleteFile(t,!0).then(function(o){r._debugLog("Deleted Google Drive file "+n+" ("+t+")",o),e()},function(e){r._debugLog("Failed to delete GD file "+n+" ("+t+")",e),o(e)})})},r._GD_copyFile=function(e,t,n,o){return r._GD_writeFile(e,void 0,o)},r._GD_moveFile=function(e,t,n,o){return r._GD_deleteFile(e,t,n).then(function(){return r._GD_writeFile(e,void 0,o)}).then(function(e){resolve(e)}).catch(function(e){reject(e)})},r.pushNextChange=function(e){function t(){n._debugLog("Pushing change: "+o.paths[0],o),n.ioActionImpl[o.type].apply(this,[o.timestamp,o.fileId].concat(o.paths)).then(function(e){n.syncMetadata.pendingLocalChanges.shift(),n.writeSyncMetadata(n.syncMetadata),n.finishPushingChange(n.pushingChangeIdx)},function(e){n.abortPushingChanges(e)})}if(-1==r.pushingChangeIdx&&!r.syncInProgress&&r.attemptStatusChange("synchronizing")){if(0===r.syncMetadata.pendingLocalChanges.length)return void r.attemptStatusChange("synced");var n=r;n.pushingChangeIdx=e||0;var o=n.syncMetadata.pendingLocalChanges[n.pushingChangeIdx];n.ensureStateIsFlushed().then(t)}},r.finishPushingChange=function(e){r.pushingChangeIdx=-1,e<r.syncMetadata.pendingLocalChanges.length?r.pushNextChange(e):r.idbfsFlushChanges().then(function(){r.attemptStatusChange("synced")})},r.performBigSync=function(){if(r._debugLog("performBigSync()"),profileBegin("BigSync","Big sync request received, starting"),r._initializationCheck()){if(r.syncInProgress)return void r._debugLog("performBigSync(): sync is already in progress, ignoring...");if(!r.attemptStatusChange("doing_big_sync"))return void r.failBigSync(new l.a("transition_impossible"));r.syncInProgress=!0,r.updateBigSyncSyncProgress(0);var e={};e.localFiles=JSON.parse(JSON.stringify(r.syncMetadata.files)),e.localDeleteList=r.computeLocalDeleteList(r.syncMetadata.pendingLocalChanges),r._debugLog("Local delete list:",e.localDeleteList),profileBegin("BS_Flush","Flush to ensure correct state"),r.idbfsFlushChanges().then(function(){return profileEnd("BS_Flush","End flush"),s.a.callUnity("SyncFS","JSMetadataStepComplete"),profileBegin("BS_RemoteList","Get remote file list"),r.fetchRemoteFileList()}).then(function(t){return profileEnd("BS_RemoteList","End remote list"),profileBegin("BS_RemoteChanges","Get remote changes since last sync"),r.updateBigSyncSyncProgress(10),e.remoteFiles=t,r._debugLog("Remote file list fetched, fetching remote changes"),r.fetchRemoteChangesSinceLastSync()}).then(function(t){profileEnd("BS_RemoteChanges","End remote changes"),profileBegin("BS_Changes","Write metadata and compute changes"),r.updateBigSyncSyncProgress(20),r._debugLog("Remote changes response:",t),r.syncMetadata.lastStartPageToken=t.newStartPageToken,r.writeSyncMetadata(r.syncMetadata),e.remoteDeleteList=r.computeRemoteDeleteList(t.changes),r._debugLog("Remote delete list:",e.remoteDeleteList)}).then(function(){r._debugLog("Calculating differences between remote FS and local FS"),e.remoteToLocalOps=r.mergeFileSystems(e.remoteFiles,e.remoteDeleteList,e.localFiles,e.localDeleteList,!0),r._debugLog("Calculating differences between local FS and remote FS"),e.localToRemoteOps=r.mergeFileSystems(e.localFiles,e.localDeleteList,e.remoteFiles,e.remoteDeleteList,!1);var t=e.remoteToLocalOps.length+e.localToRemoteOps.length,n=0;e.completeSyncMergeOperation=function(){++n,r.updateBigSyncSyncProgress(20+Math.round(70*n/t))}}).then(function(){return profileEnd("BS_Changes","End computing changes"),profileBegin("BS_MergeAndMeta","Start merging, writing metadata and flush"),r._debugLog("Merging remote FS changes into local FS"),Promise.all(e.remoteToLocalOps.map(function(t){return t.func.apply(r,t.params).then(function(){e.completeSyncMergeOperation()})})).catch(function(e){r._debugLog("Merging remote FS changes into local FS FAILED!! -- "+JSON.stringify(e))})}).then(function(){return r._debugLog("Merging local FS changes into remote FS"),Promise.all(e.localToRemoteOps.map(function(t){return t.func.apply(r,t.params).then(function(){e.completeSyncMergeOperation()})})).catch(function(e){r._debugLog("Merging local FS changes into remote FS FAILED!! -- "+JSON.stringify(e))})}).catch(function(e){throw r._debugLog("Sync failed",e),r.failBigSync(e,!0),new l.a("skip_writing_metadata")}).then(function(){return r.syncMetadata.files=e.remoteFiles,r.syncMetadata.pendingLocalChanges=[],r.writeSyncMetadata(r.syncMetadata),r.idbfsFlushChanges()}).then(function(){profileEnd("BS_MergeAndMeta","End writing metadata and flush"),r.finishBigSync()}).catch(function(e){if("skip_writing_metadata"!=e.message)throw r._debugLog("Failed to write metadata:",e),"Sync succeded, but something failed while writing metadata."})}},r.failBigSync=function(e,t){var n=r,o=function(){n._debugLog("Big sync failed! - "+JSON.stringify(e)),n.syncInProgress=!1,"transition_impossible"!=e.message&&("The user did not approve access."==e.message?n.attemptStatusChange("failed_big_sync",["manual_unauth"]):void 0==n.googleDrive.access_token?n.attemptStatusChange("big_sync_recovered"):n.attemptStatusChange("failed_big_sync",["gdrive_offline"])),n.updateBigSyncSyncProgress(100)};t?r.idbfsReverseFlush().then(o):o()},r.finishBigSync=function(){profileEnd("BigSync","Successfully completed big sync"),r._debugLog("Finished big sync!"),r.syncInProgress=!1,r.updateBigSyncSyncProgress(100),s.a.callWebGL("SyncFS_IDB","startTrackingFileChanges",[]),r.attemptStatusChange("synchronizing"),r.pushNextChange()},r.updateBigSyncSyncProgress=function(e){0===e&&s.a.callUnity("SyncFS","JSBigSyncStarted"),s.a.callUnity("SyncFS","JSBigSyncProgress",e),100===e&&s.a.callUnity("SyncFS","JSBigSyncFinished"),r.$splashscreen&&r.$splashscreen.updateSyncProgress(e/100)},r.signalFlushRequired=function(){r.needsFlushing=!0,r.internalNeedsFlushing=!0},r.ensureStateIsFlushed=function(){var e=r;if(!e.internalNeedsFlushing)return Promise.resolve();e.flushPromises=e.flushPromises?e.flushPromises:[];var t=new Promise(function(t,n){e.flushPromises.push({resolve:t,reject:n})});return void 0==e.masterFlushPromise&&(e.masterFlushPromise=new Promise(function(t,n){function o(){e.needsFlushing=!1,e.idbfsFlushChanges().then(function(){e.needsFlushing?window.setTimeout(o,50):(e.internalNeedsFlushing=!1,t())})}o()})),e.masterFlushPromise.then(function(){for(var t=e.flushPromises.length,n=t-1;n>=0;n--)e.flushPromises[n].resolve();e.flushPromises=[],e.masterFlushPromise=void 0}),t},r.idbfsGetPromiseToken=function(e,t){var n=r.idbToken++;return r.idbPromises[n]={resolve:e,reject:t},n},r.idbfsResolvePromise=function(e,t){r.idbPromises[e].resolve(t),delete r.idbPromises[e]},r.idbfsRejectPromise=function(e,t){r.idbPromises[e].reject(t),delete r.idbPromises[e]},r.idbfsCreateDirectory=function(e){var t="/idbfs"+e;s.a.callWebGL("SyncFS_IDB","createDirectory",[t])},r.idbfsReadRawFile=function(e){return new Promise(function(t,n){var o=r.idbfsGetPromiseToken(t,n);s.a.callWebGL("SyncFS_IDB","readRawFile",["/idbfs"+e,o])})},r.idbfsReadTextFile=function(e){return new Promise(function(t,n){var o=r.idbfsGetPromiseToken(t,n);s.a.callWebGL("SyncFS_IDB","readTextFile",["/idbfs"+e,o])})},r.idbfsWriteRawFile=function(e,t){return new Promise(function(n,o){var i=r.idbfsGetPromiseToken(n,o);s.a.callWebGL("SyncFS_IDB","writeRawFile",["/idbfs"+e,t,i])})},r.idbfsWriteTextFile=function(e,t){return new Promise(function(n,o){var i=r.idbfsGetPromiseToken(n,o);s.a.callWebGL("SyncFS_IDB","writeTextFile",["/idbfs"+e,t,i])})},r.idbfsRemoveFile=function(e){return new Promise(function(t,n){s.a.callWebGL("SyncFS_IDB","removeFile",["/idbfs"+e]),t()})},r.idbfsFlushChanges=function(){return new Promise(function(e,t){var n=r.idbfsGetPromiseToken(e,t);s.a.callWebGL("SyncFS_IDB","flushChanges",[n])})},r.IDB_OnWriteComplete=function(e,t){r.idbfsResolvePromise(t)},r.IDB_OnReadComplete=function(e,t,n){t?r.idbfsResolvePromise(n,t):r.idbfsRejectPromise(n,new l.a("Failed to read file "+e))},r.IDB_OnFileRemoved=function(e){},r.IDB_OnDirectoryCreated=function(e){},r.IDB_OnDirectoryRemoved=function(e){},r.IDB_OnTrackedFileModified=function(e){r.saveFile(e)},r.IDB_OnChangesFlushed=function(e){r.idbfsResolvePromise(e)},r.readSyncMetadata=function(){return new Promise(function(e,t){r.idbfsReadTextFile(r.syncMetadataPath).then(function(t){var n=JSON.parse(t);e(n)}).catch(function(t){console.warn("Failed to read sync metadata - doesn't exist or is unreadable. Assuming empty metadata.",t),e({lastStartPageToken:"",pendingLocalChanges:[],files:{}})})})},r.writeSyncMetadata=function(e){var t=JSON.stringify(e);return r.idbfsWriteTextFile(r.syncMetadataPath,t)},r.timestamp=function(){return function(e){function t(e){return e<10?"0"+e:e}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"Z"}(new Date)},r.fetchRemoteChangesSinceLastSync=function(){return r.syncMetadata.lastStartPageToken.length>0?r.googleDrive.getChangeList(r.syncMetadata.lastStartPageToken):r.googleDrive.getChangeStartPageToken().then(function(e){return Promise.resolve({changes:[],newStartPageToken:e.startPageToken})})},r.computeLocalDeleteList=function(e){var t=[];return e.forEach(function(e){"deleteFile"===e.type&&e.fileId&&t.push(e.fileId)}),t},r.computeRemoteDeleteList=function(e){var t=[];return e.forEach(function(e){e.removed&&t.push(e.fileId)}),t},r.mergeFileSystems=function(e,t,n,o,i){var a=Object.keys(e),s=Object.keys(n),c=[],l=[];return a.forEach(function(t){var a,u=e[t];if(s.includes(t)){var d=n[t],f=Date.parse(u.modifiedTime),g=Date.parse(d.modifiedTime);f!==g&&(f>g?(a={func:r.copyFileToFilesystem,params:[u,i,i?u.id:d.id]},d.modifiedTime=u.modifiedTime):(a={func:r.copyFileToFilesystem,params:[u,!i,i?u.id:d.id]},u.modifiedTime=d.modifiedTime))}else o.includes(u.id)?(a={func:r.deleteFileFromFilesystem,params:[u,i]},l.push(t)):(a={func:r.copyFileToFilesystem,params:[u,i]},n[t]=u);a&&c.push(a)}),l.forEach(function(t){delete e[t]}),c},r.copyFileToFilesystem=function(e,t,n){return t?(r._debugLog("copyFileToFilesystem: downloading "+e.name),r.googleDrive.downloadFile(e.id,e.name).then(function(t){return r.idbfsWriteRawFile(e.name,t)}).then(function(){"/.ChromePlayerPrefs"===e.name&&s.a.callUnity("SyncFS","JSReloadPlayerPrefs")})):(r._debugLog("copyFileToFilesystem: uploading "+e.name+" (remote file ID: "+n+")"),r.idbfsReadRawFile(e.name).then(function(o){return o.byteLength<window.GD_RESUMABLE_UPLOAD_SIZE_THRESHOLD?(window.ENABLE_DEBUG&&r._debugLog("copyFileToFilesystem :: copyFileToFilesystem - download: '"+t+"' - "+e.name+" ("+o.byteLength+" bytes) as multipart upload"),r.googleDrive.uploadFile(n,e.name,o,e.modifiedTime)):(window.ENABLE_DEBUG&&r._debugLog("copyFileToFilesystem :: copyFileToFilesystem - download: '"+t+"' - "+e.name+" ("+o.byteLength+" bytes) as resumable upload"),r.googleDrive.uploadFileResumable(n,e.name,o,e.modifiedTime))}))},r.deleteFileFromFilesystem=function(e,t){return t?(r._debugLog("deleteFileFromFilesystem: deleting remote file "+e.name),r.googleDrive.deleteFile(e.id,!1)):(r._debugLog("deleteFileFromFilesystem: deleting local file "+e.name),r.idbfsRemoveFile(e.name))},r.$logger=e,r.$splashscreen=n,r._setup(),r}return r(t,e),u(t,[{key:"_setup",value:function(){var e=this;profileBegin("SyncFSInit","Call _setup on SyncFS");var t=this;this.status={state:"uninitialized",reasons:[]},this.initialized=!1,this.fileSyncIsPaused=!1,this.syncInProgress=!1,this.isOnline=navigator.onLine,this.needsFlushing=!0,this.masterFlushPromise=void 0,this.pushingChangeIdx=-1,this.syncMetadataPath="/.SyncMetadata",this.syncMetadata=void 0,this.googleDrive=void 0,this.ioActionImpl={writeFile:this._GD_writeFile,deleteFile:this._GD_deleteFile};var n=function(e){t._updateOnlineStatus()};window.addEventListener("online",n),window.addEventListener("offline",n),profileBegin("GoogleAuth","start Google authentication"),this.initGoogleDrive().then(function(){e._debugLog("Google Drive API initialized"),profileEnd("GoogleAuth","Google authentication complete"),e._completeInitializationStep()}).catch(function(t){console.error("Failed to initialize Google Drive API: "+t),profileEnd("GoogleAuth","Google authentication failed"),e._completeInitializationStep()}),this.idbToken=0,this.idbPromises={}}},{key:"_completeInitializationStep",value:function(){if(!this.syncMetadata||!this.googleDrive)return void this._debugLog("_completeInitializationStep - Not yet fully complete [this.syncMetadata: "+(this.syncMetadata?"Complete":"N/A")+" , this.googleDrive: "+(this.googleDrive?"Complete":"N/A")+"]");if(!this.initialized)if(this.initialized=!0,profileEnd("SyncFSInit","SyncFS initialization fully complete"),this.googleDrive.access_token)s.a.callUnity("SyncFS","JSInitializationResult",""),this.performBigSync();else{var e="failed_big_sync",t=[];this.isOnline||t.push("local_offline"),this.googleDrive.hasUserDeclinedAuth?t.push("manual_unauth"):void 0==this.googleDrive.access_token&&0==t.length?e="big_sync_recovered":0==t.length&&console.error("Failure condition was not handled during auth"),this.attemptStatusChange(e,t),s.a.callUnity("SyncFS","JSInitializationResult","Error authenticating with google."),this.updateBigSyncSyncProgress(100)}}},{key:"attemptStatusChange",value:function(e,t){t=t||[];var n=this.status.state;if(n==e){for(var o=!1,i=t.length-1;i>=0;i--){-1==this.status.reasons.indexOf(t[i])&&(o=!0,this.status.reasons.push(t[i]))}return o&&this.sendStatus(),!0}if(this.status.reasons.length>0)return!1;0==t.length&&"failed_big_sync"==e&&(e="big_sync_recovered");var r=!1;switch(e){case"uninitialized":break;case"synced":"synchronizing"==n&&(r=!0);break;case"synchronizing":"synced"!=n&&"offline"!=n&&"doing_big_sync"!=n||(r=!0);break;case"offline":"synced"!=n&&"synchronizing"!=n||(r=!0);break;case"doing_big_sync":"uninitialized"!=n&&"big_sync_recovered"!=n||(r=!0);break;case"failed_big_sync":"doing_big_sync"!=n&&"uninitialized"!=n&&"big_sync_recovered"!=n||(r=!0);break;case"big_sync_recovered":"failed_big_sync"!=n&&"uninitialized"!=n&&"doing_big_sync"!=n||(r=!0)}return 0!=r&&(this.status.state=e,this.status.reasons=t,this.sendStatus(),window.ENABLE_DEBUG&&this._debugLog("attemptStatusChange - newState: '"+e+"' - reasons: "+JSON.stringify(t)),!0)}},{key:"errorStateForStatus",value:function(e){return"doing_big_sync"==e||"failed_big_sync"==e||"uninitialized"==e||"big_sync_recovered"==e?"failed_big_sync":"offline"}},{key:"_updateOnlineStatus",value:function(){console.log("CHANGE ONLINE STATUS",navigator.onLine),this.isOnline=navigator.onLine,this.isOnline?this.solveStatusReason("local_offline"):this.attemptStatusChange(this.errorStateForStatus(this.status.state),["local_offline"])}},{key:"abortPushingChanges",value:function(e){this.pushingChangeIdx=-1,console.log("abortPushingChanges: "+e.message),"The user did not approve access."==e.message?this.attemptStatusChange("offline",["manual_unauth"]):this.attemptStatusChange("offline",["gdrive_offline"])}},{key:"removeIdbfsFromPath",value:function(e){return e.replace(/^\/idbfs/,"")}},{key:"idbfsReverseFlush",value:function(){var e=this;return new Promise(function(t,n){var o=e.idbfsGetPromiseToken(t,n);s.a.callWebGL("SyncFS_IDB","reverseFlush",[o])})}}]),t}(a.a);t.a=d},,,,,function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=n(1),c=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.initAudio=function(t){e.audioBufferSize=t,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,window.AudioContext=window.AudioContext||window.webkitAudioContext,e.audioContext=new AudioContext},e.enableDisableAudio=function(t){e.enabled="True"===t,e.enabled?navigator.getUserMedia({audio:!0},function(t){e.audioStream=t,e.setupVolumeListening(),e.audioIntervalID=setInterval(function(){e.getVolume()},1e3)},function(e){console.log("The following error occured: "+e)}):(e.teardownAudioRecording(),e.teardownVolumeListening(),e.audioStream&&(e.audioStream.stop(),e.audioStream=null),clearInterval(e.audioIntervalID))},e.startRecording=function(){e.isListening=!1,e.teardownVolumeListening(),e.setupAudioRecording(),e.audioRecordRTC?e.audioRecordRTC.startRecording():console.info("startRecording - No audioRecordRTC instance - Skipping startRecording call")},e.stopRecording=function(t){e.isAudioRecording&&e.enabled&&(e.audioRecordRTC?e.audioRecordRTC.stopRecording(function(){e.handleAudio(e.audioRecordRTC.toURL())}):console.info("stopRecording - No audioRecordRTC instance - Skipping stopRecording call"));var n=t;e.isListening!=n&&e.enabled&&(n?e.setupVolumeListening():e.teardownVolumeListening()),e.isListening=n},e.handleAudio=function(t){if(e.audioRecordRTC){var n="uniwebview://AudioRecorded?AudioDataURL="+t;s.a.callUnity(null,"OnRecieveMessageFromChromeOS",n)}else console.debug("Audio :: handleAudio - this.audioRecordRTC is null or undefined");e.teardownAudioRecording()},e.setupAudioRecording=function(){e.audioRecordRTC=new RecordRTC(e.audioStream,{recorderType:StereoAudioRecorder,type:"audio",numberOfAudioChannels:1,mimeType:"audio/wav",bufferSize:0,disableLogs:!1}),e.audioRecordRTC.onStateChanged.call=function(t){console.log("Audio :: Audio Recorder state changed: ",t),e.isAudioRecording="recording"===t.state}},e.teardownAudioRecording=function(){e.audioRecordRTC=null},e.setupVolumeListening=function(){e.audioStream&&(e.audioWorker.onmessage=function(t){switch(t.data.command){case"volume":e.sendVolume(t.data.volume);break;default:console.log("AudioController Unknow message")}},e.recorder=e.audioContext.createScriptProcessor(e.audioBufferSize,1,1),e.recorder.onaudioprocess=function(t){if(e.isListening&&e.enabled){var n=t.inputBuffer.getChannelData(0);e.audioWorker.postMessage({command:"record",buffer:[n]})}},e.inputPoint=e.audioContext.createGain(),e.inputPoint.gain.setTargetAtTime(1,e.audioContext.currentTime,.015),e.realAudioInput=e.audioContext.createMediaStreamSource(e.audioStream),e.realAudioInput.connect(e.inputPoint),e.zeroGain=e.audioContext.createGain(),e.zeroGain.gain.setTargetAtTime(0,e.audioContext.currentTime,.015),e.inputPoint.connect(e.zeroGain),e.zeroGain.connect(e.audioContext.destination),e.inputPoint.connect(e.recorder),e.recorder.connect(e.audioContext.destination))},e.teardownVolumeListening=function(){e.recorder&&(e.recorder.onaudioprocess=null,e.recorder=null),e.realAudioInput&&(e.realAudioInput.disconnect(),e.realAudioInput=null),e.inputPoint&&(e.inputPoint.disconnect(),e.inputPoint=null),e.zeroGain&&(e.zeroGain.disconnect(),e.zeroGain=null)},e.getVolume=function(){e.isListening&&e.audioWorker.postMessage({command:"getVolume"})},e.sendVolume=function(e){var t="uniwebview://AudioVolume?AudioVolumeValue="+e;s.a.callUnity(null,"OnRecieveMessageFromChromeOS",t)},e.audioContext=null,e.recorder=null,e.isAudioRecording=!1,e.isListening=!1,e.enabled=!1,e.audioBufferSize=0,e.audioWorker=new Worker("js/audioWorker.js"),e.audioWorker.postMessage({command:"init",config:{}}),e.audioRecordRTC=null,e.audioStream=null,e.recorder=null,e.inputPoint=null,e.realAudioInput=null,e.zeroGain=null,e.audioIntervalID=-1,e}return r(t,e),t}(a.a);t.a=c},function(e,t,n){"use strict";function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){return e&&null!==e?{MajorVersion:e.majorVersion,MinorVersion:e.minorVersion,BugFixVersion:e.bugFixVersion,BuildNumber:e.buildNumber}:{MajorVersion:"N/A",MinorVersion:"N/A",BugFixVersion:"N/A",BuildNumber:"N/A"}}function s(e){var t=a(e);return t.MajorVersion+"."+t.MinorVersion+"."+t.BugFixVersion+"."+t.BuildNumber}function c(e){return e&&null!==e?{FirmwareRevision:s(e.firmwareRevision),HardwareRevision:s(e.hardwareRevision),SoftwareRevision:s(e.softwareRevision),ManufacturerName:e.manufacturerName&&null!==e.manufacturerName?e.manufacturerName:"N/A"}:{FirmwareRevision:s(),HardwareRevision:s(),SoftwareRevision:s(),ManufacturerName:"N/A"}}function l(e){return e&&null!==e?{DeviceID:e.deviceId,DeviceName:e.deviceName,ButtonState:e.isButtonPressed,BatteryLevel:e.batteryLevel,LowVoltageState:e.isLowVoltage,DeviceInfo:c(e.deviceInfo),ConnectedState:e.connectState-1,Category:e.category,SupportedFunctions:e.supportedFunctions,LastConnectedNetworkId:e.lastConnectedNetworkId}:{DeviceID:"N/A"}}function u(e){return e&&null!==e?{Revision:e.revision,ConnectID:e.connectId,TypeID:e.typeId,Mode:e.mode,DeltaInterval:e.deltaInterval,Unit:e.unit,NotificationsEnabled:e.notificationsEnabled}:{}}function d(e){return e&&null!==e?{ConnectID:e.connectId,HubIndex:e.hubIndex,Type:e.type,HardwareRevision:s(e.hardwareVersion),SoftwareRevision:s(),FirmwareRevision:s(e.firmwareVersion)}:{}}function f(e,t){if(!e||null===e)return console.warn("WRAPPER :: getSimpleServiceData legoService is not defined or null"),{};var n={};switch(t){case y.IOType.IO_TYPE_MOTOR:n.Power=e.power;break;case y.IOType.IO_TYPE_VOLTAGE:n.MilliVolts=e.valueAsMilliVolts;break;case y.IOType.IO_TYPE_CURRENT:n.MilliAmp=e.valueAsMilliAmps;break;case y.IOType.IO_TYPE_PIEZO_TONE_PLAYER:break;case y.IOType.IO_TYPE_RGB_LIGHT:n.RGBLightMode=e.rgbMode;var o=e.color;n.Color={R:o.getRed(),G:o.getGreen(),B:o.getBlue(),A:1};var i=e.defaultColor;n.DefaultColor={R:i.getRed(),G:i.getGreen(),B:i.getBlue(),A:1},n.ColorIndex=e.colorIndex,n.DefaultColorIndex=e.defaultColorIndex;break;case y.IOType.IO_TYPE_TILT_SENSOR:n.Angle=p(e.angle),n.Crash=h(e.crash),n.TiltSensorDirection=e.direction,n.TiltSensorMode=e.tiltSensorMode;break;case y.IOType.IO_TYPE_MOTION_SENSOR:n.Count=e.count,n.Distance=e.distance,n.MotionSensorMode=e.motionSensorMode;break;case y.IOType.IO_TYPE_GENERIC:}return n}function g(e){return e&&null!==e?{DeviceID:e.deviceId,IsInternalService:e.isInternalService,ServiceName:e.serviceName,DefaultInputFormat:u(e.defaultInputFormat),InputFormat:u(e.inputFormat),ConnectInfo:d(e.connectInfo),ServiceData:f(e.serviceData,e.connectInfo.type)}:{}}function p(e){return e&&null!==e?{X:e.x,Y:e.y}:{}}function h(e){return e&&null!==e?{X:e.x,Y:e.y,Z:e.z}:{}}var v=n(0),m=n(1),y=n(29),b=(n.n(y),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),w=null,S=null;window&&(window.LDSDKLogger=y.LDSDKLogger,window.LDM=S);var R=function(){function e(){return r(this,e),w||(w=this),w}return b(e,null,[{key:"getInstance",value:function(){return w||(w=new e),w}},{key:"sendMessage",value:function(e,t){m.a.callWebGL("bluetoothHandler","sendData",[{method:e,data:JSON.stringify(t)}])}}]),e}(),P=function(){function e(t){r(this,e),this.bluetooth=t,this.deviceListeners=new Map,this.deviceToListenerId=new Map}return b(e,[{key:"checkAndRegisterDeviceCallback",value:function(e){if(!this.deviceListeners.has(e)){var t=new D;this.deviceListeners.set(e,t);var n=S.registerDeviceCallbackListener(e,t);this.deviceToListenerId.set(e,n),y.LDSDKLogger.info("WRAPPER :: checkAndRegisterDeviceCallback - registered Device callback listener for "+e+" - with listenerId: "+n)}}},{key:"onDeviceAppeared",value:function(e){y.LDSDKLogger.info("WRAPPER :: onDeviceAppeared("+e.deviceName+" ["+e.deviceId+"]"),this.checkAndRegisterDeviceCallback(e.deviceId);var t=l(e);this.bluetooth.addDevice(e)&&R.sendMessage("OnDeviceAppeared",t)}},{key:"onDeviceDisappeared",value:function(e){y.LDSDKLogger.info("WRAPPER :: onDeviceDisappeared("+e.deviceName+" ["+e.deviceId+"]"),this.checkAndRegisterDeviceCallback(e.deviceId);var t=l(e);1!==t.ConnectedState&&(y.LDSDKLogger.isDebugEnabled()&&y.LDSDKLogger.debug("WRAPPER :: onDeviceDisappeared - Update connectedState to disconnected not advertising when the device has disappeared"),t.ConnectedState=1),R.sendMessage("OnDeviceDisappeared",t),this.bluetooth.removeDevice(e)}},{key:"onWillStartConnectingToDevice",value:function(e){y.LDSDKLogger.info("WRAPPER :: onWillStartConnectingToDevice("+e.deviceName+" ["+e.deviceId+"]"),this.checkAndRegisterDeviceCallback(e.deviceId);var t=l(e);R.sendMessage("OnWillStartConnectingToDevice",t)}},{key:"onDidStartInterrogatingDevice",value:function(e){y.LDSDKLogger.info("WRAPPER :: onDidStartInterrogatingDevice("+e.deviceName+" ["+e.deviceId+"]"),this.checkAndRegisterDeviceCallback(e.deviceId),backgroundPage&&backgroundPage.addDeviceAddress(e.deviceId);var t=l(e);R.sendMessage("OnDidStartInterrogatingDevice",t)}},{key:"onDidFinishInterrogatingDevice",value:function(e){y.LDSDKLogger.info("WRAPPER :: onDidFinishInterrogatingDevice("+e.deviceName+" ["+e.deviceId+"]"),this.checkAndRegisterDeviceCallback(e.deviceId);var t=l(e);S.scan(),R.sendMessage("OnDidFinishInterrogatingDevice",t)}},{key:"onDidDisconnectFromDevice",value:function(e){y.LDSDKLogger.info("WRAPPER :: onDidDisconnectFromDevice("+e.deviceName+" ["+e.deviceId+"]"),this.checkAndRegisterDeviceCallback(e.deviceId);var t=l(e);backgroundPage&&backgroundPage.removeDeviceAddress(e.deviceId),R.sendMessage("OnDidDisconnectFromDevice",t)}},{key:"onDidFailToConnectToDevice",value:function(e){y.LDSDKLogger.info("WRAPPER :: onDidFailToConnectToDevice("+e.deviceName+" ["+e.deviceId+"]"),this.checkAndRegisterDeviceCallback(e.deviceId);var t=l(e);S.scan(),backgroundPage&&backgroundPage.removeDeviceAddress(e.deviceId),R.sendMessage("OnDidFailToConnectToDevice",t)}}]),e}(),D=function(){function e(){r(this,e),this.serviceCallbackListener=new C,this.services=new Map,this.serviceListeners=new Map}return b(e,[{key:"didUpdateDeviceInfo",value:function(e,t,n){y.LDSDKLogger.isTraceEnabled()&&y.LDSDKLogger.trace("WRAPPER :: Bluetooth.js didUpdateDeviceInfo(device: ",e,", deviceInfo:",t,", error:",n,")");var o=l(e);o.DeviceInfo=c(t),R.sendMessage("DidUpdateDeviceInfo",o)}},{key:"didChangeButtonState",value:function(e,t){y.LDSDKLogger.isTraceEnabled()&&y.LDSDKLogger.trace("WRAPPER :: Bluetooth.js didChangeButtonState(device: ",e,", buttonPressed:",t);var n=l(e);R.sendMessage("DidChangeButtonState",n)}},{key:"didUpdateLowVoltageState",value:function(e,t){y.LDSDKLogger.isTraceEnabled()&&y.LDSDKLogger.trace("WRAPPER :: Bluetooth.js didUpdateLowVoltageState(device: ",e,", lowVoltage:",t);var n=l(e);R.sendMessage("DidUpdateLowVoltageState",n)}},{key:"didUpdateBatteryLevel",value:function(e,t){y.LDSDKLogger.isTraceEnabled()&&y.LDSDKLogger.trace("WRAPPER :: Bluetooth.js didUpdateBatteryLevel(device: ",e,", batteryLevel:",t);var n=l(e);R.sendMessage("DidUpdateBatteryLevel",n)}},{key:"didChangeNameFrom",value:function(e,t,n){y.LDSDKLogger.isTraceEnabled()&&y.LDSDKLogger.trace("WRAPPER :: Bluetooth.js didChangeNameFrom(device: ",e,", oldName:",t,"newName:",n);var o=l(e);R.sendMessage("DidChangeNameFrom",o)}},{key:"didFailToAddServiceWithError",value:function(e,t){var n=l(e);R.sendMessage("DidFailToAddServiceWithError",n)}},{key:"didRemoveService",value:function(e,t){y.LDSDKLogger.isTraceEnabled()&&y.LDSDKLogger.trace("WRAPPER :: Bluetooth.js didRemoveService(device: ",e,", legoService:",t);var n=t.connectInfo.connectId,o=g(t);null!==e&&e||y.LDSDKLogger.error("WRAPPER :: didRemoveService device is null"),o.DeviceID=e.deviceId,o.ConnectID=n;var i=this.serviceListeners.get(n);S.unregisterServiceCallbackListener(e.deviceId,n,i),this.serviceListeners.delete(n),R.sendMessage("DidRemoveService",o)}},{key:"didAddService",value:function(e,t){null!==e&&e||y.LDSDKLogger.error("WRAPPER :: didAddService device is null");var n=t.connectInfo.connectId;if(this.services.has(n)&&this.serviceListeners.has(n)){var o=this.serviceListeners.get(n);S.unregisterServiceCallbackListener(e.deviceId,n,o),this.serviceListeners.delete(n),this.services.delete(n)}this.services.set(n,t);var i=g(t);i.DeviceID=e.deviceId,y.LDSDKLogger.isInfoEnabled()&&y.LDSDKLogger.info("WRAPPER :: Bluetooth.js didAddService(device: "+e.deviceName+" ["+e.deviceId+"], legoService:"+t.serviceName+", connectInfo: "+t.connectInfo);var r=S.registerServiceCallbackListener(e.deviceId,n,this.serviceCallbackListener);this.serviceListeners.set(n,r),R.sendMessage("DidAddService",i)}}]),e}(),C=function(){function e(){r(this,e)}return b(e,[{key:"didUpdateInputFormat",value:function(e,t,n){var o=g(e);o.OldInputFormat=u(t),o.NewInputFormat=u(n),R.sendMessage("DidUpdateInputFormat",o)}},{key:"didUpdateValueData",value:function(e,t,n){var o=g(e);o.NewValue=e.numberValue,R.sendMessage("DidUpdateValueData",o)}},{key:"didUpdateDistance",value:function(e,t,n){var o=g(e);o.OldDistance=t,o.NewDistance=n,R.sendMessage("DidUpdateDistance",o)}},{key:"didUpdateCount",value:function(e,t){var n=g(e);n.Count=t,R.sendMessage("DidUpdateCount",n)}},{key:"didReadInitialColor",value:function(e){var t=g(e);R.sendMessage("DidReadInitialColor",t)}},{key:"didUpdateRGBValue",value:function(e,t,n){var o=g(e);o.OldColor=t,o.NewColor=n,R.sendMessage("DidUpdateRGBValue",o)}},{key:"didUpdateRGBColorIndex",value:function(e,t,n){var o=g(e);o.OldColorIndex=t,o.NewColorIndex=n,R.sendMessage("DidUpdateRGBColorIndex",o)}},{key:"didUpdateDirection",value:function(e,t,n){var o=g(e);o.OldDirection=t,o.NewDirection=n,R.sendMessage("DidUpdateDirection",o)}},{key:"didUpdateAngle",value:function(e,t,n){var o=g(e);o.OldAngle=t,o.NewAngle=n,R.sendMessage("DidUpdateAngle",o)}},{key:"didUpdateCrash",value:function(e,t,n){var o=g(e);o.OldCrash=t,o.NewCrash=n,R.sendMessage("DidUpdateCrash",o)}},{key:"didUpdateMilliVolts",value:function(e,t){var n=g(e);n.MilliVolts=t,R.sendMessage("DidUpdateMilliVolts",n)}},{key:"didUpdateMilliAmps",value:function(e,t){var n=g(e);n.MilliAmp=t,R.sendMessage("DidUpdateMilliAmps",n)}}]),e}(),F=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.addDevice=function(e){n.checkAndRegisterScanListener();for(var t=!1,o=0;o<n.devices.length;o++)n.devices[o].deviceId===e.deviceId&&(t=!0);return!t&&(n.devices.push(e),!0)},n.removeDevice=function(e){n.checkAndRegisterScanListener();for(var t=-1,o=0;o<n.devices.length;o++)n.devices[o].deviceId===e.deviceId&&(t=o);t>=0&&n.devices.splice(t,1)},n.scan=function(){return n.checkAndRegisterScanListener(),new Promise(function(e,t){n.$logger.log("WRAPPER :: Bluetooth.scan"),S.scan().then(function(){return n.$logger.log("WRAPPER :: Scan started"),e()}).catch(function(t){return n.$logger.error("WRAPPER :: Failed scanning: ",t),e()})})},n.stopScanning=function(){return n.checkAndRegisterScanListener(),new Promise(function(e,t){n.$logger.log("WRAPPER :: Bluetooth.stopScanning"),S.stopScanning().catch(function(e){n.$logger.error("WRAPPER :: Failed stopScanning: ",e)}).then(function(){return n.$logger.log("WRAPPER :: Resolving stopScanning"),e()})})},n.connectToDevice=function(e){n.checkAndRegisterScanListener(),n.$logger.log("WRAPPER :: Bluetooth.connectToDevice -- bleManager.allDevices().length "+S.allDevices().length()),n.$logger.log("WRAPPER :: Bluetooth.connectToDevice: ",e),S.stopScanning().then(function(){S.connectToDevice(e).then(function(){n.$logger.log("WRAPPER :: Bluetooth.connectToDevice Connected")}).catch(function(e){n.$logger.error("WRAPPER :: Failed connecting: ",e),S.scan()})}).catch(function(e){n.$logger.error("WRAPPER :: Failed stopScanning: ",e),S.scan()})},n.disconnectDevice=function(e){n.checkAndRegisterScanListener(),n.$logger.log("WRAPPER :: Bluetooth.disconnectDevice "+e),S.cancelDeviceConnection(e)},n.allDevices=function(){n.checkAndRegisterScanListener(),y.LDSDKLogger.debug("WRAPPER :: Bluetooth.allDevices");var e=[],t=S.allDevices();if(y.LDSDKLogger.debug("WRAPPER :: Bluetooth.allDevices - Got "+t.length()+" - Length of this.devices: "+n.devices.length),0===t.length()){for(var o=n.devices.slice(),i=0;i<o.length;i++){var r=o[i];y.LDSDKLogger.debug("WRAPPER :: Bluetooth.allDevices - sending message OnDeviceDisappeared "+r.DeviceID+" - Name: "+r.DeviceName),r.ConnectedState=1,R.sendMessage("OnDeviceDisappeared",r);var a={deviceId:r.DeviceID};y.LDSDKLogger.debug("WRAPPER :: Bluetooth.allDevices - calling this.bluetooth.removeDevice "+r.DeviceID+" - Name: "+r.DeviceName+" this.devices length before: "+n.devices.length),n.bluetooth.removeDevice(a),y.LDSDKLogger.debug("WRAPPER :: Bluetooth.allDevices - calling this.bluetooth.removeDevice "+r.DeviceID+" - Name: "+r.DeviceName+" this.devices length after: "+n.devices.length)}o=null,y.LDSDKLogger.debug("WRAPPER :: Bluetooth.allDevices - Truncating this.devices array - length before truncate: "+n.devices.length),n.devices.length=0,y.LDSDKLogger.debug("WRAPPER :: Bluetooth.allDevices - sending message OnAllDevicesUpdated - allDevices count: "+e.length)}else for(var i=0;i<t.size();i++)y.LDSDKLogger.debug("WRAPPER :: Bluetooth.allDevices - appending "+t.get(i).deviceId+" - Name: "+t.get(i).deviceName),e.push(l(t.get(i)));R.sendMessage("OnAllDevicesUpdated",e)},n.changeDeviceName=function(e,t){n.$logger.log("WRAPPER :: Bluetooth.changeDeviceName for "+e+" to new name: "+t),S.setDeviceName(e,t)},n.updateServiceData=function(e,t){n.$logger.log("WRAPPER :: Bluetooth.updateServiceData");var o=n.findServiceOnDevice(e,parseInt(t));o&&null!==o||n.$logger.error("WRAPPER :: Did not find service: "+e+", "+t)},n.updateInputFormat=function(e,t,o,i,r,a){n.$logger.log("WRAPPER :: Bluetooth.updateInputFormat");var s=n.findServiceOnDevice(e,parseInt(t));if(s&&null!==s){var c=y.InputFormat.inputFormat(parseInt(t),parseInt(s.connectInfo.type),parseInt(o),parseInt(r),parseInt(i),a.toLowerCase());n.$logger.log("WRAPPER :: updateInputFormat("+e+", "+t+", "+o+", "+i+", "+r+", "+a+") ["+s.serviceName+", internal: "+s.isInternalService+"]"),s.updateInputFormat(c)}else n.$logger.error("WRAPPER :: Did not find service: "+e+", "+t+", "+a)},n.run=function(e,t,o,i){n.$logger.log("WRAPPER :: Bluetooth.run");var r=n.findServiceOnDevice(e,parseInt(t));r&&null!==r?r.run(parseInt(o),parseInt(i)):n.$logger.error("WRAPPER :: Did not find service: "+e+", "+t)},n.brake=function(e,t){n.$logger.log("WRAPPER :: Bluetooth.brake");var o=n.findServiceOnDevice(e,parseInt(t));o&&null!==o?o.brake():n.$logger.error("WRAPPER :: Did not find service: "+e+", "+t)},n.drift=function(e,t){n.$logger.log("WRAPPER :: Bluetooth.drift");var o=n.findServiceOnDevice(e,parseInt(t));o&&null!==o?o.drift():n.$logger.error("WRAPPER :: Did not find service: "+e+", "+t)},n.playFrequency=function(e,t,o,i){n.$logger.log("WRAPPER :: Bluetooth.playFrequency");var r=n.findServiceOnDevice(e,parseInt(t));r&&null!==r?r.playFrequency(parseInt(o),parseInt(i)):n.$logger.error("WRAPPER :: Did not find service: "+e+", "+t)},n.playNote=function(e,t,o,i,r){n.$logger.log("WRAPPER :: Bluetooth.playNote");var a=n.findServiceOnDevice(e,parseInt(t));a&&null!==a?a.playNote(parseInt(o),parseInt(i),parseInt(r)):n.$logger.error("WRAPPER :: Did not find service: "+e+", "+t)},n.stopPlaying=function(e,t){n.$logger.log("WRAPPER :: Bluetooth.stopPlaying");var o=n.findServiceOnDevice(e,parseInt(t));o&&null!==o?o.stopPlaying():n.$logger.error("WRAPPER :: Did not find service: "+e+", "+t)},n.setRGBLightMode=function(e,t,o){n.$logger.log("WRAPPER :: Bluetooth.setRGBLightMode "+o);var i=n.findServiceOnDevice(e,parseInt(t));i&&null!==i?i.setRGBMode(parseInt(o)):n.$logger.error("WRAPPER :: Did not find service: "+e+", "+t)},n.changeColor=function(e,t,o){n.$logger.log("WRAPPER :: Bluetooth.changeColor "+o);var i=n.findServiceOnDevice(e,parseInt(t));i&&null!==i?i.setColor(o):n.$logger.error("WRAPPER :: Did not find service: "+e+", "+t)},n.changeColorIndex=function(e,t,o){n.$logger.log("WRAPPER :: Bluetooth.changeColorIndex "+o);var i=n.findServiceOnDevice(e,parseInt(t));i&&null!==i?i.setColorIndex(parseInt(o)):n.$logger.error("WRAPPER :: Did not find service: "+e+", "+t)},n.switchOff=function(e,t){n.$logger.log("WRAPPER :: Bluetooth.switchOff");var o=n.findServiceOnDevice(e,parseInt(t));o&&null!==o?o.switchOff():n.$logger.error("WRAPPER :: Did not find service: "+e+", "+t)},n.changeColorToDefault=function(e,t){n.$logger.log("WRAPPER :: Bluetooth.changeColorToDefault");var o=n.findServiceOnDevice(e,parseInt(t));o&&null!==o?o.switchToDefaultColor():n.$logger.error("WRAPPER :: Did not find service: "+e+", "+t)},n.setTiltSensorMode=function(e,t,o){n.$logger.log("WRAPPER :: Bluetooth.setTiltSensorMode "+o);var i=n.findServiceOnDevice(e,parseInt(t));i&&null!==i?i.setTiltSensorMode(parseInt(o)):n.$logger.error("WRAPPER :: Did not find service: "+e+", "+t)},n.setMotionSensorMode=function(e,t,o){n.$logger.log("WRAPPER :: Bluetooth.setMotionSensorMode "+o);var i=n.findServiceOnDevice(e,parseInt(t));i&&null!==i?i.setMotionSensorMode(parseInt(o)):n.$logger.error("WRAPPER :: Did not find service: "+e+", "+t)},n.findDeviceFromId=function(e){n.$logger.log("WRAPPER :: Bluetooth.findDeviceFromId "+e);var t=S.getDevice(e);return null!==t&&t||(n.$logger.error("WRAPPER :: Did not find device: "+e),n.$logger.error("WRAPPER :: allDevices count: "+S.allDevices().size())),t},n.findServiceOnDevice=function(e,t){var o=n.findDeviceFromId(e);if(null!==o&&o){var i=S.getDeviceServiceWithConnectId(e,t);return null!==i&&i||n.$logger.error("WRAPPER :: findServiceOnDevice: Did not find service: "+e+", "+t),i}n.$logger.error("WRAPPER :: Did not find device: "+e)},n.setUnityObjectName=function(e){m.a.callWebGL("bluetoothHandler","setUnityObjectName",[e])},n.$logger=e,S&&null!==S||(e.log("WRAPPER :: Caching LegoDeviceManagerImpl.getInstance()"),S=y.LegoDeviceManagerImpl.getInstance(),window&&(window.LDM=S),y.LDSDKLogger&&null!==y.LDSDKLogger&&y.LDSDKLogger.disable(),e.log("WRAPPER :: LegoDeviceManagerImpl.getInstance() - SDK Version: "+S.getSDKVersion()),S.config.listenForConnectionsAllTheTime=!0,S.config.fireDeviceInfoUpdateOnTheOnDeviceEvents=!0,S.config.startStopScanningInterval=2e3,S.config.startStopRepeatedScanning=!1,S.config.automaticReconnectOnConnectionLostEnabled=!1),n.helper=R.getInstance(),n.devices=[],n.checkAndRegisterScanListener(),n}return i(t,e),b(t,[{key:"getDevicesCallbackListenerInstance",value:function(){return this.devicesCallbackListener&&null!==this.devicesCallbackListener||(this.devicesCallbackListener=new P(this)),this.devicesCallbackListener}},{key:"checkAndRegisterScanListener",value:function(){this.callbackListenerId&&null!==this.callbackListenerId||(this.callbackListenerId=S.registerCallbackListener(this.getDevicesCallbackListenerInstance()),this.$logger.info("WRAPPER :: Registered scan listener and connect listener: ",this.callbackListenerId))}}]),t}(v.a);t.a=F},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(24),s=n(1),c=n(4),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,!1));return n.setTransparentBackground=function(e){n.webview.style.height="True"===e?"400px":"200px"},n.setInsets=function(e,t,o,i,r,a){n.webview.style.top=e+"px",n.webview.style.left=t+"px",n.webview.style.bottom=o+"px",n.webview.style.right=i+"px",n.webview.style.width="unset",n.webview.style.height="unset"},n.setVisible=function(e){n.webview.style.display="True"===e?"inherit":"none"},n.invokeUnity=function(e){s.a.callUnity("content",n.unityMethodToInvoke,e)},n.handleExportImage=function(e){n.handleExport(e,"image/jpg","jpg")},n.handleExportPdf=function(e){n.handleExport(e,"application/pdf","pdf")},n.handleSaveSDT=function(e){s.a.callUnity("content","OnEvalJavaScriptFinished",e)},n.eventHandlers.contentload=n.event_contentload.bind(n),n.unityMethodToInvoke="OnRecieveMessageFromChromeOS",n.setup(e),setTimeout(function(){n.webview.setZoomMode("disabled")},2e4),n.storage=new c.a,n.webview.addEventListener("permissionrequest",function(e){"fullscreen"===e.permission&&e.request.allow()}),n}return r(t,e),l(t,[{key:"event_contentload",value:function(){this.sendMessage({sender:"hello"}),s.a.callUnity("content",this.unityMethodToInvoke,"")}},{key:"handleExport",value:function(e,t,n){var o=this,i=e.split(";base64,"),r=i.length>1?i[1]:i[0];this.storage.saveFile(this.b64toBlob(r,t),n,function(){o.evaluatingJavaScript("ExportDone()")},function(e){o.evaluatingJavaScript("ExportDone()")})}},{key:"b64toBlob",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,o=atob(e),i=[],r=0;r<o.length;r+=n){for(var a=o.slice(r,r+n),s=new Array(a.length),c=0;c<a.length;c++)s[c]=a.charCodeAt(c);var l=new Uint8Array(s);i.push(l)}return new Blob(i,{type:t})}}]),t}(a.a);t.a=u},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.open=function(e){window.open(e)},e}return r(t,e),t}(a.a);t.a=s},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=n(1),c=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.request=function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState){var e="uniwebview://KillswitchResponse";200==t.status?(e+="?ReponseError=undefined",e+="&Data="+encodeURIComponent(t.responseText),e+="&ResponseHeader="+encodeURIComponent(t.getAllResponseHeaders()),s.a.callUnity(null,"OnRecieveMessageFromChromeOS",e)):(e+="?ReponseError=Error",e+="&Data=Error",e+="&ResponseHeader=None}",s.a.callUnity(null,"OnRecieveMessageFromChromeOS",e))}},t.error=function(){},t.open("GET",e,!0),t.send()},e}return r(t,e),t}(a.a);t.a=c},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=n(1),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=function(e){function t(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:console;o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.requestSystemCpuInfo=function(){chrome&&chrome.system&&chrome.system.cpu.getInfo&&"function"==typeof chrome.system.cpu.getInfo&&chrome.system.cpu.getInfo(function(t){s.a.callUnity(null,"OnRecieveMessageFromChromeOS","uniwebview://PlatformInfo?systemCpu="+e.getObjAsBase64Json(t))})},e.requestPlatformInfo=function(){var t="uniwebview://PlatformInfo?platformInfo=";chrome&&chrome.runtime&&chrome.runtime.getPlatformInfo&&"function"==typeof chrome.runtime.getPlatformInfo?chrome.runtime.getPlatformInfo(function(n){s.a.callUnity(null,"OnRecieveMessageFromChromeOS",t+e.getObjAsBase64Json({nativePlatformInfo:n,isArmArchitecture:-1!=n.arch.indexOf("arm"),is64bit:-1!=n.arch.indexOf("x86-64"),platformOS:n.os,platformOSDetails:navigator.appVersion.match(/\(.*; ([^\)]+)\)/)[1],chromeVersion:navigator.appVersion.match(/.*Chrome\/([0-9\.]+)/)[1]}))}):s.a.callUnity(null,"OnRecieveMessageFromChromeOS",t+e.getObjAsBase64Json({nativePlatformInfo:navigator.platform,isArmArchitecture:e.isArmArchitecture(),is64bit:e.is64BitArchitecture(),platformOS:navigator.appVersion.match(/\(.*; ([^\)]+)\)/)[1],platformOSDetails:navigator.appVersion.match(/\(.*; ([^\)]+)\)/)[1],chromeVersion:navigator.appVersion.match(/.*Chrome\/([0-9\.]+)/)[1]}))},e.requestSystemMemoryInfo=function(){chrome&&chrome.system&&chrome.system.memory&&"function"==typeof chrome.system.memory.getInfo&&chrome.system.memory.getInfo(function(t){s.a.callUnity(null,"OnRecieveMessageFromChromeOS","uniwebview://PlatformInfo?systemMemory="+e.getObjAsBase64Json(t))})},e.requestLanguageInfo=function(){chrome&&chrome.i18n&&"function"==typeof chrome.i18n.getAcceptLanguages&&chrome.i18n.getAcceptLanguages(function(t){var n=t.join(","),o="function"==typeof chrome.i18n.getUILanguage?chrome.i18n.getUILanguage():t[0];console.log("Accept Languages: "+n+", UI language: "+o),s.a.callUnity(null,"OnRecieveMessageFromChromeOS","uniwebview://PlatformInfo?language="+e.getObjAsBase64Json({acceptLanguage:t[0],acceptLanguages:n,uiLanguage:o}))})},e}return r(t,e),c(t,[{key:"getObjAsBase64Json",value:function(e){return window.btoa(window.unescape(window.encodeURIComponent(JSON.stringify(e))))}},{key:"getBitSystemArchitecture",value:function(){var e=[];window.navigator.cpuClass&&e.push((window.navigator.cpuClass+"").toLowerCase()),window.navigator.platform&&e.push((window.navigator.platform+"").toLowerCase()),navigator.userAgent&&e.push((navigator.userAgent+"").toLowerCase());var t,n,o=["x86_64","x86-64","Win64","x64;","amd64","AMD64","WOW64","x64_64","ia64","sparc64","ppc64","IRIX64"],i=32;e:for(var n=0;n<e.length;n++)for(t=0;t<o.length;t++)if(-1!=e[n].indexOf(o[t].toLowerCase())){i=64;break e}return i}},{key:"is32BitArchitecture",value:function(){return 32==this.getBitSystemArchitecture()?1:0}},{key:"is64BitArchitecture",value:function(){return 64==this.getBitSystemArchitecture()?1:0}},{key:"isArmArchitecture",value:function(){var e=[];window.navigator.cpuClass&&e.push((window.navigator.cpuClass+"").toLowerCase()),window.navigator.platform&&e.push((window.navigator.platform+"").toLowerCase()),navigator.userAgent&&e.push((navigator.userAgent+"").toLowerCase());var t,n,o=["arm"],i=!1;e:for(var n=0;n<e.length;n++)for(t=0;t<o.length;t++)if(-1!=e[n].indexOf(o[t].toLowerCase())){i=!0;break e}return i}}]),t}(a.a);t.a=l},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=n(1),c=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.playVideo=function(e,t){var n=document.createElement("div");n.style.backgroundColor=t,n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%";var o=document.createElement("video");o.className="lobbyvideo",o.src=e,o.preload="auto",o.autoplay=!0,o.controls=!0,o.onended=function(){document.body.removeChild(n)},o.onclick=function(){document.body.removeChild(n)},n.appendChild(o),document.body.appendChild(n)},n.setupVideoElements=function(){n.videoContainerElement||(n.videoContainerElement=document.createElement("div"),document.body.appendChild(n.videoContainerElement),n.videoElement=document.createElement("video"),n.videoElement.autoplay=!0,n.videoContainerElement.appendChild(n.videoElement),n.videoElement.style.position="relative",n.videoElement.style.marginLeft="auto",n.videoElement.style.marginRight="auto",n.videoElement.style.top="50%",n.videoElement.style.transform="translateY(-50%)",n.videoElement.style.display="block",n.videoElement.style.width="100%",n.videoElement.style.height="100%",n.videoElement.volume=0,n.videoElement.srcObject=n.videoStream),n.snapshotCanvas||(n.snapshotCanvas=document.createElement("canvas"),n.snapshotCanvas.style.display="none",n.snapshotCanvas.style.width="100%",n.snapshotCanvas.style.height="100%",n.snapshotCanvasContext=n.snapshotCanvas.getContext("2d"),document.body.appendChild(n.snapshotCanvas)),n.videoRecordRTC?(console.debug("Video :: setupVideoElements - videoRecordRTC already set - resetting it"),n.videoRecordRTC.reset()):(n.videoRecordRTC=new RecordRTC(n.videoStream,{type:"video"}),n.videoRecordRTC.mimeType={video:"video/webm",audio:"audio/wav"},n.videoRecordRTC.onStateChanged.call=function(e){console.log("Video :: Video Recorder state changed to: "+e.state)}),n.updateLivePreviewPosition()},n.teardownVideoElements=function(){n.videoContainerElement&&(n.videoElement&&URL.revokeObjectURL(n.videoElement.src),document.body.removeChild(n.videoContainerElement),n.videoElement=null,n.videoContainerElement=null),n.snapshotCanvas&&(document.body.removeChild(n.snapshotCanvas),n.snapshotCanvasContext=null,n.snapshotCanvas=null),n.videoStream&&(n.videoStream.stop(),n.videoStream=null),n.videoRecordRTC&&(n.videoRecordRTC.reset(),n.videoRecordRTC=null)},n.updateLivePreviewPosition=function(){n.videoContainerElement&&(n.videoContainerElement.style.position=n.livePreviewPosition.position,n.videoContainerElement.style.top=n.livePreviewPosition.top,n.videoContainerElement.style.left=n.livePreviewPosition.left,n.videoContainerElement.style.width=n.livePreviewPosition.widthPX,n.videoContainerElement.style.height=n.livePreviewPosition.heightPX),n.snapshotCanvas&&(n.snapshotCanvas.width=n.livePreviewPosition.width,n.snapshotCanvas.height=n.livePreviewPosition.height)},n.startCaptureSession=function(){if(n.videoContainerElement)n.videoElement.style.display="block";else{var e=n.livePreviewPosition.width;e/=10,e=10*Math.floor(e);var t=n.livePreviewPosition.height;t/=10,t=10*Math.floor(t),console.log("Video :: startCaptureSession - this.livePreviewPosition.width:  "+n.livePreviewPosition.width+" --\x3e "+e+", this.livePreviewPosition.height: "+n.livePreviewPosition.height+" --\x3e "+t),navigator.getUserMedia({video:{width:{ideal:e},height:{ideal:t}},audio:!0},function(e){n.videoStream=e,n.setupVideoElements()},function(e){console.error("Video :: startCaptureSession - failed getting videostream, tearing down video elements",e),n.teardownVideoElements()})}},n.setLivePreviewPosition=function(e,t,o,i){n.livePreviewPosition&&(n.livePreviewPosition.position="fixed",n.livePreviewPosition.top=t+"px",n.livePreviewPosition.left=e+"px",n.livePreviewPosition.widthPX=o+"px",n.livePreviewPosition.heightPX=i+"px",n.livePreviewPosition.width=o,n.livePreviewPosition.height=i),n.updateLivePreviewPosition()},n.startRecording=function(){n.videoRecordRTC||(console.debug("Video :: startRecording - videoRecordRTC is not set, invoking setupVideoElements"),n.setupVideoElements()),n.videoRecordRTC?n.videoRecordRTC.startRecording():console.info("Video :: Unable to start recording as no recordRTC instance available")},n.stopRecording=function(e){n.previewFilePath=e,n.videoRecordRTC?n.videoRecordRTC.stopRecording(function(){n.handleVideo(n.videoRecordRTC.toURL(),n.videoRecordRTC.getBlob())}):console.info("Video :: stopRecording - No videoRecordRTC instance - Skipping stopRecording call")},n.handleVideo=function(e,t){var o=n.videoContainerElement.style.width.replace("px",""),i=n.videoContainerElement.style.height.replace("px","");n.snapshotCanvasContext.drawImage(n.videoElement,0,0,o,i);var r=n.snapshotCanvas.toDataURL("image/jpeg",1),a=n.dataURItoBlob(r);n.storage.saveFile(t,n.previewVideoExt,function(){n.saveLocalPreviewFile(t,n.previewVideoExt,"StopVideoRecording?VideoFilePath="),n.saveLocalPreviewFile(a,n.previewImageExt,"CaptureImage?ImageFilePath=")},function(e){console.log("Video :: handleVideo - Unable to save file: "+e);s.a.callUnity(null,"OnRecieveMessageFromChromeOS","uniwebview://StopVideoRecording?VideoRecordingCancelled=true")})},n.stopCaptureSession=function(e){if("True"===e)n.videoElement.style.display="none";else{n.videoRecordRTC&&n.videoRecordRTC.stopRecording(function(e){console.debug("Video :: stopCaptureSession - stopRecording completed")});try{n.teardownVideoElements()}catch(e){console.error("Video :: stopCaptureSession: Failed teardownVideoElements",e)}}},n.captureImage=function(e){n.previewFilePath=e;var t=n.videoContainerElement.style.width.replace("px",""),o=n.videoContainerElement.style.height.replace("px","");n.snapshotCanvasContext.drawImage(n.videoElement,0,0,t,o);var i=n.snapshotCanvas.toDataURL("image/jpeg",1),r=n.dataURItoBlob(i);n.storage.saveFile(r,n.previewImageExt,function(){n.saveLocalPreviewFile(r,n.previewImageExt,"CaptureImage?ImageFilePath=")},function(e){console.log("Video :: Unable to save captured image file: "+e);s.a.callUnity(null,"OnRecieveMessageFromChromeOS","uniwebview://CaptureImage?CaptureImageCancelled=true")})},n.captureCanvasImage=function(e,t){n.previewFilePath=t;var o=n.dataURItoBlob(e);n.storage.saveFile(o,n.previewImageExt,function(){n.saveLocalPreviewFile(o,n.previewImageExt,"CaptureImage?ImageFilePath=")},function(e){console.log("Video :: Unable to save captured canvas image file: "+e);s.a.callUnity(null,"OnRecieveMessageFromChromeOS","uniwebview://CaptureImage?CaptureImageCancelled=true")})},n.saveLocalPreviewFile=function(e,t,o){var i=n.previewFilePath+"."+t,r="uniwebview://"+o+i;console.log("Video :: Saving file to index db filepath: "+i+" - newDataUrl: "+r),n.storage.saveFileToIndexDB(i,e,r)},n.dataURItoBlob=function(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],o=new Uint8Array(t.length),i=0;i<t.length;i++)o[i]=t.charCodeAt(i);return new Blob([o],{type:n})},n.storage=e,n.videoStream=null,n.videoElement=null,n.videoContainerElement=null,n.snapshotCanvas=null,n.snapshotCanvasContext=null,n.videoRecordRTC=null,n.previewFilePath=null,n.previewImageExt="jpg",n.previewVideoExt="webm",n.livePreviewPosition={},window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,n}return r(t,e),t}(a.a);t.a=c},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(1),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=function(){function e(){o(this,e)}return r(e,[{key:"initialize",value:function(e){var t=this;this.storage=e,chrome.app.window.current().onBoundsChanged.addListener(this.onBoundsChanged.bind(this)),document.addEventListener("visibilitychange",function(){"visible"!==document.visibilityState?(console.debug("pause - Document is hidden - invoking pause. document.visibilityState: "+document.visibilityState),t.storage.isSavingFile()||t.pause()):(console.debug("pause - Document is visible - invoking unpause. document.visibilityState: "+document.visibilityState),t.storage.isSavingFile()||t.unpause())}),this.onBoundsChanged()}},{key:"onBoundsChanged",value:function(){this.webviewElement=document.getElementById("webgl"),this.parentDiv=document.getElementById("parent");var e=Math.min(chrome.app.window.current().outerBounds.width,chrome.app.window.current().innerBounds.width),t=Math.min(chrome.app.window.current().outerBounds.height,chrome.app.window.current().innerBounds.height);console.log("onBoundsChanged: setting width: "+e+"px, height: "+t+"px - innerBounds: [ width: "+chrome.app.window.current().innerBounds.width+", height: "+chrome.app.window.current().innerBounds.height+"] - outerBounds: [ width: "+chrome.app.window.current().outerBounds.width+", height: "+chrome.app.window.current().outerBounds.height+"] - document: [ width: "+document.body.clientWidth+", height: "+document.body.clientHeight+"] "),this.webviewElement&&this.webviewElement.style&&this.webviewElement.style.width&&console.log("webviewElement style: [width: "+this.webviewElement.style.width+", height: "+this.webviewElement.style.height+"]"),i.a.callWebGL("window","resize",[{width:e,height:t}])}},{key:"pause",value:function(){i.a.callUnity(null,"OnRecieveMessageFromChromeOS","uniwebview://PauseUnpause?Pause=true")}},{key:"unpause",value:function(){i.a.callUnity(null,"OnRecieveMessageFromChromeOS","uniwebview://PauseUnpause?Pause=false")}}]),e}();t.a=a},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=n(5),c=n(25),l=n(26),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();window.GD_RESUMABLE_UPLOAD_CHUNK_SIZE=524288;var d=function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.initialize=function(e){var t=r;return t.SyncFS=e,new Promise(function(e,o){console.log("loadGoogleAPI"),n.i(c.a)(function(){console.log("Google API loaded"),t._authenticate(e,o)})})},r._checkIfURLReachable=function(e){return new Promise(function(t,n){var o=new XMLHttpRequest;o.open("GET",e),o.timeout=1e4,o.onload=function(){console.log("_checkIfURLReachable: onload",o),t()},o.onerror=function(){console.log("_checkIfURLReachable: onerror",o),n()},o.ontimeout=function(){console.log("_checkIfURLReachable: ontimeout",o),n()},o.send()})},r.reauthenticate=function(){return new Promise(function(e,t){r.revokeCredentials(),r._authenticate(e,t)})},r.getFileList=function(e){return new Promise(function(t,n){var o=r,i=[];!function r(a){o._fetchFileListPage(e,a,function(e){i=i.concat(e.files),"nextPageToken"in e?r(e.nextPageToken):t(i)},function(e){n(e)})}(null)})},r.downloadFile=function(e,t){var n="arraybuffer";if(t&&"string"==typeof t&&-1!==t.lastIndexOf(".")){var o=t.substr(t.lastIndexOf(".")).toLowerCase();".txt"!==o&&".json"!==o&&".proj"!==o||(n="text")}var i={path:"/drive/v3/files/"+e,params:{alt:"media"},responseType:n};return window.ENABLE_DEBUG&&console.debug("Starting download of "+t+"("+e+") using xhr responseType: "+n),"arraybuffer"===n?r.startRequest(i,function(e,t){if("ArrayBuffer"===e.constructor.name){var n=new Uint8Array(e);try{var o=l.a.bytesToBase64(n);return r._isBase64(o)?(console.log('downloadFile :: got base64 ArrayBuffer response payload for file "'+i.path+'" - decoding the response'),r._base64Decode(o)):e}catch(t){return e}}else if(console.log("downloadFile :: got "+e.constructor.name+' response payload for file "'+i.path+'"'),r._isBase64(e)){console.log("downloadFile :: got base64 encoded "+e.constructor.name+' response payload for file "'+i.path+'" - decoding the response');var a=r._base64Decode(e);return a}return e}):r.startRequest(i,r._base64Decode)},r.uploadFile=function(e,t,n,o){var i=e?"PATCH":"POST",a="/upload/drive/v3/files"+(e?"/"+e:""),s={name:t,modifiedTime:o};e||(s.parents=["appDataFolder"],s.createdTime=o);var c="#g4RJCrhHMbzaPtxpNSAw#",l=r._base64Encode(new Uint8Array(n)),u="";return u+="--"+c+"\n",u+="Content-Type: application/json; charset=UTF-8\n\n",u+=JSON.stringify(s)+"\n\n",u+="--"+c+"\n",u+="Content-Type: application/octet-stream\n\n",u+=l+"\n",u+="--"+c+"--",r.startRequest({path:a,params:{uploadType:"multipart",fields:"id,name,modifiedTime"},method:i,bodyType:"multipart/related; boundary="+c,body:u})},r.uploadFileResumable=function(e,t,n,o){var i=e?"PATCH":"POST",a="/upload/drive/v3/files"+(e?"/"+e:"");console.log(i+" "+n.byteLength+" bytes to "+a);var s={name:t,modifiedTime:o,type:"arraybuffer"};e||(s.parents=["appDataFolder"],s.createdTime=o);var c=JSON.stringify(s),l={path:a,method:i,params:{uploadType:"resumable",fields:"id,name,modifiedTime"},headers:{"Content-Type":"application/json; charset=UTF-8","X-Upload-Content-Type":"application/octet-stream","X-Body-Content-Length":c.length,"X-Upload-Content-Length":n.byteLength},bodyType:"application/json; charset=UTF-8",body:c},u=function(n,o){var i=o&&o.gapiRequest&&o.gapiRequest.data?o.gapiRequest.data.responseHeaders:null;if(null!==i){if(i.hasOwnProperty("location"))return i.location;if(i.hasOwnProperty("Location"))return i.Location}throw console.error("uploadFileResumable :: Failed Initializing resumable upload and getting session url. InitResumableParams: ",l," RawResponse",o),"Failed initializing uploadResumable for file "+t+" (fileId: "+e+")"};return r.startRequest(l,u).then(function(o){var i=window.GD_RESUMABLE_UPLOAD_CHUNK_SIZE,a=function(e){var t=parseInt(((n.byteLength-e)/i).toFixed(0));return(n.byteLength-e)/t>i&&(t+=1),t},s=function(e){var t=Math.min(e+i-1,n.byteLength-1),r=a(e);return e>=n.byteLength-1||e>=t?null:{path:o.substr("https://www.googleapis.com".length),method:"PUT",headers:{"Content-Range":"bytes "+e+"-"+t+"/"+n.byteLength,"X-Chunk":r+" chunks remaining of size "+i+" bytes"},bodyType:l.headers["X-Upload-Content-Type"],body:new Uint8Array(n).subarray(e,t+1)}},c=function(e,t){"string"==typeof t&&(t=JSON.parse(t));var n=t&&t.gapiRequest&&t.gapiRequest.data?t.gapiRequest.data.responseHeaders:null;if(n){var o;if(n.hasOwnProperty("range")?o=n.range:n.hasOwnProperty("Range")&&(o=n.Range),o){if(o.startsWith("bytes=")){var i=o.substr("bytes=".length).split("-");if(2===i.length){var r=(i[0],i[1]);return parseInt(r)+1}console.warn('Unsupported "Range" header value: '+o)}}else{if(200===n.status||201===n.status)return"resumable_upload_complete";if(404===n.status)console.log('uploadFileResumable :: _chunkResponseHandler :: Got a "not found" response');else{if(403===n.status)return console.log('uploadFileResumable :: _chunkResponseHandler :: Got a "403" response',t),null;if(500===n.status)return console.log('uploadFileResumable :: _chunkResponseHandler :: Got a "'+n.status+'" response',t),null;console.log('uploadFileResumable :: _chunkResponseHandler :: No "Range" header. Response status: '+n.status,n)}}}return console.warn("uploadFileResumable :: _chunkResponseHandler - Not a valid rawResponse",t),null},u=r,d=function e(t){if(null===t)return Promise.reject("Range was null");if("resumable_upload_complete"===t)return Promise.resolve(t);var n=a(t);if(!(n>=0))return Promise.resolve("resumable_upload_complete");var o=s(t);return o&&null!==o?(console.debug("uploadFileResumable :: Continuing resumable upload - [remainingChunks: "+n+" - Content-Range: "+o.headers["Content-Range"]+", chunkSize: "+i+"]"),u.startRequest(o,c).then(e)):void 0},f=s(0);return r.startRequest(f,c).then(d).then(function(n){return console.log("uploadFileResumable :: Resumable upload of "+t+" (id: "+e+") done!",n),Promise.resolve()})})},r.moveFile=function(e,t,n){return r.startRequest({path:"/drive/v3/files/"+e,params:{fields:"id,name,modifiedTime"},method:"PATCH",body:{name:t,modifiedTime:n}})},r.copyFile=function(e,t,n){return r.startRequest({path:"/drive/v3/files/"+e+"/copy",params:{fields:"id,name,modifiedTime"},method:"POST",body:{name:t,parents:["appDataFolder"],modifiedTime:n}})},r.deleteFile=function(e,t){return r.startRequest({path:"/drive/v3/files/"+e,method:"DELETE",callback:function(e,t){return e},errorCallback:function(e,t){return t}},void 0,function(e){return t&&404===e.code})},r.getChangeStartPageToken=function(){return r.startRequest({path:"/drive/v3/changes/startPageToken",callback:function(e,t){return e.startPageToken},errorCallback:function(e,t){return t}})},r.getChangeList=function(e){return new Promise(function(t,n){var o=r,i=[];!function e(r){o._fetchChangesPage(r,function(n){i=i.concat(n.changes),"nextPageToken"in n?e(n.nextPageToken):t({changes:i,newStartPageToken:n.newStartPageToken})},function(e){n(e)})}(e)})},r._fetchFileListPage=function(e,t,n,o){console.log("fetching page with token "+t);var i={q:e,pageSize:1e3,spaces:"appDataFolder",fields:"nextPageToken,files(id,name,modifiedTime)"};t&&(i.pageToken=t),r.startRequest({path:"/drive/v3/files",params:i}).then(n).catch(o)},r._fetchChangesPage=function(e,t,n){var o={pageToken:e,includeRemoved:!0,pageSize:1e3,restrictToMyDrive:!1,spaces:"appDataFolder"};r.startRequest({path:"/drive/v3/changes",params:o}).then(t).catch(n)},r._base64Encode=function(e){if(!r._hasByteLengthProperty(e))return r._isBase64(e)?e:(console.warn("Cannot encode input - it does not have a byteLength property which is required"),e);for(var t="",n=e.byteLength,o=0;o<n;o++)t+=String.fromCharCode(e[o]);return window.btoa(t)},r._base64Decode=function(e){if(!r._isBase64(e)&&r._hasByteLengthProperty(e))return e;var t=window.atob(e);if(r._isBase64(t))return r._base64Decode(t);for(var n=new ArrayBuffer(t.length),o=new Uint8Array(n),i=0;i<t.length;i++)o[i]=t.charCodeAt(i);return n},r._hasByteLengthProperty=function(e){return!(!e||null===e)&&"number"==typeof e.byteLength},r._isBase64=function(e){return!(!e||"string"!=typeof e)&&/^([0-9a-zA-Z+\/]{4})*(([0-9a-zA-Z+\/]{2}==)|([0-9a-zA-Z+\/]{3}=))?$/.test(e)},r.hasUserDeclinedAuth=!1,r.access_token=void 0,r.pendingRequests={},r.reqIdx=0,r.maxAttempts=5;return r.requestInterval=Math.ceil(1.1*100),r.requestQueue=[],r._syncfsTimestamp=e,r}return r(t,e),u(t,[{key:"_authenticate",value:function(e,t){var n=this,o=function(t){n.access_token=t,n.hasUserDeclinedAuth=!1,e(),n.startPerformingRequests()},i=function(e){n.access_token=void 0,n.hasUserDeclinedAuth="The user did not approve access."===e.message,t(new s.a(e.message,e.code,e.reason)),n.startPerformingRequests()};gapi.auth.authorize({immediate:!0},function(e){console.log("Received authorization result (immediate = true)",e),e.error?n._checkIfURLReachable("https://www.googleapis.com/drive/v3/about").then(function(){gapi.auth.authorize({immediate:!1},function(e){console.log("Received authorization result (immediate = false)",e),e.error?i(e.error):o(e.access_token)})}).catch(function(e){console.log("Google Drive not reachable.",e),i("Google Drive not reachable")}):o(e.access_token)})}},{key:"revokeCredentials",value:function(){this.access_token&&(chrome.identity.removeCachedAuthToken({token:this.access_token}),this.access_token=void 0)}},{key:"attemptGoogleReconnect",value:function(){if(!this.isAttemptingReconnect){var e=this;e.isAttemptingReconnect=!0;var t=0,n={path:"/drive/v3/files",params:{q:"",pageSize:2,spaces:"appDataFolder"}},o=function(){gapi.client.request(n)},i=function(){var e=1e3*t*t;console.log("retryRequest executing - to: "+e+", reconnectAttempt: "+t+", rArgs: "+JSON.stringify(n)),e>6e5&&(e=6e5),t++,window.setTimeout(o,e)},r=function(){e.SyncFS.solveStatusReason("gdrive_offline"),e.isAttemptingReconnect=!1};n.callback=function(e,t){"string"==typeof t&&(t=JSON.parse(t));var n=t&&t.gapiRequest&&t.gapiRequest.data&&t.gapiRequest.data.status&&200===t.gapiRequest.data.status||!1,o=t&&t.gapiRequest&&t.gapiRequest.data&&t.gapiRequest.data.responseHeaders&&t.gapiRequest.data.responseHeaders.status||!1,a=o?t.gapiRequest.data.responseHeaders.status:-1;n||200===a||401===a||null===e||null===e.error||e.error&&401===e.error.code?r():i()},n.errorCallback=i,o()}}},{key:"handleGoogleError",value:function(e,t){var n=this,o=n.pendingRequests[e],i=function(){n.enqueueRequest(o.args)},r=function(e){throw o.reject(t),new Error(e)},a=function(i){o.reject(i||t),delete n.pendingRequests[e],null!==i&&"The user did not approve access."===i.message||n.attemptGoogleReconnect()},c=function(){i()},l=function(){o.attempt<n.maxAttempts?(o.attempt++,window.setTimeout(i,500*o.attempt*o.attempt)):a(new s.a("timeout",t.code))};switch(t.code){case 400:r("Bad request! "+o.args.path);break;case 401:n.hasUserDeclinedAuth?a():n.reauthenticate().then(function(){c()}).catch(function(e){a(e)});break;case 403:var u=t.reason;"dailyLimitExceeded"===u||("userRateLimitExceeded"===u?l():"rateLimitExceeded"===u?l():"appNotAuthorizedToFile"===u?r("No access to file! "+o.args.path):"insufficientFilePermissions"===u?r("Insufficient file permissions! "+o.args.path):"domainPolicy"===u&&r("App cannot be used from this domain! "+o.args.path));break;case 404:r("Bad request! "+o.args.path);break;case 500:console.debug("handleError - reqIdx: "+e+"("+o.args.path+") - [code: "+t.code+", message: "+t.message+", reason: "+t.reason+"]. Retrying #attempt: "+o.attempt),l()}}},{key:"handleGoogleResponse",value:function(e,t,n){var o=this.pendingRequests[e];o.resolve(o.okPreprocess(t,n)),delete this.pendingRequests[e],this.SyncFS.solveStatusReason("gdrive_offline")}},{key:"startRequest",value:function(e,t,n){var o=this,i=this,r=i.reqIdx++;t=t||function(e,t){return e},n=n||function(e){return!1};var a=e;return new Promise(function(e,c){a.callback=function(e,t){"string"==typeof t&&(t=JSON.parse(t));var o=void 0!==t&&t.hasOwnProperty("gapiRequest")&&t.gapiRequest.hasOwnProperty("data")&&t.gapiRequest.data.hasOwnProperty("status")&&200===t.gapiRequest.data.status||!1,a=e&&e.hasOwnProperty("files")&&Array.isArray(e.files)||!1,c=e&&e.hasOwnProperty("changes")&&Array.isArray(e.changes)||!1;if(o||a||c||!e||null===e||!e.error||null===e.error||n(e.error))i.handleGoogleResponse(r,e,t);else if(e&&e.error){var l=e.error;i.handleGoogleError(r,new s.a(l.message,l.code,l.errors[0].reason))}else console.warn("Non successful response "+r+" has no error property: ",e,"rawResponse: ",t)},a.errorCallback=function(e){"timeout"!==e?(console.error("Failed to execute google request:",chrome.runtime.lastError),c(new s.a(chrome.runtime.lastError))):c(new s.a("timeout",500)),i.attemptGoogleReconnect()},i.pendingRequests[r]={args:a,attempt:0,okPreprocess:t,resolve:e,reject:c},o.enqueueRequest(a)})}},{key:"enqueueRequest",value:function(e){this.requestQueue.push(e)}},{key:"startPerformingRequests",value:function(){var e=this;void 0===e.intervalID&&(e.intervalID=window.setInterval(function(){e.performNextRequest()},e.requestInterval))}},{key:"stopPerformingRequests",value:function(){void 0!==this.intervalID&&(window.clearInterval(this.intervalID),this.intervalID=void 0)}},{key:"performNextRequest",value:function(){if(this.requestQueue.length>0){var e=this.requestQueue.shift();gapi.client.request(e)}}}]),t}(a.a);t.a=d},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=function(e){function t(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.load=function(e){r.webview.src=e},r.evaluatingJavaScript=function(e){r.sendMessage({code:e})},r.webview=null,r.eventHandlers={},n&&r.setup(e),r}return r(t,e),c(t,[{key:"setup",value:function(e){this.createWebview(),this.configureWebview(this.webview,e),this.append(),this.eventHandlers.contentload&&this.webview.addEventListener("contentload",this.eventHandlers.contentload)}},{key:"createWebview",value:function(){this.webview=document.createElement("webview")}},{key:"configureWebview",value:function(e,t){var n=e;for(var o in t)t.hasOwnProperty(o)&&("object"===s(t[o])?this.configureWebview(n[o],t[o]):n[o]=t[o])}},{key:"append",value:function(){document.body.appendChild(this.webview)}},{key:"sendMessage",value:function(e){this.webview.contentWindow.postMessage(e,"*")}}]),t}(a.a);t.a=l},function(e,t,n){"use strict";function o(e){if("undefined"!=typeof gapi)throw new Error("gapi already defined.");if("function"!=typeof e)throw new Error("gapiLoadedCallback function must be defined");if(!(chrome&&chrome.app&&chrome.app.runtime)){window.gapiIsLoaded=function(){e()};var t=document.createElement("script");return t.src="https://apis.google.com/js/client.js?onload=gapiIsLoaded",void document.documentElement.appendChild(t)}window.gapi={},window.gapi.auth={},window.gapi.client={},window.ENABLE_DEBUG=!1;var n=void 0;gapi.auth.authorize=function(e,t){if("function"!=typeof t)throw new Error("callback required");var o={};o.interactive=!1===e.immediate||!1,e.accountHint&&(o.accountHint=e.accountHint),console.assert(!e.response_type||"token"==e.response_type);var i=function(e){n=e,t(void 0!==n?{access_token:n}:{error:chrome.runtime.lastError})};chrome.identity.getAuthToken(o,i)},gapi.client.request=function(e){if("object"!==(void 0===e?"undefined":i(e)))throw new Error("args required");if("function"!=typeof e.callback)throw new Error("callback required");if("function"!=typeof e.errorCallback)throw new Error("errorCallback required");if("string"!=typeof e.path)throw new Error("path required");if(e.root&&"string"===e.root)var t=e.root+e.path;else var t="https://www.googleapis.com"+e.path;if("object"===i(e.params))for(var o in e.params)if(-1===t.indexOf(encodeURIComponent(o))){var r=-1===t.indexOf("?")?"?":"&";t+=r+encodeURIComponent(o)+"="+encodeURIComponent(e.params[o])}var a=e.method||"GET",s=[];s[XMLHttpRequest.UNSENT]="UNSENT",s[XMLHttpRequest.OPENED]="OPENED",s[XMLHttpRequest.HEADERS_RECEIVED]="HEADERS_RECEIVED",s[XMLHttpRequest.LOADING]="LOADING",s[XMLHttpRequest.DONE]="DONE";var c=new XMLHttpRequest;if(c.onreadystatechange=function(){window.ENABLE_DEBUG&&"function"==typeof console.debug&&console.debug("XHR :: onreadystatechange - new readyState: "+c.readyState+" ("+s[c.readyState]+") - path: "+t)},c.ontimeout=function(e){window.ENABLE_DEBUG&&"function"==typeof console.warn&&console.warn("XHR :: Browser timeout occurred: "+JSON.stringify(e)+", readyState: "+c.readyState+" ("+s[c.readyState]+") - path: "+t),f()},window.ENABLE_DEBUG&&"function"==typeof console.debug&&console.debug("XHR :: xhr.open("+t+")"),c.open(a,t),c.setRequestHeader("Authorization","Bearer "+n),"object"===i(e.headers))for(var l in e.headers)"content-length"!==l.toLowerCase()&&c.setRequestHeader(l,e.headers[l]);var u=function(){e.responseTimeout&&(window.clearTimeout(e.responseTimeout),delete e.responseTimeout)},d=function(){u(),e.responseTimeout=window.setTimeout(f,5e3)},f=function(){window.ENABLE_DEBUG&&"function"==typeof console.log&&console.log("XHR :: Request timeout - aborting request - readyState: "+c.readyState+" ("+s[c.readyState]+") - path: "+t),u(),c.abort(),e.errorCallback("timeout")};c.onerror=function(n){window.ENABLE_DEBUG&&"function"==typeof console.debug&&console.debug("XHR :: Request error - readyState: "+c.readyState+" ("+s[c.readyState]+") - aborting - path: "+t,"errorEvent: ",n),u(),e.errorCallback()},c.onabort=function(e){window.ENABLE_DEBUG&&"function"==typeof console.debug&&console.debug("XHR :: Request aborted - readyState: "+c.readyState+" ("+s[c.readyState]+") - aborted - path: "+t,"abortEvent: ",e)};var g=function(e){if(null===e)return null;if(""===e)return"";for(var t={},n=e.split("\r\n"),o=0;o<n.length;o++){var i=n[o];if(i&&i.trim().length>0){var r=i.indexOf(":"),a=i.substr(0,r).trim(),s=i.substr(r+1).trim();!isNaN(parseFloat(s))&&isFinite(s)&&(s=parseFloat(s)),t[a]=s}}return t};c.onload=function(){u();var t={gapiRequest:{data:{status:this.status,statusText:this.statusText,responseHeaders:g(this.getAllResponseHeaders())}}};if(this.response){var n=this.response;if("string"==typeof this.response){var o=c.getResponseHeader("Content-Type");if("string"==typeof o&&o.startsWith("application/json"))try{n=JSON.parse(n)}catch(e){if(e instanceof SyntaxError)try{n=JSON.parse(n)}catch(e){try{n=n.replace(/={1,2}$/,"")}catch(t){console&&null!==console&&console.warn&&null!==console.warn&&console.warn("Failed parsing json string - raw response: ",this.response,"Error: ",e," Callback will be called with the raw response")}}}}e.callback(n,t)}else e.callback(null,t)},("PUT"===a||"PATCH"===a?c.upload:c).onprogress=function(e){window.ENABLE_DEBUG&&console.debug("XHR :: onprogress: "+(e.lengthComputable?(e.loaded/e.total*100).toFixed(0):"?")+"% - "+a+": "+t+" ("+e.loaded+"/"+e.total+" bytes)"),d()},"string"==typeof e.responseType&&(c.responseType=e.responseType),e.bodyType&&null!==e.bodyType?(c.setRequestHeader("Content-Type",e.bodyType),c.send(e.body)):void 0!==e.body?(c.setRequestHeader("Content-Type","application/json"),c.send(JSON.stringify(e.body))):c.send(),d()},setTimeout(function(){e()},0)}t.a=o;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}},function(e,t,n){"use strict";function o(e,t,n,r){var a,s,c,l,u,d,f=isFinite(n)?n:0,g=15;t&&(this.encoding=t.toString());e:switch(this.encoding){case"UTF-8":l=o.putUTF8CharCode,u=o.getUTF8CharLength,a=Uint8Array;break e;case"UTF-16":l=o.putUTF16CharCode,u=o.getUTF16CharLength,a=Uint16Array;break e;case"UTF-32":a=Uint32Array,g&=14;break e;default:a=Uint8Array,g&=14}e:switch(void 0===e?"undefined":i(e)){case"string":g&=7;break e;case"object":switch(e.constructor){case o:g&=3;break e;case String:g&=7;break e;case ArrayBuffer:s=new a(e),d="UTF-32"===this.encoding?e.byteLength>>>2:"UTF-16"===this.encoding?e.byteLength>>>1:e.byteLength,c=0!==f||isFinite(r)&&r!==d?new a(e,f,isFinite(r)?r:d-f):s;break e;case Uint32Array:case Uint16Array:case Uint8Array:a=e.constructor,d=e.length,s=0===e.byteOffset&&e.length===(a===Uint32Array?e.buffer.byteLength>>>2:a===Uint16Array?e.buffer.byteLength>>>1:e.buffer.byteLength)?e:new a(e.buffer),c=0!==f||isFinite(r)&&r!==d?e.subarray(f,isFinite(r)?f+r:d):e;break e;default:s=new a(e),d=s.length,c=0!==f||isFinite(r)&&r!==d?s.subarray(f,isFinite(r)?f+r:d):s}break e;default:s=c=new a(Number(e)||0)}if(g<8){var p,h,v,m,y,b,w;4&g?(p=e,h=d=p.length,g^="UTF-32"===this.encoding?0:2,f=v=n?Math.max((h+n)%h,0):0,y=m=(Number.isInteger(r)?Math.min(Math.max(r,0)+f,h):h)-1):(p=e.rawData,d=e.makeIndex(),f=v=n?Math.max((d+n)%d,0):0,h=Number.isInteger(r)?Math.min(Math.max(r,0),d-v):d,y=m=h+v,"UTF-8"===e.encoding?(b=o.getUTF8CharLength,w=o.loadUTF8CharCode):"UTF-16"===e.encoding?(b=o.getUTF16CharLength,w=o.loadUTF16CharCode):g&=1),(0===h||g<4&&p.encoding===this.encoding&&0===v&&h===d)&&(g=7);e:switch(g){case 0:s=new a(h);for(var S=0;S<h;s[S]=p[f+S++]);break e;case 1:h=0;for(var R=f;R<y;R++)h+=u(p[R]);s=new a(h);for(var R=f,S=0;S<h;R++)S=l(s,p[R],S);break e;case 2:f=0;var P;for(D=0;D<v;D++)P=w(p,f),f+=b(P);s=new a(h);for(var R=f,S=0;S<h;R+=b(P),S++)P=w(p,R),s[S]=P;break e;case 3:h=0;for(var P,D=0,R=0;D<m;R+=b(P))P=w(p,R),D===v&&(f=R),++D>v&&(h+=u(P));s=new a(h);for(var R=f,S=0;S<h;R+=b(P))P=w(p,R),S=l(s,P,S);break e;case 4:s=new a(h);for(var C=0;C<h;C++)s[C]=255&p.charCodeAt(C);break e;case 5:h=0;for(var F=0;F<d;F++)F===v&&(f=h),h+=u(p.charCodeAt(F)),F===m&&(y=h);s=new a(h);for(var S=0,D=0;S<h;D++)S=l(s,p.charCodeAt(D),S);break e;case 6:s=new a(h);for(var C=0;C<h;C++)s[C]=p.charCodeAt(C);break e;case 7:s=new a(h?p:0)}c=g>3&&(f>0||y<s.length-1)?s.subarray(f,y):s}this.buffer=s.buffer,this.bufferView=s,this.rawData=c,Object.freeze(this)}t.a=o;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Number.isInteger||(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&e>-9007199254740992&&e<9007199254740992&&Math.floor(e)===e}),o.loadUTF8CharCode=function(e,t){var n=e.length,o=e[t];return o>251&&o<254&&t+5<n?1073741824*(o-252)+(e[t+1]-128<<24)+(e[t+2]-128<<18)+(e[t+3]-128<<12)+(e[t+4]-128<<6)+e[t+5]-128:o>247&&o<252&&t+4<n?(o-248<<24)+(e[t+1]-128<<18)+(e[t+2]-128<<12)+(e[t+3]-128<<6)+e[t+4]-128:o>239&&o<248&&t+3<n?(o-240<<18)+(e[t+1]-128<<12)+(e[t+2]-128<<6)+e[t+3]-128:o>223&&o<240&&t+2<n?(o-224<<12)+(e[t+1]-128<<6)+e[t+2]-128:o>191&&o<224&&t+1<n?(o-192<<6)+e[t+1]-128:o},o.putUTF8CharCode=function(e,t,n){var o=n;return t<128?e[o++]=t:t<2048?(e[o++]=192+(t>>>6),e[o++]=128+(63&t)):t<65536?(e[o++]=224+(t>>>12),e[o++]=128+(t>>>6&63),e[o++]=128+(63&t)):t<2097152?(e[o++]=240+(t>>>18),e[o++]=128+(t>>>12&63),e[o++]=128+(t>>>6&63),e[o++]=128+(63&t)):t<67108864?(e[o++]=248+(t>>>24),e[o++]=128+(t>>>18&63),e[o++]=128+(t>>>12&63),e[o++]=128+(t>>>6&63),e[o++]=128+(63&t)):(e[o++]=252+t/1073741824,e[o++]=128+(t>>>24&63),e[o++]=128+(t>>>18&63),e[o++]=128+(t>>>12&63),e[o++]=128+(t>>>6&63),e[o++]=128+(63&t)),o},o.getUTF8CharLength=function(e){return e<128?1:e<2048?2:e<65536?3:e<2097152?4:e<67108864?5:6},o.loadUTF16CharCode=function(e,t){var n=e[t];return n>55231&&t+1<e.length?(n-55296<<10)+e[t+1]+9216:n},o.putUTF16CharCode=function(e,t,n){var o=n;return t<65536?e[o++]=t:(e[o++]=55232+(t>>>10),e[o++]=56320+(1023&t)),o},o.getUTF16CharLength=function(e){return e<65536?1:2},o.b64ToUint6=function(e){return e>64&&e<91?e-65:e>96&&e<123?e-71:e>47&&e<58?e+4:43===e?62:47===e?63:0},o.uint6ToB64=function(e){return e<26?e+65:e<52?e+71:e<62?e-4:62===e?43:63===e?47:65},o.bytesToBase64=function(e){for(var t,n=(3-e.length%3)%3,i="",r=e.length,a=0,s=0;s<r;s++)t=s%3,a|=e[s]<<(16>>>t&24),2!==t&&e.length-s!=1||(i+=String.fromCharCode(o.uint6ToB64(a>>>18&63),o.uint6ToB64(a>>>12&63),o.uint6ToB64(a>>>6&63),o.uint6ToB64(63&a)),a=0);return 0===n?i:i.substring(0,i.length-n)+(1===n?"=":"==")},o.base64ToBytes=function(e,t){for(var n,i,r=e.replace(/[^A-Za-z0-9\+\/]/g,""),a=r.length,s=t?Math.ceil((3*a+1>>>2)/t)*t:3*a+1>>>2,c=new Uint8Array(s),l=0,u=0,d=0;d<a;d++)if(i=3&d,l|=o.b64ToUint6(r.charCodeAt(d))<<18-6*i,3===i||a-d==1){for(n=0;n<3&&u<s;n++,u++)c[u]=l>>>(16>>>n&24)&255;l=0}return c},o.makeFromBase64=function(e,t,n,i){return new o("UTF-16"===t||"UTF-32"===t?o.base64ToBytes(e,"UTF-16"===t?2:4).buffer:o.base64ToBytes(e),t,n,i)},o.prototype.encoding="UTF-8",o.prototype.makeIndex=function(e,t){var n,o=this.rawData,i=o.length,r=t||0,a=r,s=isNaN(e)?1/0:e;if(e+1>o.length)throw new RangeError("StringView.prototype.makeIndex - The offset can't be major than the length of the array - 1.");switch(this.encoding){case"UTF-8":var c;for(n=0;a<i&&n<s;n++)c=o[a],a+=c>251&&c<254&&a+5<i?6:c>247&&c<252&&a+4<i?5:c>239&&c<248&&a+3<i?4:c>223&&c<240&&a+2<i?3:c>191&&c<224&&a+1<i?2:1;break;case"UTF-16":for(n=r;a<i&&n<s;n++)a+=o[a]>55231&&a+1<o.length?2:1;break;default:a=n=isFinite(e)?e:i-1}return e?a:n},o.prototype.toBase64=function(e){return o.bytesToBase64(e?this.bufferView.constructor===Uint8Array?this.bufferView:new Uint8Array(this.buffer):this.rawData.constructor===Uint8Array?this.rawData:new Uint8Array(this.buffer,this.rawData.byteOffset,this.rawData.length<<(this.rawData.constructor===Uint16Array?1:2)))},o.prototype.subview=function(e,t){var n,i,r,a,s,c="UTF-8"===this.encoding||"UTF-16"===this.encoding,l=this.rawData.length;return 0===l?new o(this.buffer,this.encoding):(s=c?this.makeIndex():l,r=e?e+1>s?s:Math.max((s+e)%s,0):0,a=Number.isInteger(t)?Math.max(t,0)+r>s?s-r:t:s-r,0===r&&a===s?this:(c?(i=r<s?this.makeIndex(r):s,n=a?this.makeIndex(a,i)-i:0):(i=r,n=a),"UTF-16"===this.encoding?i<<=1:"UTF-32"===this.encoding&&(i<<=2),new o(this.buffer,this.encoding,this.rawData.byteOffset+i,n)))},o.prototype.forEachChar=function(e,t,n,i){var r,a,s=this.rawData;if("UTF-8"===this.encoding||"UTF-16"===this.encoding){var c,l;"UTF-8"===this.encoding?(c=o.getUTF8CharLength,l=o.loadUTF8CharCode):"UTF-16"===this.encoding&&(c=o.getUTF16CharLength,l=o.loadUTF16CharCode),a=isFinite(n)?this.makeIndex(n):0,r=isFinite(i)?this.makeIndex(i,a):s.length;for(var u,d=0;a<r;d++)u=l(s,a),t?e.call(t,u,d,a,s):e(u,d,a,s),a+=c(u)}else for(a=isFinite(n)?n:0,r=isFinite(i)?i+a:s.length,a;a<r;a++)t?e.call(t,s[a],a,a,s):e(s[a],a,a,s)},o.prototype.valueOf=o.prototype.toString=function(){if("UTF-8"!==this.encoding&&"UTF-16"!==this.encoding)return String.fromCharCode.apply(null,this.rawData);var e,t,n="";"UTF-8"===this.encoding?(t=o.getUTF8CharLength,e=o.loadUTF8CharCode):"UTF-16"===this.encoding&&(t=o.getUTF16CharLength,e=o.loadUTF16CharCode);for(var i,r=this.rawData.length,a=0;a<r;a+=t(i))i=e(this.rawData,a),n+=String.fromCharCode(i);return n}},function(e,t,n){"use strict";function o(){return"["+(Date.now()-w)/1e3+"] "}function i(e){return"string"==typeof e?e:r(e)}function r(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:" ",o="",i=t;i<e.length;i++){i>t&&(o+=n);var r=b(e[i]);if(null!==e[i])if("object"===r){var a={};a.o=e[i];var s=[];e[i].hasOwnProperty("toString")&&"function"==typeof e[i].toString?o+=e[i].toString():o+=JSON.stringify(a,function(e,t){if("object"===(void 0===t?"undefined":b(t))&&null!==t){if(-1!==s.indexOf(t))return;s.push(t)}return t},"\t"),s=null}else o+=e[i];else o+="null"}return o}Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),s=n(9),c=n(22),l=n(4),u=n(20),d=n(21),f=n(15),g=n(16),p=n(17),h=n(10),v=n(18),m=n(19),y=n(8),b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Date.now||(Date.now=function(){return(new Date).getTime()});var w=Date.now(),S=console;window.console={log:function(){var e=[i(arguments)];Array.prototype.unshift.call(e,o()),S.log.apply(S,e)},trace:function(){var e=[i(arguments)];Array.prototype.unshift.call(e,o()),S.trace.apply(S,e)},info:function(){var e=[i(arguments)];Array.prototype.unshift.call(e,o()),S.info.apply(S,e)},error:function(){var e=[i(arguments)];Array.prototype.unshift.call(e,o()),S.error.apply(S,e)},debug:function(){var e=i(arguments);if(-1===e.indexOf("Screen position out of view frustum")){var t=[e];Array.prototype.unshift.call(t,o()),S.debug.apply(S,t)}},assert:function(){var e=[i(arguments)];Array.prototype.unshift.call(e,o()),S.assert.apply(S,e)},warn:function(){var e=[i(arguments)];Array.prototype.unshift.call(e,o()),S.warn.apply(S,e)},time:function(){var e=[i(arguments)];S.time.apply(S,e)},timeStamp:function(){var e=[i(arguments)];S.timeStamp.apply(S,e)},timeEnd:function(){var e=[i(arguments)];S.timeEnd.apply(S,e)}};var R=console,P=new l.a,D=new c.a,C=new a.a(R,window),F={log:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];R.log("[SyncFS] ",t)}},E=new s.a;window.addEventListener("load",function(){E.onBoundsChanged()});var I=new y.a(["cros"],!0,"splashscreen"),_=function(){R.debug("[App.js] On supported platform");var e=document.createElement("webview");e.id="webgl",e.setAttribute("src","webgl/index.html"),e.setAttribute("partition","persist:webgl"),document.getElementById("parent").appendChild(e),setTimeout(function(){document.getElementById("webgl").setZoomMode("disabled")},1e3),document.getElementById("webgl").addEventListener("dialog",function(e){R.debug("[App.js] Dialog from webgl webview",e.messageText)}),document.addEventListener("mousewheel",function(e){!0===e.ctrlKey&&(e.preventDefault(),e.stopPropagation())}),C.initialize().then(function(){chrome.runtime.getPlatformInfo(function(e){R.debug(chrome.runtime.getManifest().name+" manifest version: "+chrome.runtime.getManifest().version+" starting on "+e.os+" "+e.arch+" - Chrome details("+navigator.appVersion+") - onLine: "+navigator.onLine)}),D.initialize(P),C.register("Killswitch",new m.a),C.register("ExternalLink",new v.a),C.register("Splashscreen",E),C.register("Storage",P),C.register("PlatformInfo",new u.a),C.register("Audio",new f.a),C.register("Video",new d.a(P)),C.register("Content",new p.a({id:"contentViewer",style:{width:"600px",position:"absolute",display:"none"},partition:"persist:webgl"})),C.register("Bluetooth",new g.a(R,window)),C.register("SyncFS",new h.a(F,E))}).catch(function(e){console.error("ChromeApp failed registration of libraries",e)})};I.runOnApprovedOS(_)},,function(e,t){e.exports=LEGO_BLE_SDK}]);
//# sourceMappingURL=chromeapp.bundle.js.map