!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=28)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return i(e,[{key:"getPublicFunctions",value:function(){return Object.keys(this)}},{key:"handle",value:function(e){var t=e.data.map(function(e){return e});return this[e.method].apply(null,t)}}]),e}();t.a=o},,function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=null,a=function(){function e(){return r(this,e),o||(o=this),o}return i(e,[{key:"handle",value:function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];e.forward(n.target,n.method,n.data)}}],[{key:"setAppWindow",value:function(e){o.appWindow=e}},{key:"setAppOrigin",value:function(e){o.appOrigin=e}},{key:"getAppWindow",value:function(){return o.appWindow}},{key:"getAppOrigin",value:function(){return o.appOrigin}},{key:"forward",value:function(t,n,r){e.getAppOrigin()&&e.getAppWindow()&&e.getAppWindow().postMessage({sender:"unity",target:n,method:t,data:r},e.getAppOrigin())}}]),e}();t.a=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=null,a=function(){function e(){return r(this,e),null===o&&(o=this,this.queue=[]),o}return i(e,[{key:"setUnityGameInstance",value:function(e){e?(profileEnd("SetUnityGameInstance","Unity game instance received"),o.unityGameInstance=e):console.warn("UnityMessageHandler.setUnityGameInstance got undefined instance")}},{key:"setUnityObjectName",value:function(e){for(profileEnd("SetUnityObjectName","Unity object name '"+e+"' received"),o.unityObjectName=e;this.queue.length>0;){var t=this.queue.shift();this.callUnity.apply(this,t)}}},{key:"callUnity",value:function(e,t){o.unityObjectName?SendMessage(o.unityObjectName,e,"string"!=typeof t?JSON.stringify(t):t):this.queue.push([e,t])}}]),e}();t.a=a},,,,function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(3),o=n(2),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(){function e(t,n){var a=this;r(this,e),this.addProfilingUtils(),this.unityMessageHandler=new i.a,this.messageForwarder=new o.a,this.$logger=t,this.$window=n,this.$window.addEventListener("message",function(e){a.receiveMessage.call(a,e)}),this.$window.unity={Setup:this.unityMessageHandler},this.listeners={}}return s(e,[{key:"addProfilingUtils",value:function(){window.profileBegin=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.prototype.unshift.call(n,"<A-"+e+"> "),console.log.apply(console,n)},window.profileEnd=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.prototype.unshift.call(n,"<B-"+e+"> "),console.log.apply(console,n)}}}]),s(e,[{key:"attachToGlobalUnityFunction",value:function(e){var t=this;e.methods.forEach(function(n){t.$window.unity[e.name]||(t.$window.unity[e.name]={}),t.$window.unity[e.name][n]=function(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];o.a.forward(n,e.name,r)}}),this.$logger.log("Registered "+e.name)}},{key:"initialize",value:function(){var e=this;return new Promise(function(t){e.$logger.debug("Initialize"),t()})}},{key:"attachListener",value:function(e,t){this.listeners[e]=t}},{key:"receiveMessage",value:function(e){if(!o.a.getAppWindow()||!o.a.getAppOrigin())return o.a.setAppWindow(e.source),o.a.setAppOrigin(e.origin),void this.$logger.log("Established connection with app window");if("register"===e.data.type)return void this.attachToGlobalUnityFunction(e.data);if("unity"===e.data.target)return void this.unityMessageHandler.callUnity(e.data.method,e.data.data);if("sendUnityData"===e.data.target)return void this.sendDataToUnity(e.data.data,e.data.transferID,e.data.metadata,e.data.unityCallback);if("requestUnityData"===e.data.target)return o.a.forward(e.data.callbackName,e.data.sender,[e.data.metadata,window._transferToJS[e.data.transferID]]),void delete window._transferToJS[e.data.transferID];var t=this.listeners[e.data.target],n=e.data.target+"."+e.data.method+"("+JSON.stringify(e.data.data)+")";try{t&&t.handle?t.handle(e.data):this.$logger.warn('UnityApp - receiveMessage - No listener found for "'+e.data.target+'" in this.listeners: ',this.listeners)}catch(t){this.$logger.error("UnityApp - receiveMessage - listener handling for "+n+" failed! Event: "+JSON.stringify(e.data)+" ==> Error [ "+(t.message?"message: "+t.message+", ":"")+(t.stack?"Stack: "+t.stack:"")+" ]")}}},{key:"sendDataToUnity",value:function(e,t,n,r){console.log(t.name+" "+t.len+" "+(void 0===e?"undefined":a(e)));var i=this.$window;i._transferToUnity=i._transferToUnity?i._transferToUnity:{},i._transferToUnity[n]=e,this.unityMessageHandler.callUnity(r,t)}}]),e}();t.a=u},,,,function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=n(2),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._attachTrackingDelegate=function(){var t=e;if(!e.globalExists("FS"))return void setTimeout(e._attachTrackingDelegate,100);var n=FS.trackingDelegate.onWriteToFile;console.log("origOnWriteToFile: "+n),FS.trackingDelegate.onWriteToFile=function(e){void 0!==n&&n(e),t._trackingFilesChanges&&t._shouldAutoTrackFile(e)&&(t._modifiedFiles.has(e)||t._modifiedFiles.add(e))},console.log("Attached tracking delegate")},e.globalExists=function(e){return e in window},e.readRawFile=function(t,n){var r,i=e._readFile(t,"binary");i&&(r=i.buffer),s.a.forward("IDB_OnReadComplete","SyncFS",[t,r,n])},e.writeRawFile=function(t,n,r){e._writeFile(t,"binary",new Uint8Array(n),r)},e.readTextFile=function(t,n){profileBegin("R","IDB Read file: "+t);var r=e._readFile(t,"utf8");profileEnd("R","IDB Read complete"),s.a.forward("IDB_OnReadComplete","SyncFS",[t,r,n])},e.writeTextFile=function(t,n,r){e._writeFile(t,"utf8",n,r)},e._readFile=function(e,t){var n;try{n=FS.readFile(e,{encoding:t})}catch(n){console.log("Failed to read file "+e+" using encoding: "+t+", error: "+JSON.stringify(n))}return n},e._writeFile=function(t,n,r,i){var o=t.split("/").slice(0,-1).join("/");e._createDirectoryRecursive(o),r&&console.log("Writing "+r.length+" bytes to file path "+t+" encoding: "+n),FS.writeFile(t,r,{encoding:n}),s.a.forward("IDB_OnWriteComplete","SyncFS",[t,i])},e.createDirectory=function(e){FS.mkdir(e),s.a.forward("IDB_OnDirectoryCreated","SyncFS",[e])},e._createDirectoryRecursive=function(e){for(var t=e.split("/").slice(2),n="/idbfs",r=0;r<t.length;r++){n+="/"+t[r];try{FS.mkdir(n)}catch(e){}}},e.removeDirectory=function(t){e.removeDirectoryContentsRecursively(t),FS.rmdir(t),s.a.forward("IDB_OnDirectoryRemoved","SyncFS",[t])},e.removeFile=function(e){FS.unlink(e),s.a.forward("IDB_OnFileRemoved","SyncFS",[e])},e.removeDirectoryContents=function(t){e.removeDirectoryContentsRecursively(t)},e.reverseFlush=function(e){profileBegin("Rev","IDB start reverse flush"),FS.syncfs(!0,function(t){t&&console.error("SyncFS_IDB - reverseFlush - failed FS.syncfs"),s.a.forward("IDB_OnChangesFlushed","SyncFS",[e]),profileEnd("Rev","IDB end reverse flush")})},e.flushChanges=function(t){if(e.flushing)return void e.flushQueue.push(t);profileBegin("F","IDB start flush");var n=e;e.flushing=!0,FS.syncfs(!1,function(e){profileEnd("F","IDB end flush"),s.a.forward("IDB_OnChangesFlushed","SyncFS",[t]),n.flushing=!1,n.flushQueue.length>0&&n.flushChanges(n.flushQueue.shift())})},e.printFolderStructure=function(t){e.listFolderStructure(t).forEach(function(e){console.log(e)})},e.listFolderStructure=function(t){for(var n=[],r=FS.readdir(t),i=0;i<r.length;++i){var o=r[i];if("."!==o&&".."!==o){var a=t+"/"+o,s=FS.stat(a).mode;FS.isDir(s)?n=n.concat(e.listFolderStructure(a)):n.push(a)}}return n},e.startTrackingFileChanges=function(){console.log("SyncFS_IDB.startTrackingFileChanges()");var t=e;e._trackingFilesChanges=!0,setInterval(function(){t._syncChangedFiles()},1e3)},e._syncChangedFiles=function(){e._modifiedFiles.forEach(function(e){s.a.forward("IDB_OnTrackedFileModified","SyncFS",[e])}),e._modifiedFiles.clear()},e._shouldRemoveFile=function(e){return!0},e._shouldAutoTrackFile=function(t){return t===e._playerPrefsPath},e._setup(),e}return o(t,e),u(t,[{key:"_setup",value:function(){console.log("SyncFS_IDB._setup()"),this._playerPrefsPath="/idbfs/PlayerPrefs",this._trackingFilesChanges=!1,this._modifiedFiles=new Set,this._attachTrackingDelegate(),this.flushQueue=[],this.flushing=!1}},{key:"removeDirectoryContentsRecursively",value:function(e){for(var t=this,n=FS.readdir(e),r=0;r<n.length;++r){var i=n[r];if("."!==i&&".."!==i){var o=e+"/"+i,a=FS.stat(o).mode;FS.isDir(a)?(t.removeDirectoryContentsRecursively(o),FS.rmdir(o)):t._shouldRemoveFile(o)?FS.unlink(o):console.log("will NOT remove file: "+o)}}}}]),t}(a.a);t.a=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=n(3),u=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setUnityObjectName=function(t){for(e.unityObjectName=t;e.queue.length>0;){var n=e.queue.unshift();e.sendData.apply(e,n)}},e.sendData=function(t){e.unityObjectName?SendMessage(e.unityObjectName,t.method,"string"!=typeof t.data?JSON.stringify(t.data):t.data):e.queue.push([method,t])},e.queue=[],e.unityMessageHandler=new s.a,e}return o(t,e),t}(a.a);t.a=u},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=n(3),u=n(2),c=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.saveFile=function(t){var n=new FileReader;n.onload=function(r){var i=new Int8Array(n.result);FS.writeFile(t.filePath,i,{encoding:"binary"}),FS.syncfs(!1,function(n){n?console.log(n):(e.unityMessageHandler.callUnity("OnRecieveMessageFromChromeOS",t.dataURL),u.a.forward("saveFile","SyncFS",[t.filePath]))})},n.readAsArrayBuffer(t.fileBlob)},e.unityMessageHandler=new s.a,e}return o(t,e),t}(a.a);t.a=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=function(e){function t(){var e,n,o,a;r(this,t);for(var s=arguments.length,u=Array(s),c=0;c<s;c++)u[c]=arguments[c];return n=o=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),o.resize=function(e){var t=window.document.getElementById("#canvas");if(!t){var n=window.document.getElementsByTagName("canvas");1===n.length?t=n[0]:console.info("Found "+n.length+" <canvas> elements on page - none of them with id #canvas")}t?(t.width=e.width,t.height=e.height):console.error("No unityCanvas found. Unable to set width and height data after resize")},a=n,i(o,a)}return o(t,e),t}(a.a);t.a=s},,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(14),i=n(13),o=n(11),a=n(12),s=n(7),u=new s.a(console,window);u.initialize().then(function(){u.attachListener("window",new r.a),u.attachListener("emscriptenFSHandler",new i.a),u.attachListener("SyncFS_IDB",new o.a),u.attachListener("bluetoothHandler",new a.a)})}]);
//# sourceMappingURL=unity.bundle.js.map