{"version":3,"sources":["webpack:///chromeapp.bundle.js","webpack:///webpack/bootstrap c3b1f8227955d8cd9346","webpack:///./src/components/BaseModule.js","webpack:///./src/MessageHandler.js","webpack:///./src/MessageForwarder.js","webpack:///../chromeos_resources/src/components/Storage.js","webpack:///./src/components/SyncError.js","webpack:///./src/ChromeApp.js","webpack:///./src/components/OSLimiter.js","webpack:///./src/components/Splashscreen.js","webpack:///./src/components/SyncFS.js","webpack:///../chromeos_resources/src/components/Audio.js","webpack:///../chromeos_resources/src/components/Bluetooth.js","webpack:///../chromeos_resources/src/components/ContentViewerWebview.js","webpack:///../chromeos_resources/src/components/ExternalLink.js","webpack:///../chromeos_resources/src/components/Killswitch.js","webpack:///../chromeos_resources/src/components/PlatformInfo.js","webpack:///../chromeos_resources/src/components/Video.js","webpack:///../chromeos_resources/src/components/Window.js","webpack:///./src/components/GoogleDrive.js","webpack:///./src/components/Webview.js","webpack:///./src/gapi_chrome_apps.js","webpack:///./src/stringview.js","webpack:///../chromeos_resources/src/app.js","webpack:///external \"LEGO_BLE_SDK\""],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","__webpack_exports__","_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","length","descriptor","writable","key","protoProps","staticProps","BaseModule","this","keys","message","args","data","map","arg","method","apply","MessageHandler","view","getInstance","contentWindow","postMessage","sender","metadata","transferID","unityCallback","callbackName","MessageForwarder","forward","appWindow","appOrigin","getAppOrigin","getAppWindow","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","__WEBPACK_IMPORTED_MODULE_0_components_BaseModule__","__WEBPACK_IMPORTED_MODULE_1_MessageHandler__","Storage","isSavingFile","savingFile","showFilePicker","mimeType","filePath","fileTypes","mimeTypes","chrome","fileSystem","chooseEntry","type","accepts","entry","runtime","lastError","console","warn","currentFileEntry","fileSplit","split","fileExt","file","saveFilePath","dataURL","saveFileToIndexDB","saveFile","fileBlob","extension","writeSuccessCallback","writeErrorCallback","config","suggestedName","extensions","writableEntry","createWriter","writer","onerror","error","onwriteend","e","loaded","total","truncate","size","waitForIO","seek","write","callWebGL","_BaseModule","callback","start","Date","now","reentrant","readyState","WRITING","setTimeout","abort","SyncError","code","reason","ChromeApp","$logger","$window","addProfilingUtils","webgl","listeners","window","profileBegin","tag","Array","unshift","log","profileEnd","Promise","resolve","debug","loadCompleted","addEventListener","event","handleMessage","attachListeners","sendHelloMessage","setWebGL","document","listenerName","listenerInstance","methods","getPublicFunctions","webview","id","afterLoadCallback","getElementById","messageType","messageText","dialog","ok","$event","handle","OSLimiter","approvedList","allowDevelopmentMode","parentElementId","runOnApprovedOS","approved","service","approvedFn","getPlatformInfo","info","isSupportedOS","os","inDevelopmentMode","documentElement","className","unsupportedOS","createElement","appendChild","createTextNode","i18n","getMessage","closeLink","onclick","close","body","getManifest","developmentMode","indexOf","Splashscreen","options","mainElement","splashscreenElement","splashscreenTagId","barElement","loadingBar","loadingBarId","hide","style","display","show","removeProperty","unityDoneLoading","unityProgress","unityDone","updateTotalProgress","updateProgress","progress","updateSyncProgress","syncProgress","totalProgress","currentProgress","Math","max","fullWidth","width","callUnity","onBoundsChanged","imageWidth","initialProgress","app","current","addListener","bind","__WEBPACK_IMPORTED_MODULE_2_components_GoogleDrive__","__WEBPACK_IMPORTED_MODULE_3_components_SyncError__","GD_RESUMABLE_UPLOAD_SIZE_THRESHOLD","SyncFS","$splashscreen","initializeFileSystem","syncMetadata","idbfsReverseFlush","then","readSyncMetadata","_debugLog","_completeInitializationStep","initGoogleDrive","_this","reject","drive","GoogleDrive","timestamp","initialize","googleDrive","syncError","reauthenticate","reauthenticating","solveStatusReason","catch","authError","requestStatusUpdate","sendStatus","idx","status","reasons","pop","state","attemptStatusChange","pushNextChange","pauseFileSync","fileSyncIsPaused","resumeFileSync","JSON","stringify","addIOAction","actionType","paths","fileId","_getFileID","removePendingWriteActions","action","changes","pendingLocalChanges","pushingChangeIdx","push","writeSyncMetadata","signalFlushRequired","ensureStateIsFlushed","path","pushingChange","filter","change","_initializationCheck","removeIdbfsFromPath","_normalizePath","updateFileModifiedTime","modifiedTime","saveMetadata","files","createDirectoryTree","deleteFile","_deleteFile","copyFile","sourcePath","destPath","_copyFile","moveFile","_moveFile","deleteDirectory","startsWith","copyDirectory","len","destFilePath","substr","moveDirectory","from","a","parse","initialized","replace","undefined","fetchRemoteFileList","getFileList","allFiles","forEach","_GD_writeFile","idbfsReadRawFile","byteLength","ENABLE_DEBUG","uploadFile","uploadFileResumable","_GD_deleteFile","_GD_copyFile","_GD_moveFile","changeIndex","doActualPush","ioActionImpl","concat","result","shift","finishPushingChange","abortPushingChanges","syncInProgress","nextChangeIdx","idbfsFlushChanges","performBigSync","failBigSync","updateBigSyncSyncProgress","sync","localFiles","localDeleteList","computeLocalDeleteList","remoteFiles","fetchRemoteChangesSinceLastSync","changeResponse","lastStartPageToken","newStartPageToken","remoteDeleteList","computeRemoteDeleteList","remoteToLocalOps","mergeFileSystems","localToRemoteOps","numTotalOps","numCompletedOps","completeSyncMergeOperation","round","all","op","func","params","finishBigSync","reverseFlushNeeded","revertChanges","access_token","needsFlushing","internalNeedsFlushing","flushPromises","masterFlushPromise","doFlush","idbfsGetPromiseToken","token","idbToken","idbPromises","idbfsResolvePromise","idbfsRejectPromise","idbfsCreateDirectory","idbfsPath","idbfsReadTextFile","idbfsWriteRawFile","idbfsWriteTextFile","contents","idbfsRemoveFile","IDB_OnWriteComplete","context","IDB_OnReadComplete","IDB_OnFileRemoved","IDB_OnDirectoryCreated","IDB_OnDirectoryRemoved","IDB_OnTrackedFileModified","IDB_OnChangesFlushed","syncMetadataPath","fileContent","metadataContents","date","pad","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","getChangeList","getChangeStartPageToken","response","startPageToken","removedFileIds","removed","srcFiles","srcDeleteList","destFiles","destDeleteList","srcIsRemote","srcFilePaths","destFilePaths","ops","filesToDelete","srcFilePath","srcFile","includes","destFile","srcFileModifiedDate","destFileModifiedDate","copyFileToFilesystem","deleteFileFromFilesystem","download","remoteFileId","downloadFile","isRemoteFS","_setup","isOnline","navigator","onLine","onlineListener","_updateOnlineStatus","target_state","hasUserDeclinedAuth","newState","newReasons","oldState","changed","legal","errorStateForStatus","Audio","initAudio","bufferSize","audioBufferSize","getUserMedia","webkitGetUserMedia","AudioContext","webkitAudioContext","audioContext","enableDisableAudio","enable","enabled","audio","audioStream","setupVolumeListening","audioIntervalID","setInterval","getVolume","teardownAudioRecording","teardownVolumeListening","stop","clearInterval","startRecording","isListening","setupAudioRecording","audioRecordRTC","stopRecording","resumeListening","isAudioRecording","handleAudio","toURL","newIsListening","audioURL","RecordRTC","recorderType","StereoAudioRecorder","numberOfAudioChannels","disableLogs","onStateChanged","audioWorker","onmessage","command","sendVolume","volume","recorder","createScriptProcessor","onaudioprocess","inputData","inputBuffer","getChannelData","buffer","inputPoint","createGain","gain","setTargetAtTime","currentTime","realAudioInput","createMediaStreamSource","connect","zeroGain","destination","disconnect","clipVolume","Worker","getSimpleRevision","legoFirmwareRevision","MajorVersion","majorVersion","MinorVersion","minorVersion","BugFixVersion","bugFixVersion","BuildNumber","buildNumber","getSimpleRevisionString","revisionObj","getSimpleDeviceInfo","legoDeviceInfo","FirmwareRevision","firmwareRevision","HardwareRevision","hardwareRevision","SoftwareRevision","softwareRevision","ManufacturerName","manufacturerName","getSimpleLegoDevice","legoBluetoothDevice","DeviceID","deviceId","DeviceName","deviceName","ButtonState","isButtonPressed","BatteryLevel","batteryLevel","LowVoltageState","isLowVoltage","DeviceInfo","deviceInfo","ConnectedState","connectState","Category","category","SupportedFunctions","supportedFunctions","LastConnectedNetworkId","lastConnectedNetworkId","getSimpleInputFormat","inputFormat","Revision","revision","ConnectID","connectId","TypeID","typeId","Mode","mode","DeltaInterval","deltaInterval","Unit","unit","NotificationsEnabled","notificationsEnabled","getSimpleConnectInfo","legoConnectInfo","HubIndex","hubIndex","Type","hardwareVersion","firmwareVersion","getSimpleServiceData","legoServiceData","serviceType","IOType","IO_TYPE_MOTOR","Power","power","IO_TYPE_VOLTAGE","MilliVolts","valueAsMilliVolts","IO_TYPE_CURRENT","MilliAmp","valueAsMilliAmps","IO_TYPE_PIEZO_TONE_PLAYER","IO_TYPE_RGB_LIGHT","RGBLightMode","rgbMode","color","Color","R","getRed","G","getGreen","B","getBlue","A","defaultColor","DefaultColor","ColorIndex","colorIndex","DefaultColorIndex","defaultColorIndex","IO_TYPE_TILT_SENSOR","Angle","getSimpleTiltSensorAngle","angle","Crash","getSimpleTiltSensorCrash","crash","TiltSensorDirection","direction","TiltSensorMode","tiltSensorMode","IO_TYPE_MOTION_SENSOR","Count","count","Distance","distance","MotionSensorMode","motionSensorMode","IO_TYPE_GENERIC","getSimpleService","legoService","IsInternalService","isInternalService","ServiceName","serviceName","DefaultInputFormat","defaultInputFormat","InputFormat","ConnectInfo","connectInfo","ServiceData","serviceData","legoTiltSensorAngle","X","x","Y","y","legoTiltSensorCrash","Z","z","__WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__","bleManagerInstance","LDSDKLogger","LDM","Helper","methodName","payload","DevicesCallbackListenerImpl","bluetooth","deviceListeners","Map","deviceToListenerId","address","has","listener","DeviceCallbackListener","set","listenerId","registerDeviceCallbackListener","checkAndRegisterDeviceCallback","legoDevice","addDevice","sendMessage","isDebugEnabled","removeDevice","backgroundPage","addDeviceAddress","scan","removeDeviceAddress","serviceCallbackListener","ServiceCallbackListener","services","serviceListeners","device","isTraceEnabled","trace","buttonPressed","lowVoltage","oldName","newName","simpleService","unregisterServiceCallbackListener","delete","isInfoEnabled","registerServiceCallbackListener","oldFormat","OldInputFormat","NewInputFormat","oldData","valueData","NewValue","numberValue","oldDistance","newDistance","OldDistance","NewDistance","oldColor","OldColor","NewColor","oldColorIndex","newColorIndex","OldColorIndex","NewColorIndex","oldDirection","OldDirection","NewDirection","oldAngle","OldAngle","NewAngle","oldCrash","OldCrash","NewCrash","milliVolts","currentSensor","milliAmps","Bluetooth","checkAndRegisterScanListener","found","devices","idxToRemove","splice","stopScanning","connectToDevice","legoDeviceId","allDevices","disconnectDevice","cancelDeviceConnection","allManagedDevices","devicesCopy","slice","proxyLegoBluetoothDevice","changeDeviceName","setDeviceName","updateServiceData","findServiceOnDevice","parseInt","updateInputFormat","toLowerCase","run","motorDirection","brake","drift","playFrequency","frequency","milliseconds","playNote","note","octave","stopPlaying","setRGBLightMode","rgbLightMode","setRGBMode","changeColor","jsonColor","setColor","changeColorIndex","setColorIndex","switchOff","changeColorToDefault","switchToDefaultColor","setTiltSensorMode","setMotionSensorMode","findDeviceFromId","getDevice","getDeviceServiceWithConnectId","setUnityObjectName","unityObjectName","LegoDeviceManagerImpl","disable","getSDKVersion","listenForConnectionsAllTheTime","fireDeviceInfoUpdateOnTheOnDeviceEvents","startStopScanningInterval","startStopRepeatedScanning","automaticReconnectOnConnectionLostEnabled","helper","devicesCallbackListener","callbackListenerId","registerCallbackListener","getDevicesCallbackListenerInstance","__WEBPACK_IMPORTED_MODULE_0_components_Webview__","__WEBPACK_IMPORTED_MODULE_2_components_Storage__","ContentViewerWebview","setTransparentBackground","height","setInsets","top","left","bottom","right","setVisible","visible","invokeUnity","unityMethodToInvoke","handleExportImage","dataURI","handleExport","handleExportPdf","handleSaveSDT","eventHandlers","event_contentload","setup","setZoomMode","storage","permission","request","allow","_Webview","splitString","dataBase64","b64toBlob","evaluatingJavaScript","err","b64Data","contentType","sliceSize","byteCharacters","atob","byteArrays","offset","byteNumbers","charCodeAt","byteArray","Uint8Array","Blob","Webview","ExternalLink","open","url","Killswitch","XMLHttpRequest","onreadystatechange","encodeURIComponent","responseText","getAllResponseHeaders","send","PlatformInfo","requestSystemCpuInfo","system","cpu","getInfo","getObjAsBase64Json","requestPlatformInfo","platformInfo","nativePlatformInfo","isArmArchitecture","arch","is64bit","platformOS","platformOSDetails","appVersion","match","chromeVersion","platform","is64BitArchitecture","requestSystemMemoryInfo","memory","requestLanguageInfo","getAcceptLanguages","languageList","languages","join","uiLanguage","getUILanguage","acceptLanguage","acceptLanguages","obj","btoa","unescape","_to_check","cpuClass","userAgent","_i","_c","_64bits_signatures","_bits","outer_loop","getBitSystemArchitecture","_arm_signatures","_arm","VideoController","$storage","playVideo","bgColor","videoContainer","backgroundColor","position","video","src","preload","autoplay","controls","onended","removeChild","setupVideoElements","videoContainerElement","videoElement","marginLeft","marginRight","transform","srcObject","videoStream","snapshotCanvas","snapshotCanvasContext","getContext","videoRecordRTC","reset","updateLivePreviewPosition","teardownVideoElements","URL","revokeObjectURL","livePreviewPosition","widthPX","heightPX","startCaptureSession","floor","ideal","setLivePreviewPosition","previewFilePath","handleVideo","getBlob","videoURL","videoBlob","drawImage","dataString","toDataURL","imageBlob","dataURItoBlob","previewVideoExt","saveLocalPreviewFile","previewImageExt","stopCaptureSession","currentlyCapturing","captureImage","captureCanvasImage","imageData","newDataURL","mimeString","array","requestAnimationFrame","webkitRequestAnimationFrame","__WEBPACK_IMPORTED_MODULE_0_MessageHandler__","WindowController","visibilityState","pause","unpause","webviewElement","parentDiv","min","outerBounds","innerBounds","clientWidth","clientHeight","__WEBPACK_IMPORTED_MODULE_1_components_SyncError__","__WEBPACK_IMPORTED_MODULE_2_gapi_chrome_apps__","__WEBPACK_IMPORTED_MODULE_3_stringview__","GD_RESUMABLE_UPLOAD_CHUNK_SIZE","timestampFunc","configureGoogleAPI","_authenticate","_checkIfURLReachable","xhr","timeout","onload","ontimeout","revokeCredentials","query","fetchNextPage","pageToken","_fetchFileListPage","nextPageToken","responseType","lastIndexOf","alt","startRequest","rawResponse","responseArr","base64","StringView","bytesToBase64","_isBase64","_base64Decode","decodedResponse","parents","createdTime","boundary","dataStr","_base64Encode","uploadType","fields","bodyType","initMethod","initResumableParams","processInitResumableResponseHandler","responseHeaders","gapiRequest","resumableSessionUri","chunkSize","_getRemainingChunkCount","range","chunkCount","toFixed","_prepareParams","startByte","endByte","remainingChunkCount","subarray","_chunkResponseHandler","rangeHeaderValue","byteParts","_promiseHandler","nextRequestParams","firstRangeParams","newPath","ignoreFileNotFound","errorCallback","_fetchChangesPage","okCallback","bytes","_hasByteLengthProperty","binary","String","fromCharCode","encodedDataStr","ArrayBuffer","input","test","pendingRequests","reqIdx","maxAttempts","requestInterval","ceil","requestQueue","_syncfsTimestamp","success","startPerformingRequests","failure","gapi","auth","authorize","immediate","identity","removeCachedAuthToken","isAttemptingReconnect","reconnectAttempt","rArgs","doRequest","client","retryRequest","to","reconnectSuccessful","rawResponseSuccess","hasStatus","requestIdx","req","enqueueRequest","failWithThrow","throwMessage","Error","failSimple","newError","attemptGoogleReconnect","immediateReattempt","tryReatempt","attempt","okPreprocess","requestArgs","errorHandler","responseHasFiles","isArray","responseHasChanges","handleGoogleResponse","handleGoogleError","errors","errorMessage","intervalID","performNextRequest","_typeof","Symbol","iterator","settings","autosetup","load","js","createWebview","configureWebview","append","parentObject","parent","setting","gapiLoadedCallback","gapiIsLoaded","script","details","interactive","accountHint","assert","response_type","callbackWrapper","getAuthTokenCallbackParam","getAuthToken","root","paramName","deliminator","xhrReadyStates","UNSENT","OPENED","HEADERS_RECEIVED","LOADING","DONE","handleTimeout","setRequestHeader","headers","headerName","clearResponseTimeout","responseTimeout","clearTimeout","setResponseTimeout","onabort","getHeadersAsObj","headersString","headerElements","headerElement","trim","headerNameSeparatorIdx","headerValue","isNaN","parseFloat","isFinite","rawResponseObject","statusText","respObject","getResponseHeader","SyntaxError","decodeErr","upload","onprogress","lengthComputable","vInput","sEncoding","nOffset","nLength","fTAView","aWhole","aRaw","fPutOutptCode","fGetOutptChrSize","nInptLen","nStartIdx","nTranscrType","encoding","toString","encSwitch","putUTF8CharCode","getUTF8CharLength","putUTF16CharCode","getUTF16CharLength","Uint16Array","Uint32Array","typeSwitch","byteOffset","Number","vSource","nOutptLen","nCharStart","nCharEnd","nEndIdx","fGetInptChrSize","fGetInptChrCode","isInteger","rawData","makeIndex","loadUTF8CharCode","loadUTF16CharCode","conversionSwitch","nOutptIdx","nInptIdx","nChrCode","nChrIdx","nIdx","nMapIdx","bufferView","freeze","nVal","aChars","nLen","nPart","aTarget","nChar","nPutAt","nFrstChr","b64ToUint6","nChr","uint6ToB64","nUint6","aBytes","nMod3","eqLen","sB64Enc","nUint24","substring","base64ToBytes","sBase64","nBlockBytes","nMod4","nInLen","nOutLen","nOutIdx","nInIdx","makeFromBase64","sB64Inpt","nByteOffset","nChrLength","nStartFrom","nChrEnd","nRawLength","nIdxEnd","nStopAtChr","Infinity","RangeError","toBase64","bWholeBuffer","subview","nCharOffset","nCharLength","nRawSubLen","nRawSubOffset","nSubOffset","nSubLen","nThisLen","bVariableLen","nRawLen","forEachChar","fCallback","oThat","nChrOffset","nChrLen","nRawEnd","nRawIdx","aSource","valueOf","fGetCode","fGetIncr","sView","tstamp","startTime","getArgString","concatArgs","separator","cache","__WEBPACK_IMPORTED_MODULE_0_ChromeApp__","__WEBPACK_IMPORTED_MODULE_1_components_Splashscreen__","__WEBPACK_IMPORTED_MODULE_2_components_Window__","__WEBPACK_IMPORTED_MODULE_3_components_Storage__","__WEBPACK_IMPORTED_MODULE_4_components_PlatformInfo__","__WEBPACK_IMPORTED_MODULE_5_components_Video__","__WEBPACK_IMPORTED_MODULE_6_components_Audio__","__WEBPACK_IMPORTED_MODULE_7_components_Bluetooth__","__WEBPACK_IMPORTED_MODULE_8_components_ContentViewerWebview__","__WEBPACK_IMPORTED_MODULE_9_components_SyncFS__","__WEBPACK_IMPORTED_MODULE_10_components_ExternalLink__","__WEBPACK_IMPORTED_MODULE_11_components_Killswitch__","__WEBPACK_IMPORTED_MODULE_12_components_OSLimiter__","getTime","oldConsole","arguments","argString","time","timeStamp","timeEnd","windowController","chromeApp","syncFSLogger","splashscreen","osLimiter","initApp","webGLwebview","setAttribute","ctrlKey","preventDefault","stopPropagation","version","register","Video","partition","LEGO_BLE_SDK"],"mappings":"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","file":"chromeapp.bundle.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 27);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BaseModule = function () {\n  function BaseModule() {\n    _classCallCheck(this, BaseModule);\n  }\n\n  _createClass(BaseModule, [{\n    key: \"getPublicFunctions\",\n    value: function getPublicFunctions() {\n      return Object.keys(this);\n    }\n  }, {\n    key: \"handle\",\n    value: function handle(message) {\n      var args = message.data.map(function (arg) {\n        return arg;\n      });\n      return this[message.method].apply(null, args);\n    }\n  }]);\n\n  return BaseModule;\n}();\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (BaseModule);\n\n/***/ }),\n/* 1 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar instance = null;\n\nvar MessageHandler = function () {\n  function MessageHandler() {\n    _classCallCheck(this, MessageHandler);\n\n    if (!instance) {\n      instance = this;\n    }\n    return instance;\n  }\n\n  _createClass(MessageHandler, null, [{\n    key: 'getInstance',\n    value: function getInstance() {\n      if (!instance) {\n        instance = new MessageHandler();\n      }\n\n      return instance;\n    }\n  }, {\n    key: 'setWebGL',\n    value: function setWebGL(view) {\n      MessageHandler.getInstance().view = view;\n    }\n  }, {\n    key: 'callWebGL',\n    value: function callWebGL(target, method, data) {\n      MessageHandler.getInstance().view.contentWindow.postMessage({\n        target: target,\n        method: method,\n        data: data\n      }, '*');\n    }\n\n    // NOTE(Catalin,22.03.2016): sender is currently ignored past this call.\n\n  }, {\n    key: 'callUnity',\n    value: function callUnity(sender, method, data) {\n      MessageHandler.getInstance().view.contentWindow.postMessage({\n        sender: sender,\n        target: 'unity',\n        method: method,\n        data: data\n      }, '*');\n    }\n\n    // Data gets stored into a shared memory arena between unity and js.\n    // Do the equivalent of callUnity(nil, unityCallback.method, metadata) after the data is ready.\n\n  }, {\n    key: 'sendDataToUnity',\n    value: function sendDataToUnity(data, metadata, transferID, unityCallback) {\n      MessageHandler.getInstance().view.contentWindow.postMessage({\n        target: \"sendUnityData\",\n        data: data,\n        metadata: metadata,\n        transferID: transferID,\n        unityCallback: unityCallback ? unityCallback : \"JSArrayBufferReady\"\n      }, '*');\n    }\n\n    // UnityApp will call sender[callbackName](metadata, data);\n\n  }, {\n    key: 'requestDataFromUnity',\n    value: function requestDataFromUnity(transferID, sender, callbackName, metadata) {\n      MessageHandler.getInstance().view.contentWindow.postMessage({\n        target: \"requestUnityData\",\n        transferID: transferID,\n        sender: sender,\n        metadata: metadata,\n        callbackName: callbackName\n      }, '*');\n    }\n  }]);\n\n  return MessageHandler;\n}();\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (MessageHandler);\n\n/***/ }),\n/* 2 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar instance = null;\n\nvar MessageForwarder = function () {\n  function MessageForwarder() {\n    _classCallCheck(this, MessageForwarder);\n\n    if (!instance) {\n      instance = this;\n    }\n    return instance;\n  }\n\n  _createClass(MessageForwarder, [{\n    key: 'handle',\n    value: function handle() {\n      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      MessageForwarder.forward(args.target, args.method, args.data);\n    }\n  }], [{\n    key: 'setAppWindow',\n    value: function setAppWindow(appWindow) {\n      instance.appWindow = appWindow;\n    }\n  }, {\n    key: 'setAppOrigin',\n    value: function setAppOrigin(appOrigin) {\n      instance.appOrigin = appOrigin;\n    }\n  }, {\n    key: 'getAppWindow',\n    value: function getAppWindow() {\n      return instance.appWindow;\n    }\n  }, {\n    key: 'getAppOrigin',\n    value: function getAppOrigin() {\n      return instance.appOrigin;\n    }\n  }, {\n    key: 'forward',\n    value: function forward(method, target, data) {\n      if (MessageForwarder.getAppOrigin() && MessageForwarder.getAppWindow()) {\n        MessageForwarder.getAppWindow().postMessage({\n          sender: 'unity',\n          target: target,\n          method: method,\n          data: data\n        }, MessageForwarder.getAppOrigin());\n      }\n    }\n  }]);\n\n  return MessageForwarder;\n}();\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (MessageForwarder);\n\n/***/ }),\n/* 3 */,\n/* 4 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_components_BaseModule__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_MessageHandler__ = __webpack_require__(1);\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n\n\n\nvar Storage = function (_BaseModule) {\n  _inherits(Storage, _BaseModule);\n\n  function Storage() {\n    _classCallCheck(this, Storage);\n\n    var _this = _possibleConstructorReturn(this, (Storage.__proto__ || Object.getPrototypeOf(Storage)).call(this));\n\n    _this.isSavingFile = function () {\n      return _this.savingFile;\n    };\n\n    _this.showFilePicker = function (mimeType, filePath) {\n      var fileTypes = [{\n        mimeTypes: [mimeType]\n      }];\n      chrome.fileSystem.chooseEntry({ type: 'openFile', accepts: fileTypes }, function (entry) {\n        if (!entry) {\n          return;\n        }\n\n        if (chrome.runtime.lastError) {\n          console.warn('showFilePicker - chooseEntry error: ', chrome.runtime.lastError.message);\n          return;\n        }\n\n        _this.currentFileEntry = entry;\n\n        var fileSplit = entry.name.split('.');\n        var fileExt = fileSplit[fileSplit.length - 1];\n\n        _this.currentFileEntry.file(function (file) {\n          var saveFilePath = filePath + '.' + fileExt;\n          var dataURL = 'uniwebview://FileSelectedFromPicker?FilePath=' + saveFilePath + '&MimeType=' + mimeType;\n          _this.saveFileToIndexDB(saveFilePath, file, dataURL);\n        });\n      });\n    };\n\n    _this.saveFile = function (fileBlob, extension, writeSuccessCallback, writeErrorCallback) {\n      _this.savingFile = true;\n      var config = { type: 'saveFile', suggestedName: 'untitled.' + extension, accepts: [{ extensions: ['' + extension] }] };\n      chrome.fileSystem.chooseEntry(config, function (writableEntry) {\n        if (chrome.runtime.lastError) {\n          console.warn('saveFile - chooseEntry error: ', chrome.runtime.lastError.message);\n          writeErrorCallback(chrome.runtime.lastError.message);\n          _this.savingFile = false;\n          return;\n        }\n\n        if (!writableEntry) {\n          writeErrorCallback(chrome.runtime.lastError.message);\n          _this.savingFile = false;\n          return;\n        }\n        writableEntry.createWriter(function (writer) {\n          writer.onerror = function (error) {\n            writeErrorCallback(error);\n            _this.savingFile = false;\n          };\n          writer.onwriteend = function (e) {\n            if (e.loaded > 0 && e.total > 0 && e.loaded === e.total) {\n              writeSuccessCallback();\n              _this.savingFile = false;\n            }\n          };\n\n          writer.truncate(fileBlob.size);\n          _this.waitForIO(writer, function () {\n            writer.seek(0);\n            writer.write(fileBlob);\n          });\n        }, function (error) {\n          writeErrorCallback(error);\n          _this.savingFile = false;\n        });\n      });\n    };\n\n    _this.saveFileToIndexDB = function (filePath, fileBlob, dataURL) {\n      __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callWebGL('emscriptenFSHandler', 'saveFile', [{ filePath: filePath, fileBlob: fileBlob, dataURL: dataURL }]);\n    };\n\n    _this.currentFileEntry = null;\n    _this.savingFile = false;\n    return _this;\n  }\n\n  _createClass(Storage, [{\n    key: 'waitForIO',\n    value: function waitForIO(writer, callback) {\n      // set a watchdog to avoid eventual locking:\n      var start = Date.now();\n      // wait for a few seconds\n      var reentrant = function reentrant() {\n        if (writer.readyState === writer.WRITING && Date.now() - start < 4000) {\n          setTimeout(reentrant, 100);\n          return;\n        }\n        if (writer.readyState === writer.WRITING) {\n          // console.error( \"Write operation taking too long, aborting!\n          // (current writer readyState is \" + writer.readyState + \")\");\n          writer.abort();\n        } else {\n          callback();\n        }\n      };\n      setTimeout(reentrant, 100);\n    }\n  }]);\n\n  return Storage;\n}(__WEBPACK_IMPORTED_MODULE_0_components_BaseModule__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (Storage);\n\n/***/ }),\n/* 5 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar SyncError = function SyncError(message, code, reason) {\n    _classCallCheck(this, SyncError);\n\n    this.message = message ? message : 'undefined';\n    this.code = code ? code : 0; // 0 means NOT an HTML error.\n    this.reason = reason ? reason : '';\n};\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (SyncError);\n\n/***/ }),\n/* 6 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_MessageForwarder__ = __webpack_require__(2);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_MessageHandler__ = __webpack_require__(1);\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\n\nvar ChromeApp = function () {\n  _createClass(ChromeApp, [{\n    key: 'addProfilingUtils',\n    value: function addProfilingUtils() {\n      window.profileBegin = function (tag) {\n        for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n\n        Array.prototype.unshift.call(args, \"<A-\" + tag + \"> \");\n        console.log.apply(console, args);\n      };\n      window.profileEnd = function (tag) {\n        for (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n          args[_key2 - 1] = arguments[_key2];\n        }\n\n        Array.prototype.unshift.call(args, \"<B-\" + tag + \"> \");\n        console.log.apply(console, args);\n      };\n    }\n  }]);\n\n  function ChromeApp($logger, $window) {\n    _classCallCheck(this, ChromeApp);\n\n    this.addProfilingUtils();\n    this.webgl = null;\n\n    // Dependencies\n    this.$logger = $logger;\n    this.$window = $window;\n\n    this.listeners = {};\n  }\n\n  _createClass(ChromeApp, [{\n    key: 'initialize',\n    value: function initialize() {\n      var _this = this;\n\n      return new Promise(function (resolve) {\n        _this.$logger.debug('[CoreChromeApp] Initialize');\n        var loadCompleted = function loadCompleted() {\n          _this.$window.addEventListener('message', function (event) {\n            _this.handleMessage.call(_this, event);\n          });\n          _this.webgl = _this.attachListeners('webgl', function (view) {\n            _this.sendHelloMessage(view);\n            __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].setWebGL(view);\n            resolve();\n          });\n        };\n        // Have the document already loaded?\n        if (_this.$window.document.readyState === 'complete') {\n          loadCompleted();\n        } else {\n          // If not => listen for load event\n          _this.$window.addEventListener('load', loadCompleted);\n        }\n      });\n    }\n  }, {\n    key: 'register',\n    value: function register(listenerName, listenerInstance) {\n      this.listeners[listenerName] = listenerInstance;\n\n      // Setup listener in webgl context\n      this.webgl.contentWindow.postMessage({\n        type: 'register',\n        name: listenerName,\n        methods: listenerInstance.getPublicFunctions()\n      }, '*');\n    }\n  }, {\n    key: 'remove',\n    value: function remove(listenerName) {\n      delete this.listeners[listenerName];\n    }\n  }, {\n    key: 'sendHelloMessage',\n    value: function sendHelloMessage(webview) {\n      webview.contentWindow.postMessage({\n        sender: 'hello'\n      }, '*');\n      this.$logger.debug('Sent hello message to ' + webview.id);\n    }\n  }, {\n    key: 'attachListeners',\n    value: function attachListeners(id, afterLoadCallback) {\n      var _this2 = this;\n\n      var view = document.getElementById(id);\n\n      view.addEventListener('dialog', function (event) {\n        _this2.$logger.debug('[' + id + '] dialog of type ' + event.messageType + ' : ' + event.messageText);\n        event.dialog.ok('');\n      });\n\n      view.addEventListener('consolemessage', function (event) {\n        _this2.$logger.debug('[' + id + '] ' + event.message);\n      });\n\n      view.addEventListener('contentload', function () {\n        _this2.$logger.debug('Finished loading ' + id);\n        if (afterLoadCallback) {\n          afterLoadCallback(view);\n        }\n      });\n\n      view.addEventListener('message', function (event) {\n        _this2.$logger.debug('[' + id + '] - EVENT[message] - ', event);\n      });\n\n      return view;\n    }\n  }, {\n    key: 'handleMessage',\n    value: function handleMessage($event) {\n      // this.$logger.log('ChromeApp - handleMessage - Received message:', $event);\n\n      this.$window.listeners = this.listeners;\n\n      try {\n        this.listeners[$event.data.target].handle($event.data);\n      } catch (error) {\n        this.$logger.error('ChromeApp - handleMessage - No listener registered!', error);\n      }\n    }\n  }]);\n\n  return ChromeApp;\n}();\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (ChromeApp);\n\n/***/ }),\n/* 7 */,\n/* 8 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_components_BaseModule__ = __webpack_require__(0);\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n\n\n/**\n * Component which allows for only running a method if on an approved OS or in development mode\n *\n * To set development mode add the following line to the manifest:\n *\n * \"developmentMode\" : true,\n *\n * NOTE: This will produce a warning about \"Unrecognized manifest key 'developmentMode'.\"\n */\n\nvar OSLimiter = function (_BaseModule) {\n\t_inherits(OSLimiter, _BaseModule);\n\n\t/**\n  * Constructors the OSLimiter component\n  * @param  {Array}   approvedList         The list of OS' that should be approved. Default []\n  * @param  {Boolean} allowDevelopmentMode If limiter should look for development mode or not. Default true\n  * @param  {String}  parentElementId      Optional parameter specifying the ID of the parent element to \n  *                                        append error message to. If not set, will append to body\n  */\n\tfunction OSLimiter() {\n\t\tvar approvedList = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\t\tvar allowDevelopmentMode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\t\tvar parentElementId = arguments[2];\n\n\t\t_classCallCheck(this, OSLimiter);\n\n\t\tvar _this = _possibleConstructorReturn(this, (OSLimiter.__proto__ || Object.getPrototypeOf(OSLimiter)).call(this));\n\n\t\t_this.runOnApprovedOS = function (approved) {\n\t\t\tvar service = _this;\n\t\t\tvar approvedFn = approved;\n\n\t\t\tchrome.runtime.getPlatformInfo(function (info) {\n\t\t\t\tif (service.isSupportedOS(info.os) || service.inDevelopmentMode()) {\n\t\t\t\t\tif (approvedFn && typeof approvedFn === 'function') {\n\t\t\t\t\t\tapprovedFn();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('Unsupported OS and not configured for development mode');\n\n\t\t\t\t\t// Add unsupported class for html element\n\t\t\t\t\tdocument.documentElement.className = 'unsupported';\n\n\t\t\t\t\tvar unsupportedOS = document.createElement('div');\n\t\t\t\t\tunsupportedOS.id = 'unsupported';\n\t\t\t\t\t// Set text from i18n\n\t\t\t\t\tunsupportedOS.appendChild(document.createTextNode(chrome.i18n.getMessage('unsupportedOSMessage')));\n\n\t\t\t\t\tvar closeLink = document.createElement('a');\n\t\t\t\t\tcloseLink.appendChild(document.createTextNode(chrome.i18n.getMessage('closeApp')));\n\t\t\t\t\tcloseLink.className = 'close-button';\n\t\t\t\t\tcloseLink.onclick = function () {\n\t\t\t\t\t\twindow.close();\n\t\t\t\t\t};\n\n\t\t\t\t\tunsupportedOS.appendChild(closeLink);\n\n\t\t\t\t\t// Append unsupported message to parent\n\t\t\t\t\tif (service.parentElementId) {\n\t\t\t\t\t\tdocument.getElementById(service.parentElementId).appendChild(unsupportedOS);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdocument.body.appendChild(unsupportedOS);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t_this.inDevelopmentMode = function () {\n\t\t\treturn _this.allowDevelopmentMode && !!chrome.runtime.getManifest().developmentMode;\n\t\t};\n\n\t\t_this.isSupportedOS = function (os) {\n\t\t\treturn _this.approvedList.indexOf(os) !== -1;\n\t\t};\n\n\t\t_this.approvedList = approvedList;\n\t\t_this.allowDevelopmentMode = allowDevelopmentMode;\n\t\t_this.parentElementId = parentElementId;\n\t\treturn _this;\n\t}\n\n\t// PUBLIC API\n\n\n\t// END PUBLIC API\n\n\t/**\n * Check if app is in development mode. \n * \n * @return {boolean} true if in development mode, false otherwise\n */\n\n\n\treturn OSLimiter;\n}(__WEBPACK_IMPORTED_MODULE_0_components_BaseModule__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (OSLimiter);\n\n/***/ }),\n/* 9 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_components_BaseModule__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_MessageHandler__ = __webpack_require__(1);\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n\n\n\nvar Splashscreen = function (_BaseModule) {\n  _inherits(Splashscreen, _BaseModule);\n\n  function Splashscreen(options) {\n    _classCallCheck(this, Splashscreen);\n\n    var _this = _possibleConstructorReturn(this, (Splashscreen.__proto__ || Object.getPrototypeOf(Splashscreen)).call(this));\n\n    _this.mainElement = function () {\n      if (!_this.splashscreenElement) {\n        _this.splashscreenElement = document.getElementById(_this.splashscreenTagId);\n      }\n      return _this.splashscreenElement;\n    };\n\n    _this.barElement = function () {\n      if (!_this.loadingBar) {\n        _this.loadingBar = document.getElementById(_this.loadingBarId);\n      }\n      return _this.loadingBar;\n    };\n\n    _this.hide = function () {\n      console.debug('[CoreSplashScreen] Invoking hide()');\n      _this.mainElement().style.display = 'none';\n    };\n\n    _this.show = function () {\n      console.debug('[CoreSplashScreen] Invoking show()');\n      var style = _this.mainElement().style || {};\n      if (style.removeProperty) {\n        style.removeProperty('display');\n      } else {\n        style.display = '';\n      }\n      _this.mainElement().style = style;\n    };\n\n    _this.unityDoneLoading = function () {\n      console.debug('[CoreSplashScreen] Unity done message');\n      _this.unityProgress = 1;\n      _this.unityDone = true;\n      _this.updateTotalProgress();\n    };\n\n    _this.updateProgress = function (progress) {\n      console.debug('[CoreSplashScreen] Updating unity progress', progress);\n      _this.unityProgress = progress;\n      _this.updateTotalProgress();\n    };\n\n    _this.updateSyncProgress = function (progress) {\n      console.debug('[CoreSplashScreen] Updating sync progress', progress);\n      _this.syncProgress = progress;\n      _this.updateTotalProgress();\n    };\n\n    _this.updateTotalProgress = function () {\n      var totalProgress = (_this.unityProgress + _this.syncProgress) / 2;\n\n      _this.currentProgress = Math.max(_this.currentProgress, totalProgress);\n      console.log('[CoreSplashScreen] Updating total progress', _this.currentProgress);\n      //The full width from CSS minus margin\n      var fullWidth = _this.currentProgress * 100;\n\n      if (_this.barElement()) {\n        _this.loadingBar.style.width = fullWidth + '%';\n      }\n\n      if (_this.syncProgress === 1 && _this.unityDone) {\n        // Inform unity that the loading is done and it can show lobby\n        console.log('[CoreSplashScreen] Both sync and unity is ready');\n        __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(null, 'JSFinishedLoading');\n      }\n    };\n\n    _this.onBoundsChanged = function () {};\n\n    options = options || {};\n    _this.splashscreenTagId = options.splashscreenTagId || 'splashscreen';\n    _this.loadingBarId = options.loadingBarId || 'loadingBar';\n    _this.imageWidth = options.imageWidth || 2048;\n    // Initially 5% to show a little progress from the start. If changed, remember to update CSS\n    _this.currentProgress = options.initialProgress || 0.05;\n\n    chrome.app.window.current().onBoundsChanged.addListener(_this.onBoundsChanged.bind(_this));\n\n    _this.onBoundsChanged();\n\n    _this.unityProgress = 0;\n    _this.syncProgress = 0;\n    _this.unityDone = false;\n    return _this;\n  }\n\n  // Progress from unity\n\n\n  return Splashscreen;\n}(__WEBPACK_IMPORTED_MODULE_0_components_BaseModule__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (Splashscreen);\n\n/***/ }),\n/* 10 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_components_BaseModule__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_MessageHandler__ = __webpack_require__(1);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_components_GoogleDrive__ = __webpack_require__(23);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_components_SyncError__ = __webpack_require__(5);\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n// NOTE(Catalin): API is still very fluid, things may change.\n\n\n\n\n\n\n// TODO: adapt for offline scenarios\n// TODO: refactor, remove unused code\n\n/**\n * The RESUMABLE_UPLOAD_SIZE_THRESHOLD value controls which strategy is used for\n * uploading the file to Google Drive.\n *\n * If the file size is less than the threshold a multipart upload with the entire file uploaded in one request.\n * Google Drive documentation (as of September 2017) specifies that multipart upload\n * should not be done for files larger than 5MB.\n *\n * If the file size is larger than or equal to the threshold we will upload to Google Drive\n * using the resumable upload method, and upload the file in multiple chunks.\n *\n * @type {number}\n */\nwindow.GD_RESUMABLE_UPLOAD_SIZE_THRESHOLD = 0.5 * 1024 * 1024;\n\nvar SyncFS = function (_BaseModule) {\n    _inherits(SyncFS, _BaseModule);\n\n    function SyncFS($logger, $splashscreen) {\n        _classCallCheck(this, SyncFS);\n\n        var _this2 = _possibleConstructorReturn(this, (SyncFS.__proto__ || Object.getPrototypeOf(SyncFS)).call(this));\n\n        _this2.initializeFileSystem = function () {\n            if (_this2.syncMetadata) return;\n\n            profileEnd(\"SyncRequest\", \"Sync request received\");\n            profileBegin(\"ReadMetadata\", \"Start reading metadata for syncfs\");\n\n            _this2.idbfsReverseFlush().then(function () {\n                return _this2.readSyncMetadata();\n            }).then(function (metadata) {\n                _this2._debugLog('Done reading sync metadata');\n                _this2.syncMetadata = metadata;\n                profileEnd(\"ReadMetadata\", \"Metadata received\");\n                _this2._completeInitializationStep();\n            });\n        };\n\n        _this2.initGoogleDrive = function () {\n            var _this = _this2;\n            return new Promise(function (resolve, reject) {\n                _this2._debugLog('Initializing Google Drive API');\n                var drive = new __WEBPACK_IMPORTED_MODULE_2_components_GoogleDrive__[\"a\" /* default */](_this2.timestamp);\n                drive.initialize(_this).then(function () {\n                    _this.googleDrive = drive;\n                    resolve();\n                }, function (syncError) {\n                    _this.googleDrive = drive;\n                    reject(syncError);\n                });\n            });\n        };\n\n        _this2.reauthenticate = function () {\n            if (_this2.reauthenticating) return;\n            _this2.reauthenticating = true;\n            _this2._debugLog(\"Reauthenticating with Google Drive\");\n            _this2.googleDrive.reauthenticate().then(function () {\n                _this2._debugLog(\"Successfully reauthenticated with Google Drive\");\n                _this2.solveStatusReason(\"manual_unauth\");\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(\"SyncFS\", \"JSReauthenticateResult\", true);\n            }).catch(function (authError) {\n                _this2._debugLog(\"Failed to reauthenticate with Google Drive\");\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(\"SyncFS\", \"JSReauthenticateResult\", false);\n            }).then(function () {\n                _this2.reauthenticating = false;\n            });\n        };\n\n        _this2.requestStatusUpdate = function () {\n            _this2.sendStatus();\n        };\n\n        _this2.solveStatusReason = function (reason) {\n            var idx = _this2.status.reasons.indexOf(reason);\n            if (idx == -1) return;\n            _this2.status.reasons[idx] = _this2.status.reasons[_this2.status.reasons.length - 1];\n            _this2.status.reasons.pop();\n\n            if (_this2.status.reasons.length == 0) {\n                if (_this2.status.state == \"failed_big_sync\") _this2.attemptStatusChange(\"big_sync_recovered\");\n                if (_this2.status.state == \"offline\") {\n                    _this2.attemptStatusChange(\"synchronizing\");\n                    _this2.pushNextChange();\n                }\n            } else {\n                _this2.sendStatus();\n            }\n        };\n\n        _this2.pauseFileSync = function () {\n            _this2.fileSyncIsPaused = true;\n        };\n\n        _this2.resumeFileSync = function () {\n            _this2.fileSyncIsPaused = false;\n            _this2.pushNextChange();\n        };\n\n        _this2.sendStatus = function () {\n            __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(\"SyncFS\", \"JSSyncStatusChanged\", JSON.stringify(_this2.status));\n        };\n\n        _this2.addIOAction = function (actionType, paths) {\n            if (actionType !== 'writeFile' && actionType !== 'deleteFile') {\n                _this2._debugLog('Unrecognized sync action type ' + actionType + '!');\n                return;\n            }\n\n            var fileId = _this2._getFileID(paths[0]);\n            if (actionType === 'deleteFile') {\n                _this2.removePendingWriteActions(paths[0]);\n                if (!fileId) {\n                    _this2._debugLog('Canceling remote delete action for file ' + paths[0] + ' - the file does not exist on Google Drive thus the request would have resulted in 403/404');\n                    return;\n                }\n            }\n\n            var changes = _this2.syncMetadata.pendingLocalChanges;\n            // merge subsequent writes to the same file into one action;\n            // any different operation performed on the file breaks the chain of merged actions;\n            // [writeFile:A, writeFile:A] => [writeFile:A] (merged)\n            // [writeFile:A, deleteFile:A, writeFile:A] => [writeFile:A, deleteFile:A, writeFile:A] (no merging)\n            // we could do more robust change merging to minimize network traffic but it doesn't seem worth it for now\n            var action;\n            if (actionType === 'writeFile') {\n                // find the last action performed on the given file\n                for (var i = changes.length - 1; i >= 0; --i) {\n                    // don't merge with changes being currently pushed\n                    if (i == _this2.pushingChangeIdx) continue;\n\n                    if (changes[i].paths[0] === paths[0]) {\n                        if (changes[i].type === 'writeFile') {\n                            changes[i].timestamp = _this2.timestamp();\n                            action = changes[i];\n                        }\n                        break;\n                    }\n                }\n            }\n            if (!action) {\n                action = {\n                    type: actionType,\n                    paths: paths,\n                    timestamp: _this2.timestamp(),\n                    fileId: fileId\n                };\n                changes.push(action);\n\n                _this2._debugLog('Added IO action: ' + action.type + ' ' + action.paths[0] + ' ' + action.paths[1] + ' ' + action.timestamp, _this2.syncMetadata.pendingLocalChanges);\n            }\n\n            _this2.writeSyncMetadata(_this2.syncMetadata);\n            if (_this2.pushingChangeIdx == -1 && !_this2.fileSyncIsPaused) {\n                _this2.pushNextChange();\n            }\n\n            _this2.signalFlushRequired();\n            _this2.ensureStateIsFlushed();\n\n            return action;\n        };\n\n        _this2.removePendingWriteActions = function (path) {\n            var pushingChange;\n            if (_this2.pushingChangeIdx != -1) {\n                pushingChange = _this2.syncMetadata.pendingLocalChanges[_this2.pushingChangeIdx];\n            }\n\n            _this2.syncMetadata.pendingLocalChanges = _this2.syncMetadata.pendingLocalChanges.filter(function (change) {\n                // only remove pending write actions\n                if (change.type !== 'writeFile') return true;\n                // don't remove the change currently being pushed\n                if (change == pushingChange) return true;\n                // remove the write action if the path matches\n                if (change.paths[0] === path) {\n                    _this2._debugLog('Removing pending write action (file deleted): ' + change.paths[0] + ', ' + change.timestamp);\n                    return false;\n                }\n                // keep other writes in the queue\n                return true;\n            });\n\n            if (pushingChange) {\n                _this2.pushingChangeIdx = _this2.syncMetadata.pendingLocalChanges.indexOf(pushingChange);\n            }\n        };\n\n        _this2.saveFile = function (path) {\n            if (!_this2._initializationCheck()) return;\n            path = _this2.removeIdbfsFromPath(_this2._normalizePath(path));\n            var action = _this2.addIOAction('writeFile', [path]);\n            _this2.updateFileModifiedTime(path, action.timestamp, true);\n        };\n\n        _this2.updateFileModifiedTime = function (path, modifiedTime, saveMetadata) {\n            var file = _this2.syncMetadata.files[path];\n            if (!file) {\n                file = { name: path };\n                _this2.syncMetadata.files[path] = file;\n            }\n            file.modifiedTime = modifiedTime;\n            if (saveMetadata) {\n                _this2.writeSyncMetadata(_this2.syncMetadata);\n            }\n            _this2._debugLog('Updated modified time of file ' + path + ' to ' + modifiedTime);\n        };\n\n        _this2.createDirectoryTree = function (path) {\n            // Do nothing, directory structure is stored implicitly in file names, e.g. file.name=\"a/b/c/file.txt\"\n        };\n\n        _this2.deleteFile = function (path) {\n            if (!_this2._initializationCheck()) return;\n            path = _this2.removeIdbfsFromPath(_this2._normalizePath(path));\n            _this2._deleteFile(path);\n            _this2.writeSyncMetadata(_this2.syncMetadata);\n        };\n\n        _this2.copyFile = function (sourcePath, destPath) {\n            if (!_this2._initializationCheck()) return;\n            sourcePath = _this2.removeIdbfsFromPath(_this2._normalizePath(sourcePath));\n            destPath = _this2.removeIdbfsFromPath(_this2._normalizePath(destPath));\n            _this2._copyFile(sourcePath, destPath, true);\n        };\n\n        _this2.moveFile = function (sourcePath, destPath) {\n            if (!_this2._initializationCheck()) return;\n            sourcePath = _this2.removeIdbfsFromPath(_this2._normalizePath(sourcePath));\n            destPath = _this2.removeIdbfsFromPath(_this2._normalizePath(destPath));\n            _this2._moveFile(sourcePath, destPath, true);\n        };\n\n        _this2.deleteDirectory = function (path) {\n            if (!_this2._initializationCheck()) return;\n\n            path = _this2.removeIdbfsFromPath(_this2._normalizePath(path)) + \"/\";\n\n            var keys = Object.keys(_this2.syncMetadata.files);\n            for (var idx = 0; idx < keys.length; ++idx) {\n                var key = keys[idx];\n                if (key.startsWith(path)) {\n                    _this2._deleteFile(key);\n                }\n            }\n\n            _this2.writeSyncMetadata(_this2.syncMetadata);\n        };\n\n        _this2.copyDirectory = function (sourcePath, destPath) {\n            if (!_this2._initializationCheck()) return;\n\n            sourcePath = _this2.removeIdbfsFromPath(_this2._normalizePath(sourcePath)) + \"/\";\n            destPath = _this2.removeIdbfsFromPath(_this2._normalizePath(destPath)) + \"/\";\n\n            var len = sourcePath.length;\n            var keys = Object.keys(_this2.syncMetadata.files);\n            for (var idx = 0; idx < keys.length; ++idx) {\n                var key = keys[idx];\n                if (key.startsWith(sourcePath)) {\n                    var destFilePath = destPath + key.substr(len);\n                    _this2._copyFile(key, destFilePath, false);\n                }\n            }\n\n            _this2.writeSyncMetadata(_this2.syncMetadata);\n        };\n\n        _this2.moveDirectory = function (sourcePath, destPath) {\n            if (!_this2._initializationCheck()) return;\n\n            sourcePath = _this2.removeIdbfsFromPath(_this2._normalizePath(sourcePath)) + \"/\";\n            destPath = _this2.removeIdbfsFromPath(_this2._normalizePath(destPath)) + \"/\";\n\n            var len = sourcePath.length;\n            var keys = Object.keys(_this2.syncMetadata.files);\n            for (var idx = 0; idx < keys.length; ++idx) {\n                var key = keys[idx];\n                if (key.startsWith(sourcePath)) {\n                    var destFilePath = destPath + key.substr(len);\n                    _this2._moveFile(key, destFilePath, false);\n                }\n            }\n\n            _this2.writeSyncMetadata(_this2.syncMetadata);\n        };\n\n        _this2._debugLog = function () {\n            for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n                args[_key] = arguments[_key];\n            }\n\n            console.log(Array.from(args).map(function (a) {\n                try {\n                    return JSON.parse(JSON.stringify(a));\n                } catch (e) {\n                    return a;\n                }\n            }));\n        };\n\n        _this2._initializationCheck = function () {\n            if (_this2.initialized) {\n                return true;\n            } else {\n                _this2._debugLog('Google Drive API is not initialized yet! Ignoring the call.');\n                return false;\n            }\n        };\n\n        _this2._normalizePath = function (path) {\n            if (typeof path !== 'string') {\n                return path; // silently fail and do nothing.\n            }\n            path = ('/' + path).replace(/[\\\\\\/]+/g, '/');\n            path = path.replace(/\\/$/, '');\n            return path;\n        };\n\n        _this2._getFileID = function (path) {\n            return _this2.syncMetadata.files[path] ? _this2.syncMetadata.files[path].id : undefined;\n        };\n\n        _this2.fetchRemoteFileList = function () {\n            return new Promise(function (resolve, reject) {\n                _this2._debugLog('Fetching remote file list');\n                _this2.googleDrive.getFileList(\"\").then(function (files) {\n                    var allFiles = {};\n                    files.forEach(function (file) {\n                        if (file) {\n                            allFiles[file.name] = file;\n                        }\n                    });\n                    resolve(allFiles);\n                }, function (syncError) {\n                    _this2._debugLog('Failed to fetch remote file list: ' + syncError);\n                    reject(syncError);\n                });\n            });\n        };\n\n        _this2._deleteFile = function (path) {\n            _this2.addIOAction('deleteFile', [path]);\n            delete _this2.syncMetadata.files[path];\n        };\n\n        _this2._copyFile = function (sourcePath, destPath, saveMetadata) {\n            var action = _this2.addIOAction('writeFile', [destPath]);\n            // will create new File entry with destPath and given timestamp,\n            // id is going to be updated based on the response from Google Drive\n            _this2.updateFileModifiedTime(destPath, action.timestamp, saveMetadata);\n        };\n\n        _this2._moveFile = function (sourcePath, destPath, saveMetadata) {\n            _this2.addIOAction('deleteFile', [sourcePath]);\n            var action = _this2.addIOAction('writeFile', [destPath]);\n\n            _this2.syncMetadata.files[destPath] = _this2.syncMetadata.files[sourcePath];\n            delete _this2.syncMetadata.files[sourcePath];\n            _this2.syncMetadata.files[destPath].name = destPath;\n            delete _this2.syncMetadata.files[destPath].id;\n            _this2.updateFileModifiedTime(destPath, action.timestamp, saveMetadata);\n        };\n\n        _this2._GD_writeFile = function (timestamp, fileId, path) {\n            return new Promise(function (resolve, reject) {\n                _this2.idbfsReadRawFile(path).then(function (data) {\n                    var fileId = _this2._getFileID(path);\n                    if (data.byteLength < window.GD_RESUMABLE_UPLOAD_SIZE_THRESHOLD) {\n                        if (window.ENABLE_DEBUG) {\n                            _this2._debugLog('_GD_writeFile :: Uploading file ' + path + ' (' + data.byteLength + ' bytes) as multipart upload');\n                        }\n                        return _this2.googleDrive.uploadFile(fileId, path, data, timestamp);\n                    } else {\n                        if (window.ENABLE_DEBUG) {\n                            _this2._debugLog('_GD_writeFile :: Uploading file ' + path + ' (' + data.byteLength + ' bytes) as resumable upload');\n                        }\n                        return _this2.googleDrive.uploadFileResumable(fileId, path, data, timestamp);\n                    }\n                }).then(function (metadata) {\n                    _this2._debugLog('Uploaded file ' + path, metadata);\n                    _this2.syncMetadata.files[path] = metadata;\n                    _this2.writeSyncMetadata(_this2.syncMetadata);\n                    resolve(metadata);\n                }).catch(function (syncError) {\n                    _this2._debugLog('Failed to upload file ' + path, syncError);\n                    reject(syncError);\n                });\n            });\n        };\n\n        _this2._GD_deleteFile = function (timestamp, fileId, path) {\n            return new Promise(function (resolve, reject) {\n                _this2._debugLog('Delete GD file: ', path, fileId);\n                _this2.googleDrive.deleteFile(fileId, true).then(function (metadata) {\n                    _this2._debugLog('Deleted Google Drive file ' + path + ' (' + fileId + ')', metadata);\n                    resolve();\n                }, function (syncError) {\n                    _this2._debugLog('Failed to delete GD file ' + path + ' (' + fileId + ')', syncError);\n                    reject(syncError);\n                });\n            });\n        };\n\n        _this2._GD_copyFile = function (timestamp, fileId, sourcePath, destPath) {\n            return _this2._GD_writeFile(timestamp, undefined, destPath);\n        };\n\n        _this2._GD_moveFile = function (timestamp, fileId, sourcePath, destPath) {\n            return _this2._GD_deleteFile(timestamp, fileId, sourcePath).then(function () {\n                return _this2._GD_writeFile(timestamp, undefined, destPath);\n            }).then(function (metadata) {\n                resolve(metadata);\n            }).catch(function (syncError) {\n                reject(syncError);\n            });\n        };\n\n        _this2.pushNextChange = function (changeIndex) {\n            if (_this2.pushingChangeIdx != -1 || _this2.syncInProgress) return;\n            if (!_this2.attemptStatusChange(\"synchronizing\")) return; // If we can't get into a \"synchronizing\" state, bail.\n            if (_this2.syncMetadata.pendingLocalChanges.length === 0) {\n                _this2.attemptStatusChange(\"synced\");\n                return;\n            }\n\n            var _this = _this2;\n\n            _this.pushingChangeIdx = changeIndex ? changeIndex : 0;\n            var change = _this.syncMetadata.pendingLocalChanges[_this.pushingChangeIdx];\n\n            function doActualPush() {\n                _this._debugLog('Pushing change: ' + change.paths[0], change);\n\n                // perform the remote IO action\n                var actionPromise = _this.ioActionImpl[change.type].apply(this, [change.timestamp, change.fileId].concat(change.paths));\n                actionPromise.then(function (result) {\n                    // remove the action from the queue and persist the queue\n                    _this.syncMetadata.pendingLocalChanges.shift();\n                    _this.writeSyncMetadata(_this.syncMetadata);\n                    // proceed with the next pending change\n                    _this.finishPushingChange(_this.pushingChangeIdx);\n                }, function (syncError) {\n                    _this.abortPushingChanges(syncError);\n                });\n            }\n\n            _this.ensureStateIsFlushed().then(doActualPush);\n        };\n\n        _this2.finishPushingChange = function (nextChangeIdx) {\n            _this2.pushingChangeIdx = -1;\n            if (nextChangeIdx < _this2.syncMetadata.pendingLocalChanges.length) {\n                _this2.pushNextChange(nextChangeIdx);\n            } else {\n                _this2.idbfsFlushChanges().then(function () {\n                    _this2.attemptStatusChange(\"synced\");\n                });\n            }\n        };\n\n        _this2.performBigSync = function () {\n            _this2._debugLog(\"performBigSync()\");\n            profileBegin(\"BigSync\", \"Big sync request received, starting\");\n\n            if (!_this2._initializationCheck()) return;\n\n            if (_this2.syncInProgress) {\n                _this2._debugLog(\"performBigSync(): sync is already in progress, ignoring...\");\n                return;\n            }\n\n            if (!_this2.attemptStatusChange(\"doing_big_sync\")) {\n                _this2.failBigSync(new __WEBPACK_IMPORTED_MODULE_3_components_SyncError__[\"a\" /* default */](\"transition_impossible\"));\n                return;\n            }\n\n            _this2.syncInProgress = true;\n\n            _this2.updateBigSyncSyncProgress(0);\n\n            // hosts the sync state\n            var sync = {};\n\n            // get local file list (sync metadata should be already loaded at this point)\n            sync.localFiles = JSON.parse(JSON.stringify(_this2.syncMetadata.files)); // copy the files registry as localFiles is meant to be a temporary, local object\n            // this._debugLog(\"Local files:\", sync.localFiles);\n            // compute local delete list\n            sync.localDeleteList = _this2.computeLocalDeleteList(_this2.syncMetadata.pendingLocalChanges);\n            _this2._debugLog(\"Local delete list:\", sync.localDeleteList);\n\n            profileBegin(\"BS_Flush\", \"Flush to ensure correct state\");\n            // Ensure correct local state.\n            _this2.idbfsFlushChanges().then(function () {\n                profileEnd(\"BS_Flush\", \"End flush\");\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(\"SyncFS\", \"JSMetadataStepComplete\");\n                profileBegin(\"BS_RemoteList\", \"Get remote file list\");\n                return _this2.fetchRemoteFileList();\n            })\n            // fetch remote file list\n            .then(function (files) {\n                profileEnd(\"BS_RemoteList\", \"End remote list\");\n                profileBegin(\"BS_RemoteChanges\", \"Get remote changes since last sync\");\n                _this2.updateBigSyncSyncProgress(10);\n                sync.remoteFiles = files;\n                _this2._debugLog(\"Remote file list fetched, fetching remote changes\");\n                return _this2.fetchRemoteChangesSinceLastSync();\n            })\n            // fetch remote change list since last sync\n            .then(function (changeResponse) {\n                profileEnd(\"BS_RemoteChanges\", \"End remote changes\");\n                profileBegin(\"BS_Changes\", \"Write metadata and compute changes\");\n                _this2.updateBigSyncSyncProgress(20);\n                _this2._debugLog(\"Remote changes response:\", changeResponse);\n                // remember the current start page token for the next sync\n                _this2.syncMetadata.lastStartPageToken = changeResponse.newStartPageToken;\n                _this2.writeSyncMetadata(_this2.syncMetadata);\n                // generate remote delete list\n                sync.remoteDeleteList = _this2.computeRemoteDeleteList(changeResponse.changes);\n                _this2._debugLog(\"Remote delete list:\", sync.remoteDeleteList);\n            })\n            // calculate changes that need to be applied between file systems\n            .then(function () {\n                _this2._debugLog(\"Calculating differences between remote FS and local FS\");\n                sync.remoteToLocalOps = _this2.mergeFileSystems(sync.remoteFiles, sync.remoteDeleteList, sync.localFiles, sync.localDeleteList, true);\n                _this2._debugLog(\"Calculating differences between local FS and remote FS\");\n                sync.localToRemoteOps = _this2.mergeFileSystems(sync.localFiles, sync.localDeleteList, sync.remoteFiles, sync.remoteDeleteList, false);\n                // prepare progress data\n                var numTotalOps = sync.remoteToLocalOps.length + sync.localToRemoteOps.length;\n                var numCompletedOps = 0;\n                sync.completeSyncMergeOperation = function () {\n                    ++numCompletedOps;\n                    _this2.updateBigSyncSyncProgress(20 + Math.round(70 * numCompletedOps / numTotalOps));\n                };\n            })\n            // merge remote FS changes into local FS\n            .then(function () {\n                profileEnd(\"BS_Changes\", \"End computing changes\");\n                profileBegin(\"BS_MergeAndMeta\", \"Start merging, writing metadata and flush\"); // merging is really short, clutters the profier.\n                _this2._debugLog(\"Merging remote FS changes into local FS\");\n                return Promise.all(sync.remoteToLocalOps.map(function (op) {\n                    return op.func.apply(_this2, op.params).then(function () {\n                        sync.completeSyncMergeOperation();\n                    });\n                })).catch(function (e) {\n                    _this2._debugLog(\"Merging remote FS changes into local FS FAILED!! -- \" + JSON.stringify(e));\n                });\n            })\n            // merge local FS changes into remote FS\n            .then(function () {\n                _this2._debugLog(\"Merging local FS changes into remote FS\");\n                return Promise.all(sync.localToRemoteOps.map(function (op) {\n                    return op.func.apply(_this2, op.params).then(function () {\n                        sync.completeSyncMergeOperation();\n                    });\n                })).catch(function (e) {\n                    _this2._debugLog(\"Merging local FS changes into remote FS FAILED!! -- \" + JSON.stringify(e));\n                });\n            }).catch(function (syncError) {\n                _this2._debugLog(\"Sync failed\", syncError);\n                _this2.failBigSync(syncError, true);\n\n                throw new __WEBPACK_IMPORTED_MODULE_3_components_SyncError__[\"a\" /* default */](\"skip_writing_metadata\"); // Skip the other methods in the promise.\n            }).then(function () {\n                // update sync metadata with remote file list, the filesystems should be the same at this point\n                _this2.syncMetadata.files = sync.remoteFiles;\n                // clear local pending changes queue - at this points both filesystems should be the same\n                _this2.syncMetadata.pendingLocalChanges = [];\n                _this2.writeSyncMetadata(_this2.syncMetadata);\n\n                return _this2.idbfsFlushChanges();\n            }).then(function () {\n                profileEnd(\"BS_MergeAndMeta\", \"End writing metadata and flush\");\n                _this2.finishBigSync();\n            }).catch(function (syncError) {\n                if (syncError.message != \"skip_writing_metadata\") {\n                    _this2._debugLog(\"Failed to write metadata:\", syncError); // NOTE(Catalin): I don't know if this is possible, it should not be...\n                    throw \"Sync succeded, but something failed while writing metadata.\";\n                }\n            });\n        };\n\n        _this2.failBigSync = function (syncError, reverseFlushNeeded) {\n            // Revert sync changes\n            var _this = _this2;\n            var revertChanges = function revertChanges() {\n                _this._debugLog(\"Big sync failed! - \" + JSON.stringify(syncError));\n\n                _this.syncInProgress = false;\n                if (syncError.message != \"transition_impossible\") {\n                    // TODO(Catalin): Other reasons may occur here?\n                    if (syncError.message == \"The user did not approve access.\") _this.attemptStatusChange(\"failed_big_sync\", [\"manual_unauth\"]);else if (_this.googleDrive.access_token == undefined)\n                        // No automatic recovery mechanism, but users have to manually restart big sync,\n                        // as they have to do authentication again.\n                        _this.attemptStatusChange(\"big_sync_recovered\");else {\n                        _this.attemptStatusChange(\"failed_big_sync\", [\"gdrive_offline\"]);\n                    }\n                }\n\n                // Unity expects a \"JSBigSyncFinished\" event to exit loading.\n                _this.updateBigSyncSyncProgress(100);\n            };\n\n            if (reverseFlushNeeded) {\n                _this2.idbfsReverseFlush().then(revertChanges);\n            } else {\n                revertChanges();\n            }\n        };\n\n        _this2.finishBigSync = function () {\n            profileEnd(\"BigSync\", \"Successfully completed big sync\");\n            _this2._debugLog(\"Finished big sync!\");\n\n            // finish big sync\n            _this2.syncInProgress = false;\n            _this2.updateBigSyncSyncProgress(100);\n\n            // activate realtime sync\n            __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callWebGL('SyncFS_IDB', 'startTrackingFileChanges', []);\n            _this2.attemptStatusChange(\"synchronizing\"); // TODO(Catalin): ok, see if/how status changes should trigger synchronization.\n            _this2.pushNextChange();\n        };\n\n        _this2.updateBigSyncSyncProgress = function (progress) {\n            if (progress === 0) {\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(\"SyncFS\", \"JSBigSyncStarted\");\n            }\n            __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(\"SyncFS\", \"JSBigSyncProgress\", progress);\n            if (progress === 100) {\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(\"SyncFS\", \"JSBigSyncFinished\");\n            }\n\n            if (_this2.$splashscreen) {\n                _this2.$splashscreen.updateSyncProgress(progress / 100);\n            }\n        };\n\n        _this2.signalFlushRequired = function () {\n            _this2.needsFlushing = true;\n            _this2.internalNeedsFlushing = true;\n        };\n\n        _this2.ensureStateIsFlushed = function () {\n            var _this = _this2;\n            if (!_this.internalNeedsFlushing) return Promise.resolve();\n\n            _this.flushPromises = _this.flushPromises ? _this.flushPromises : [];\n\n            var p = new Promise(function (resolve, reject) {\n                _this.flushPromises.push({ resolve: resolve, reject: reject });\n            });\n\n            if (_this.masterFlushPromise == undefined) {\n                _this.masterFlushPromise = new Promise(function (resolve, reject) {\n                    function doFlush() {\n                        _this.needsFlushing = false;\n                        _this.idbfsFlushChanges().then(function () {\n                            if (!_this.needsFlushing) {\n                                _this.internalNeedsFlushing = false;\n                                resolve();\n                            } else {\n                                window.setTimeout(doFlush, 50);\n                            }\n                        });\n                    }\n\n                    doFlush();\n                });\n            }\n\n            _this.masterFlushPromise.then(function () {\n                var len = _this.flushPromises.length;\n                for (var i = len - 1; i >= 0; i--) {\n                    _this.flushPromises[i].resolve();\n                }\n                _this.flushPromises = [];\n                _this.masterFlushPromise = undefined;\n            });\n\n            return p;\n        };\n\n        _this2.idbfsGetPromiseToken = function (resolve, reject) {\n            var token = _this2.idbToken++;\n            _this2.idbPromises[token] = {\n                resolve: resolve,\n                reject: reject\n            };\n            return token;\n        };\n\n        _this2.idbfsResolvePromise = function (token, result) {\n            _this2.idbPromises[token].resolve(result);\n            delete _this2.idbPromises[token];\n        };\n\n        _this2.idbfsRejectPromise = function (token, error) {\n            _this2.idbPromises[token].reject(error);\n            delete _this2.idbPromises[token];\n        };\n\n        _this2.idbfsCreateDirectory = function (path) {\n            var idbfsPath = \"/idbfs\" + path;\n            __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callWebGL('SyncFS_IDB', 'createDirectory', [idbfsPath]);\n        };\n\n        _this2.idbfsReadRawFile = function (path) {\n            return new Promise(function (resolve, reject) {\n                var token = _this2.idbfsGetPromiseToken(resolve, reject);\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callWebGL('SyncFS_IDB', 'readRawFile', ['/idbfs' + path, token]);\n            });\n        };\n\n        _this2.idbfsReadTextFile = function (path) {\n            return new Promise(function (resolve, reject) {\n                var token = _this2.idbfsGetPromiseToken(resolve, reject);\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callWebGL('SyncFS_IDB', 'readTextFile', ['/idbfs' + path, token]);\n            });\n        };\n\n        _this2.idbfsWriteRawFile = function (path, data) {\n            return new Promise(function (resolve, reject) {\n                var token = _this2.idbfsGetPromiseToken(resolve, reject);\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callWebGL('SyncFS_IDB', 'writeRawFile', ['/idbfs' + path, data, token]);\n            });\n        };\n\n        _this2.idbfsWriteTextFile = function (path, contents) {\n            return new Promise(function (resolve, reject) {\n                var token = _this2.idbfsGetPromiseToken(resolve, reject);\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callWebGL('SyncFS_IDB', 'writeTextFile', ['/idbfs' + path, contents, token]);\n            });\n        };\n\n        _this2.idbfsRemoveFile = function (path) {\n            return new Promise(function (resolve, reject) {\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callWebGL('SyncFS_IDB', 'removeFile', ['/idbfs' + path]);\n                resolve();\n            });\n        };\n\n        _this2.idbfsFlushChanges = function () {\n            return new Promise(function (resolve, reject) {\n                var token = _this2.idbfsGetPromiseToken(resolve, reject);\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callWebGL('SyncFS_IDB', 'flushChanges', [token]);\n            });\n        };\n\n        _this2.IDB_OnWriteComplete = function (path, context) {\n            _this2.idbfsResolvePromise(context);\n        };\n\n        _this2.IDB_OnReadComplete = function (path, result, context) {\n            if (result) {\n                _this2.idbfsResolvePromise(context, result);\n            } else {\n                _this2.idbfsRejectPromise(context, new __WEBPACK_IMPORTED_MODULE_3_components_SyncError__[\"a\" /* default */]('Failed to read file ' + path));\n            }\n        };\n\n        _this2.IDB_OnFileRemoved = function (path) {};\n\n        _this2.IDB_OnDirectoryCreated = function (path) {};\n\n        _this2.IDB_OnDirectoryRemoved = function (path) {};\n\n        _this2.IDB_OnTrackedFileModified = function (path) {\n            _this2.saveFile(path);\n        };\n\n        _this2.IDB_OnChangesFlushed = function (context) {\n            _this2.idbfsResolvePromise(context);\n        };\n\n        _this2.readSyncMetadata = function () {\n            return new Promise(function (resolve, reject) {\n                _this2.idbfsReadTextFile(_this2.syncMetadataPath).then(function (fileContent) {\n                    var metadata = JSON.parse(fileContent);\n                    resolve(metadata);\n                }).catch(function (error) {\n                    console.warn(\"Failed to read sync metadata - doesn't exist or is unreadable. Assuming empty metadata.\", error);\n                    var defaultMetadata = {\n                        // last startPageToken returned from the GD changes service\n                        lastStartPageToken: \"\",\n                        // local changes (IO actions) awaiting to be synced with GD\n                        pendingLocalChanges: [],\n                        // file full path => File object\n                        files: {}\n                    };\n                    resolve(defaultMetadata);\n                });\n            });\n        };\n\n        _this2.writeSyncMetadata = function (metadata) {\n            var metadataContents = JSON.stringify(metadata);\n            // this._debugLog(\"Sync metadata:\", metadata, metadataContents);\n            return _this2.idbfsWriteTextFile(_this2.syncMetadataPath, metadataContents);\n        };\n\n        _this2.timestamp = function () {\n            function dateStringRFC3339(date) {\n                function pad(n) {\n                    return n < 10 ? '0' + n : n;\n                }\n                return date.getUTCFullYear() + '-' + pad(date.getUTCMonth() + 1) + '-' + pad(date.getUTCDate()) + 'T' + pad(date.getUTCHours()) + ':' + pad(date.getUTCMinutes()) + ':' + pad(date.getUTCSeconds()) + 'Z';\n            }\n            return dateStringRFC3339(new Date());\n        };\n\n        _this2.fetchRemoteChangesSinceLastSync = function () {\n            if (_this2.syncMetadata.lastStartPageToken.length > 0) {\n                return _this2.googleDrive.getChangeList(_this2.syncMetadata.lastStartPageToken);\n            } else {\n                return _this2.googleDrive.getChangeStartPageToken().then(function (response) {\n                    return Promise.resolve({\n                        changes: [],\n                        newStartPageToken: response.startPageToken\n                    });\n                });\n            }\n        };\n\n        _this2.computeLocalDeleteList = function (changes) {\n            var removedFileIds = [];\n            changes.forEach(function (change) {\n                if (change.type === \"deleteFile\" && change.fileId) {\n                    removedFileIds.push(change.fileId);\n                }\n            });\n            return removedFileIds;\n        };\n\n        _this2.computeRemoteDeleteList = function (changes) {\n            var removedFileIds = [];\n            changes.forEach(function (change) {\n                if (change.removed) {\n                    removedFileIds.push(change.fileId);\n                }\n            });\n            return removedFileIds;\n        };\n\n        _this2.mergeFileSystems = function (srcFiles, srcDeleteList, destFiles, destDeleteList, srcIsRemote) {\n            var srcFilePaths = Object.keys(srcFiles);\n            var destFilePaths = Object.keys(destFiles);\n            var ops = [];\n            var filesToDelete = [];\n            srcFilePaths.forEach(function (srcFilePath) {\n                var srcFile = srcFiles[srcFilePath];\n                var op;\n                if (destFilePaths.includes(srcFilePath)) {\n                    // file exists in destination file system\n                    var destFile = destFiles[srcFilePath];\n                    var srcFileModifiedDate = Date.parse(srcFile.modifiedTime);\n                    var destFileModifiedDate = Date.parse(destFile.modifiedTime);\n                    if (srcFileModifiedDate !== destFileModifiedDate) {\n                        // files are different, overwrite the older one with the newer one\n                        if (srcFileModifiedDate > destFileModifiedDate) {\n                            // copy from src to dest\n                            op = { func: _this2.copyFileToFilesystem, params: [srcFile, srcIsRemote, srcIsRemote ? srcFile.id : destFile.id] };\n                            destFile.modifiedTime = srcFile.modifiedTime;\n                        } else {\n                            // copy from dest to src\n                            op = { func: _this2.copyFileToFilesystem, params: [srcFile, !srcIsRemote, srcIsRemote ? srcFile.id : destFile.id] };\n                            srcFile.modifiedTime = destFile.modifiedTime;\n                        }\n                    }\n                } else {\n                    // file doesn't exist in destination file system\n                    if (destDeleteList.includes(srcFile.id)) {\n                        // file is in the destination FS deletion list - remove from source FS\n                        op = { func: _this2.deleteFileFromFilesystem, params: [srcFile, srcIsRemote] };\n                        filesToDelete.push(srcFilePath);\n                    } else {\n                        // file is NOT in the destination FS deletion list - copy from source FS to destination FS\n                        op = { func: _this2.copyFileToFilesystem, params: [srcFile, srcIsRemote] };\n                        destFiles[srcFilePath] = srcFile;\n                    }\n                }\n                if (op) {\n                    ops.push(op);\n                }\n            });\n            filesToDelete.forEach(function (srcFilePath) {\n                delete srcFiles[srcFilePath];\n            });\n            return ops;\n        };\n\n        _this2.copyFileToFilesystem = function (file, download, remoteFileId) {\n            if (download) {\n                // download file from remote into local\n                _this2._debugLog('copyFileToFilesystem: downloading ' + file.name);\n                // this._debugLog(`copyFileToFilesystem: downloading ${file.name}`, file);\n                return _this2.googleDrive.downloadFile(file.id, file.name).then(function (data) {\n                    return _this2.idbfsWriteRawFile(file.name, data);\n                }).then(function () {\n                    // notify Unity that Chrome-app specific PlayerPrefs file has been changed\n                    if (file.name === \"/.ChromePlayerPrefs\") {\n                        __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(\"SyncFS\", \"JSReloadPlayerPrefs\");\n                    }\n                });\n            } else {\n                // upload file from local to remote\n                _this2._debugLog('copyFileToFilesystem: uploading ' + file.name + ' (remote file ID: ' + remoteFileId + ')');\n                return _this2.idbfsReadRawFile(file.name).then(function (data) {\n                    if (data.byteLength < window.GD_RESUMABLE_UPLOAD_SIZE_THRESHOLD) {\n                        if (window.ENABLE_DEBUG) {\n                            _this2._debugLog('copyFileToFilesystem :: copyFileToFilesystem - download: \\'' + download + '\\' - ' + file.name + ' (' + data.byteLength + ' bytes) as multipart upload');\n                        }\n                        return _this2.googleDrive.uploadFile(remoteFileId, file.name, data, file.modifiedTime);\n                    } else {\n                        if (window.ENABLE_DEBUG) {\n                            _this2._debugLog('copyFileToFilesystem :: copyFileToFilesystem - download: \\'' + download + '\\' - ' + file.name + ' (' + data.byteLength + ' bytes) as resumable upload');\n                        }\n                        return _this2.googleDrive.uploadFileResumable(remoteFileId, file.name, data, file.modifiedTime);\n                    }\n                });\n            }\n        };\n\n        _this2.deleteFileFromFilesystem = function (file, isRemoteFS) {\n            if (isRemoteFS) {\n                // perform delete request\n                _this2._debugLog('deleteFileFromFilesystem: deleting remote file ' + file.name);\n                return _this2.googleDrive.deleteFile(file.id, false);\n            } else {\n                // remove from IndexedDB\n                _this2._debugLog('deleteFileFromFilesystem: deleting local file ' + file.name);\n                return _this2.idbfsRemoveFile(file.name);\n            }\n        };\n\n        _this2.$logger = $logger;\n        _this2.$splashscreen = $splashscreen;\n        _this2._setup();\n        return _this2;\n    }\n\n    // SyncFS can be in various states during the app lifetime. Note that states annotated with a +\n    // in this list will have additional information stored in a `reasons` field. Error states will\n    // `reasons` will only exit when all reasons are resolved.\n    // SyncFS status format: {state:<string>, reasons:[<string>, <string>...]}\n\n    // States:\n    // 'uninitialized'      // Initialization has yet to happen, unity can do nothing with us.\n    // 'synced'             // Default state when nothing is happening, and anything can happen\n    // 'synchronizing'      // Sync work in progress, show spinner.\n    // +'offline'           // Something went wrong during upstream sync. The app will recover, but\n    // users should know their data is not being synced.\n    // 'doing_big_sync'     // Sync work in progress, show big sync progress bar.\n    // +'failed_big_sync'   // Something went wrong during initial sync, and the app requires user\n    // interaction to resume sync (user must be in the lobby).\n    // 'big_sync_recovered' // The app recovered from failed_big_sync. This should signal to the\n    // user they move into a spot where the app is safe to sync (probably\n    // the lobby).\n\n    // Reasons:\n    // 'manual_unauth'      // Sync was manually disabled by rejecting the google drive\n    // authentication dialog.\n    // 'local_offline'      // A sync operation failed because we went offline.\n    // 'gdrive_offline'     // Communication to google drive failed and all immediate recovery\n    // failed. Assuming google is offline and doing further exponential\n    // backoff until we re-establish connection.\n\n    _createClass(SyncFS, [{\n        key: '_setup',\n        value: function _setup() {\n            var _this3 = this;\n\n            profileBegin(\"SyncFSInit\", \"Call _setup on SyncFS\");\n            var _this = this;\n\n            this.status = { state: 'uninitialized', reasons: [] };\n\n            this.initialized = false;\n            this.fileSyncIsPaused = false; // Does not affect syncing metadata, just pauses file upload/download;\n            this.syncInProgress = false;\n            this.isOnline = navigator.onLine;\n            this.needsFlushing = true;\n            this.masterFlushPromise = undefined;\n            this.pushingChangeIdx = -1;\n\n            this.syncMetadataPath = \"/.SyncMetadata\"; // stored only locally, /idbfs prefix added internally\n            this.syncMetadata = undefined;\n            this.googleDrive = undefined;\n\n            this.ioActionImpl = {\n                \"writeFile\": this._GD_writeFile,\n                \"deleteFile\": this._GD_deleteFile\n            };\n\n            var onlineListener = function onlineListener(event) {\n                _this._updateOnlineStatus();\n            };\n\n            // Fun fact, these events are not triggered when using throttling in the inspector, 2 year old bug\n            // and I doubt anyone will ever fix it. https://bugs.chromium.org/p/chromium/issues/detail?id=422956\n            // You gotta kill your internet connection at an OS level to test these.\n            window.addEventListener('online', onlineListener);\n            window.addEventListener('offline', onlineListener);\n\n            // This will fail when offline due to errors thrown by gapi, but will create a GoogleDrive\n            // object and set up this.googleDrive properly.\n            profileBegin(\"GoogleAuth\", \"start Google authentication\");\n\n            this.initGoogleDrive().then(function () {\n                _this3._debugLog('Google Drive API initialized');\n                profileEnd(\"GoogleAuth\", \"Google authentication complete\");\n                _this3._completeInitializationStep();\n            }).catch(function (error) {\n                console.error('Failed to initialize Google Drive API: ' + error);\n                profileEnd(\"GoogleAuth\", \"Google authentication failed\");\n                _this3._completeInitializationStep();\n            });\n\n            this.idbToken = 0;\n            this.idbPromises = {};\n        }\n\n        // Initialization\n        ////////////////////////////////////////////////////////////////////////////////////////////////\n\n        // Should be called once emscripten has been loaded.\n\n    }, {\n        key: '_completeInitializationStep',\n\n\n        // Initialization is done in 2 separate phases. Google auth and loading metadata. This waits for\n        // both to be completed and notifies unity when done.\n        value: function _completeInitializationStep() {\n            if (!this.syncMetadata || !this.googleDrive) {\n                this._debugLog(\"_completeInitializationStep - Not yet fully complete [this.syncMetadata: \" + (this.syncMetadata ? \"Complete\" : \"N/A\") + \" , this.googleDrive: \" + (this.googleDrive ? \"Complete\" : \"N/A\") + \"]\");\n                return;\n            } // Init not done yet.\n            if (this.initialized) return; // already initialized\n\n            this.initialized = true;\n            profileEnd(\"SyncFSInit\", \"SyncFS initialization fully complete\");\n            if (this.googleDrive.access_token) {\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(\"SyncFS\", \"JSInitializationResult\", '');\n                this.performBigSync();\n            } else {\n                var target_state = \"failed_big_sync\";\n                var reasons = [];\n                if (!this.isOnline) reasons.push(\"local_offline\");\n                if (this.googleDrive.hasUserDeclinedAuth) {\n                    // Users declined google access. Stay offline.\n                    reasons.push(\"manual_unauth\");\n                } else if (this.googleDrive.access_token == undefined && reasons.length == 0) {\n                    // Authentication error, we can try again right away whenever the user goes to the lobby.\n                    target_state = \"big_sync_recovered\";\n                } else if (reasons.length == 0) {\n                    // If we get here, it probably means this.isOnline is faulty, we already handle all\n                    // authentication errors above, and reading syncMetadata failures should be solved by now.\n                    console.error(\"Failure condition was not handled during auth\");\n                }\n\n                this.attemptStatusChange(target_state, reasons);\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(\"SyncFS\", \"JSInitializationResult\", 'Error authenticating with google.');\n                this.updateBigSyncSyncProgress(100); // Skip big sync and notify unity that it's complete.\n            }\n        }\n\n        // Status management\n        ////////////////////////////////////////////////////////////////////////////////////////////////\n\n    }, {\n        key: 'attemptStatusChange',\n\n\n        // This method may add reasons to the current status, but will not remove reasons.\n        // Returns if the transition was possible or if we are already in that state.\n        value: function attemptStatusChange(newState, newReasons) {\n            // Handle transitioning to the same state\n            newReasons = newReasons ? newReasons : [];\n            var oldState = this.status.state;\n            if (oldState == newState) {\n                var changed = false;\n                for (var i = newReasons.length - 1; i >= 0; i--) {\n                    var idx = this.status.reasons.indexOf(newReasons[i]);\n                    if (idx == -1) {\n                        changed = true;\n                        this.status.reasons.push(newReasons[i]);\n                    }\n                }\n                if (changed) this.sendStatus();\n                return true;\n            }\n\n            if (this.status.reasons.length > 0) return false;\n\n            // Auto-solve error states when no reasons are presented.\n            if (newReasons.length == 0) {\n                if (newState == 'failed_big_sync') newState = 'big_sync_recovered';\n            }\n\n            // Legal state transition checks:\n            var legal = false;\n            switch (newState) {\n                case 'uninitialized':\n                    {}break;\n                case 'synced':\n                    {\n                        if (oldState == 'synchronizing') legal = true;\n                    }break;\n                case 'synchronizing':\n                    {\n                        if (oldState == 'synced' || oldState == 'offline' || oldState == 'doing_big_sync') legal = true;\n                    }break;\n                case 'offline':\n                    {\n                        if (oldState == 'synced' || oldState == 'synchronizing') legal = true;\n                    }break;\n                case 'doing_big_sync':\n                    {\n                        if (oldState == 'uninitialized' || oldState == 'big_sync_recovered') legal = true;\n                    }break;\n                case 'failed_big_sync':\n                    {\n                        if (oldState == 'doing_big_sync' || oldState == 'uninitialized' || oldState == 'big_sync_recovered') legal = true;\n                    }break;\n                case 'big_sync_recovered':\n                    {\n                        if (oldState == 'failed_big_sync' || oldState == 'uninitialized' || oldState == 'doing_big_sync') legal = true;\n                    }break;\n            }\n            if (legal == false) return false;\n\n            // Do actual transition.\n            this.status.state = newState;\n            this.status.reasons = newReasons;\n            this.sendStatus();\n            if (window.ENABLE_DEBUG) {\n                this._debugLog(\"attemptStatusChange - newState: '\" + newState + \"' - reasons: \" + JSON.stringify(newReasons) + \"\");\n            }\n\n            /* LECQA-179: This will start retrying reconnect - work in progress\n            if (newReasons.indexOf(\"gdrive_offline\") !== -1) {\n                this.googleDrive.attemptGoogleReconnect();\n            }\n            */\n            return true;\n        }\n    }, {\n        key: 'errorStateForStatus',\n        value: function errorStateForStatus(status) {\n            if (status == 'doing_big_sync' || status == 'failed_big_sync' || status == 'uninitialized' || status == 'big_sync_recovered') return 'failed_big_sync';\n            return 'offline';\n        }\n    }, {\n        key: '_updateOnlineStatus',\n        value: function _updateOnlineStatus() {\n            // if (this.isOnline == navigator.onLine) return;\n\n            console.log(\"CHANGE ONLINE STATUS\", navigator.onLine);\n            this.isOnline = navigator.onLine;\n            if (this.isOnline) {\n                this.solveStatusReason(\"local_offline\");\n            } else {\n                this.attemptStatusChange(this.errorStateForStatus(this.status.state), [\"local_offline\"]);\n            }\n        }\n\n        // IO action registry\n        ////////////////////////////////////////////////////////////////////////////////////////////////\n\n        // Action types:\n        // writeFile, deleteFile\n\n\n        // File operations\n        ////////////////////////////////////////////////////////////////////////////////////////////////\n\n        // Private helpers\n        ////////////////////////////////////////////////////////////////////////////////////////////////\n\n        // Realtime synchronization to Google Drive\n        ////////////////////////////////////////////////////////////////////////////////////////////////\n\n        // TODO(Catalin): Error handling and quota checks.\n\n    }, {\n        key: 'abortPushingChanges',\n        value: function abortPushingChanges(syncError) {\n            this.pushingChangeIdx = -1;\n            console.log(\"abortPushingChanges: \" + syncError.message);\n            if (syncError.message == \"The user did not approve access.\") this.attemptStatusChange(\"offline\", [\"manual_unauth\"]);else this.attemptStatusChange(\"offline\", [\"gdrive_offline\"]);\n        }\n\n        // Big sync\n        ////////////////////////////////////////////////////////////////////////////////////////////////\n\n        // Flushing\n        ////////////////////////////////////////////////////////////////////////////////////////////////\n\n    }, {\n        key: 'removeIdbfsFromPath',\n\n\n        // IndexedDB IO helpers\n\n        value: function removeIdbfsFromPath(path) {\n            return path.replace(/^\\/idbfs/, '');\n        }\n    }, {\n        key: 'idbfsReverseFlush',\n        value: function idbfsReverseFlush() {\n            var _this4 = this;\n\n            return new Promise(function (resolve, reject) {\n                var token = _this4.idbfsGetPromiseToken(resolve, reject);\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callWebGL('SyncFS_IDB', 'reverseFlush', [token]);\n            });\n        }\n\n        // IndexedDB raw IO callbacks\n\n        // Sync metadata\n\n        // Big sync operations\n\n        // generates RFC 3339 compliant timestamp used by Google Drive REST API;\n        // always returns values in UTC\n\n\n        // returns a list of merge operations\n\n    }]);\n\n    return SyncFS;\n}(__WEBPACK_IMPORTED_MODULE_0_components_BaseModule__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (SyncFS);\n\n/***/ }),\n/* 11 */,\n/* 12 */,\n/* 13 */,\n/* 14 */,\n/* 15 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_components_BaseModule__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_MessageHandler__ = __webpack_require__(1);\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n\n\n\nvar Audio = function (_BaseModule) {\n    _inherits(Audio, _BaseModule);\n\n    function Audio() {\n        _classCallCheck(this, Audio);\n\n        var _this = _possibleConstructorReturn(this, (Audio.__proto__ || Object.getPrototypeOf(Audio)).call(this));\n\n        _this.initAudio = function (bufferSize) {\n            _this.audioBufferSize = bufferSize;\n            navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;\n\n            window.AudioContext = window.AudioContext || window.webkitAudioContext;\n\n            _this.audioContext = new AudioContext();\n        };\n\n        _this.enableDisableAudio = function (enable) {\n            _this.enabled = enable === 'True';\n\n            if (_this.enabled) {\n                navigator.getUserMedia({\n                    audio: true\n                }, function (audioStream) {\n                    _this.audioStream = audioStream;\n                    _this.setupVolumeListening();\n                    _this.audioIntervalID = setInterval(function () {\n                        _this.getVolume();\n                    }, 1000);\n                }, function (error) {\n                    console.log('The following error occured: ' + error);\n                });\n            } else {\n\n                _this.teardownAudioRecording();\n                _this.teardownVolumeListening();\n\n                if (_this.audioStream) {\n                    _this.audioStream.stop();\n                    _this.audioStream = null;\n                }\n                clearInterval(_this.audioIntervalID);\n            }\n        };\n\n        _this.startRecording = function () {\n\n            _this.isListening = false;\n            _this.teardownVolumeListening();\n\n            _this.setupAudioRecording();\n            if (_this.audioRecordRTC) {\n                // this.isAudioRecording = true;\n                _this.audioRecordRTC.startRecording();\n            } else {\n                console.info('startRecording - No audioRecordRTC instance - Skipping startRecording call');\n            }\n        };\n\n        _this.stopRecording = function (resumeListening) {\n            if (_this.isAudioRecording && _this.enabled) {\n                if (_this.audioRecordRTC) {\n                    _this.audioRecordRTC.stopRecording(function () {\n                        _this.handleAudio(_this.audioRecordRTC.toURL());\n                    });\n                } else {\n                    console.info('stopRecording - No audioRecordRTC instance - Skipping stopRecording call');\n                }\n            }\n\n            var newIsListening = resumeListening;\n            if (_this.isListening != newIsListening && _this.enabled) {\n                if (newIsListening) {\n                    _this.setupVolumeListening();\n                } else {\n                    _this.teardownVolumeListening();\n                }\n            }\n            _this.isListening = newIsListening;\n        };\n\n        _this.handleAudio = function (audioURL) {\n            if (_this.audioRecordRTC) {\n                var dataURL = 'uniwebview://AudioRecorded?AudioDataURL=' + audioURL;\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n            } else {\n                console.debug('Audio :: handleAudio - this.audioRecordRTC is null or undefined');\n            }\n            _this.teardownAudioRecording();\n        };\n\n        _this.setupAudioRecording = function () {\n            _this.audioRecordRTC = new RecordRTC(_this.audioStream, {\n                recorderType: StereoAudioRecorder,\n                type: 'audio',\n                numberOfAudioChannels: 1,\n                mimeType: 'audio/wav',\n                bufferSize: 0,\n                disableLogs: false\n            });\n            _this.audioRecordRTC.onStateChanged.call = function (state) {\n                console.log('Audio :: Audio Recorder state changed: ', state);\n                _this.isAudioRecording = state['state'] === 'recording';\n            };\n        };\n\n        _this.teardownAudioRecording = function () {\n            _this.audioRecordRTC = null;\n        };\n\n        _this.setupVolumeListening = function () {\n            if (_this.audioStream) {\n                _this.audioWorker.onmessage = function (e) {\n                    switch (e.data.command) {\n                        case 'volume':\n                            _this.sendVolume(e.data.volume);\n                            break;\n                        default:\n                            console.log('AudioController Unknow message');\n                            break;\n                    }\n                };\n\n                _this.recorder = _this.audioContext.createScriptProcessor(_this.audioBufferSize, 1, 1);\n                _this.recorder.onaudioprocess = function (e) {\n                    if (!_this.isListening || !_this.enabled) {\n                        return;\n                    }\n\n                    var inputData = e.inputBuffer.getChannelData(0);\n\n                    _this.audioWorker.postMessage({\n                        command: 'record',\n                        buffer: [inputData]\n                    });\n                };\n\n                _this.inputPoint = _this.audioContext.createGain();\n                _this.inputPoint.gain.setTargetAtTime(1, _this.audioContext.currentTime, 0.015);\n\n                // Create an AudioNode from the stream.\n                _this.realAudioInput = _this.audioContext.createMediaStreamSource(_this.audioStream);\n                _this.realAudioInput.connect(_this.inputPoint);\n\n                _this.zeroGain = _this.audioContext.createGain();\n                _this.zeroGain.gain.setTargetAtTime(0.0, _this.audioContext.currentTime, 0.015);\n                _this.inputPoint.connect(_this.zeroGain);\n                _this.zeroGain.connect(_this.audioContext.destination);\n\n                _this.inputPoint.connect(_this.recorder);\n                _this.recorder.connect(_this.audioContext.destination);\n            }\n        };\n\n        _this.teardownVolumeListening = function () {\n            if (_this.recorder) {\n                _this.recorder.onaudioprocess = null;\n                _this.recorder = null;\n            }\n\n            if (_this.realAudioInput) {\n                _this.realAudioInput.disconnect();\n                _this.realAudioInput = null;\n            }\n\n            if (_this.inputPoint) {\n                _this.inputPoint.disconnect();\n                _this.inputPoint = null;\n            }\n\n            if (_this.zeroGain) {\n                _this.zeroGain.disconnect();\n                _this.zeroGain = null;\n            }\n        };\n\n        _this.getVolume = function () {\n            if (_this.isListening) {\n                _this.audioWorker.postMessage({\n                    command: 'getVolume'\n                });\n            }\n        };\n\n        _this.sendVolume = function (clipVolume) {\n            var dataURL = 'uniwebview://AudioVolume?AudioVolumeValue=' + clipVolume;\n            __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n        };\n\n        _this.audioContext = null;\n\n        _this.recorder = null;\n        _this.isAudioRecording = false;\n        _this.isListening = false;\n        _this.enabled = false;\n        _this.audioBufferSize = 0;\n        _this.audioWorker = new Worker('js/audioWorker.js');\n        _this.audioWorker.postMessage({\n            command: 'init',\n            config: {}\n        });\n        _this.audioRecordRTC = null;\n        _this.audioStream = null;\n\n        _this.recorder = null;\n        _this.inputPoint = null;\n        _this.realAudioInput = null;\n        _this.zeroGain = null;\n        _this.audioIntervalID = -1;\n        return _this;\n    }\n\n    return Audio;\n}(__WEBPACK_IMPORTED_MODULE_0_components_BaseModule__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (Audio);\n\n/***/ }),\n/* 16 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* unused harmony export Helper */\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_components_BaseModule__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_MessageHandler__ = __webpack_require__(1);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__ = __webpack_require__(29);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__);\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\n\n\nvar instance = null;\nvar bleManagerInstance = null;\n\nif (window) {\n    window.LDSDKLogger = __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"];\n    window.LDM = bleManagerInstance;\n}\n\nvar Helper = function () {\n    function Helper() {\n        _classCallCheck(this, Helper);\n\n        if (!instance) {\n            instance = this;\n        }\n        return instance;\n    }\n\n    _createClass(Helper, null, [{\n        key: 'getInstance',\n        value: function getInstance() {\n            if (!instance) {\n                instance = new Helper();\n            }\n\n            return instance;\n        }\n    }, {\n        key: 'sendMessage',\n        value: function sendMessage(methodName, payload) {\n            __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callWebGL('bluetoothHandler', 'sendData', [{ method: methodName, data: JSON.stringify(payload) }]);\n        }\n    }]);\n\n    return Helper;\n}();\n\n/****************************************************************************\n    Simple object functions for wrapping sdk data to simpler representations\n******************************************************************************/\nfunction getSimpleRevision(legoFirmwareRevision) {\n    if (!legoFirmwareRevision || legoFirmwareRevision === null) {\n        // HardwareRevision is usually null, this is a fallback for that case\n        return {\n            MajorVersion: 'N/A',\n            MinorVersion: 'N/A',\n            BugFixVersion: 'N/A',\n            BuildNumber: 'N/A'\n        };\n    }\n    return {\n        MajorVersion: legoFirmwareRevision.majorVersion,\n        MinorVersion: legoFirmwareRevision.minorVersion,\n        BugFixVersion: legoFirmwareRevision.bugFixVersion,\n        BuildNumber: legoFirmwareRevision.buildNumber\n    };\n}\n\nfunction getSimpleRevisionString(legoFirmwareRevision) {\n    var revisionObj = getSimpleRevision(legoFirmwareRevision);\n    return revisionObj.MajorVersion + '.' + revisionObj.MinorVersion + '.' + revisionObj.BugFixVersion + '.' + revisionObj.BuildNumber;\n}\n\nfunction getSimpleDeviceInfo(legoDeviceInfo) {\n    if (!legoDeviceInfo || legoDeviceInfo === null) {\n        // console.warn('WRAPPER :: legoDeviceInfo is not defined or null');\n        return {\n            FirmwareRevision: getSimpleRevisionString(),\n            HardwareRevision: getSimpleRevisionString(),\n            SoftwareRevision: getSimpleRevisionString(),\n            ManufacturerName: 'N/A'\n        };\n    }\n    return {\n        FirmwareRevision: getSimpleRevisionString(legoDeviceInfo.firmwareRevision),\n        HardwareRevision: getSimpleRevisionString(legoDeviceInfo.hardwareRevision),\n        SoftwareRevision: getSimpleRevisionString(legoDeviceInfo.softwareRevision),\n        ManufacturerName: legoDeviceInfo.manufacturerName && legoDeviceInfo.manufacturerName !== null ? legoDeviceInfo.manufacturerName : 'N/A'\n    };\n}\n\nfunction getSimpleLegoDevice(legoBluetoothDevice) {\n    if (!legoBluetoothDevice || legoBluetoothDevice === null) {\n        // console.warn('WRAPPER :: legoBluetoothDevice is not defined or null');\n        return {\n            DeviceID: 'N/A'\n        };\n    }\n\n    return {\n        DeviceID: legoBluetoothDevice.deviceId,\n        DeviceName: legoBluetoothDevice.deviceName,\n        ButtonState: legoBluetoothDevice.isButtonPressed,\n        BatteryLevel: legoBluetoothDevice.batteryLevel,\n        LowVoltageState: legoBluetoothDevice.isLowVoltage,\n        DeviceInfo: getSimpleDeviceInfo(legoBluetoothDevice.deviceInfo),\n        ConnectedState: legoBluetoothDevice.connectState - 1,\n        Category: legoBluetoothDevice.category,\n        SupportedFunctions: legoBluetoothDevice.supportedFunctions,\n        LastConnectedNetworkId: legoBluetoothDevice.lastConnectedNetworkId\n    };\n}\n\nfunction getSimpleInputFormat(inputFormat) {\n    if (!inputFormat || inputFormat === null) {\n        return {};\n    }\n\n    return {\n        Revision: inputFormat.revision,\n        ConnectID: inputFormat.connectId,\n        TypeID: inputFormat.typeId,\n        Mode: inputFormat.mode,\n        DeltaInterval: inputFormat.deltaInterval,\n        Unit: inputFormat.unit,\n        NotificationsEnabled: inputFormat.notificationsEnabled\n    };\n}\n\nfunction getSimpleConnectInfo(legoConnectInfo) {\n    if (!legoConnectInfo || legoConnectInfo === null) {\n        // console.warn('WRAPPER :: legoConnectInfo is not defined or null');\n        return {};\n    }\n    return {\n        ConnectID: legoConnectInfo.connectId,\n        HubIndex: legoConnectInfo.hubIndex,\n        Type: legoConnectInfo.type,\n        HardwareRevision: getSimpleRevisionString(legoConnectInfo.hardwareVersion),\n        SoftwareRevision: getSimpleRevisionString(),\n        FirmwareRevision: getSimpleRevisionString(legoConnectInfo.firmwareVersion)\n    };\n}\n\nfunction getSimpleServiceData(legoServiceData, serviceType) {\n    if (!legoServiceData || legoServiceData === null) {\n        console.warn('WRAPPER :: getSimpleServiceData legoService is not defined or null');\n        return {};\n    }\n\n    var result = {};\n    switch (serviceType) {\n        case __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"IOType\"].IO_TYPE_MOTOR:\n            result.Power = legoServiceData.power;\n            break;\n        case __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"IOType\"].IO_TYPE_VOLTAGE:\n            result.MilliVolts = legoServiceData.valueAsMilliVolts;\n            break;\n        case __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"IOType\"].IO_TYPE_CURRENT:\n            result.MilliAmp = legoServiceData.valueAsMilliAmps;\n            break;\n        case __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"IOType\"].IO_TYPE_PIEZO_TONE_PLAYER:\n            break;\n        case __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"IOType\"].IO_TYPE_RGB_LIGHT:\n            result.RGBLightMode = legoServiceData.rgbMode;\n            var color = legoServiceData.color;\n            result.Color = { R: color.getRed(), G: color.getGreen(), B: color.getBlue(), A: 1 };\n            var defaultColor = legoServiceData.defaultColor;\n            result.DefaultColor = {\n                R: defaultColor.getRed(),\n                G: defaultColor.getGreen(),\n                B: defaultColor.getBlue(),\n                A: 1\n            };\n            result.ColorIndex = legoServiceData.colorIndex;\n            result.DefaultColorIndex = legoServiceData.defaultColorIndex;\n            break;\n        case __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"IOType\"].IO_TYPE_TILT_SENSOR:\n            result.Angle = getSimpleTiltSensorAngle(legoServiceData.angle);\n            result.Crash = getSimpleTiltSensorCrash(legoServiceData.crash);\n            result.TiltSensorDirection = legoServiceData.direction;\n            result.TiltSensorMode = legoServiceData.tiltSensorMode;\n            break;\n        case __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"IOType\"].IO_TYPE_MOTION_SENSOR:\n            result.Count = legoServiceData.count;\n            result.Distance = legoServiceData.distance;\n            result.MotionSensorMode = legoServiceData.motionSensorMode;\n            break;\n        case __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"IOType\"].IO_TYPE_GENERIC:\n            break;\n    }\n    return result;\n}\n\nfunction getSimpleService(legoService) {\n    if (!legoService || legoService === null) {\n        // console.warn('WRAPPER :: legoService is not defined or null');\n        return {};\n    }\n\n    return {\n        DeviceID: legoService.deviceId,\n        IsInternalService: legoService.isInternalService,\n        ServiceName: legoService.serviceName,\n        DefaultInputFormat: getSimpleInputFormat(legoService.defaultInputFormat),\n        InputFormat: getSimpleInputFormat(legoService.inputFormat),\n        ConnectInfo: getSimpleConnectInfo(legoService.connectInfo),\n        ServiceData: getSimpleServiceData(legoService.serviceData, legoService.connectInfo.type)\n    };\n}\n\nfunction getSimpleTiltSensorAngle(legoTiltSensorAngle) {\n    if (!legoTiltSensorAngle || legoTiltSensorAngle === null) {\n        // console.warn('WRAPPER :: legoTiltSensorAngle is not defined or null');\n        return {};\n    }\n    return {\n        X: legoTiltSensorAngle.x,\n        Y: legoTiltSensorAngle.y\n    };\n}\n\nfunction getSimpleTiltSensorCrash(legoTiltSensorCrash) {\n    if (!legoTiltSensorCrash || legoTiltSensorCrash === null) {\n        // console.warn('WRAPPER :: legoTiltSensorCrash is not defined or null');\n        return {};\n    }\n    return {\n        X: legoTiltSensorCrash.x,\n        Y: legoTiltSensorCrash.y,\n        Z: legoTiltSensorCrash.z\n    };\n}\n\nvar DevicesCallbackListenerImpl = function () {\n    function DevicesCallbackListenerImpl(bluetooth) {\n        _classCallCheck(this, DevicesCallbackListenerImpl);\n\n        this.bluetooth = bluetooth;\n        this.deviceListeners = new Map();\n        this.deviceToListenerId = new Map();\n    }\n\n    _createClass(DevicesCallbackListenerImpl, [{\n        key: 'checkAndRegisterDeviceCallback',\n        value: function checkAndRegisterDeviceCallback(address) {\n            if (!this.deviceListeners.has(address)) {\n                var listener = new DeviceCallbackListener();\n                this.deviceListeners.set(address, listener);\n                var listenerId = bleManagerInstance.registerDeviceCallbackListener(address, listener);\n                this.deviceToListenerId.set(address, listenerId);\n                __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].info('WRAPPER :: checkAndRegisterDeviceCallback - registered Device callback listener for ' + address + ' - with listenerId: ' + listenerId);\n            }\n        }\n\n        /**\n         * This function is called whenever a new device not previously seen in a scan is discovered.\n         *\n         * @param legoBluetoothDevice\n         */\n\n    }, {\n        key: 'onDeviceAppeared',\n        value: function onDeviceAppeared(legoBluetoothDevice) {\n            __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].info('WRAPPER :: onDeviceAppeared(' + legoBluetoothDevice.deviceName + ' [' + legoBluetoothDevice.deviceId + ']');\n            this.checkAndRegisterDeviceCallback(legoBluetoothDevice.deviceId);\n            var legoDevice = getSimpleLegoDevice(legoBluetoothDevice);\n            if (this.bluetooth.addDevice(legoBluetoothDevice)) {\n                Helper.sendMessage('OnDeviceAppeared', legoDevice);\n            }\n        }\n\n        /**\n         * If a device previously available during scanning no longer appears in scans, this function is called.\n         * @param legoBluetoothDevice\n         */\n\n    }, {\n        key: 'onDeviceDisappeared',\n        value: function onDeviceDisappeared(legoBluetoothDevice) {\n            __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].info('WRAPPER :: onDeviceDisappeared(' + legoBluetoothDevice.deviceName + ' [' + legoBluetoothDevice.deviceId + ']');\n            this.checkAndRegisterDeviceCallback(legoBluetoothDevice.deviceId);\n            var legoDevice = getSimpleLegoDevice(legoBluetoothDevice);\n            if (legoDevice.ConnectedState !== 1) {\n                if (__WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].isDebugEnabled()) {\n                    __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].debug('WRAPPER :: onDeviceDisappeared - Update connectedState to disconnected not' + ' advertising when the device has disappeared');\n                }\n                legoDevice.ConnectedState = 1; // When the device disappears set the state to not advertising\n            }\n\n            Helper.sendMessage('OnDeviceDisappeared', legoDevice);\n            this.bluetooth.removeDevice(legoBluetoothDevice);\n        }\n\n        /**\n         * This function is called immediately before the sdk starts connecting to a device.\n         * If a scan is running, it will be stopped.\n         *\n         * @param legoBluetoothDevice\n         */\n\n    }, {\n        key: 'onWillStartConnectingToDevice',\n        value: function onWillStartConnectingToDevice(legoBluetoothDevice) {\n            __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].info('WRAPPER :: onWillStartConnectingToDevice(' + legoBluetoothDevice.deviceName + ' [' + legoBluetoothDevice.deviceId + ']');\n            this.checkAndRegisterDeviceCallback(legoBluetoothDevice.deviceId);\n            var legoDevice = getSimpleLegoDevice(legoBluetoothDevice);\n            Helper.sendMessage('OnWillStartConnectingToDevice', legoDevice);\n        }\n\n        /**\n         * This function is called when the device has connected and the SDK starts querying the device for its\n         * services and characteristics. The device is not yet ready to be queried see @link\n         * onDidFinishInterrogatingDevice instead.\n         *\n         * @param legoBluetoothDevice\n         */\n\n    }, {\n        key: 'onDidStartInterrogatingDevice',\n        value: function onDidStartInterrogatingDevice(legoBluetoothDevice) {\n            __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].info('WRAPPER :: onDidStartInterrogatingDevice(' + legoBluetoothDevice.deviceName + ' [' + legoBluetoothDevice.deviceId + ']');\n            this.checkAndRegisterDeviceCallback(legoBluetoothDevice.deviceId);\n            if (backgroundPage) {\n                backgroundPage.addDeviceAddress(legoBluetoothDevice.deviceId);\n            }\n            var legoDevice = getSimpleLegoDevice(legoBluetoothDevice);\n            Helper.sendMessage('OnDidStartInterrogatingDevice', legoDevice);\n        }\n\n        /**\n         * When the device has connected, and its services and characteristics have been discovered the connect has\n         * completed and the device is ready for use.\n         *\n         * @param legoBluetoothDevice\n         */\n\n    }, {\n        key: 'onDidFinishInterrogatingDevice',\n        value: function onDidFinishInterrogatingDevice(legoBluetoothDevice) {\n            __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].info('WRAPPER :: onDidFinishInterrogatingDevice(' + legoBluetoothDevice.deviceName + ' [' + legoBluetoothDevice.deviceId + ']');\n            this.checkAndRegisterDeviceCallback(legoBluetoothDevice.deviceId);\n            var legoDevice = getSimpleLegoDevice(legoBluetoothDevice);\n            bleManagerInstance.scan(); // TODO: Do this from Unity instead - and only if the connect\n            // dialog is shown\n            Helper.sendMessage('OnDidFinishInterrogatingDevice', legoDevice);\n        }\n\n        /**\n         * When we have successfully disconnected from a device (or the device disconnects).\n         *\n         * @param legoBluetoothDevice\n         */\n\n    }, {\n        key: 'onDidDisconnectFromDevice',\n        value: function onDidDisconnectFromDevice(legoBluetoothDevice) {\n            __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].info('WRAPPER :: onDidDisconnectFromDevice(' + legoBluetoothDevice.deviceName + ' [' + legoBluetoothDevice.deviceId + ']');\n            this.checkAndRegisterDeviceCallback(legoBluetoothDevice.deviceId);\n            var legoDevice = getSimpleLegoDevice(legoBluetoothDevice);\n            if (backgroundPage) {\n                backgroundPage.removeDeviceAddress(legoBluetoothDevice.deviceId);\n            }\n            Helper.sendMessage('OnDidDisconnectFromDevice', legoDevice);\n        }\n\n        /**\n         * Called when a a connection attempt fails\n         *\n         * @param legoBluetoothDevice\n         */\n\n    }, {\n        key: 'onDidFailToConnectToDevice',\n        value: function onDidFailToConnectToDevice(legoBluetoothDevice) {\n            __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].info('WRAPPER :: onDidFailToConnectToDevice(' + legoBluetoothDevice.deviceName + ' [' + legoBluetoothDevice.deviceId + ']');\n            this.checkAndRegisterDeviceCallback(legoBluetoothDevice.deviceId);\n            var legoDevice = getSimpleLegoDevice(legoBluetoothDevice);\n            bleManagerInstance.scan(); // TODO: Do this from Unity instead - and only if the connect\n            // dialog is shown\n            if (backgroundPage) {\n                backgroundPage.removeDeviceAddress(legoBluetoothDevice.deviceId);\n            }\n            Helper.sendMessage('OnDidFailToConnectToDevice', legoDevice);\n        }\n    }]);\n\n    return DevicesCallbackListenerImpl;\n}();\n\nvar DeviceCallbackListener = function () {\n    function DeviceCallbackListener() {\n        _classCallCheck(this, DeviceCallbackListener);\n\n        this.serviceCallbackListener = new ServiceCallbackListener();\n        this.services = new Map();\n        this.serviceListeners = new Map();\n    }\n\n    _createClass(DeviceCallbackListener, [{\n        key: 'didUpdateDeviceInfo',\n        value: function didUpdateDeviceInfo(device, deviceInfo, error) {\n            if (__WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].isTraceEnabled()) {\n                __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].trace('WRAPPER :: Bluetooth.js didUpdateDeviceInfo(device: ', device, ', deviceInfo:', deviceInfo, ', error:', error, ')');\n            }\n            var legoDevice = getSimpleLegoDevice(device);\n            legoDevice.DeviceInfo = getSimpleDeviceInfo(deviceInfo);\n            Helper.sendMessage('DidUpdateDeviceInfo', legoDevice);\n        }\n    }, {\n        key: 'didChangeButtonState',\n        value: function didChangeButtonState(device, buttonPressed) {\n            if (__WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].isTraceEnabled()) {\n                __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].trace('WRAPPER :: Bluetooth.js didChangeButtonState(device: ', device, ', buttonPressed:', buttonPressed);\n            }\n            var legoDevice = getSimpleLegoDevice(device);\n            Helper.sendMessage('DidChangeButtonState', legoDevice);\n        }\n    }, {\n        key: 'didUpdateLowVoltageState',\n        value: function didUpdateLowVoltageState(device, lowVoltage) {\n            if (__WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].isTraceEnabled()) {\n                __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].trace('WRAPPER :: Bluetooth.js didUpdateLowVoltageState(device: ', device, ', lowVoltage:', lowVoltage);\n            }\n            var legoDevice = getSimpleLegoDevice(device);\n            Helper.sendMessage('DidUpdateLowVoltageState', legoDevice);\n        }\n    }, {\n        key: 'didUpdateBatteryLevel',\n        value: function didUpdateBatteryLevel(device, batteryLevel) {\n            if (__WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].isTraceEnabled()) {\n                __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].trace('WRAPPER :: Bluetooth.js didUpdateBatteryLevel(device: ', device, ', batteryLevel:', batteryLevel);\n            }\n            var legoDevice = getSimpleLegoDevice(device);\n            Helper.sendMessage('DidUpdateBatteryLevel', legoDevice);\n        }\n    }, {\n        key: 'didChangeNameFrom',\n        value: function didChangeNameFrom(device, oldName, newName) {\n            if (__WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].isTraceEnabled()) {\n                __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].trace('WRAPPER :: Bluetooth.js didChangeNameFrom(device: ', device, ', oldName:', oldName, 'newName:', newName);\n            }\n            var legoDevice = getSimpleLegoDevice(device);\n            Helper.sendMessage('DidChangeNameFrom', legoDevice);\n        }\n    }, {\n        key: 'didFailToAddServiceWithError',\n        value: function didFailToAddServiceWithError(device, error) {\n            var legoDevice = getSimpleLegoDevice(device);\n            Helper.sendMessage('DidFailToAddServiceWithError', legoDevice);\n        }\n    }, {\n        key: 'didRemoveService',\n        value: function didRemoveService(device, legoService) {\n            if (__WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].isTraceEnabled()) {\n                __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].trace('WRAPPER :: Bluetooth.js didRemoveService(device: ', device, ', legoService:', legoService);\n            }\n            var connectId = legoService.connectInfo.connectId;\n            var simpleService = getSimpleService(legoService);\n            if (device === null || !device) {\n                __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].error('WRAPPER :: didRemoveService device is null');\n            }\n            simpleService.DeviceID = device.deviceId;\n            simpleService.ConnectID = connectId;\n\n            var listenerId = this.serviceListeners.get(connectId);\n            bleManagerInstance.unregisterServiceCallbackListener(device.deviceId, connectId, listenerId);\n            this.serviceListeners.delete(connectId);\n\n            Helper.sendMessage('DidRemoveService', simpleService);\n        }\n    }, {\n        key: 'didAddService',\n        value: function didAddService(device, legoService) {\n            if (device === null || !device) {\n                __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].error('WRAPPER :: didAddService device is null');\n            }\n\n            var connectId = legoService.connectInfo.connectId;\n            if (this.services.has(connectId) && this.serviceListeners.has(connectId)) {\n                var _listenerId = this.serviceListeners.get(connectId);\n                bleManagerInstance.unregisterServiceCallbackListener(device.deviceId, connectId, _listenerId);\n                this.serviceListeners.delete(connectId);\n                this.services.delete(connectId);\n            }\n\n            this.services.set(connectId, legoService);\n            var simpleService = getSimpleService(legoService);\n            simpleService.DeviceID = device.deviceId;\n            if (__WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].isInfoEnabled()) {\n                __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].info('WRAPPER :: Bluetooth.js didAddService(device: ' + device.deviceName + ' [' + device.deviceId + '], legoService:' + legoService.serviceName + ', connectInfo: ' + legoService.connectInfo);\n            }\n            var listenerId = bleManagerInstance.registerServiceCallbackListener(device.deviceId, connectId, this.serviceCallbackListener);\n            this.serviceListeners.set(connectId, listenerId);\n            Helper.sendMessage('DidAddService', simpleService);\n        }\n    }]);\n\n    return DeviceCallbackListener;\n}();\n\n/**\n * Each connected LegoService (Motor, MotionSensor, TiltSensor, RGBLight etc) offers a callback interface so the client\n * can get notifications of value updates.\n *\n * They all have a registerCallbackListener(listener) that returns an id and a\n * unregisterCallbackListener(listenerId) function for unregistering.\n *\n * The ServiceCallbackListener is an example implementation of such a listener showing all the possible methods that\n * can be invoked.\n */\n\n\nvar ServiceCallbackListener = function () {\n    function ServiceCallbackListener() {\n        _classCallCheck(this, ServiceCallbackListener);\n    }\n\n    _createClass(ServiceCallbackListener, [{\n        key: 'didUpdateInputFormat',\n        value: function didUpdateInputFormat(legoService, oldFormat, inputFormat) {\n            var simpleService = getSimpleService(legoService);\n            simpleService.OldInputFormat = getSimpleInputFormat(oldFormat);\n            simpleService.NewInputFormat = getSimpleInputFormat(inputFormat);\n            Helper.sendMessage('DidUpdateInputFormat', simpleService);\n        }\n\n        /**\n         *\n         * @param legoService\n         * @param oldData Previous value as an arraybuffer\n         * @param valueData New value as an arraybuffer\n         */\n\n    }, {\n        key: 'didUpdateValueData',\n        value: function didUpdateValueData(legoService, oldData, valueData) {\n            var simpleService = getSimpleService(legoService);\n            simpleService.NewValue = legoService.numberValue;\n            Helper.sendMessage('DidUpdateValueData', simpleService);\n        }\n\n        // MotionSensor specific methods\n\n    }, {\n        key: 'didUpdateDistance',\n        value: function didUpdateDistance(legoService, oldDistance, newDistance) {\n            var simpleService = getSimpleService(legoService);\n            simpleService.OldDistance = oldDistance;\n            simpleService.NewDistance = newDistance;\n            Helper.sendMessage('DidUpdateDistance', simpleService);\n        }\n    }, {\n        key: 'didUpdateCount',\n        value: function didUpdateCount(legoService, count) {\n            var simpleService = getSimpleService(legoService);\n            simpleService.Count = count;\n            Helper.sendMessage('DidUpdateCount', simpleService);\n        }\n\n        // RGB light specific methods\n\n    }, {\n        key: 'didReadInitialColor',\n        value: function didReadInitialColor(legoService) {\n            var simpleService = getSimpleService(legoService);\n            Helper.sendMessage('DidReadInitialColor', simpleService);\n        }\n    }, {\n        key: 'didUpdateRGBValue',\n        value: function didUpdateRGBValue(legoService, oldColor, color) {\n            var simpleService = getSimpleService(legoService);\n            simpleService.OldColor = oldColor;\n            simpleService.NewColor = color;\n            Helper.sendMessage('DidUpdateRGBValue', simpleService);\n        }\n    }, {\n        key: 'didUpdateRGBColorIndex',\n        value: function didUpdateRGBColorIndex(legoService, oldColorIndex, newColorIndex) {\n            var simpleService = getSimpleService(legoService);\n            simpleService.OldColorIndex = oldColorIndex;\n            simpleService.NewColorIndex = newColorIndex;\n            Helper.sendMessage('DidUpdateRGBColorIndex', simpleService);\n        }\n\n        // TiltSensor specific methods\n\n    }, {\n        key: 'didUpdateDirection',\n        value: function didUpdateDirection(legoService, oldDirection, direction) {\n            var simpleService = getSimpleService(legoService);\n            simpleService.OldDirection = oldDirection;\n            simpleService.NewDirection = direction;\n            Helper.sendMessage('DidUpdateDirection', simpleService);\n        }\n    }, {\n        key: 'didUpdateAngle',\n        value: function didUpdateAngle(legoService, oldAngle, angle) {\n            var simpleService = getSimpleService(legoService);\n            simpleService.OldAngle = oldAngle;\n            simpleService.NewAngle = angle;\n            Helper.sendMessage('DidUpdateAngle', simpleService);\n        }\n    }, {\n        key: 'didUpdateCrash',\n        value: function didUpdateCrash(legoService, oldCrash, crash) {\n            var simpleService = getSimpleService(legoService);\n            simpleService.OldCrash = oldCrash;\n            simpleService.NewCrash = crash;\n            Helper.sendMessage('DidUpdateCrash', simpleService);\n        }\n\n        // VoltageSensor specific methods\n\n    }, {\n        key: 'didUpdateMilliVolts',\n        value: function didUpdateMilliVolts(legoService, milliVolts) {\n            var simpleService = getSimpleService(legoService);\n            simpleService.MilliVolts = milliVolts;\n            Helper.sendMessage('DidUpdateMilliVolts', simpleService);\n        }\n\n        // CurrentSensor specific methods\n\n    }, {\n        key: 'didUpdateMilliAmps',\n        value: function didUpdateMilliAmps(currentSensor, milliAmps) {\n            var simpleService = getSimpleService(currentSensor);\n            simpleService.MilliAmp = milliAmps;\n            Helper.sendMessage('DidUpdateMilliAmps', simpleService);\n        }\n    }]);\n\n    return ServiceCallbackListener;\n}();\n\nvar Bluetooth = function (_BaseModule) {\n    _inherits(Bluetooth, _BaseModule);\n\n    function Bluetooth($logger) {\n        _classCallCheck(this, Bluetooth);\n\n        var _this = _possibleConstructorReturn(this, (Bluetooth.__proto__ || Object.getPrototypeOf(Bluetooth)).call(this));\n\n        _this.addDevice = function (legoDevice) {\n            _this.checkAndRegisterScanListener();\n            var found = false;\n            for (var i = 0; i < _this.devices.length; i++) {\n                if (_this.devices[i].deviceId === legoDevice.deviceId) {\n                    found = true;\n                }\n            }\n            if (!found) {\n                _this.devices.push(legoDevice);\n                return true;\n            }\n            return false;\n        };\n\n        _this.removeDevice = function (legoDevice) {\n            _this.checkAndRegisterScanListener();\n            var idxToRemove = -1;\n            for (var i = 0; i < _this.devices.length; i++) {\n                if (_this.devices[i].deviceId === legoDevice.deviceId) {\n                    idxToRemove = i;\n                }\n            }\n            // const idx = this.simpleList.indexOf(item);\n            if (idxToRemove >= 0) {\n                _this.devices.splice(idxToRemove, 1);\n            }\n        };\n\n        _this.scan = function () {\n            _this.checkAndRegisterScanListener();\n            return new Promise(function (resolve, reject) {\n                _this.$logger.log('WRAPPER :: Bluetooth.scan');\n                bleManagerInstance.scan().then(function () {\n                    _this.$logger.log('WRAPPER :: Scan started');\n                    return resolve();\n                }).catch(function (error) {\n                    _this.$logger.error('WRAPPER :: Failed scanning: ', error);\n                    return resolve(); // We should probably reject\n                });\n            });\n        };\n\n        _this.stopScanning = function () {\n            _this.checkAndRegisterScanListener();\n            return new Promise(function (resolve, reject) {\n                _this.$logger.log('WRAPPER :: Bluetooth.stopScanning');\n                bleManagerInstance.stopScanning().catch(function (error) {\n                    _this.$logger.error('WRAPPER :: Failed stopScanning: ', error);\n                }).then(function () {\n                    _this.$logger.log('WRAPPER :: Resolving stopScanning');\n                    return resolve();\n                });\n            });\n        };\n\n        _this.connectToDevice = function (legoDeviceId) {\n            _this.checkAndRegisterScanListener();\n            _this.$logger.log('WRAPPER :: Bluetooth.connectToDevice -- bleManager.allDevices().length ' + bleManagerInstance.allDevices().length());\n            _this.$logger.log('WRAPPER :: Bluetooth.connectToDevice: ', legoDeviceId);\n            bleManagerInstance.stopScanning().then(function () {\n                bleManagerInstance.connectToDevice(legoDeviceId).then(function () {\n                    _this.$logger.log('WRAPPER :: Bluetooth.connectToDevice Connected');\n                    // New scan will be started in the onDidFinishInterrogatingDevice callback, so\n                    // we don't interrupt the connect\n                }).catch(function (error) {\n                    _this.$logger.error('WRAPPER :: Failed connecting: ', error);\n                    bleManagerInstance.scan();\n                });\n            }).catch(function (error) {\n                _this.$logger.error('WRAPPER :: Failed stopScanning: ', error);\n                bleManagerInstance.scan();\n            });\n        };\n\n        _this.disconnectDevice = function (legoDeviceId) {\n            _this.checkAndRegisterScanListener();\n            _this.$logger.log('WRAPPER :: Bluetooth.disconnectDevice ' + legoDeviceId);\n            bleManagerInstance.cancelDeviceConnection(legoDeviceId);\n        };\n\n        _this.allDevices = function () {\n            _this.checkAndRegisterScanListener();\n            __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].debug('WRAPPER :: Bluetooth.allDevices');\n            var allDevices = [];\n            var allManagedDevices = bleManagerInstance.allDevices();\n            __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].debug('WRAPPER :: Bluetooth.allDevices - Got ' + allManagedDevices.length() + ' - Length of' + ' this.devices: ' + _this.devices.length);\n            if (allManagedDevices.length() === 0) {\n                // Something is not in sync - make it sync\n                var devicesCopy = _this.devices.slice();\n                for (var i = 0; i < devicesCopy.length; i++) {\n                    var legoDevice = devicesCopy[i]; // Maybe replace the code below by simply setting ConnectedState: 1\n\n                    __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].debug('WRAPPER :: Bluetooth.allDevices - sending message OnDeviceDisappeared ' + legoDevice.DeviceID + ' - Name: ' + legoDevice.DeviceName);\n                    legoDevice.ConnectedState = 1; // Device has disappeared - so it should be shown like it is not\n                    // advertising\n                    Helper.sendMessage('OnDeviceDisappeared', legoDevice);\n                    var proxyLegoBluetoothDevice = {\n                        deviceId: legoDevice.DeviceID\n                    };\n                    __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].debug('WRAPPER :: Bluetooth.allDevices - calling this.bluetooth.removeDevice ' + legoDevice.DeviceID + ' - Name: ' + legoDevice.DeviceName + ' this.devices length before: ' + _this.devices.length);\n                    _this.bluetooth.removeDevice(proxyLegoBluetoothDevice);\n                    __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].debug('WRAPPER :: Bluetooth.allDevices - calling this.bluetooth.removeDevice ' + legoDevice.DeviceID + ' - Name: ' + legoDevice.DeviceName + ' this.devices length after: ' + _this.devices.length);\n                }\n                devicesCopy = null;\n                __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].debug('WRAPPER :: Bluetooth.allDevices - Truncating this.devices array - length before truncate: ' + _this.devices.length);\n                _this.devices.length = 0;\n                __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].debug('WRAPPER :: Bluetooth.allDevices - sending message OnAllDevicesUpdated - allDevices count: ' + allDevices.length);\n            } else {\n                for (var i = 0; i < allManagedDevices.size(); i++) {\n                    __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].debug('WRAPPER :: Bluetooth.allDevices - appending ' + allManagedDevices.get(i).deviceId + ' - Name: ' + allManagedDevices.get(i).deviceName);\n                    allDevices.push(getSimpleLegoDevice(allManagedDevices.get(i)));\n                }\n            }\n\n            Helper.sendMessage('OnAllDevicesUpdated', allDevices);\n        };\n\n        _this.changeDeviceName = function (legoDeviceId, name) {\n            _this.$logger.log('WRAPPER :: Bluetooth.changeDeviceName for ' + legoDeviceId + ' to new name: ' + name);\n            bleManagerInstance.setDeviceName(legoDeviceId, name);\n        };\n\n        _this.updateServiceData = function (legoDeviceId, connectId) {\n            _this.$logger.log('WRAPPER :: Bluetooth.updateServiceData');\n            var legoService = _this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n            if (!legoService || legoService === null) {\n                _this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n            } else {\n                /*\n                            this.$logger.warn('WRAPPER :: TODO: updateServiceData(' + legoDeviceId + ', ' + connectId + ') [' + legoService.serviceName + ', internal: ' + legoService.isInternalService + '] - not doing anything');\n                            if (1 === 1) {\n                                return;\n                            }\n                            var inputFormat = legoService.inputFormat;\n                            if (!inputFormat || inputFormat === null) {\n                                var defaultInputFormat = legoService.defaultInputFormat;\n                                if (defaultInputFormat && defaultInputFormat !== null) {\n                                    let fullInputFormat = InputFormat.fromSimpleInputFormat(defaultInputFormat);\n                                    if (legoService.connectInfo.type === IOType.IO_TYPE_CURRENT || legoService.connectInfo.type === IOType.IO_TYPE_VOLTAGE) {\n                                        if (defaultInputFormat.notificationsEnabled) {\n                                            //LWC-1529: Make sure we do not receive Voltage and Current notifications in WeDo. We don't need them, and they put a lot of strain on the BLE comm\n                                            fullInputFormat = InputFormat.fromSimpleInputFormat(defaultInputFormat).inputFormatBySettingNotificationsEnabled(false);\n                                        }\n                                    }\n                                    legoService.updateInputFormat(fullInputFormat);\n                                }\n                            }\n                */\n            }\n        };\n\n        _this.updateInputFormat = function (legoDeviceId, connectId, mode, unit, deltaInterval, notificationsEnabled) {\n            _this.$logger.log('WRAPPER :: Bluetooth.updateInputFormat');\n\n            var legoService = _this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n            if (!legoService || legoService === null) {\n                _this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId + ', ' + notificationsEnabled);\n            } else {\n                var inputFormat = __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"InputFormat\"].inputFormat(parseInt(connectId), parseInt(legoService.connectInfo.type), parseInt(mode), parseInt(deltaInterval), parseInt(unit), notificationsEnabled.toLowerCase());\n                _this.$logger.log('WRAPPER :: updateInputFormat(' + legoDeviceId + ', ' + connectId + ', ' + mode + ', ' + unit + ', ' + deltaInterval + ', ' + notificationsEnabled + ') [' + legoService.serviceName + ', internal: ' + legoService.isInternalService + ']');\n                legoService.updateInputFormat(inputFormat);\n            }\n        };\n\n        _this.run = function (legoDeviceId, connectId, motorDirection, power) {\n            _this.$logger.log('WRAPPER :: Bluetooth.run');\n            var legoService = _this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n            if (!legoService || legoService === null) {\n                _this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n            } else {\n                legoService.run(parseInt(motorDirection), parseInt(power));\n            }\n        };\n\n        _this.brake = function (legoDeviceId, connectId) {\n            _this.$logger.log('WRAPPER :: Bluetooth.brake');\n            var legoService = _this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n            if (!legoService || legoService === null) {\n                _this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n            } else {\n                legoService.brake();\n            }\n        };\n\n        _this.drift = function (legoDeviceId, connectId) {\n            _this.$logger.log('WRAPPER :: Bluetooth.drift');\n            var legoService = _this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n            if (!legoService || legoService === null) {\n                _this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n            } else {\n                legoService.drift();\n            }\n        };\n\n        _this.playFrequency = function (legoDeviceId, connectId, frequency, milliseconds) {\n            _this.$logger.log('WRAPPER :: Bluetooth.playFrequency');\n            var legoService = _this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n            if (!legoService || legoService === null) {\n                _this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n            } else {\n                legoService.playFrequency(parseInt(frequency), parseInt(milliseconds));\n            }\n        };\n\n        _this.playNote = function (legoDeviceId, connectId, note, octave, milliseconds) {\n            _this.$logger.log('WRAPPER :: Bluetooth.playNote');\n            var legoService = _this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n            if (!legoService || legoService === null) {\n                _this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n            } else {\n                legoService.playNote(parseInt(note), parseInt(octave), parseInt(milliseconds));\n            }\n        };\n\n        _this.stopPlaying = function (legoDeviceId, connectId) {\n            _this.$logger.log('WRAPPER :: Bluetooth.stopPlaying');\n            var legoService = _this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n            if (!legoService || legoService === null) {\n                _this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n            } else {\n                legoService.stopPlaying();\n            }\n        };\n\n        _this.setRGBLightMode = function (legoDeviceId, connectId, rgbLightMode) {\n            _this.$logger.log('WRAPPER :: Bluetooth.setRGBLightMode ' + rgbLightMode);\n            var legoService = _this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n            if (!legoService || legoService === null) {\n                _this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n            } else {\n                legoService.setRGBMode(parseInt(rgbLightMode));\n            }\n        };\n\n        _this.changeColor = function (legoDeviceId, connectId, jsonColor) {\n            _this.$logger.log('WRAPPER :: Bluetooth.changeColor ' + jsonColor);\n            var legoService = _this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n            if (!legoService || legoService === null) {\n                _this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n            } else {\n                legoService.setColor(jsonColor);\n            }\n        };\n\n        _this.changeColorIndex = function (legoDeviceId, connectId, colorIndex) {\n            _this.$logger.log('WRAPPER :: Bluetooth.changeColorIndex ' + colorIndex);\n            var legoService = _this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n            if (!legoService || legoService === null) {\n                _this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n            } else {\n                legoService.setColorIndex(parseInt(colorIndex));\n            }\n        };\n\n        _this.switchOff = function (legoDeviceId, connectId) {\n            _this.$logger.log('WRAPPER :: Bluetooth.switchOff');\n            var legoService = _this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n            if (!legoService || legoService === null) {\n                _this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n            } else {\n                legoService.switchOff();\n            }\n        };\n\n        _this.changeColorToDefault = function (legoDeviceId, connectId) {\n            _this.$logger.log('WRAPPER :: Bluetooth.changeColorToDefault');\n            var legoService = _this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n            if (!legoService || legoService === null) {\n                _this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n            } else {\n                legoService.switchToDefaultColor();\n            }\n        };\n\n        _this.setTiltSensorMode = function (legoDeviceId, connectId, tiltSensorMode) {\n            _this.$logger.log('WRAPPER :: Bluetooth.setTiltSensorMode ' + tiltSensorMode);\n            var legoService = _this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n            if (!legoService || legoService === null) {\n                _this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n            } else {\n                legoService.setTiltSensorMode(parseInt(tiltSensorMode));\n            }\n        };\n\n        _this.setMotionSensorMode = function (legoDeviceId, connectId, motionSensorMode) {\n            _this.$logger.log('WRAPPER :: Bluetooth.setMotionSensorMode ' + motionSensorMode);\n            var legoService = _this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n            if (!legoService || legoService === null) {\n                _this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n            } else {\n                legoService.setMotionSensorMode(parseInt(motionSensorMode));\n            }\n        };\n\n        _this.findDeviceFromId = function (legoDeviceId) {\n            _this.$logger.log('WRAPPER :: Bluetooth.findDeviceFromId ' + legoDeviceId);\n            var device = bleManagerInstance.getDevice(legoDeviceId);\n            if (device === null || !device) {\n                _this.$logger.error('WRAPPER :: Did not find device: ' + legoDeviceId);\n                _this.$logger.error('WRAPPER :: allDevices count: ' + bleManagerInstance.allDevices().size());\n            }\n            return device;\n        };\n\n        _this.findServiceOnDevice = function (legoDeviceId, connectId) {\n            var device = _this.findDeviceFromId(legoDeviceId);\n            if (device === null || !device) {\n                _this.$logger.error('WRAPPER :: Did not find device: ' + legoDeviceId);\n            } else {\n                var service = bleManagerInstance.getDeviceServiceWithConnectId(legoDeviceId, connectId);\n                if (service === null || !service) {\n                    _this.$logger.error('WRAPPER :: findServiceOnDevice: Did not find service: ' + legoDeviceId + ', ' + connectId);\n                }\n                return service;\n            }\n        };\n\n        _this.setUnityObjectName = function (unityObjectName) {\n            __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callWebGL('bluetoothHandler', 'setUnityObjectName', [unityObjectName]);\n        };\n\n        _this.$logger = $logger;\n        if (!bleManagerInstance || bleManagerInstance === null) {\n            $logger.log('WRAPPER :: Caching LegoDeviceManagerImpl.getInstance()');\n            bleManagerInstance = __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LegoDeviceManagerImpl\"].getInstance();\n            if (window) {\n                window.LDM = bleManagerInstance;\n            }\n            if (__WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"] && __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"] !== null) {\n                __WEBPACK_IMPORTED_MODULE_2__lego_components_blesdk__[\"LDSDKLogger\"].disable();\n            }\n            $logger.log('WRAPPER :: LegoDeviceManagerImpl.getInstance() - SDK Version: ' + bleManagerInstance.getSDKVersion());\n            bleManagerInstance.config.listenForConnectionsAllTheTime = true;\n            bleManagerInstance.config.fireDeviceInfoUpdateOnTheOnDeviceEvents = true;\n            bleManagerInstance.config.startStopScanningInterval = 2000;\n            bleManagerInstance.config.startStopRepeatedScanning = false;\n            bleManagerInstance.config.automaticReconnectOnConnectionLostEnabled = false;\n        }\n\n        _this.helper = Helper.getInstance();\n        _this.devices = [];\n        _this.checkAndRegisterScanListener();\n        return _this;\n    }\n\n    _createClass(Bluetooth, [{\n        key: 'getDevicesCallbackListenerInstance',\n        value: function getDevicesCallbackListenerInstance() {\n            if (!this.devicesCallbackListener || this.devicesCallbackListener === null) {\n                this.devicesCallbackListener = new DevicesCallbackListenerImpl(this);\n            }\n            return this.devicesCallbackListener;\n        }\n    }, {\n        key: 'checkAndRegisterScanListener',\n        value: function checkAndRegisterScanListener() {\n            if (!this.callbackListenerId || this.callbackListenerId === null) {\n                this.callbackListenerId = bleManagerInstance.registerCallbackListener(this.getDevicesCallbackListenerInstance()); // LECQA-82 - Register for\n                // scan callbacks as soon as wedo starts\n                this.$logger.info('WRAPPER :: Registered scan listener and connect listener: ', this.callbackListenerId);\n            }\n        }\n\n        //LegoDeviceManager\n\n\n        //LegoDevice\n\n\n        // LegoService\n\n\n        // LegoMotor\n\n\n        // LegoPiezoTonePlayer\n\n\n        // LegoRGBLight\n\n\n        // LegoTiltSensor\n\n\n        // LegoMotionSensor\n\n\n        // helper\n\n    }]);\n\n    return Bluetooth;\n}(__WEBPACK_IMPORTED_MODULE_0_components_BaseModule__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (Bluetooth);\n\n/***/ }),\n/* 17 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_components_Webview__ = __webpack_require__(24);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_MessageHandler__ = __webpack_require__(1);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_components_Storage__ = __webpack_require__(4);\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n\n\n\n\n\nvar ContentViewerWebview = function (_Webview) {\n  _inherits(ContentViewerWebview, _Webview);\n\n  function ContentViewerWebview(options) {\n    _classCallCheck(this, ContentViewerWebview);\n\n    var _this = _possibleConstructorReturn(this, (ContentViewerWebview.__proto__ || Object.getPrototypeOf(ContentViewerWebview)).call(this, options, false));\n\n    _this.setTransparentBackground = function (enabled) {\n      _this.webview.style.height = enabled === 'True' ? '400px' : '200px';\n    };\n\n    _this.setInsets = function (top, left, bottom, right, width, height) {\n      _this.webview.style.top = top + 'px';\n      _this.webview.style.left = left + 'px';\n      _this.webview.style.bottom = bottom + 'px';\n      _this.webview.style.right = right + 'px';\n      _this.webview.style.width = 'unset';\n      _this.webview.style.height = 'unset';\n    };\n\n    _this.setVisible = function (visible) {\n      _this.webview.style.display = visible === 'True' ? 'inherit' : 'none';\n    };\n\n    _this.invokeUnity = function (data) {\n      __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity('content', _this.unityMethodToInvoke, data);\n    };\n\n    _this.handleExportImage = function (dataURI) {\n      _this.handleExport(dataURI, 'image/jpg', 'jpg');\n    };\n\n    _this.handleExportPdf = function (dataURI) {\n      _this.handleExport(dataURI, 'application/pdf', 'pdf');\n    };\n\n    _this.handleSaveSDT = function (data) {\n      __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity('content', 'OnEvalJavaScriptFinished', data);\n    };\n\n    _this.eventHandlers['contentload'] = _this.event_contentload.bind(_this);\n\n    _this.unityMethodToInvoke = 'OnRecieveMessageFromChromeOS';\n\n    _this.setup(options);\n    setTimeout(function () {\n      _this.webview.setZoomMode('disabled');\n    }, 20000);\n    _this.storage = new __WEBPACK_IMPORTED_MODULE_2_components_Storage__[\"a\" /* default */]();\n\n    _this.webview.addEventListener('permissionrequest', function (e) {\n      if (e.permission === 'fullscreen') {\n        e.request.allow();\n      }\n    });\n    return _this;\n  }\n\n  _createClass(ContentViewerWebview, [{\n    key: 'event_contentload',\n    value: function event_contentload() {\n      // Welcome message\n      this.sendMessage({\n        sender: 'hello'\n      });\n\n      __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity('content', this.unityMethodToInvoke, '');\n    }\n  }, {\n    key: 'handleExport',\n    value: function handleExport(dataURI, mimeType, extension) {\n      var _this2 = this;\n\n      var splitString = dataURI.split(';base64,');\n      var dataBase64 = splitString.length > 1 ? splitString[1] : splitString[0];\n\n      this.storage.saveFile(this.b64toBlob(dataBase64, mimeType), extension, function () {\n        _this2.evaluatingJavaScript('ExportDone()');\n      }, function (err) {\n        _this2.evaluatingJavaScript('ExportDone()');\n      });\n    }\n  }, {\n    key: 'b64toBlob',\n    value: function b64toBlob(b64Data) {\n      var contentType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n      var sliceSize = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 512;\n\n      var byteCharacters = atob(b64Data);\n      var byteArrays = [];\n\n      for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {\n        var slice = byteCharacters.slice(offset, offset + sliceSize);\n\n        var byteNumbers = new Array(slice.length);\n        for (var i = 0; i < slice.length; i++) {\n          byteNumbers[i] = slice.charCodeAt(i);\n        }\n\n        var byteArray = new Uint8Array(byteNumbers);\n\n        byteArrays.push(byteArray);\n      }\n\n      var blob = new Blob(byteArrays, { type: contentType });\n      return blob;\n    }\n  }]);\n\n  return ContentViewerWebview;\n}(__WEBPACK_IMPORTED_MODULE_0_components_Webview__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (ContentViewerWebview);\n\n/***/ }),\n/* 18 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_components_BaseModule__ = __webpack_require__(0);\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n\n\nvar ExternalLink = function (_BaseModule) {\n  _inherits(ExternalLink, _BaseModule);\n\n  function ExternalLink() {\n    _classCallCheck(this, ExternalLink);\n\n    var _this = _possibleConstructorReturn(this, (ExternalLink.__proto__ || Object.getPrototypeOf(ExternalLink)).call(this));\n\n    _this.open = function (url) {\n      window.open(url);\n    };\n\n    return _this;\n  }\n\n  return ExternalLink;\n}(__WEBPACK_IMPORTED_MODULE_0_components_BaseModule__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (ExternalLink);\n\n/***/ }),\n/* 19 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_components_BaseModule__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_MessageHandler__ = __webpack_require__(1);\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n\n\n\nvar Killswitch = function (_BaseModule) {\n  _inherits(Killswitch, _BaseModule);\n\n  function Killswitch() {\n    _classCallCheck(this, Killswitch);\n\n    var _this = _possibleConstructorReturn(this, (Killswitch.__proto__ || Object.getPrototypeOf(Killswitch)).call(this));\n\n    _this.request = function (url) {\n      var request = new XMLHttpRequest();\n      request.onreadystatechange = function () {\n        if (request.readyState == 4) //Response recieved and ready\n          {\n            var dataURL = 'uniwebview://KillswitchResponse';\n            if (request.status == 200) //ok\n              {\n                dataURL += '?ReponseError=undefined';\n                dataURL += '&Data=' + encodeURIComponent(request.responseText);\n                dataURL += '&ResponseHeader=' + encodeURIComponent(request.getAllResponseHeaders());\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n              } else //404 not found\n              {\n                dataURL += '?ReponseError=Error';\n                dataURL += '&Data=Error';\n                dataURL += '&ResponseHeader=None}';\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n              }\n          }\n      };\n      request.error = function () {};\n\n      request.open(\"GET\", url, true);\n      request.send();\n    };\n\n    return _this;\n  }\n\n  return Killswitch;\n}(__WEBPACK_IMPORTED_MODULE_0_components_BaseModule__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (Killswitch);\n\n/***/ }),\n/* 20 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_components_BaseModule__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_MessageHandler__ = __webpack_require__(1);\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n\n\n\nvar PlatformInfo = function (_BaseModule) {\n    _inherits(PlatformInfo, _BaseModule);\n\n    function PlatformInfo() {\n        var logger = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : console;\n\n        _classCallCheck(this, PlatformInfo);\n\n        var _this = _possibleConstructorReturn(this, (PlatformInfo.__proto__ || Object.getPrototypeOf(PlatformInfo)).call(this));\n\n        _this.requestSystemCpuInfo = function () {\n            var dataURL = 'uniwebview://PlatformInfo?systemCpu=';\n            if (chrome && chrome.system && chrome.system.cpu.getInfo && typeof chrome.system.cpu.getInfo === 'function') {\n                chrome.system.cpu.getInfo(function (info) {\n                    __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL + _this.getObjAsBase64Json(info));\n                });\n            }\n        };\n\n        _this.requestPlatformInfo = function () {\n\n            var dataURL = 'uniwebview://PlatformInfo?platformInfo=';\n\n            if (chrome && chrome.runtime && chrome.runtime.getPlatformInfo && typeof chrome.runtime.getPlatformInfo === 'function') {\n                chrome.runtime.getPlatformInfo(function (platformInfo) {\n                    __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL + _this.getObjAsBase64Json({\n                        nativePlatformInfo: platformInfo,\n                        isArmArchitecture: platformInfo.arch.indexOf('arm') != -1,\n                        is64bit: platformInfo.arch.indexOf('x86-64') != -1,\n                        platformOS: platformInfo.os, /* \"mac\", \"win\", \"android\", \"cros\", \"linux\", or \"openbsd\" */\n                        platformOSDetails: navigator.appVersion.match(/\\(.*; ([^\\)]+)\\)/)[1],\n                        chromeVersion: navigator.appVersion.match(/.*Chrome\\/([0-9\\.]+)/)[1]\n                    }));\n                });\n            } else {\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL + _this.getObjAsBase64Json({\n                    nativePlatformInfo: navigator.platform,\n                    isArmArchitecture: _this.isArmArchitecture(),\n                    is64bit: _this.is64BitArchitecture(),\n                    platformOS: navigator.appVersion.match(/\\(.*; ([^\\)]+)\\)/)[1],\n                    platformOSDetails: navigator.appVersion.match(/\\(.*; ([^\\)]+)\\)/)[1],\n                    chromeVersion: navigator.appVersion.match(/.*Chrome\\/([0-9\\.]+)/)[1]\n                }));\n            }\n        };\n\n        _this.requestSystemMemoryInfo = function () {\n            var dataURL = 'uniwebview://PlatformInfo?systemMemory=';\n\n            if (chrome && chrome.system && chrome.system.memory && typeof chrome.system.memory.getInfo === 'function') {\n                chrome.system.memory.getInfo(function (info) {\n                    __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL + _this.getObjAsBase64Json(info));\n                });\n            }\n        };\n\n        _this.requestLanguageInfo = function () {\n            var dataURL = 'uniwebview://PlatformInfo?language=';\n\n            if (chrome && chrome.i18n && typeof chrome.i18n.getAcceptLanguages === 'function') {\n                chrome.i18n.getAcceptLanguages(function (languageList) {\n                    var languages = languageList.join(\",\");\n                    var uiLanguage = typeof chrome.i18n.getUILanguage === 'function' ? chrome.i18n.getUILanguage() : languageList[0];\n                    console.log('Accept Languages: ' + languages + ', UI language: ' + uiLanguage);\n\n                    __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL + _this.getObjAsBase64Json({\n                        acceptLanguage: languageList[0],\n                        acceptLanguages: languages,\n                        uiLanguage: uiLanguage\n                    }));\n                });\n            }\n        };\n\n        return _this;\n    }\n\n    _createClass(PlatformInfo, [{\n        key: 'getObjAsBase64Json',\n        value: function getObjAsBase64Json(obj) {\n            return window.btoa(window.unescape(window.encodeURIComponent(JSON.stringify(obj))));\n        }\n    }, {\n        key: 'getBitSystemArchitecture',\n        value: function getBitSystemArchitecture() {\n            var _to_check = [];\n            if (window.navigator.cpuClass) _to_check.push((window.navigator.cpuClass + \"\").toLowerCase());\n            if (window.navigator.platform) _to_check.push((window.navigator.platform + \"\").toLowerCase());\n            if (navigator.userAgent) _to_check.push((navigator.userAgent + \"\").toLowerCase());\n\n            var _64bits_signatures = [\"x86_64\", \"x86-64\", \"Win64\", \"x64;\", \"amd64\", \"AMD64\", \"WOW64\", \"x64_64\", \"ia64\", \"sparc64\", \"ppc64\", \"IRIX64\"];\n            var _bits = 32,\n                _i,\n                _c;\n            outer_loop: for (var _c = 0; _c < _to_check.length; _c++) {\n                for (_i = 0; _i < _64bits_signatures.length; _i++) {\n                    if (_to_check[_c].indexOf(_64bits_signatures[_i].toLowerCase()) != -1) {\n                        _bits = 64;\n                        break outer_loop;\n                    }\n                }\n            }\n            return _bits;\n        }\n    }, {\n        key: 'is32BitArchitecture',\n        value: function is32BitArchitecture() {\n            return this.getBitSystemArchitecture() == 32 ? 1 : 0;\n        }\n    }, {\n        key: 'is64BitArchitecture',\n        value: function is64BitArchitecture() {\n            return this.getBitSystemArchitecture() == 64 ? 1 : 0;\n        }\n    }, {\n        key: 'isArmArchitecture',\n        value: function isArmArchitecture() {\n            var _to_check = [];\n            if (window.navigator.cpuClass) _to_check.push((window.navigator.cpuClass + \"\").toLowerCase());\n            if (window.navigator.platform) _to_check.push((window.navigator.platform + \"\").toLowerCase());\n            if (navigator.userAgent) _to_check.push((navigator.userAgent + \"\").toLowerCase());\n\n            var _arm_signatures = [\"arm\"];\n            var _arm = false,\n                _i,\n                _c;\n            outer_loop: for (var _c = 0; _c < _to_check.length; _c++) {\n                for (_i = 0; _i < _arm_signatures.length; _i++) {\n                    if (_to_check[_c].indexOf(_arm_signatures[_i].toLowerCase()) != -1) {\n                        _arm = true;\n                        break outer_loop;\n                    }\n                }\n            }\n            return _arm;\n        }\n    }]);\n\n    return PlatformInfo;\n}(__WEBPACK_IMPORTED_MODULE_0_components_BaseModule__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (PlatformInfo);\n\n/***/ }),\n/* 21 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_components_BaseModule__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_MessageHandler__ = __webpack_require__(1);\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n\n\n\nvar VideoController = function (_BaseModule) {\n    _inherits(VideoController, _BaseModule);\n\n    function VideoController($storage) {\n        _classCallCheck(this, VideoController);\n\n        var _this = _possibleConstructorReturn(this, (VideoController.__proto__ || Object.getPrototypeOf(VideoController)).call(this));\n\n        _this.playVideo = function (url, bgColor) {\n            var videoContainer = document.createElement('div');\n            videoContainer.style.backgroundColor = bgColor;\n            videoContainer.style.position = 'fixed';\n            videoContainer.style.top = '0';\n            videoContainer.style.left = '0';\n            videoContainer.style.width = '100%';\n            videoContainer.style.height = '100%';\n\n            var video = document.createElement('video');\n            video.className = 'lobbyvideo';\n            video.src = url;\n            video.preload = 'auto';\n            video.autoplay = true;\n            video.controls = true;\n            video.onended = function () {\n                document.body.removeChild(videoContainer);\n            };\n            video.onclick = function () {\n                document.body.removeChild(videoContainer);\n            };\n            videoContainer.appendChild(video);\n            document.body.appendChild(videoContainer);\n        };\n\n        _this.setupVideoElements = function () {\n            if (!_this.videoContainerElement) {\n                _this.videoContainerElement = document.createElement('div');\n                document.body.appendChild(_this.videoContainerElement);\n\n                _this.videoElement = document.createElement('video');\n                _this.videoElement.autoplay = true;\n                _this.videoContainerElement.appendChild(_this.videoElement);\n                _this.videoElement.style.position = 'relative';\n                _this.videoElement.style.marginLeft = 'auto';\n                _this.videoElement.style.marginRight = 'auto';\n                _this.videoElement.style.top = '50%';\n                _this.videoElement.style.transform = 'translateY(-50%)';\n                _this.videoElement.style.display = 'block';\n                _this.videoElement.style.width = '100%';\n                _this.videoElement.style.height = '100%';\n\n                _this.videoElement.volume = 0;\n\n                _this.videoElement.srcObject = _this.videoStream;\n            }\n\n            if (!_this.snapshotCanvas) {\n                _this.snapshotCanvas = document.createElement('canvas');\n                _this.snapshotCanvas.style.display = 'none';\n                _this.snapshotCanvas.style.width = '100%';\n                _this.snapshotCanvas.style.height = '100%';\n                _this.snapshotCanvasContext = _this.snapshotCanvas.getContext('2d');\n                document.body.appendChild(_this.snapshotCanvas);\n            }\n\n            if (!_this.videoRecordRTC) {\n                _this.videoRecordRTC = new RecordRTC(_this.videoStream, { type: 'video' });\n                _this.videoRecordRTC.mimeType = {\n                    video: 'video/webm',\n                    audio: 'audio/wav'\n                };\n\n                _this.videoRecordRTC.onStateChanged.call = function (state) {\n                    console.log('Video :: Video Recorder state changed to: ' + state['state']);\n                };\n            } else {\n                console.debug('Video :: setupVideoElements - videoRecordRTC already set - resetting it');\n                _this.videoRecordRTC.reset();\n            }\n\n            _this.updateLivePreviewPosition();\n        };\n\n        _this.teardownVideoElements = function () {\n            if (_this.videoContainerElement) {\n                if (_this.videoElement) {\n                    URL.revokeObjectURL(_this.videoElement.src);\n                }\n                document.body.removeChild(_this.videoContainerElement);\n                _this.videoElement = null;\n                _this.videoContainerElement = null;\n            }\n\n            if (_this.snapshotCanvas) {\n                document.body.removeChild(_this.snapshotCanvas);\n                _this.snapshotCanvasContext = null;\n                _this.snapshotCanvas = null;\n            }\n\n            if (_this.videoStream) {\n                _this.videoStream.stop();\n                _this.videoStream = null;\n            }\n\n            if (_this.videoRecordRTC) {\n                _this.videoRecordRTC.reset();\n                _this.videoRecordRTC = null;\n            }\n        };\n\n        _this.updateLivePreviewPosition = function () {\n            if (_this.videoContainerElement) {\n                _this.videoContainerElement.style.position = _this.livePreviewPosition.position;\n                _this.videoContainerElement.style.top = _this.livePreviewPosition.top;\n                _this.videoContainerElement.style.left = _this.livePreviewPosition.left;\n                _this.videoContainerElement.style.width = _this.livePreviewPosition.widthPX;\n                _this.videoContainerElement.style.height = _this.livePreviewPosition.heightPX;\n            }\n\n            if (_this.snapshotCanvas) {\n                _this.snapshotCanvas.width = _this.livePreviewPosition.width;\n                _this.snapshotCanvas.height = _this.livePreviewPosition.height;\n            }\n        };\n\n        _this.startCaptureSession = function () {\n            if (!_this.videoContainerElement) {\n                var width = _this.livePreviewPosition.width;\n                width /= 10.0;\n                width = Math.floor(width) * 10;\n\n                var height = _this.livePreviewPosition.height;\n                height /= 10.0;\n                height = Math.floor(height) * 10;\n\n                console.log('Video :: startCaptureSession - this.livePreviewPosition.width:  ' + _this.livePreviewPosition.width + ' --> ' + width + ', this.livePreviewPosition.height: ' + _this.livePreviewPosition.height + ' --> ' + height);\n                navigator.getUserMedia({\n                    video: {\n                        width: { /*min: width,*/ideal: width /*, max: width */ },\n                        height: { /*min: height, */ideal: height /*, max: height*/ }\n                    },\n                    audio: true\n                }, function (videoStream) {\n                    _this.videoStream = videoStream;\n                    _this.setupVideoElements();\n                }, function (e) {\n                    console.error('Video :: startCaptureSession - failed getting videostream, tearing down video elements', e);\n                    _this.teardownVideoElements();\n                });\n            } else {\n                _this.videoElement.style.display = 'block';\n            }\n        };\n\n        _this.setLivePreviewPosition = function (x, y, width, height) {\n            if (_this.livePreviewPosition) {\n                _this.livePreviewPosition.position = 'fixed';\n                _this.livePreviewPosition.top = y + 'px';\n                _this.livePreviewPosition.left = x + 'px';\n                _this.livePreviewPosition.widthPX = width + 'px';\n                _this.livePreviewPosition.heightPX = height + 'px';\n                _this.livePreviewPosition.width = width;\n                _this.livePreviewPosition.height = height;\n            }\n\n            _this.updateLivePreviewPosition();\n        };\n\n        _this.startRecording = function () {\n            if (!_this.videoRecordRTC) {\n                console.debug('Video :: startRecording - videoRecordRTC is not set, invoking setupVideoElements');\n                _this.setupVideoElements();\n            }\n            if (_this.videoRecordRTC) {\n                _this.videoRecordRTC.startRecording();\n            } else {\n                console.info('Video :: Unable to start recording as no recordRTC instance available');\n            }\n        };\n\n        _this.stopRecording = function (filePath) {\n            _this.previewFilePath = filePath;\n            if (_this.videoRecordRTC) {\n                _this.videoRecordRTC.stopRecording(function () {\n                    _this.handleVideo(_this.videoRecordRTC.toURL(), _this.videoRecordRTC.getBlob());\n                });\n            } else {\n                console.info('Video :: stopRecording - No videoRecordRTC instance - Skipping stopRecording call');\n            }\n        };\n\n        _this.handleVideo = function (videoURL, videoBlob) {\n            var width = _this.videoContainerElement.style.width.replace('px', '');\n            var height = _this.videoContainerElement.style.height.replace('px', '');\n            _this.snapshotCanvasContext.drawImage(_this.videoElement, 0, 0, width, height);\n            var dataString = _this.snapshotCanvas.toDataURL('image/jpeg', 1);\n            var imageBlob = _this.dataURItoBlob(dataString);\n\n            _this.storage.saveFile(videoBlob, _this.previewVideoExt, function () {\n                _this.saveLocalPreviewFile(videoBlob, _this.previewVideoExt, 'StopVideoRecording?VideoFilePath=');\n                _this.saveLocalPreviewFile(imageBlob, _this.previewImageExt, 'CaptureImage?ImageFilePath=');\n            }, function (error) {\n                console.log('Video :: handleVideo - Unable to save file: ' + error);\n                var dataURL = 'uniwebview://StopVideoRecording?VideoRecordingCancelled=true';\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n            });\n        };\n\n        _this.stopCaptureSession = function (currentlyCapturing) {\n            if (currentlyCapturing === 'True') {\n                _this.videoElement.style.display = 'none';\n            } else {\n                if (_this.videoRecordRTC) {\n                    _this.videoRecordRTC.stopRecording(function (videoURL) {\n                        console.debug('Video :: stopCaptureSession - stopRecording completed');\n                    });\n                }\n\n                try {\n                    _this.teardownVideoElements();\n                } catch (err) {\n                    console.error('Video :: stopCaptureSession: Failed teardownVideoElements', err);\n                }\n            }\n        };\n\n        _this.captureImage = function (filePath) {\n            _this.previewFilePath = filePath;\n            var width = _this.videoContainerElement.style.width.replace('px', '');\n            var height = _this.videoContainerElement.style.height.replace('px', '');\n            _this.snapshotCanvasContext.drawImage(_this.videoElement, 0, 0, width, height);\n            var dataString = _this.snapshotCanvas.toDataURL('image/jpeg', 1);\n\n            var imageBlob = _this.dataURItoBlob(dataString);\n            _this.storage.saveFile(imageBlob, _this.previewImageExt, function () {\n                _this.saveLocalPreviewFile(imageBlob, _this.previewImageExt, 'CaptureImage?ImageFilePath=');\n            }, function (error) {\n                console.log('Video :: Unable to save captured image file: ' + error);\n                var dataURL = 'uniwebview://CaptureImage?CaptureImageCancelled=true';\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n            });\n        };\n\n        _this.captureCanvasImage = function (imageData, filePath) {\n            _this.previewFilePath = filePath;\n            var imageBlob = _this.dataURItoBlob(imageData);\n            _this.storage.saveFile(imageBlob, _this.previewImageExt, function () {\n                _this.saveLocalPreviewFile(imageBlob, _this.previewImageExt, 'CaptureImage?ImageFilePath=');\n            }, function (error) {\n                console.log('Video :: Unable to save captured canvas image file: ' + error);\n                var dataURL = 'uniwebview://CaptureImage?CaptureImageCancelled=true';\n                __WEBPACK_IMPORTED_MODULE_1_MessageHandler__[\"a\" /* default */].callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n            });\n        };\n\n        _this.saveLocalPreviewFile = function (fileBlob, extension, dataURL) {\n            var filePath = _this.previewFilePath + '.' + extension;\n            var newDataURL = 'uniwebview://' + dataURL + filePath;\n            console.log('Video :: Saving file to index db filepath: ' + filePath + ' - newDataUrl: ' + newDataURL);\n            _this.storage.saveFileToIndexDB(filePath, fileBlob, newDataURL);\n        };\n\n        _this.dataURItoBlob = function (dataURI) {\n            var data = atob(dataURI.split(',')[1]);\n            var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\n            var array = new Uint8Array(data.length);\n            for (var i = 0; i < data.length; i++) {\n                array[i] = data.charCodeAt(i);\n            }\n            return new Blob([array], { type: mimeString });\n        };\n\n        _this.storage = $storage;\n        _this.videoStream = null;\n        _this.videoElement = null;\n        _this.videoContainerElement = null;\n        _this.snapshotCanvas = null;\n        _this.snapshotCanvasContext = null;\n        _this.videoRecordRTC = null;\n        _this.previewFilePath = null;\n\n        _this.previewImageExt = 'jpg';\n        _this.previewVideoExt = 'webm';\n\n        _this.livePreviewPosition = {};\n\n        window.requestAnimationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame;\n\n        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;\n        return _this;\n    }\n\n    return VideoController;\n}(__WEBPACK_IMPORTED_MODULE_0_components_BaseModule__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (VideoController);\n\n/***/ }),\n/* 22 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_MessageHandler__ = __webpack_require__(1);\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\nvar WindowController = function () {\n    function WindowController() {\n        _classCallCheck(this, WindowController);\n    }\n\n    _createClass(WindowController, [{\n        key: 'initialize',\n        value: function initialize($storage) {\n            var _this = this;\n\n            this.storage = $storage;\n\n            chrome.app.window.current().onBoundsChanged.addListener(this.onBoundsChanged.bind(this));\n\n            document.addEventListener('visibilitychange', function () {\n                // Page Visibility Level 2 - https://www.w3.org/TR/page-visibility/\n                if (document.visibilityState !== 'visible') {\n                    console.debug('pause - Document is hidden - invoking pause. document.visibilityState: ' + document.visibilityState);\n                    if (!_this.storage.isSavingFile()) {\n                        _this.pause();\n                    }\n                } else {\n                    console.debug('pause - Document is visible - invoking unpause. document.visibilityState: ' + document.visibilityState);\n                    if (!_this.storage.isSavingFile()) {\n                        _this.unpause();\n                    }\n                }\n            });\n\n            this.onBoundsChanged();\n        }\n    }, {\n        key: 'onBoundsChanged',\n        value: function onBoundsChanged() {\n            this.webviewElement = document.getElementById('webgl'); //webview element from chromecore\n            this.parentDiv = document.getElementById('parent'); //parent div from chromecore\n\n            // let width = chrome.app.window.current().innerBounds.width;\n            // let height = chrome.app.window.current().innerBounds.height;\n            var width = Math.min(chrome.app.window.current().outerBounds.width, chrome.app.window.current().innerBounds.width);\n            var height = Math.min(chrome.app.window.current().outerBounds.height, chrome.app.window.current().innerBounds.height);\n\n            // this.webviewElement.style.width = `${width}px`;\n            // this.webviewElement.style.height = `${height}px`;\n            //\n            // this.parentDiv.style.width = `${width}px`;\n            // this.parentDiv.style.height = `${height}px`;\n\n            console.log('onBoundsChanged: setting width: ' + width + 'px, height: ' + height + 'px - innerBounds: [ width: ' + chrome.app.window.current().innerBounds.width + ', height: ' + chrome.app.window.current().innerBounds.height + '] - outerBounds: [ width: ' + chrome.app.window.current().outerBounds.width + ', height: ' + chrome.app.window.current().outerBounds.height + '] - document: [ width: ' + document.body.clientWidth + ', height: ' + document.body.clientHeight + '] ');\n            if (this.webviewElement && this.webviewElement.style && this.webviewElement.style.width) {\n                console.log('webviewElement style: [width: ' + this.webviewElement.style.width + ', height: ' + this.webviewElement.style.height + ']');\n            }\n            __WEBPACK_IMPORTED_MODULE_0_MessageHandler__[\"a\" /* default */].callWebGL('window', 'resize', [{ width: width, height: height }]);\n        }\n    }, {\n        key: 'pause',\n        value: function pause() {\n            var dataURL = 'uniwebview://PauseUnpause?Pause=true';\n            __WEBPACK_IMPORTED_MODULE_0_MessageHandler__[\"a\" /* default */].callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n        }\n    }, {\n        key: 'unpause',\n        value: function unpause() {\n            var dataURL = 'uniwebview://PauseUnpause?Pause=false';\n            __WEBPACK_IMPORTED_MODULE_0_MessageHandler__[\"a\" /* default */].callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n        }\n    }]);\n\n    return WindowController;\n}();\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (WindowController);\n\n/***/ }),\n/* 23 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_components_BaseModule__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_components_SyncError__ = __webpack_require__(5);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_gapi_chrome_apps__ = __webpack_require__(25);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_stringview__ = __webpack_require__(26);\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n\n\n\n\n\n/* Google Drive API documentation specifies that the value\n   should be a multiple of 256KB */\nwindow.GD_RESUMABLE_UPLOAD_CHUNK_SIZE = 2 * 256 * 1024;\n\nvar GoogleDrive = function (_BaseModule) {\n    _inherits(GoogleDrive, _BaseModule);\n\n    function GoogleDrive(timestampFunc) {\n        _classCallCheck(this, GoogleDrive);\n\n        var _this2 = _possibleConstructorReturn(this, (GoogleDrive.__proto__ || Object.getPrototypeOf(GoogleDrive)).call(this));\n\n        _this2.initialize = function (SyncFS) {\n            var _this = _this2;\n            _this.SyncFS = SyncFS;\n            return new Promise(function (resolve, reject) {\n                console.log('loadGoogleAPI');\n                __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2_gapi_chrome_apps__[\"a\" /* configureGoogleAPI */])(function () {\n                    console.log('Google API loaded');\n                    _this._authenticate(resolve, reject);\n                });\n            });\n        };\n\n        _this2._checkIfURLReachable = function (url) {\n            return new Promise(function (resolve, reject) {\n                var xhr = new XMLHttpRequest();\n                xhr.open(\"GET\", url);\n                xhr.timeout = 10000;\n                xhr.onload = function () {\n                    console.log(\"_checkIfURLReachable: onload\", xhr);\n                    resolve();\n                };\n                xhr.onerror = function () {\n                    console.log(\"_checkIfURLReachable: onerror\", xhr);\n                    reject();\n                };\n                xhr.ontimeout = function () {\n                    console.log(\"_checkIfURLReachable: ontimeout\", xhr);\n                    reject();\n                };\n                xhr.send();\n            });\n        };\n\n        _this2.reauthenticate = function () {\n            return new Promise(function (resolve, reject) {\n                _this2.revokeCredentials();\n                _this2._authenticate(resolve, reject);\n            });\n        };\n\n        _this2.getFileList = function (query) {\n            return new Promise(function (resolve, reject) {\n                var _this = _this2;\n                var files = [];\n                var fetchNextPage = function fetchNextPage(pageToken) {\n                    _this._fetchFileListPage(query, pageToken, function (response) {\n                        files = files.concat(response.files);\n                        if (\"nextPageToken\" in response) {\n                            fetchNextPage(response.nextPageToken);\n                        } else {\n                            resolve(files);\n                        }\n                    }, function (error) {\n                        reject(error);\n                    });\n                };\n                // fetch the first page\n                fetchNextPage(null);\n            });\n        };\n\n        _this2.downloadFile = function (fileId, name) {\n            var responseType = 'arraybuffer';\n            if (name && typeof name === 'string') {\n                if (name.lastIndexOf('.') !== -1) {\n                    var extension = name.substr(name.lastIndexOf('.')).toLowerCase();\n                    if (extension === '.txt' || extension === '.json' || extension === '.proj') {\n                        responseType = 'text';\n                    }\n                }\n            }\n\n            var args = {\n                path: \"/drive/v3/files/\" + fileId,\n                params: {\n                    alt: \"media\"\n                },\n                responseType: responseType\n            };\n\n            if (window.ENABLE_DEBUG) {\n                console.debug('Starting download of ' + name + '(' + fileId + ') using xhr responseType: ' + responseType);\n            }\n            if (responseType === 'arraybuffer') {\n                return _this2.startRequest(args, function (response, rawResponse) {\n                    if ('ArrayBuffer' === response.constructor.name) {\n                        var responseArr = new Uint8Array(response);\n\n                        try {\n                            var base64 = __WEBPACK_IMPORTED_MODULE_3_stringview__[\"a\" /* StringView */].bytesToBase64(responseArr); // Make b64 string from typed array\n                            if (!_this2._isBase64(base64)) {\n                                return response;\n                            }\n                            console.log('downloadFile :: got base64 ArrayBuffer response payload for file \"' + args.path + '\" - decoding the response');\n                            return _this2._base64Decode(base64);\n                        } catch (e) {\n                            return response;\n                        }\n                    } else {\n                        console.log('downloadFile :: got ' + response.constructor.name + ' response payload for file \"' + args.path + '\"');\n                        if (_this2._isBase64(response)) {\n                            console.log('downloadFile :: got base64 encoded ' + response.constructor.name + ' response payload for file \"' + args.path + '\" - decoding the response');\n                            var decodedResponse = _this2._base64Decode(response);\n                            return decodedResponse;\n                        }\n                    }\n                    return response;\n                });\n            } else {\n                return _this2.startRequest(args, _this2._base64Decode);\n            }\n        };\n\n        _this2.uploadFile = function (fileId, name, data, timestamp) {\n            var method = fileId ? \"PATCH\" : \"POST\";\n            var path = \"/upload/drive/v3/files\" + (fileId ? \"/\" + fileId : \"\");\n\n            var metadata = {\n                \"name\": name,\n                \"modifiedTime\": timestamp\n            };\n\n            if (!fileId) {\n                metadata.parents = [\"appDataFolder\"];\n                metadata.createdTime = timestamp;\n            }\n\n            var boundary = \"#g4RJCrhHMbzaPtxpNSAw#\";\n            var dataStr = _this2._base64Encode(new Uint8Array(data));\n            var body = \"\";\n            body += \"--\" + boundary + \"\\n\";\n            body += \"Content-Type: application/json; charset=UTF-8\\n\\n\";\n            body += JSON.stringify(metadata) + \"\\n\\n\";\n            body += \"--\" + boundary + \"\\n\";\n            body += \"Content-Type: application/octet-stream\\n\\n\";\n            body += dataStr + \"\\n\";\n            body += \"--\" + boundary + \"--\";\n\n            return _this2.startRequest({\n                path: path,\n                params: {\n                    uploadType: \"multipart\",\n                    fields: \"id,name,modifiedTime\"\n                },\n                method: method,\n                bodyType: \"multipart/related; boundary=\" + boundary,\n                body: body\n            });\n        };\n\n        _this2.uploadFileResumable = function (fileId, name, data, timestamp) {\n            var initMethod = fileId ? 'PATCH' : 'POST';\n            var path = \"/upload/drive/v3/files\" + (fileId ? \"/\" + fileId : \"\");\n            console.log(initMethod + ' ' + data.byteLength + ' bytes to ' + path);\n\n            var metadata = {\n                \"name\": name,\n                \"modifiedTime\": timestamp,\n                \"type\": 'arraybuffer'\n            };\n\n            if (!fileId) {\n                metadata.parents = [\"appDataFolder\"];\n                metadata.createdTime = timestamp;\n            }\n\n            var body = JSON.stringify(metadata);\n\n            var initResumableParams = {\n                'path': path,\n                'method': initMethod,\n                'params': {\n                    'uploadType': 'resumable',\n                    'fields': 'id,name,modifiedTime'\n                },\n                'headers': {\n                    'Content-Type': 'application/json; charset=UTF-8',\n                    'X-Upload-Content-Type': 'application/octet-stream',\n                    'X-Body-Content-Length': body.length,\n                    'X-Upload-Content-Length': data.byteLength\n                },\n                'bodyType': 'application/json; charset=UTF-8',\n                'body': body\n            };\n\n            var processInitResumableResponseHandler = function processInitResumableResponseHandler(response, rawResponse) {\n                var responseHeaders = rawResponse && rawResponse.gapiRequest && rawResponse.gapiRequest.data ? rawResponse.gapiRequest.data.responseHeaders : null;\n                if (responseHeaders !== null) {\n                    if (responseHeaders.hasOwnProperty('location')) {\n                        return responseHeaders['location'];\n                    } else if (responseHeaders.hasOwnProperty('Location')) {\n                        return responseHeaders['Location'];\n                    }\n                }\n                console.error('uploadFileResumable :: Failed Initializing resumable upload and getting session url. InitResumableParams: ', initResumableParams, ' RawResponse', rawResponse);\n                throw 'Failed initializing uploadResumable for file ' + name + ' (fileId: ' + fileId + ')';\n            };\n\n            return _this2.startRequest(initResumableParams, processInitResumableResponseHandler).then(function (resumableSessionUri) {\n\n                var chunkSize = window.GD_RESUMABLE_UPLOAD_CHUNK_SIZE;\n\n                /**\n                 * Calculates the number of chunks still needed before completing the upload.\n                 * We cannot rely on the values we use in the Content-Range header of the request, instead we use the Range header in the response to get the number of bytes that was actually received by the server.\n                 *\n                 * @param range\n                 * @return {Number} The number of chunk requests needed (at least) before the upload can be considered to be complete.\n                 * @private\n                 */\n                var _getRemainingChunkCount = function _getRemainingChunkCount(range) {\n                    var chunkCount = parseInt(((data.byteLength - range) / chunkSize).toFixed(0));\n                    if ((data.byteLength - range) / chunkCount > chunkSize) {\n                        chunkCount += 1;\n                    }\n                    return chunkCount;\n                };\n\n                /**\n                 * This function can prepare parameters for the multiple-chunk resumable uploads to google drive\n                 * @param startByte - The offset from where to start the range selection of the file bytes\n                 * @return {*} Returns an object that can be used as 1st argument for startRequest\n                 * @private\n                 */\n                var _prepareParams = function _prepareParams(startByte) {\n                    var endByte = Math.min(startByte + chunkSize - 1, data.byteLength - 1);\n                    var remainingChunkCount = _getRemainingChunkCount(startByte);\n                    // console.log(`uploadFileResumable :: prepareParams: ${startByte}-${endByte}/${data.byteLength} (chunkSize: ${chunkSize}, remainingChunkCount: ${remainingChunkCount}) - (${fileId}-${name})`);\n                    if (startByte >= data.byteLength - 1 || startByte >= endByte) {\n                        // Signal error by returning null\n                        return null;\n                    }\n\n                    var requestParams = {\n                        'path': resumableSessionUri.substr('https://www.googleapis.com'.length),\n                        'method': 'PUT', /* PATCH? */\n                        'headers': {\n                            'Content-Range': 'bytes ' + startByte + '-' + endByte + '/' + data.byteLength,\n                            'X-Chunk': remainingChunkCount + ' chunks remaining of size ' + chunkSize + ' bytes'\n                        },\n                        'bodyType': initResumableParams['headers']['X-Upload-Content-Type'],\n                        'body': new Uint8Array(data).subarray(startByte, endByte + 1)\n                    };\n                    return requestParams;\n                };\n\n                /**\n                 * This is a custom okPreprocess handler that can be used as 2nd argument to startRequest for the chunk upload requests.\n                 *\n                 * The value returned by this handler can be used as the next 'start offset' for the subsequent Content-Range header, or to consider the upload complete, or to consider it failed.\n                 *\n                 * @param response\n                 * @param rawResponse\n                 * @return {number|string|null} If status of the rawResponse is 308 and the Range header is present, the \"endbyte\" + 1 is returned (range: bytes 512-2048 ==> 2049 would be returned).\n                 * If the status is 200 or 201 - the string 'resumable_upload_complete' is returned, and if the status is neither 200/201 and no Range header is present - null is returned.\n                 * @private\n                 */\n                var _chunkResponseHandler = function _chunkResponseHandler(response, rawResponse) {\n                    if (typeof rawResponse === 'string') {\n                        rawResponse = JSON.parse(rawResponse);\n                    }\n                    var responseHeaders = rawResponse && rawResponse.gapiRequest && rawResponse.gapiRequest.data ? rawResponse.gapiRequest.data.responseHeaders : null;\n                    if (responseHeaders) {\n                        var rangeHeaderValue;\n                        if (responseHeaders.hasOwnProperty('range')) {\n                            rangeHeaderValue = responseHeaders['range'];\n                        } else if (responseHeaders.hasOwnProperty('Range')) {\n                            rangeHeaderValue = responseHeaders['Range'];\n                        }\n                        if (rangeHeaderValue) {\n                            //Expected Range header value: 'bytes=0-524287'\n                            if (rangeHeaderValue.startsWith('bytes=')) {\n                                var byteParts = rangeHeaderValue.substr('bytes='.length).split('-');\n                                if (byteParts.length === 2) {\n                                    var startByte = byteParts[0];\n                                    var endByte = byteParts[1];\n                                    return parseInt(endByte) + 1;\n                                } else {\n                                    console.warn('Unsupported \"Range\" header value: ' + rangeHeaderValue);\n                                }\n                            }\n                        } else if (responseHeaders.status === 200 || responseHeaders.status === 201) {\n                            // Upload complete\n                            return 'resumable_upload_complete';\n                        } else if (responseHeaders.status === 404) {\n                            console.log('uploadFileResumable :: _chunkResponseHandler :: Got a \"not found\" response');\n                        } else if (responseHeaders.status === 403) {\n                            console.log('uploadFileResumable :: _chunkResponseHandler :: Got a \"403\" response', rawResponse);\n                            return null; //'resumable_upload_timeout'\n                        } else if (responseHeaders.status === 500) {\n                            console.log('uploadFileResumable :: _chunkResponseHandler :: Got a \"' + responseHeaders.status + '\" response', rawResponse);\n                            return null; //'resumable_upload_timeout';\n                        } else {\n                            console.log('uploadFileResumable :: _chunkResponseHandler :: No \"Range\" header. Response status: ' + responseHeaders.status, responseHeaders);\n                        }\n                    }\n                    console.warn('uploadFileResumable :: _chunkResponseHandler - Not a valid rawResponse', rawResponse);\n                    return null;\n                };\n\n                var _this = _this2;\n                var _promiseHandler = function _promiseHandler(range) {\n                    if (range === null) {\n                        return Promise.reject('Range was null');\n                    }\n                    if (range === 'resumable_upload_complete') {\n                        return Promise.resolve(range);\n                    }\n\n                    var remainingChunkCount = _getRemainingChunkCount(range);\n                    if (remainingChunkCount >= 0) {\n                        var nextRequestParams = _prepareParams(range);\n                        if (nextRequestParams && nextRequestParams !== null) {\n                            console.debug('uploadFileResumable :: Continuing resumable upload - [remainingChunks: ' + remainingChunkCount + ' - Content-Range: ' + nextRequestParams['headers']['Content-Range'] + ', chunkSize: ' + chunkSize + ']');\n                            return _this.startRequest(nextRequestParams, _chunkResponseHandler) //TODO: Add errorResponseHandler (and implement retry logic)\n                            .then(_promiseHandler);\n                        }\n                    } else {\n                        // console.log('uploadFileResumable :: resolving _promiseHandler - remainingChunkCount: ' + remainingChunkCount);\n                        return Promise.resolve('resumable_upload_complete');\n                    }\n                };\n\n                var firstRangeParams = _prepareParams(0);\n                return _this2.startRequest(firstRangeParams, _chunkResponseHandler).then(_promiseHandler).then(function (result) {\n                    console.log('uploadFileResumable :: Resumable upload of ' + name + ' (id: ' + fileId + ') done!', result);\n                    return Promise.resolve();\n                });\n            });\n        };\n\n        _this2.moveFile = function (fileId, newPath, timestamp) {\n            return _this2.startRequest({\n                'path': '/drive/v3/files/' + fileId,\n                'params': {\n                    fields: \"id,name,modifiedTime\"\n                },\n                'method': \"PATCH\",\n                body: {\n                    name: newPath,\n                    modifiedTime: timestamp\n                }\n            });\n        };\n\n        _this2.copyFile = function (fileId, newPath, timestamp) {\n            return _this2.startRequest({\n                path: \"/drive/v3/files/\" + fileId + \"/copy\",\n                params: {\n                    fields: \"id,name,modifiedTime\"\n                },\n                method: \"POST\",\n                body: {\n                    name: newPath,\n                    parents: [\"appDataFolder\"],\n                    modifiedTime: timestamp\n                }\n            });\n        };\n\n        _this2.deleteFile = function (fileId, ignoreFileNotFound) {\n            return _this2.startRequest({\n                path: \"/drive/v3/files/\" + fileId,\n                method: \"DELETE\",\n                callback: function callback(metadata, rawResponse) {\n                    return metadata;\n                },\n                errorCallback: function errorCallback(metadata, rawResponse) {\n                    return rawResponse;\n                }\n            }, undefined, function (error) {\n                // Don't treat 404: File Not Found as errors when deleting files -\n                // sometimes we cannot really tell whether a file would exist on Google Drive\n                // and it doesn't make sense to execute an additional request to check that.\n                return ignoreFileNotFound && error.code === 404;\n            });\n        };\n\n        _this2.getChangeStartPageToken = function () {\n            return _this2.startRequest({\n                path: \"/drive/v3/changes/startPageToken\",\n                callback: function callback(response, rawResponse) {\n                    return response.startPageToken;\n                },\n                errorCallback: function errorCallback(response, rawResponse) {\n                    return rawResponse;\n                }\n            });\n        };\n\n        _this2.getChangeList = function (startPageToken) {\n            return new Promise(function (resolve, reject) {\n                var _this = _this2;\n                var changes = [];\n                var fetchNextPage = function fetchNextPage(pageToken) {\n                    _this._fetchChangesPage(pageToken, function (response) {\n                        changes = changes.concat(response.changes);\n                        if (\"nextPageToken\" in response) {\n                            fetchNextPage(response.nextPageToken);\n                        } else {\n                            resolve({\n                                changes: changes,\n                                newStartPageToken: response.newStartPageToken\n                            });\n                        }\n                    }, function (error) {\n                        reject(error);\n                    });\n                };\n                // fetch the first page\n                fetchNextPage(startPageToken);\n            });\n        };\n\n        _this2._fetchFileListPage = function (query, pageToken, okCallback, errorCallback) {\n            console.log(\"fetching page with token \" + pageToken);\n            var params = {\n                \"q\": query,\n                \"pageSize\": 1000,\n                \"spaces\": \"appDataFolder\",\n                \"fields\": \"nextPageToken,files(id,name,modifiedTime)\"\n            };\n            if (pageToken) {\n                params.pageToken = pageToken;\n            }\n\n            _this2.startRequest({\n                path: \"/drive/v3/files\",\n                params: params\n            }).then(okCallback).catch(errorCallback);\n        };\n\n        _this2._fetchChangesPage = function (pageToken, okCallback, errorCallback) {\n            var params = {\n                \"pageToken\": pageToken,\n                \"includeRemoved\": true,\n                \"pageSize\": 1000,\n                \"restrictToMyDrive\": false,\n                \"spaces\": \"appDataFolder\"\n            };\n\n            _this2.startRequest({\n                path: \"/drive/v3/changes\",\n                params: params\n            }).then(okCallback).catch(errorCallback);\n        };\n\n        _this2._base64Encode = function (bytes) {\n            if (!_this2._hasByteLengthProperty(bytes)) {\n                if (_this2._isBase64(bytes)) {\n                    //Input is already base64 encoded\n                    return bytes;\n                }\n                console.warn('Cannot encode input - it does not have a byteLength property which is required');\n                return bytes;\n            }\n            var binary = '';\n            var len = bytes.byteLength;\n            for (var i = 0; i < len; i++) {\n                binary += String.fromCharCode(bytes[i]);\n            }\n            return window.btoa(binary);\n        };\n\n        _this2._base64Decode = function (encodedDataStr) {\n            if (!_this2._isBase64(encodedDataStr) && _this2._hasByteLengthProperty(encodedDataStr)) {\n                // input is not base64, and has a byteLength property - skip decoding\n                return encodedDataStr;\n            }\n            var binary = window.atob(encodedDataStr);\n            if (_this2._isBase64(binary)) {\n                /// Workaround for bad sync behavior - Some files have been uploaded as b64 that was encoded more than once... in those cases we will have to decode more than once to get the original binary :-/\n                return _this2._base64Decode(binary);\n            }\n            var buffer = new ArrayBuffer(binary.length);\n            var view = new Uint8Array(buffer);\n            for (var i = 0; i < binary.length; i++) {\n                view[i] = binary.charCodeAt(i);\n            }\n            return buffer;\n        };\n\n        _this2._hasByteLengthProperty = function (input) {\n            if (input && input !== null) {\n                return typeof input.byteLength === 'number';\n            }\n            return false;\n        };\n\n        _this2._isBase64 = function (input) {\n            if (!input || typeof input !== 'string') {\n                return false;\n            }\n\n            var base64CharRegex = /^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;\n            /*\n                ^                          # Start of input\n                ([0-9a-zA-Z+/]{4})*        # Groups of 4 valid characters decode\n                                           # to 24 bits of data for each group\n                (                          # Either ending with:\n                    ([0-9a-zA-Z+/]{2}==)   # two valid characters followed by ==\n                    |                      # , or\n                    ([0-9a-zA-Z+/]{3}=)    # three valid characters followed by =\n                )?                         # , or nothing\n                $                          # End of input\n             */\n            return base64CharRegex.test(input);\n        };\n\n        _this2.hasUserDeclinedAuth = false;\n        _this2.access_token = undefined;\n        _this2.pendingRequests = {};\n        _this2.reqIdx = 0;\n        _this2.maxAttempts = 5;\n        var maxRequestsPerSecond = 10;\n        // slightly increase the interval to decrease the chance of actually making too many requests per second\n        _this2.requestInterval = Math.ceil(1.1 * (1000 / maxRequestsPerSecond));\n        _this2.requestQueue = [];\n        _this2._syncfsTimestamp = timestampFunc;\n        return _this2;\n    }\n\n    _createClass(GoogleDrive, [{\n        key: '_authenticate',\n        value: function _authenticate(resolve, reject) {\n            var _this = this;\n            var success = function success(token) {\n                _this.access_token = token;\n                _this.hasUserDeclinedAuth = false;\n                resolve();\n                _this.startPerformingRequests();\n            };\n            var failure = function failure(error) {\n                _this.access_token = undefined;\n                // NOTE: Ask google about this. There's no guarantee this message is not localized.\n                // Ok, we asked google, they said it's not localized, but the guy who answered was not 100% sure.\n                _this.hasUserDeclinedAuth = error.message === \"The user did not approve access.\";\n                reject(new __WEBPACK_IMPORTED_MODULE_1_components_SyncError__[\"a\" /* default */](error.message, error.code, error.reason));\n                _this.startPerformingRequests();\n            };\n            // try to use the cached auth. token first\n            gapi.auth.authorize({ immediate: true }, function (result) {\n                console.log('Received authorization result (immediate = true)', result);\n                if (!result.error) {\n                    success(result.access_token);\n                } else {\n                    // show the GD authorization popup to the user\n                    _this._checkIfURLReachable(\"https://www.googleapis.com/drive/v3/about\").then(function () {\n                        gapi.auth.authorize({ immediate: false }, function (result) {\n                            console.log('Received authorization result (immediate = false)', result);\n                            if (!result.error) {\n                                success(result.access_token);\n                            } else {\n                                failure(result.error);\n                            }\n                        });\n                    }).catch(function (e) {\n                        console.log(\"Google Drive not reachable.\", e);\n                        failure(\"Google Drive not reachable\");\n                    });\n                }\n            });\n        }\n    }, {\n        key: 'revokeCredentials',\n        value: function revokeCredentials() {\n            // do not stop performing requests - we need to make the next request and try reauthenticating if it ends with 401\n            //this.stopPerformingRequests();\n            if (this.access_token) {\n                chrome.identity.removeCachedAuthToken({ token: this.access_token });\n                this.access_token = undefined;\n            }\n        }\n    }, {\n        key: 'attemptGoogleReconnect',\n        value: function attemptGoogleReconnect() {\n            if (this.isAttemptingReconnect) return;\n            var _this = this;\n            _this.isAttemptingReconnect = true;\n            var reconnectAttempt = 0;\n\n            // Set up some bogus but legit parameters that google can actually respond to.\n            var rArgs = {\n                path: \"/drive/v3/files\",\n                params: {\n                    \"q\": \"\",\n                    \"pageSize\": 2,\n                    \"spaces\": \"appDataFolder\"\n                }\n            };\n\n            var doRequest = function doRequest() {\n                gapi.client.request(rArgs);\n            };\n\n            var retryRequest = function retryRequest() {\n                var to = 1000 * reconnectAttempt * reconnectAttempt;\n                console.log('retryRequest executing - to: ' + to + ', reconnectAttempt: ' + reconnectAttempt + ', rArgs: ' + JSON.stringify(rArgs));\n                if (to > 10 * 60 * 1000) {\n                    to = 10 * 60 * 1000;\n                } // max 10 minutes interval;\n                reconnectAttempt++;\n                window.setTimeout(doRequest, to);\n            };\n\n            var reconnectSuccessful = function reconnectSuccessful() {\n                _this.SyncFS.solveStatusReason(\"gdrive_offline\");\n                _this.isAttemptingReconnect = false;\n            };\n\n            rArgs.callback = function (response, rawResponse) {\n                if (typeof rawResponse === 'string') {\n                    rawResponse = JSON.parse(rawResponse);\n                }\n                var rawResponseSuccess = rawResponse && rawResponse.gapiRequest && rawResponse.gapiRequest.data && rawResponse.gapiRequest.data.status && rawResponse.gapiRequest.data.status === 200 || false;\n                var hasStatus = rawResponse && rawResponse.gapiRequest && rawResponse.gapiRequest.data && rawResponse.gapiRequest.data.responseHeaders && rawResponse.gapiRequest.data.responseHeaders.status || false;\n                var status = hasStatus ? rawResponse.gapiRequest.data.responseHeaders.status : -1;\n\n                if (rawResponseSuccess || status === 200 || status === 401 || response === null || response.error === null || response.error && response.error.code === 401) {\n                    // Don't worry about not being authenticated, that gets handled somewhere else. Here we just try to regain a connection to google.\n                    // console.log('Google Drive :: Callback for doRequest ==> reconnectSuccessful');\n                    reconnectSuccessful();\n                } else {\n                    // console.log('Google Drive :: Callback for doRequest ==> retryRequest -[rawResponseSuccess: ' + rawResponseSuccess +']', rawResponse);\n                    retryRequest();\n                }\n            };\n            rArgs.errorCallback = retryRequest;\n\n            doRequest();\n        }\n    }, {\n        key: 'handleGoogleError',\n        value: function handleGoogleError(requestIdx, syncError) {\n            var _this = this;\n            var req = _this.pendingRequests[requestIdx];\n\n            var retryRequest = function retryRequest() {\n                _this.enqueueRequest(req.args);\n            };\n\n            // There's a likely bug in our code somewhere where we create the calls to google apis if we got here.\n            var failWithThrow = function failWithThrow(throwMessage) {\n                req.reject(syncError);\n                throw new Error(throwMessage);\n            };\n\n            // The request failed for external reasons and we could not sync. Start pinging google so we know when it's back online.\n            var failSimple = function failSimple(newError) {\n                req.reject(newError ? newError : syncError);\n                delete _this.pendingRequests[requestIdx];\n\n                if (newError === null || newError.message !== \"The user did not approve access.\") {\n                    _this.attemptGoogleReconnect();\n                }\n            };\n\n            var immediateReattempt = function immediateReattempt() {\n                retryRequest();\n            };\n\n            var tryReatempt = function tryReatempt() {\n                if (req.attempt < _this.maxAttempts) {\n                    req.attempt++;\n                    // Reattempt the request after 0.5, 2, 4.5, 8 and 12.5 seconds.\n                    window.setTimeout(retryRequest, 500 * req.attempt * req.attempt);\n                } else {\n                    failSimple(new __WEBPACK_IMPORTED_MODULE_1_components_SyncError__[\"a\" /* default */](\"timeout\", syncError.code));\n                }\n            };\n\n            switch (syncError.code) {\n                // 400: Bad Request\n                //      --- Should never happen for us, this means there's a bug in our code, fix it!\n                case 400:\n                    {\n                        failWithThrow('Bad request! ' + req.args.path);\n                    }break;\n\n                // 401: Invalid Credentials\n                //      --- Try re-authentication. If it fails then users should not be able to use the app?\n                case 401:\n                    {\n                        if (_this.hasUserDeclinedAuth) {\n                            failSimple();\n                        } else {\n                            _this.reauthenticate().then(function () {\n                                immediateReattempt();\n                            }).catch(function (syncError) {\n                                failSimple(syncError);\n                            });\n                        }\n                    }break;\n\n                // 403: Daily Limit Exceeded\n                //      --- Solution involves politics, buy additional quota.\n                // 403: User Rate Limit Exceeded\n                // 403: Rate Limit Exceeded (these 2 are caused by doing too many requests in a short amount of time)\n                //      --- Raise per-user quota\n                //      --- Batch requests\n                //      --- Exponential backoff\n                // 403: The user has not granted the app {appId} {verb} access to the file {fileId}\n                // 403: The user does not have sufficient permissions for file {fileId}\n                // 403: App with id {appId} cannot be used within the authenticated user's domain\n                //      --- Should never happen for us. It means we're trying to access a file outside\n                //          of appData, that is a bug.\n                case 403:\n                    {\n                        var reason = syncError.reason;\n                        if (reason === \"dailyLimitExceeded\") {\n                            // Buy more quota!\n                        } else if (reason === \"userRateLimitExceeded\") {\n                            tryReatempt();\n                        } else if (reason === \"rateLimitExceeded\") {\n                            tryReatempt();\n                        } else if (reason === \"appNotAuthorizedToFile\") {\n                            failWithThrow('No access to file! ' + req.args.path);\n                        } else if (reason === \"insufficientFilePermissions\") {\n                            failWithThrow('Insufficient file permissions! ' + req.args.path);\n                        } else if (reason === \"domainPolicy\") {\n                            failWithThrow('App cannot be used from this domain! ' + req.args.path);\n                        }\n                    }break;\n\n                // 404: File not found: {fileId}\n                //      --- Should never happen in production, this means there's a bug in our code.\n                case 404:\n                    {\n                        failWithThrow('Bad request! ' + req.args.path);\n                    }break;\n\n                // 500: Backend Error\n                //      --- Exponential backoff\n                case 500:\n                    {\n                        console.debug('handleError - reqIdx: ' + requestIdx + '(' + req.args.path + ') - [code: ' + syncError.code + ', message: ' + syncError.message + ', reason: ' + syncError.reason + ']. Retrying #attempt: ' + req.attempt);\n                        tryReatempt();\n                    }break;\n            }\n        }\n\n        // Figure out when to use response and when and how to use rawResponse.\n\n    }, {\n        key: 'handleGoogleResponse',\n        value: function handleGoogleResponse(requestIdx, response, rawResponse) {\n            var req = this.pendingRequests[requestIdx];\n            req.resolve(req.okPreprocess(response, rawResponse));\n            delete this.pendingRequests[requestIdx];\n            this.SyncFS.solveStatusReason(\"gdrive_offline\");\n        }\n    }, {\n        key: 'startRequest',\n        value: function startRequest(requestArgs, okPreprocess, errorHandler) {\n            var _this3 = this;\n\n            var _this = this;\n            var idx = _this.reqIdx++;\n            okPreprocess = okPreprocess ? okPreprocess : function (response, rawResponse) {\n                return response;\n            }; // by default return response unmodified\n            errorHandler = errorHandler ? errorHandler : function (error) {\n                return false;\n            }; // don't handle any errors by default\n            var rArgs = requestArgs;\n\n            return new Promise(function (resolve, reject) {\n                rArgs.callback = function (response, rawResponse) {\n                    if (typeof rawResponse === 'string') {\n                        rawResponse = JSON.parse(rawResponse);\n                    }\n                    var rawResponseSuccess = rawResponse !== undefined && rawResponse.hasOwnProperty('gapiRequest') && rawResponse.gapiRequest.hasOwnProperty('data') && rawResponse.gapiRequest.data.hasOwnProperty('status') && rawResponse.gapiRequest.data.status === 200 || false;\n                    var responseHasFiles = response && response.hasOwnProperty('files') && Array.isArray(response.files) || false;\n                    var responseHasChanges = response && response.hasOwnProperty('changes') && Array.isArray(response.changes) || false;\n                    if (rawResponseSuccess || responseHasFiles || responseHasChanges || !response || response === null || !response.error || response.error === null || errorHandler(response.error)) {\n                        _this.handleGoogleResponse(idx, response, rawResponse);\n                    } else {\n                        if (response && response.error) {\n                            var e = response.error;\n                            _this.handleGoogleError(idx, new __WEBPACK_IMPORTED_MODULE_1_components_SyncError__[\"a\" /* default */](e.message, e.code, e.errors[0].reason)); // TODO(Catalin): Is this reliable? Documentation doesn't explain why an error contains a list of errors, but a single message and a single error code...\n                        } else {\n                            console.warn('Non successful response ' + idx + ' has no error property: ', response, 'rawResponse: ', rawResponse);\n                        }\n                    }\n                };\n\n                rArgs.errorCallback = function (errorMessage) {\n                    if (errorMessage !== \"timeout\") {\n                        console.error(\"Failed to execute google request:\", chrome.runtime.lastError);\n                        reject(new __WEBPACK_IMPORTED_MODULE_1_components_SyncError__[\"a\" /* default */](chrome.runtime.lastError));\n                    } else {\n                        // If we get a 5 sec timeout, assume google is down, and start pinging.\n                        reject(new __WEBPACK_IMPORTED_MODULE_1_components_SyncError__[\"a\" /* default */](\"timeout\", 500));\n                    }\n                    _this.attemptGoogleReconnect();\n                };\n\n                _this.pendingRequests[idx] = {\n                    args: rArgs,\n                    attempt: 0,\n                    okPreprocess: okPreprocess,\n                    resolve: resolve,\n                    reject: reject\n                };\n\n                _this3.enqueueRequest(rArgs);\n            });\n        }\n    }, {\n        key: 'enqueueRequest',\n        value: function enqueueRequest(args) {\n            this.requestQueue.push(args);\n        }\n    }, {\n        key: 'startPerformingRequests',\n        value: function startPerformingRequests() {\n            var _this = this;\n            if (_this.intervalID !== undefined) return;\n            _this.intervalID = window.setInterval(function () {\n                _this.performNextRequest();\n            }, _this.requestInterval);\n        }\n    }, {\n        key: 'stopPerformingRequests',\n        value: function stopPerformingRequests() {\n            if (this.intervalID === undefined) return;\n            window.clearInterval(this.intervalID);\n            this.intervalID = undefined;\n        }\n    }, {\n        key: 'performNextRequest',\n        value: function performNextRequest() {\n            var _this = this;\n            if (this.requestQueue.length > 0) {\n                var requestArgs = this.requestQueue.shift();\n                gapi.client.request(requestArgs);\n            }\n        }\n\n        // Query format: https://developers.google.com/drive/v3/web/search-parameters, use empty string for all files/directories\n\n\n        /**\n         * Implementation that can upload a file using resumable method\n         * https://developers.google.com/drive/v3/web/resumable-upload\n         *\n         * The steps are:\n         *  1) Initiate the resumable upload session\n         *  2) Receive the response and extract the Location header that contains the resumable session uri\n         *  3) Upload the file to the resumable session uri. This can either be done as 'single request' or as 'multiple chunks'\n         *  3a) Single request:\n         *      - Create a PUT request to the resumable session uri\n         *      - Add the file data to the request body\n         *      - Add a Content-Length header, with the number of bytes in the file (body)\n         *      - Send the request\n         *  3b) Multiple Chunks:\n         *      1) Create a PUT request to the resumable session uri\n         *      2) Add chunk data to request body. Create chunks in multiples of 256KB (256*1024 bytes) in size, except for the final chunk that completes the upload.\n         *          (Keep the chunk size as large as possible so that the upload is efficient)\n         *      3) Add two headers:\n         *          - Content-Length: Set to the number of bytes in the current chunk\n         *          - Content-Range: Set to show which bytes in the file you are uploading.\n         *            For example, Content-Range: bytes 0-524287/2000000 shows that you are uploading the first 524,288 bytes (256 x 1024 x 2) in a 2,000,000 byte file.\n         *      4) Send the request, and process the response\n         *      5) Repeat steps 1-4 for each remaining chunk in the file.\n         *         Use the 'Range' header in the response to determine where to start the next chunk.\n         *         Do NOT assume that the server received all bytes sent in the previous request\n         *\n         * @param fileId\n         * @param name\n         * @param data\n         * @param timestamp\n         * @return {*}\n         */\n\n    }]);\n\n    return GoogleDrive;\n}(__WEBPACK_IMPORTED_MODULE_0_components_BaseModule__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (GoogleDrive);\n\n/***/ }),\n/* 24 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_components_BaseModule__ = __webpack_require__(0);\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n\n\nvar Webview = function (_BaseModule) {\n  _inherits(Webview, _BaseModule);\n\n  function Webview(settings) {\n    var autosetup = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n    _classCallCheck(this, Webview);\n\n    var _this = _possibleConstructorReturn(this, (Webview.__proto__ || Object.getPrototypeOf(Webview)).call(this));\n\n    _this.load = function (url) {\n      _this.webview.src = url;\n    };\n\n    _this.evaluatingJavaScript = function (js) {\n      _this.sendMessage({\n        code: js\n      });\n    };\n\n    _this.webview = null;\n    _this.eventHandlers = {};\n\n    if (autosetup) {\n      _this.setup(settings);\n    }\n    return _this;\n  }\n\n  _createClass(Webview, [{\n    key: 'setup',\n    value: function setup(settings) {\n      this.createWebview();\n      this.configureWebview(this.webview, settings);\n      this.append();\n\n      if (this.eventHandlers['contentload']) {\n        this.webview.addEventListener('contentload', this.eventHandlers['contentload']);\n      }\n    }\n  }, {\n    key: 'createWebview',\n    value: function createWebview() {\n      this.webview = document.createElement('webview');\n    }\n  }, {\n    key: 'configureWebview',\n    value: function configureWebview(parentObject, settings) {\n      var parent = parentObject;\n      for (var setting in settings) {\n        if (settings.hasOwnProperty(setting)) {\n          if (_typeof(settings[setting]) === 'object') {\n            this.configureWebview(parent[setting], settings[setting]);\n          } else {\n            parent[setting] = settings[setting];\n          }\n        }\n      }\n    }\n  }, {\n    key: 'append',\n    value: function append() {\n      document.body.appendChild(this.webview);\n    }\n  }, {\n    key: 'sendMessage',\n    value: function sendMessage(data) {\n      this.webview.contentWindow.postMessage(data, '*');\n    }\n\n    // PUBLIC FUNCTIONS\n\n  }]);\n\n  return Webview;\n}(__WEBPACK_IMPORTED_MODULE_0_components_BaseModule__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (Webview);\n\n/***/ }),\n/* 25 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = configureGoogleAPI;\n/**\n * Copyright 2013 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n/**\n * gapi-chrome-apps version 0.001\n *\n * Provides the Google API javascript client 'gapi' as\n * appropriate for hosted websites, or if in a Chrome packaged\n * app implement a minimal set of functionality that is Content\n * Security Policy compliant and uses the chrome identity api.\n *\n * https://github.com/GoogleChrome/chrome-app-samples/tree/master/gapi-chrome-apps-lib\n *\n */\n\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction configureGoogleAPI(gapiLoadedCallback) {\n  if (typeof gapi !== 'undefined') throw new Error('gapi already defined.');\n  if (typeof gapiLoadedCallback !== 'function') throw new Error('gapiLoadedCallback function must be defined');\n\n  // If not running in a chrome packaged app, load web gapi:\n  if (!(chrome && chrome.app && chrome.app.runtime)) {\n    window.gapiIsLoaded = function () {\n      gapiLoadedCallback();\n    };\n    // Load web gapi.\n    var script = document.createElement('script');\n    script.src = 'https://apis.google.com/js/client.js?onload=gapiIsLoaded';\n    document.documentElement.appendChild(script);\n    return;\n  }\n\n  window.gapi = {};\n  window.gapi.auth = {};\n  window.gapi.client = {};\n\n  window.ENABLE_DEBUG = false;\n\n  var access_token = undefined;\n\n  gapi.auth.authorize = function (params, callback) {\n    if (typeof callback !== 'function') throw new Error('callback required');\n\n    var details = {};\n    details.interactive = params.immediate === false || false;\n    if (params.accountHint) {\n      // Specifying this prevents the account chooser from appearing on Android.\n      details.accountHint = params.accountHint;\n    }\n    console.assert(!params.response_type || params.response_type == 'token');\n\n    var callbackWrapper = function callbackWrapper(getAuthTokenCallbackParam) {\n      access_token = getAuthTokenCallbackParam;\n      if (typeof access_token !== 'undefined') callback({ access_token: access_token });else callback({ error: chrome.runtime.lastError });\n    };\n\n    chrome.identity.getAuthToken(details, callbackWrapper);\n  };\n\n  gapi.client.request = function (args) {\n    if ((typeof args === 'undefined' ? 'undefined' : _typeof(args)) !== 'object') throw new Error('args required');\n    if (typeof args.callback !== 'function') throw new Error('callback required');\n    if (typeof args.errorCallback !== 'function') throw new Error('errorCallback required');\n    if (typeof args.path !== 'string') throw new Error('path required');\n\n    if (args.root && args.root === 'string') {\n      var path = args.root + args.path;\n    } else {\n      var path = 'https://www.googleapis.com' + args.path;\n    }\n\n    if (_typeof(args.params) === 'object') {\n      for (var paramName in args.params) {\n        if (path.indexOf(encodeURIComponent(paramName)) !== -1) {\n          continue;\n        }\n        var deliminator = path.indexOf('?') === -1 ? '?' : '&';\n        path += deliminator + encodeURIComponent(paramName) + \"=\" + encodeURIComponent(args.params[paramName]);\n      }\n    }\n\n    var method = args.method || 'GET';\n\n    var xhrReadyStates = [];\n    xhrReadyStates[XMLHttpRequest.UNSENT] = 'UNSENT';\n    xhrReadyStates[XMLHttpRequest.OPENED] = 'OPENED';\n    xhrReadyStates[XMLHttpRequest.HEADERS_RECEIVED] = 'HEADERS_RECEIVED';\n    xhrReadyStates[XMLHttpRequest.LOADING] = 'LOADING';\n    xhrReadyStates[XMLHttpRequest.DONE] = 'DONE';\n\n    var xhr = new XMLHttpRequest();\n    xhr.onreadystatechange = function () {\n\n      if (window.ENABLE_DEBUG && typeof console.debug === 'function') {\n        console.debug('XHR :: onreadystatechange - new readyState: ' + xhr.readyState + ' (' + xhrReadyStates[xhr.readyState] + ') - path: ' + path);\n      }\n    };\n\n    xhr.ontimeout = function (timeout) {\n      if (window.ENABLE_DEBUG && typeof console.warn === 'function') {\n        console.warn('XHR :: Browser timeout occurred: ' + JSON.stringify(timeout) + ', readyState: ' + xhr.readyState + ' (' + xhrReadyStates[xhr.readyState] + ') - path: ' + path);\n      }\n      handleTimeout();\n    };\n\n    // Enable this to get logging of the request urls that we invoke during GAPI use\n    if (window.ENABLE_DEBUG && typeof console.debug === 'function') {\n      console.debug('XHR :: xhr.open(' + path + ')');\n    }\n\n    xhr.open(method, path);\n    xhr.setRequestHeader('Authorization', 'Bearer ' + access_token);\n\n    if (_typeof(args.headers) === 'object') {\n      for (var headerName in args.headers) {\n        if (headerName.toLowerCase() !== 'content-length') {\n          // content-length is considered 'unsafe'\n          xhr.setRequestHeader(headerName, args.headers[headerName]);\n        }\n      }\n    }\n\n    var clearResponseTimeout = function clearResponseTimeout() {\n      if (args.responseTimeout) {\n        window.clearTimeout(args.responseTimeout);\n        delete args.responseTimeout;\n      }\n    };\n\n    var setResponseTimeout = function setResponseTimeout() {\n      clearResponseTimeout();\n      args.responseTimeout = window.setTimeout(handleTimeout, 5000);\n    };\n    var handleTimeout = function handleTimeout() {\n      if (window.ENABLE_DEBUG && typeof console.log === 'function') {\n        console.log('XHR :: Request timeout - aborting request - readyState: ' + xhr.readyState + ' (' + xhrReadyStates[xhr.readyState] + ') - path: ' + path);\n      }\n      clearResponseTimeout();\n      xhr.abort();\n      args.errorCallback(\"timeout\");\n    };\n\n    xhr.onerror = function (event) {\n      if (window.ENABLE_DEBUG && typeof console.debug === 'function') {\n        console.debug('XHR :: Request error - readyState: ' + xhr.readyState + ' (' + xhrReadyStates[xhr.readyState] + ') - aborting - path: ' + path, 'errorEvent: ', event);\n      }\n      clearResponseTimeout();\n      args.errorCallback();\n    };\n\n    xhr.onabort = function (event) {\n      if (window.ENABLE_DEBUG && typeof console.debug === 'function') {\n        console.debug('XHR :: Request aborted - readyState: ' + xhr.readyState + ' (' + xhrReadyStates[xhr.readyState] + ') - aborted - path: ' + path, 'abortEvent: ', event);\n      }\n    };\n\n    var getHeadersAsObj = function getHeadersAsObj(headersString) {\n      if (headersString === null) return null;\n      if (headersString === '') return '';\n\n      var headers = {};\n      var headerElements = headersString.split('\\r\\n');\n      for (var i = 0; i < headerElements.length; i++) {\n        var headerElement = headerElements[i];\n        if (headerElement && headerElement.trim().length > 0) {\n          var headerNameSeparatorIdx = headerElement.indexOf(':');\n          var headerName = headerElement.substr(0, headerNameSeparatorIdx).trim();\n          var headerValue = headerElement.substr(headerNameSeparatorIdx + 1).trim();\n          if (!isNaN(parseFloat(headerValue)) && isFinite(headerValue)) {\n            // If value is numeric, replace the value with the numeric representation\n            headerValue = parseFloat(headerValue);\n          }\n          headers[headerName] = headerValue;\n        }\n      }\n      return headers;\n    };\n\n    xhr.onload = function () {\n      clearResponseTimeout();\n\n      var rawResponseObject = {\n        // TODO: body.\n        // TODO: error handling; this function is called if a protocol-level error occurs (e.g. HTTP 404, 500)\n        gapiRequest: {\n          data: {\n            status: this.status,\n            statusText: this.statusText,\n            responseHeaders: getHeadersAsObj(this.getAllResponseHeaders())\n          }\n        }\n      };\n\n      if (this.response) {\n        var respObject = this.response;\n        if (typeof this.response === 'string') {\n          var contentType = xhr.getResponseHeader('Content-Type');\n          if (typeof contentType === 'string' && contentType.startsWith('application/json')) {\n            try {\n              respObject = JSON.parse(respObject);\n            } catch (err) {\n              var fallbackParsingSuccess = false;\n              if (err instanceof SyntaxError) {\n                try {\n                  respObject = JSON.parse(respObject);\n                } catch (err) {\n                  try {\n                    // Audio recorder bug could have been adding json files with base64 encoded content - handle this properly.\n                    respObject = respObject.replace(/={1,2}$/, ''); // Strip base64 '='' padding at the end\n                  } catch (decodeErr) {\n                    if (console && console !== null && console.warn && console.warn !== null) {\n                      console.warn('Failed parsing json string - raw response: ', this.response, 'Error: ', err, ' Callback will be called with the raw response');\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n        args.callback(respObject, rawResponseObject); // Send the rawwResponseObject instead of the string\n      } else {\n        args.callback(null, rawResponseObject); // Send the rawwResponseObject instead of the string\n      }\n    };\n\n    var progressObj = method === 'PUT' || method === 'PATCH' ? xhr.upload : xhr;\n    progressObj.onprogress = function (event) {\n      // restart progress timeout for the next chunk of data\n      if (window.ENABLE_DEBUG) {\n        console.debug('XHR :: onprogress: ' + (event.lengthComputable ? (event.loaded / event.total * 100).toFixed(0) : '?') + '% - ' + method + ': ' + path + ' (' + event.loaded + '/' + event.total + ' bytes)');\n      }\n      setResponseTimeout();\n    };\n\n    // send the request\n    if (typeof args.responseType === 'string') {\n      xhr.responseType = args.responseType;\n    }\n    if (args.bodyType && args.bodyType !== null) {\n      xhr.setRequestHeader('Content-Type', args.bodyType);\n      xhr.send(args.body);\n    } else if (typeof args.body !== 'undefined') {\n      xhr.setRequestHeader('Content-Type', 'application/json');\n      xhr.send(JSON.stringify(args.body));\n    } else {\n      xhr.send();\n    }\n\n    setResponseTimeout();\n  };\n\n  // Call client handler when gapi is ready.\n  setTimeout(function () {\n    gapiLoadedCallback();\n  }, 0);\n}\n\n/***/ }),\n/* 26 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = StringView;\n\n\n/*\\\n|*|\n|*|\t:: Number.isInteger() polyfill ::\n|*|\n|*|\thttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isInteger\n|*|\n\\*/\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nif (!Number.isInteger) {\n\tNumber.isInteger = function isInteger(nVal) {\n\t\treturn typeof nVal === \"number\" && isFinite(nVal) && nVal > -9007199254740992 && nVal < 9007199254740992 && Math.floor(nVal) === nVal;\n\t};\n}\n\n/*\\\n|*|\n|*|\tStringView - Mozilla Developer Network\n|*|\n|*|\tRevision #12, March 21st, 2017\n|*|\n|*|\thttps://developer.mozilla.org/en-US/Add-ons/Code_snippets/StringView\n|*|\thttps://developer.mozilla.org/en-US/docs/User:fusionchess\n|*|\thttps://github.com/madmurphy/stringview.js\n|*|\n|*|\tThis framework is released under the GNU Lesser General Public License, version 3 or later.\n|*|\thttp://www.gnu.org/licenses/lgpl-3.0.html\n|*|\n\\*/\n\nfunction StringView(vInput, sEncoding /* optional (default: UTF-8) */, nOffset /* optional */, nLength /* optional */) {\n\n\tvar fTAView,\n\t    aWhole,\n\t    aRaw,\n\t    fPutOutptCode,\n\t    fGetOutptChrSize,\n\t    nInptLen,\n\t    nStartIdx = isFinite(nOffset) ? nOffset : 0,\n\t    nTranscrType = 15;\n\n\tif (sEncoding) {\n\t\tthis.encoding = sEncoding.toString();\n\t}\n\n\tencSwitch: switch (this.encoding) {\n\t\tcase \"UTF-8\":\n\t\t\tfPutOutptCode = StringView.putUTF8CharCode;\n\t\t\tfGetOutptChrSize = StringView.getUTF8CharLength;\n\t\t\tfTAView = Uint8Array;\n\t\t\tbreak encSwitch;\n\t\tcase \"UTF-16\":\n\t\t\tfPutOutptCode = StringView.putUTF16CharCode;\n\t\t\tfGetOutptChrSize = StringView.getUTF16CharLength;\n\t\t\tfTAView = Uint16Array;\n\t\t\tbreak encSwitch;\n\t\tcase \"UTF-32\":\n\t\t\tfTAView = Uint32Array;\n\t\t\tnTranscrType &= 14;\n\t\t\tbreak encSwitch;\n\t\tdefault:\n\t\t\t/* case \"ASCII\", or case \"BinaryString\" or unknown cases */\n\t\t\tfTAView = Uint8Array;\n\t\t\tnTranscrType &= 14;\n\t}\n\n\ttypeSwitch: switch (typeof vInput === \"undefined\" ? \"undefined\" : _typeof(vInput)) {\n\t\tcase \"string\":\n\t\t\t/* the input argument is a primitive string: a new buffer will be created. */\n\t\t\tnTranscrType &= 7;\n\t\t\tbreak typeSwitch;\n\t\tcase \"object\":\n\t\t\tclassSwitch: switch (vInput.constructor) {\n\t\t\t\tcase StringView:\n\t\t\t\t\t/* the input argument is a stringView: a new buffer will be created. */\n\t\t\t\t\tnTranscrType &= 3;\n\t\t\t\t\tbreak typeSwitch;\n\t\t\t\tcase String:\n\t\t\t\t\t/* the input argument is an objectified string: a new buffer will be created. */\n\t\t\t\t\tnTranscrType &= 7;\n\t\t\t\t\tbreak typeSwitch;\n\t\t\t\tcase ArrayBuffer:\n\t\t\t\t\t/* the input argument is an arrayBuffer: the buffer will be shared. */\n\t\t\t\t\taWhole = new fTAView(vInput);\n\t\t\t\t\tnInptLen = this.encoding === \"UTF-32\" ? vInput.byteLength >>> 2 : this.encoding === \"UTF-16\" ? vInput.byteLength >>> 1 : vInput.byteLength;\n\t\t\t\t\taRaw = nStartIdx === 0 && (!isFinite(nLength) || nLength === nInptLen) ? aWhole : new fTAView(vInput, nStartIdx, !isFinite(nLength) ? nInptLen - nStartIdx : nLength);\n\n\t\t\t\t\tbreak typeSwitch;\n\t\t\t\tcase Uint32Array:\n\t\t\t\tcase Uint16Array:\n\t\t\t\tcase Uint8Array:\n\t\t\t\t\t/* the input argument is a typedArray: the buffer, and possibly the array itself, will be shared. */\n\t\t\t\t\tfTAView = vInput.constructor;\n\t\t\t\t\tnInptLen = vInput.length;\n\t\t\t\t\taWhole = vInput.byteOffset === 0 && vInput.length === (fTAView === Uint32Array ? vInput.buffer.byteLength >>> 2 : fTAView === Uint16Array ? vInput.buffer.byteLength >>> 1 : vInput.buffer.byteLength) ? vInput : new fTAView(vInput.buffer);\n\t\t\t\t\taRaw = nStartIdx === 0 && (!isFinite(nLength) || nLength === nInptLen) ? vInput : vInput.subarray(nStartIdx, isFinite(nLength) ? nStartIdx + nLength : nInptLen);\n\n\t\t\t\t\tbreak typeSwitch;\n\t\t\t\tdefault:\n\t\t\t\t\t/* the input argument is an array or another serializable object: a new typedArray will be created. */\n\t\t\t\t\taWhole = new fTAView(vInput);\n\t\t\t\t\tnInptLen = aWhole.length;\n\t\t\t\t\taRaw = nStartIdx === 0 && (!isFinite(nLength) || nLength === nInptLen) ? aWhole : aWhole.subarray(nStartIdx, isFinite(nLength) ? nStartIdx + nLength : nInptLen);\n\t\t\t}\n\t\t\tbreak typeSwitch;\n\t\tdefault:\n\t\t\t/* the input argument is a number, a boolean or a function: a new typedArray will be created. */\n\t\t\taWhole = aRaw = new fTAView(Number(vInput) || 0);\n\n\t}\n\n\tif (nTranscrType < 8) {\n\n\t\tvar vSource, nOutptLen, nCharStart, nCharEnd, nEndIdx, fGetInptChrSize, fGetInptChrCode;\n\n\t\tif (nTranscrType & 4) {\n\t\t\t/* input is string */\n\n\t\t\tvSource = vInput;\n\t\t\tnOutptLen = nInptLen = vSource.length;\n\t\t\tnTranscrType ^= this.encoding === \"UTF-32\" ? 0 : 2;\n\t\t\t/* ...or...: nTranscrType ^= Number(this.encoding !== \"UTF-32\") << 1; */\n\t\t\tnStartIdx = nCharStart = nOffset ? Math.max((nOutptLen + nOffset) % nOutptLen, 0) : 0;\n\t\t\tnEndIdx = nCharEnd = (Number.isInteger(nLength) ? Math.min(Math.max(nLength, 0) + nStartIdx, nOutptLen) : nOutptLen) - 1;\n\t\t} else {\n\t\t\t/* input is stringView */\n\n\t\t\tvSource = vInput.rawData;\n\t\t\tnInptLen = vInput.makeIndex();\n\t\t\tnStartIdx = nCharStart = nOffset ? Math.max((nInptLen + nOffset) % nInptLen, 0) : 0;\n\t\t\tnOutptLen = Number.isInteger(nLength) ? Math.min(Math.max(nLength, 0), nInptLen - nCharStart) : nInptLen;\n\t\t\tnEndIdx = nCharEnd = nOutptLen + nCharStart;\n\n\t\t\tif (vInput.encoding === \"UTF-8\") {\n\t\t\t\tfGetInptChrSize = StringView.getUTF8CharLength;\n\t\t\t\tfGetInptChrCode = StringView.loadUTF8CharCode;\n\t\t\t} else if (vInput.encoding === \"UTF-16\") {\n\t\t\t\tfGetInptChrSize = StringView.getUTF16CharLength;\n\t\t\t\tfGetInptChrCode = StringView.loadUTF16CharCode;\n\t\t\t} else {\n\t\t\t\tnTranscrType &= 1;\n\t\t\t}\n\t\t}\n\n\t\tif (nOutptLen === 0 || nTranscrType < 4 && vSource.encoding === this.encoding && nCharStart === 0 && nOutptLen === nInptLen) {\n\n\t\t\t/* the encoding is the same, the length too and the offset is 0... or the input is empty! */\n\n\t\t\tnTranscrType = 7;\n\t\t}\n\n\t\tconversionSwitch: switch (nTranscrType) {\n\n\t\t\tcase 0:\n\n\t\t\t\t/* both the source and the new StringView have a fixed-length encoding... */\n\n\t\t\t\taWhole = new fTAView(nOutptLen);\n\t\t\t\tfor (var nOutptIdx = 0; nOutptIdx < nOutptLen; aWhole[nOutptIdx] = vSource[nStartIdx + nOutptIdx++]) {}\n\t\t\t\tbreak conversionSwitch;\n\n\t\t\tcase 1:\n\n\t\t\t\t/* the source has a fixed-length encoding but the new StringView has a variable-length encoding... */\n\n\t\t\t\t/* mapping... */\n\n\t\t\t\tnOutptLen = 0;\n\n\t\t\t\tfor (var nInptIdx = nStartIdx; nInptIdx < nEndIdx; nInptIdx++) {\n\t\t\t\t\tnOutptLen += fGetOutptChrSize(vSource[nInptIdx]);\n\t\t\t\t}\n\n\t\t\t\taWhole = new fTAView(nOutptLen);\n\n\t\t\t\t/* transcription of the source... */\n\n\t\t\t\tfor (var nInptIdx = nStartIdx, nOutptIdx = 0; nOutptIdx < nOutptLen; nInptIdx++) {\n\t\t\t\t\tnOutptIdx = fPutOutptCode(aWhole, vSource[nInptIdx], nOutptIdx);\n\t\t\t\t}\n\n\t\t\t\tbreak conversionSwitch;\n\n\t\t\tcase 2:\n\n\t\t\t\t/* the source has a variable-length encoding but the new StringView has a fixed-length encoding... */\n\n\t\t\t\t/* mapping... */\n\n\t\t\t\tnStartIdx = 0;\n\n\t\t\t\tvar nChrCode;\n\n\t\t\t\tfor (nChrIdx = 0; nChrIdx < nCharStart; nChrIdx++) {\n\t\t\t\t\tnChrCode = fGetInptChrCode(vSource, nStartIdx);\n\t\t\t\t\tnStartIdx += fGetInptChrSize(nChrCode);\n\t\t\t\t}\n\n\t\t\t\taWhole = new fTAView(nOutptLen);\n\n\t\t\t\t/* transcription of the source... */\n\n\t\t\t\tfor (var nInptIdx = nStartIdx, nOutptIdx = 0; nOutptIdx < nOutptLen; nInptIdx += fGetInptChrSize(nChrCode), nOutptIdx++) {\n\t\t\t\t\tnChrCode = fGetInptChrCode(vSource, nInptIdx);\n\t\t\t\t\taWhole[nOutptIdx] = nChrCode;\n\t\t\t\t}\n\n\t\t\t\tbreak conversionSwitch;\n\n\t\t\tcase 3:\n\n\t\t\t\t/* both the source and the new StringView have a variable-length encoding... */\n\n\t\t\t\t/* mapping... */\n\n\t\t\t\tnOutptLen = 0;\n\n\t\t\t\tvar nChrCode;\n\n\t\t\t\tfor (var nChrIdx = 0, nInptIdx = 0; nChrIdx < nCharEnd; nInptIdx += fGetInptChrSize(nChrCode)) {\n\t\t\t\t\tnChrCode = fGetInptChrCode(vSource, nInptIdx);\n\t\t\t\t\tif (nChrIdx === nCharStart) {\n\t\t\t\t\t\tnStartIdx = nInptIdx;\n\t\t\t\t\t}\n\t\t\t\t\tif (++nChrIdx > nCharStart) {\n\t\t\t\t\t\tnOutptLen += fGetOutptChrSize(nChrCode);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\taWhole = new fTAView(nOutptLen);\n\n\t\t\t\t/* transcription... */\n\n\t\t\t\tfor (var nInptIdx = nStartIdx, nOutptIdx = 0; nOutptIdx < nOutptLen; nInptIdx += fGetInptChrSize(nChrCode)) {\n\t\t\t\t\tnChrCode = fGetInptChrCode(vSource, nInptIdx);\n\t\t\t\t\tnOutptIdx = fPutOutptCode(aWhole, nChrCode, nOutptIdx);\n\t\t\t\t}\n\n\t\t\t\tbreak conversionSwitch;\n\n\t\t\tcase 4:\n\n\t\t\t\t/* DOMString to ASCII or BinaryString or other unknown encodings */\n\n\t\t\t\taWhole = new fTAView(nOutptLen);\n\n\t\t\t\t/* transcription... */\n\n\t\t\t\tfor (var nIdx = 0; nIdx < nOutptLen; nIdx++) {\n\t\t\t\t\taWhole[nIdx] = vSource.charCodeAt(nIdx) & 0xff;\n\t\t\t\t}\n\n\t\t\t\tbreak conversionSwitch;\n\n\t\t\tcase 5:\n\n\t\t\t\t/* DOMString to UTF-8 or to UTF-16 */\n\n\t\t\t\t/* mapping... */\n\n\t\t\t\tnOutptLen = 0;\n\n\t\t\t\tfor (var nMapIdx = 0; nMapIdx < nInptLen; nMapIdx++) {\n\t\t\t\t\tif (nMapIdx === nCharStart) {\n\t\t\t\t\t\tnStartIdx = nOutptLen;\n\t\t\t\t\t}\n\t\t\t\t\tnOutptLen += fGetOutptChrSize(vSource.charCodeAt(nMapIdx));\n\t\t\t\t\tif (nMapIdx === nCharEnd) {\n\t\t\t\t\t\tnEndIdx = nOutptLen;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\taWhole = new fTAView(nOutptLen);\n\n\t\t\t\t/* transcription... */\n\n\t\t\t\tfor (var nOutptIdx = 0, nChrIdx = 0; nOutptIdx < nOutptLen; nChrIdx++) {\n\t\t\t\t\tnOutptIdx = fPutOutptCode(aWhole, vSource.charCodeAt(nChrIdx), nOutptIdx);\n\t\t\t\t}\n\n\t\t\t\tbreak conversionSwitch;\n\n\t\t\tcase 6:\n\n\t\t\t\t/* DOMString to UTF-32 */\n\n\t\t\t\taWhole = new fTAView(nOutptLen);\n\n\t\t\t\t/* transcription... */\n\n\t\t\t\tfor (var nIdx = 0; nIdx < nOutptLen; nIdx++) {\n\t\t\t\t\taWhole[nIdx] = vSource.charCodeAt(nIdx);\n\t\t\t\t}\n\n\t\t\t\tbreak conversionSwitch;\n\n\t\t\tcase 7:\n\n\t\t\t\taWhole = new fTAView(nOutptLen ? vSource : 0);\n\t\t\t\tbreak conversionSwitch;\n\n\t\t}\n\n\t\taRaw = nTranscrType > 3 && (nStartIdx > 0 || nEndIdx < aWhole.length - 1) ? aWhole.subarray(nStartIdx, nEndIdx) : aWhole;\n\t}\n\n\tthis.buffer = aWhole.buffer;\n\tthis.bufferView = aWhole;\n\tthis.rawData = aRaw;\n\n\tObject.freeze(this);\n}\n\n/* CONSTRUCTOR'S METHODS */\n\nStringView.loadUTF8CharCode = function (aChars, nIdx) {\n\t/* The ISO 10646 view of UTF-8 considers valid codepoints encoded by 1-6 bytes, \n  * while the Unicode view of UTF-8 in 2003 has limited them to 1-4 bytes in order to \n  * match UTF-16's codepoints. In front of a 5/6-byte sequence StringView tries to \n  * encode it in any case.\n  */\n\tvar nLen = aChars.length,\n\t    nPart = aChars[nIdx];\n\treturn nPart > 251 && nPart < 254 && nIdx + 5 < nLen ?\n\t/* (nPart - 252 << 30) may be not safe in ECMAScript! So...: */\n\t/* six bytes */(nPart - 252) * 1073741824 + (aChars[nIdx + 1] - 128 << 24) + (aChars[nIdx + 2] - 128 << 18) + (aChars[nIdx + 3] - 128 << 12) + (aChars[nIdx + 4] - 128 << 6) + aChars[nIdx + 5] - 128 : nPart > 247 && nPart < 252 && nIdx + 4 < nLen ?\n\t/* five bytes */(nPart - 248 << 24) + (aChars[nIdx + 1] - 128 << 18) + (aChars[nIdx + 2] - 128 << 12) + (aChars[nIdx + 3] - 128 << 6) + aChars[nIdx + 4] - 128 : nPart > 239 && nPart < 248 && nIdx + 3 < nLen ?\n\t/* four bytes */(nPart - 240 << 18) + (aChars[nIdx + 1] - 128 << 12) + (aChars[nIdx + 2] - 128 << 6) + aChars[nIdx + 3] - 128 : nPart > 223 && nPart < 240 && nIdx + 2 < nLen ?\n\t/* three bytes */(nPart - 224 << 12) + (aChars[nIdx + 1] - 128 << 6) + aChars[nIdx + 2] - 128 : nPart > 191 && nPart < 224 && nIdx + 1 < nLen ?\n\t/* two bytes */(nPart - 192 << 6) + aChars[nIdx + 1] - 128 :\n\t/* one byte */nPart;\n};\n\nStringView.putUTF8CharCode = function (aTarget, nChar, nPutAt) {\n\n\tvar nIdx = nPutAt;\n\n\tif (nChar < 0x80 /* 128 */) {\n\t\t\t/* one byte */\n\t\t\taTarget[nIdx++] = nChar;\n\t\t} else if (nChar < 0x800 /* 2048 */) {\n\t\t\t/* two bytes */\n\t\t\taTarget[nIdx++] = 0xc0 /* 192 */ + (nChar >>> 6);\n\t\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar & 0x3f /* 63 */);\n\t\t} else if (nChar < 0x10000 /* 65536 */) {\n\t\t\t/* three bytes */\n\t\t\taTarget[nIdx++] = 0xe0 /* 224 */ + (nChar >>> 12);\n\t\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar >>> 6 & 0x3f /* 63 */);\n\t\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar & 0x3f /* 63 */);\n\t\t} else if (nChar < 0x200000 /* 2097152 */) {\n\t\t\t/* four bytes */\n\t\t\taTarget[nIdx++] = 0xf0 /* 240 */ + (nChar >>> 18);\n\t\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar >>> 12 & 0x3f /* 63 */);\n\t\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar >>> 6 & 0x3f /* 63 */);\n\t\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar & 0x3f /* 63 */);\n\t\t} else if (nChar < 0x4000000 /* 67108864 */) {\n\t\t\t/* five bytes */\n\t\t\taTarget[nIdx++] = 0xf8 /* 248 */ + (nChar >>> 24);\n\t\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar >>> 18 & 0x3f /* 63 */);\n\t\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar >>> 12 & 0x3f /* 63 */);\n\t\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar >>> 6 & 0x3f /* 63 */);\n\t\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar & 0x3f /* 63 */);\n\t\t} else /* if (nChar <= 0x7fffffff) */{\n\t\t\t/* 2147483647 */\n\t\t\t/* six bytes */\n\t\t\taTarget[nIdx++] = 0xfc /* 252 */ + /* (nChar >>> 30) may be not safe in ECMAScript! So...: */nChar / 1073741824;\n\t\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar >>> 24 & 0x3f /* 63 */);\n\t\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar >>> 18 & 0x3f /* 63 */);\n\t\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar >>> 12 & 0x3f /* 63 */);\n\t\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar >>> 6 & 0x3f /* 63 */);\n\t\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar & 0x3f /* 63 */);\n\t\t}\n\n\treturn nIdx;\n};\n\nStringView.getUTF8CharLength = function (nChar) {\n\treturn nChar < 0x80 ? 1 : nChar < 0x800 ? 2 : nChar < 0x10000 ? 3 : nChar < 0x200000 ? 4 : nChar < 0x4000000 ? 5 : 6;\n};\n\nStringView.loadUTF16CharCode = function (aChars, nIdx) {\n\n\t/* UTF-16 to DOMString decoding algorithm */\n\tvar nFrstChr = aChars[nIdx];\n\n\treturn nFrstChr > 0xD7BF /* 55231 */ && nIdx + 1 < aChars.length ? (nFrstChr - 0xD800 /* 55296 */ << 10) + aChars[nIdx + 1] + 0x2400 /* 9216 */\n\t: nFrstChr;\n};\n\nStringView.putUTF16CharCode = function (aTarget, nChar, nPutAt) {\n\n\tvar nIdx = nPutAt;\n\n\tif (nChar < 0x10000 /* 65536 */) {\n\t\t\t/* one element */\n\t\t\taTarget[nIdx++] = nChar;\n\t\t} else {\n\t\t/* two elements */\n\t\taTarget[nIdx++] = 0xD7C0 /* 55232 */ + (nChar >>> 10);\n\t\taTarget[nIdx++] = 0xDC00 /* 56320 */ + (nChar & 0x3FF /* 1023 */);\n\t}\n\n\treturn nIdx;\n};\n\nStringView.getUTF16CharLength = function (nChar) {\n\treturn nChar < 0x10000 ? 1 : 2;\n};\n\n/* Array of bytes to base64 string decoding */\n\nStringView.b64ToUint6 = function (nChr) {\n\n\treturn nChr > 64 && nChr < 91 ? nChr - 65 : nChr > 96 && nChr < 123 ? nChr - 71 : nChr > 47 && nChr < 58 ? nChr + 4 : nChr === 43 ? 62 : nChr === 47 ? 63 : 0;\n};\n\nStringView.uint6ToB64 = function (nUint6) {\n\n\treturn nUint6 < 26 ? nUint6 + 65 : nUint6 < 52 ? nUint6 + 71 : nUint6 < 62 ? nUint6 - 4 : nUint6 === 62 ? 43 : nUint6 === 63 ? 47 : 65;\n};\n\n/* Base64 string to array encoding */\n\nStringView.bytesToBase64 = function (aBytes) {\n\n\tvar eqLen = (3 - aBytes.length % 3) % 3,\n\t    sB64Enc = \"\";\n\n\tfor (var nMod3, nLen = aBytes.length, nUint24 = 0, nIdx = 0; nIdx < nLen; nIdx++) {\n\t\tnMod3 = nIdx % 3;\n\t\t/* Uncomment the following line in order to split the output in lines 76-character long: */\n\t\t/*\n  if (nIdx > 0 && (nIdx * 4 / 3) % 76 === 0) { sB64Enc += \"\\r\\n\"; }\n  */\n\t\tnUint24 |= aBytes[nIdx] << (16 >>> nMod3 & 24);\n\t\tif (nMod3 === 2 || aBytes.length - nIdx === 1) {\n\t\t\tsB64Enc += String.fromCharCode(StringView.uint6ToB64(nUint24 >>> 18 & 63), StringView.uint6ToB64(nUint24 >>> 12 & 63), StringView.uint6ToB64(nUint24 >>> 6 & 63), StringView.uint6ToB64(nUint24 & 63));\n\t\t\tnUint24 = 0;\n\t\t}\n\t}\n\n\treturn eqLen === 0 ? sB64Enc : sB64Enc.substring(0, sB64Enc.length - eqLen) + (eqLen === 1 ? \"=\" : \"==\");\n};\n\nStringView.base64ToBytes = function (sBase64, nBlockBytes) {\n\n\tvar sB64Enc = sBase64.replace(/[^A-Za-z0-9\\+\\/]/g, \"\"),\n\t    nInLen = sB64Enc.length,\n\t    nOutLen = nBlockBytes ? Math.ceil((nInLen * 3 + 1 >>> 2) / nBlockBytes) * nBlockBytes : nInLen * 3 + 1 >>> 2,\n\t    aBytes = new Uint8Array(nOutLen);\n\n\tfor (var nMod3, nMod4, nUint24 = 0, nOutIdx = 0, nInIdx = 0; nInIdx < nInLen; nInIdx++) {\n\t\tnMod4 = nInIdx & 3;\n\t\tnUint24 |= StringView.b64ToUint6(sB64Enc.charCodeAt(nInIdx)) << 18 - 6 * nMod4;\n\t\tif (nMod4 === 3 || nInLen - nInIdx === 1) {\n\t\t\tfor (nMod3 = 0; nMod3 < 3 && nOutIdx < nOutLen; nMod3++, nOutIdx++) {\n\t\t\t\taBytes[nOutIdx] = nUint24 >>> (16 >>> nMod3 & 24) & 255;\n\t\t\t}\n\t\t\tnUint24 = 0;\n\t\t}\n\t}\n\n\treturn aBytes;\n};\n\nStringView.makeFromBase64 = function (sB64Inpt, sEncoding, nByteOffset, nLength) {\n\n\treturn new StringView(sEncoding === \"UTF-16\" || sEncoding === \"UTF-32\" ? StringView.base64ToBytes(sB64Inpt, sEncoding === \"UTF-16\" ? 2 : 4).buffer : StringView.base64ToBytes(sB64Inpt), sEncoding, nByteOffset, nLength);\n};\n\n/* DEFAULT VALUES */\n\nStringView.prototype.encoding = \"UTF-8\"; /* Default encoding... */\n\n/* INSTANCES' METHODS */\n\nStringView.prototype.makeIndex = function (nChrLength, nStartFrom) {\n\n\tvar aTarget = this.rawData,\n\t    nChrEnd,\n\t    nRawLength = aTarget.length,\n\t    nStartIdx = nStartFrom || 0,\n\t    nIdxEnd = nStartIdx,\n\t    nStopAtChr = isNaN(nChrLength) ? Infinity : nChrLength;\n\n\tif (nChrLength + 1 > aTarget.length) {\n\t\tthrow new RangeError(\"StringView.prototype.makeIndex - The offset can\\'t be major than the length of the array - 1.\");\n\t}\n\n\tswitch (this.encoding) {\n\n\t\tcase \"UTF-8\":\n\n\t\t\tvar nPart;\n\n\t\t\tfor (nChrEnd = 0; nIdxEnd < nRawLength && nChrEnd < nStopAtChr; nChrEnd++) {\n\t\t\t\tnPart = aTarget[nIdxEnd];\n\t\t\t\tnIdxEnd += nPart > 251 && nPart < 254 && nIdxEnd + 5 < nRawLength ? 6 : nPart > 247 && nPart < 252 && nIdxEnd + 4 < nRawLength ? 5 : nPart > 239 && nPart < 248 && nIdxEnd + 3 < nRawLength ? 4 : nPart > 223 && nPart < 240 && nIdxEnd + 2 < nRawLength ? 3 : nPart > 191 && nPart < 224 && nIdxEnd + 1 < nRawLength ? 2 : 1;\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase \"UTF-16\":\n\n\t\t\tfor (nChrEnd = nStartIdx; nIdxEnd < nRawLength && nChrEnd < nStopAtChr; nChrEnd++) {\n\t\t\t\tnIdxEnd += aTarget[nIdxEnd] > 0xD7BF /* 55231 */ && nIdxEnd + 1 < aTarget.length ? 2 : 1;\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tnIdxEnd = nChrEnd = isFinite(nChrLength) ? nChrLength : nRawLength - 1;\n\n\t}\n\n\tif (nChrLength) {\n\t\treturn nIdxEnd;\n\t}\n\n\treturn nChrEnd;\n};\n\nStringView.prototype.toBase64 = function (bWholeBuffer) {\n\n\treturn StringView.bytesToBase64(bWholeBuffer ? this.bufferView.constructor === Uint8Array ? this.bufferView : new Uint8Array(this.buffer) : this.rawData.constructor === Uint8Array ? this.rawData : new Uint8Array(this.buffer, this.rawData.byteOffset, this.rawData.length << (this.rawData.constructor === Uint16Array ? 1 : 2)));\n};\n\nStringView.prototype.subview = function (nCharOffset /* optional */, nCharLength /* optional */) {\n\n\tvar nRawSubLen,\n\t    nRawSubOffset,\n\t    nSubOffset,\n\t    nSubLen,\n\t    bVariableLen = this.encoding === \"UTF-8\" || this.encoding === \"UTF-16\",\n\t    nThisLen,\n\t    nRawLen = this.rawData.length;\n\n\tif (nRawLen === 0) {\n\t\treturn new StringView(this.buffer, this.encoding);\n\t}\n\n\tnThisLen = bVariableLen ? this.makeIndex() : nRawLen;\n\tnSubOffset = nCharOffset ? nCharOffset + 1 > nThisLen ? nThisLen : Math.max((nThisLen + nCharOffset) % nThisLen, 0) : 0;\n\tnSubLen = Number.isInteger(nCharLength) ? Math.max(nCharLength, 0) + nSubOffset > nThisLen ? nThisLen - nSubOffset : nCharLength : nThisLen - nSubOffset;\n\n\tif (nSubOffset === 0 && nSubLen === nThisLen) {\n\t\treturn this;\n\t}\n\n\tif (bVariableLen) {\n\t\tnRawSubOffset = nSubOffset < nThisLen ? this.makeIndex(nSubOffset) : nThisLen;\n\t\tnRawSubLen = nSubLen ? this.makeIndex(nSubLen, nRawSubOffset) - nRawSubOffset : 0;\n\t} else {\n\t\tnRawSubOffset = nSubOffset;\n\t\tnRawSubLen = nSubLen;\n\t}\n\n\tif (this.encoding === \"UTF-16\") {\n\t\tnRawSubOffset <<= 1;\n\t} else if (this.encoding === \"UTF-32\") {\n\t\tnRawSubOffset <<= 2;\n\t}\n\n\treturn new StringView(this.buffer, this.encoding, this.rawData.byteOffset + nRawSubOffset, nRawSubLen);\n};\n\nStringView.prototype.forEachChar = function (fCallback, oThat, nChrOffset, nChrLen) {\n\n\tvar aSource = this.rawData,\n\t    nRawEnd,\n\t    nRawIdx;\n\n\tif (this.encoding === \"UTF-8\" || this.encoding === \"UTF-16\") {\n\n\t\tvar fGetInptChrSize, fGetInptChrCode;\n\n\t\tif (this.encoding === \"UTF-8\") {\n\t\t\tfGetInptChrSize = StringView.getUTF8CharLength;\n\t\t\tfGetInptChrCode = StringView.loadUTF8CharCode;\n\t\t} else if (this.encoding === \"UTF-16\") {\n\t\t\tfGetInptChrSize = StringView.getUTF16CharLength;\n\t\t\tfGetInptChrCode = StringView.loadUTF16CharCode;\n\t\t}\n\n\t\tnRawIdx = isFinite(nChrOffset) ? this.makeIndex(nChrOffset) : 0;\n\t\tnRawEnd = isFinite(nChrLen) ? this.makeIndex(nChrLen, nRawIdx) : aSource.length;\n\n\t\tfor (var nChrCode, nChrIdx = 0; nRawIdx < nRawEnd; nChrIdx++) {\n\t\t\tnChrCode = fGetInptChrCode(aSource, nRawIdx);\n\t\t\tif (!oThat) {\n\t\t\t\tfCallback(nChrCode, nChrIdx, nRawIdx, aSource);\n\t\t\t} else {\n\t\t\t\tfCallback.call(oThat, nChrCode, nChrIdx, nRawIdx, aSource);\n\t\t\t}\n\t\t\tnRawIdx += fGetInptChrSize(nChrCode);\n\t\t}\n\t} else {\n\n\t\tnRawIdx = isFinite(nChrOffset) ? nChrOffset : 0;\n\t\tnRawEnd = isFinite(nChrLen) ? nChrLen + nRawIdx : aSource.length;\n\n\t\tfor (nRawIdx; nRawIdx < nRawEnd; nRawIdx++) {\n\t\t\tif (!oThat) {\n\t\t\t\tfCallback(aSource[nRawIdx], nRawIdx, nRawIdx, aSource);\n\t\t\t} else {\n\t\t\t\tfCallback.call(oThat, aSource[nRawIdx], nRawIdx, nRawIdx, aSource);\n\t\t\t}\n\t\t}\n\t}\n};\n\nStringView.prototype.valueOf = StringView.prototype.toString = function () {\n\n\tif (this.encoding !== \"UTF-8\" && this.encoding !== \"UTF-16\") {\n\t\t/* ASCII, UTF-32 or BinaryString to DOMString */\n\t\treturn String.fromCharCode.apply(null, this.rawData);\n\t}\n\n\tvar fGetCode,\n\t    fGetIncr,\n\t    sView = \"\";\n\n\tif (this.encoding === \"UTF-8\") {\n\t\tfGetIncr = StringView.getUTF8CharLength;\n\t\tfGetCode = StringView.loadUTF8CharCode;\n\t} else if (this.encoding === \"UTF-16\") {\n\t\tfGetIncr = StringView.getUTF16CharLength;\n\t\tfGetCode = StringView.loadUTF16CharCode;\n\t}\n\n\tfor (var nChr, nLen = this.rawData.length, nIdx = 0; nIdx < nLen; nIdx += fGetIncr(nChr)) {\n\t\tnChr = fGetCode(this.rawData, nIdx);\n\t\tsView += String.fromCharCode(nChr);\n\t}\n\n\treturn sView;\n};\n\n/***/ }),\n/* 27 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_ChromeApp__ = __webpack_require__(6);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_components_Splashscreen__ = __webpack_require__(9);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_components_Window__ = __webpack_require__(22);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_components_Storage__ = __webpack_require__(4);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_components_PlatformInfo__ = __webpack_require__(20);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_components_Video__ = __webpack_require__(21);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6_components_Audio__ = __webpack_require__(15);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7_components_Bluetooth__ = __webpack_require__(16);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8_components_ContentViewerWebview__ = __webpack_require__(17);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9_components_SyncFS__ = __webpack_require__(10);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10_components_ExternalLink__ = __webpack_require__(18);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_11_components_Killswitch__ = __webpack_require__(19);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_12_components_OSLimiter__ = __webpack_require__(8);\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n\n// import Logger from 'Logger';\n\n\n\n\n\n\n\n\n\n\n\n\n//import UpdateChecker from 'components/UpdateChecker';\n\n// Timestamps in console - start\nif (!Date.now) {\n  Date.now = function () {\n    return new Date().getTime();\n  };\n}\nvar startTime = Date.now();\nfunction tstamp() {\n  var t = (Date.now() - startTime) / 1000.0;\n  return '[' + t + '] ';\n}\n\nfunction getArgString(args) {\n  if (typeof args === 'string') {\n    return args;\n  }\n  // return JSON.stringify(args);\n  return concatArgs(args);\n}\n\n/**\n * @ignore\n * Get a message to print by the logger\n *\n * @param {object|Array} args - The arguments to log\n * @param {number} [offset = 0] - The number of arguments to skip - by default no arguments are skipped\n * @param {string} [separator = ' '] The separator to use between the args - by default a space is used\n * @return {string}\n */\nfunction concatArgs(args) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  var separator = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : ' ';\n\n  var message = '';\n  for (var i = offset; i < args.length; i++) {\n    if (i > offset) {\n      message += separator;\n    }\n    var type = _typeof(args[i]);\n    if (args[i] !== null) {\n      if (type === 'object') {\n        var o = {};\n        o.o = args[i];\n        var cache = [];\n        if (args[i].hasOwnProperty('toString') && typeof args[i].toString === 'function') {\n          message += args[i].toString();\n        } else {\n          // message += JSON.stringify(args[i]);\n          message += JSON.stringify(o, function (key, value) {\n            if ((typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object' && value !== null) {\n              if (cache.indexOf(value) !== -1) {\n                // Circular reference found, ignore key\n                return;\n              }\n              // Store value in our collection\n              cache.push(value);\n            }\n            return value;\n          }, '\\t');\n        }\n        cache = null;\n      } else {\n        message += args[i];\n      }\n    } else {\n      message += 'null';\n    }\n  }\n\n  return message;\n}\n\nvar oldConsole = console;\nwindow.console = {\n  log: function log() {\n    var args = [getArgString(arguments)];\n    Array.prototype.unshift.call(args, tstamp());\n    oldConsole.log.apply(oldConsole, args);\n  },\n  trace: function trace() {\n    var args = [getArgString(arguments)];\n    Array.prototype.unshift.call(args, tstamp());\n    oldConsole.trace.apply(oldConsole, args);\n  },\n  info: function info() {\n    var args = [getArgString(arguments)];\n    Array.prototype.unshift.call(args, tstamp());\n    oldConsole.info.apply(oldConsole, args);\n  },\n  error: function error() {\n    var args = [getArgString(arguments)];\n    Array.prototype.unshift.call(args, tstamp());\n    oldConsole.error.apply(oldConsole, args);\n  },\n  debug: function debug() {\n    var argString = getArgString(arguments);\n    if (argString.indexOf('Screen position out of view frustum') !== -1) {\n      return;\n    }\n    var args = [argString];\n    Array.prototype.unshift.call(args, tstamp());\n    oldConsole.debug.apply(oldConsole, args);\n  },\n  assert: function assert() {\n    var args = [getArgString(arguments)];\n    Array.prototype.unshift.call(args, tstamp());\n    oldConsole.assert.apply(oldConsole, args);\n  },\n  warn: function warn() {\n    var args = [getArgString(arguments)];\n    Array.prototype.unshift.call(args, tstamp());\n    oldConsole.warn.apply(oldConsole, args);\n  },\n  time: function time() {\n    var args = [getArgString(arguments)];\n    oldConsole.time.apply(oldConsole, args);\n  },\n  timeStamp: function timeStamp() {\n    var args = [getArgString(arguments)];\n    oldConsole.timeStamp.apply(oldConsole, args);\n  },\n  timeEnd: function timeEnd() {\n    var args = [getArgString(arguments)];\n    oldConsole.timeEnd.apply(oldConsole, args);\n  }\n};\n// Timestamps in console - end\n\nvar $logger = console;\n\nvar storage = new __WEBPACK_IMPORTED_MODULE_3_components_Storage__[\"a\" /* default */]();\n\nvar windowController = new __WEBPACK_IMPORTED_MODULE_2_components_Window__[\"a\" /* default */]();\n\nvar chromeApp = new __WEBPACK_IMPORTED_MODULE_0_ChromeApp__[\"a\" /* default */]($logger, window);\n\nvar syncFSLogger = {\n  log: function log() {\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    $logger.log('[SyncFS] ', args);\n  }\n};\n\nvar splashscreen = new __WEBPACK_IMPORTED_MODULE_1_components_Splashscreen__[\"a\" /* default */]();\nwindow.addEventListener('load', function () {\n  splashscreen.onBoundsChanged();\n});\n\nvar osLimiter = new __WEBPACK_IMPORTED_MODULE_12_components_OSLimiter__[\"a\" /* default */](['cros'], true, 'splashscreen');\n\n//const updateChecker = new UpdateChecker($logger);\n\nvar initApp = function initApp() {\n  $logger.debug('[App.js] On supported platform');\n\n  // Create the webview to hold the webGL\n  //<webview id=\"webgl\" src=\"webgl/index.html\" partition=\"persist:webgl\"></webview>\n  var webGLwebview = document.createElement('webview');\n  webGLwebview.id = 'webgl';\n  webGLwebview.setAttribute('src', 'webgl/index.html');\n  webGLwebview.setAttribute('partition', 'persist:webgl');\n\n  // Append webview to parent element\n  document.getElementById('parent').appendChild(webGLwebview);\n\n  setTimeout(function () {\n    document.getElementById('webgl').setZoomMode('disabled');\n  }, 1000);\n\n  document.getElementById('webgl').addEventListener('dialog', function (e) {\n    $logger.debug('[App.js] Dialog from webgl webview', e.messageText);\n  });\n\n  document.addEventListener('mousewheel', function (e) {\n    if (e.ctrlKey === true) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  });\n\n  chromeApp.initialize().then(function () {\n    chrome.runtime.getPlatformInfo(function (platformInfo) {\n      $logger.debug(chrome.runtime.getManifest().name + ' manifest version: ' + chrome.runtime.getManifest().version + ' starting on ' + platformInfo.os + ' ' + platformInfo.arch + ' - Chrome details(' + navigator.appVersion + ') - onLine: ' + navigator.onLine);\n    });\n\n    windowController.initialize(storage);\n\n    chromeApp.register('Killswitch', new __WEBPACK_IMPORTED_MODULE_11_components_Killswitch__[\"a\" /* default */]());\n    chromeApp.register('ExternalLink', new __WEBPACK_IMPORTED_MODULE_10_components_ExternalLink__[\"a\" /* default */]());\n    chromeApp.register('Splashscreen', splashscreen);\n    chromeApp.register('Storage', storage);\n    chromeApp.register('PlatformInfo', new __WEBPACK_IMPORTED_MODULE_4_components_PlatformInfo__[\"a\" /* default */]());\n    chromeApp.register('Audio', new __WEBPACK_IMPORTED_MODULE_6_components_Audio__[\"a\" /* default */]());\n    chromeApp.register('Video', new __WEBPACK_IMPORTED_MODULE_5_components_Video__[\"a\" /* default */](storage));\n    chromeApp.register('Content', new __WEBPACK_IMPORTED_MODULE_8_components_ContentViewerWebview__[\"a\" /* default */]({\n      id: 'contentViewer',\n      style: {\n        width: '600px',\n        position: 'absolute',\n        display: 'none'\n      },\n      partition: 'persist:webgl'\n    }));\n    chromeApp.register('Bluetooth', new __WEBPACK_IMPORTED_MODULE_7_components_Bluetooth__[\"a\" /* default */]($logger, window));\n    chromeApp.register('SyncFS', new __WEBPACK_IMPORTED_MODULE_9_components_SyncFS__[\"a\" /* default */](syncFSLogger, splashscreen));\n  })\n  // .then( () => {\n  // setTimeout(() => {\n  //     updateChecker.checkForUpdates();\n  // }, 15000); // set some delay so we minimize the chance of interfering with the normal startup flow\n  // })\n  .catch(function (err) {\n    console.error('ChromeApp failed registration of libraries', err);\n  });\n};\n\n// Check if OS is supported\nosLimiter.runOnApprovedOS(initApp);\n\n/***/ }),\n/* 28 */,\n/* 29 */\n/***/ (function(module, exports) {\n\nmodule.exports = LEGO_BLE_SDK;\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// chromeapp.bundle.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 27);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c3b1f8227955d8cd9346","export default class BaseModule {\n\n  getPublicFunctions() {\n    return Object.keys(this);\n  }\n\n  handle(message) {\n    const args = message.data.map((arg) => {\n      return arg;\n    });\n    return this[message.method].apply(null, args);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/BaseModule.js","let instance = null;\n\nexport default class MessageHandler {\n\n  constructor() {\n    if (!instance) {\n      instance = this;\n    }\n    return instance;\n  }\n\n  static getInstance() {\n    if (!instance) {\n      instance = new MessageHandler();\n    }\n\n    return instance;\n  }\n\n  static setWebGL(view) {\n    MessageHandler.getInstance().view = view;\n  }\n\n  static callWebGL(target, method, data) {\n    MessageHandler.getInstance().view.contentWindow.postMessage({\n      target,\n      method,\n      data\n    }, '*');\n  }\n\n  // NOTE(Catalin,22.03.2016): sender is currently ignored past this call.\n  static callUnity(sender, method, data) {\n    MessageHandler.getInstance().view.contentWindow.postMessage({\n      sender,\n      target: 'unity',\n      method,\n      data,\n    }, '*');\n  }\n\n  // Data gets stored into a shared memory arena between unity and js.\n  // Do the equivalent of callUnity(nil, unityCallback.method, metadata) after the data is ready.\n  static sendDataToUnity(data, metadata, transferID, unityCallback) {\n    MessageHandler.getInstance().view.contentWindow.postMessage({\n      target: \"sendUnityData\",\n      data: data,\n      metadata: metadata,\n      transferID: transferID,\n      unityCallback: unityCallback ? unityCallback : \"JSArrayBufferReady\",\n    }, '*');\n  }\n\n  // UnityApp will call sender[callbackName](metadata, data);\n  static requestDataFromUnity(transferID, sender, callbackName, metadata) {\n    MessageHandler.getInstance().view.contentWindow.postMessage({\n      target: \"requestUnityData\",\n      transferID: transferID,\n      sender: sender,\n      metadata: metadata,\n      callbackName: callbackName,\n    }, '*');\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/MessageHandler.js","let instance = null;\n\nexport default class MessageForwarder {\n  constructor() {\n    if (!instance) {\n      instance = this;\n    }\n    return instance;\n  }\n\n  static setAppWindow(appWindow) {\n    instance.appWindow = appWindow;\n  }\n\n  static setAppOrigin(appOrigin) {\n    instance.appOrigin = appOrigin;\n  }\n\n  static getAppWindow() {\n    return instance.appWindow;\n  }\n\n  static getAppOrigin() {\n    return instance.appOrigin;\n  }\n\n  handle(...args) {\n    MessageForwarder.forward(args.target, args.method, args.data);\n  }\n\n  static forward(method, target, data) {\n    if (MessageForwarder.getAppOrigin() && MessageForwarder.getAppWindow()) {\n      MessageForwarder.getAppWindow().postMessage({\n        sender: 'unity',\n        target,\n        method,\n        data,\n      }, MessageForwarder.getAppOrigin());\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/MessageForwarder.js","import BaseModule from 'components/BaseModule';\nimport MessageHandler from 'MessageHandler';\n\nexport default class Storage extends BaseModule{\n\n  constructor() {\n    super();\n    this.currentFileEntry = null;\n    this.savingFile = false;\n  }\n  \n  isSavingFile = ()  => {\n    return this.savingFile;\n  }\n\n  showFilePicker = (mimeType, filePath) => {\n    const fileTypes = [{\n      mimeTypes: [mimeType],\n    }];\n    chrome.fileSystem.chooseEntry({ type: 'openFile', accepts: fileTypes }, (entry) => {\n      if (!entry) {\n        return;\n      }\n\n      if (chrome.runtime.lastError) {\n        console.warn('showFilePicker - chooseEntry error: ', chrome.runtime.lastError.message);\n        return;\n      }\n\n\n      this.currentFileEntry = entry;\n      \n      const fileSplit = entry.name.split('.');\n      const fileExt = fileSplit[fileSplit.length-1];\n      \n      this.currentFileEntry.file( (file) => {\n        const saveFilePath = `${filePath}.${fileExt}`;\n        const dataURL = `uniwebview://FileSelectedFromPicker?FilePath=${saveFilePath}&MimeType=${mimeType}`;\n        this.saveFileToIndexDB(saveFilePath, file, dataURL);\n      });\n    });\n  }\n\n  saveFile = (fileBlob, extension, writeSuccessCallback, writeErrorCallback) => {\n    this.savingFile = true;\n    const config = { type: 'saveFile', suggestedName: `untitled.${extension}`, accepts: [ { extensions: [ `${extension}` ] } ] };\n    chrome.fileSystem.chooseEntry(config, (writableEntry) => {\n      if (chrome.runtime.lastError) {\n        console.warn('saveFile - chooseEntry error: ', chrome.runtime.lastError.message);\n        writeErrorCallback(chrome.runtime.lastError.message);\n        this.savingFile = false;\n        return;\n      }\n\n      if (!writableEntry) {\n        writeErrorCallback(chrome.runtime.lastError.message);\n        this.savingFile = false;\n        return;\n      }\n      writableEntry.createWriter((writer) => {\n        writer.onerror = (error) => {\n          writeErrorCallback(error);\n          this.savingFile = false;\n        };\n        writer.onwriteend = (e) => {\n          if (e.loaded > 0 && e.total > 0 && e.loaded === e.total)\n          {\n            writeSuccessCallback();\n            this.savingFile = false;\n          }\n        };\n\n        writer.truncate(fileBlob.size);\n        this.waitForIO(writer, () => {\n          writer.seek(0);\n          writer.write(fileBlob);\n        });\n      }, (error) => {\n          writeErrorCallback(error);\n          this.savingFile = false;\n      });\n    });\n  }\n\n  waitForIO(writer, callback) {\n    // set a watchdog to avoid eventual locking:\n    const start = Date.now();\n    // wait for a few seconds\n    const reentrant = () => {\n      if (writer.readyState === writer.WRITING && Date.now() - start < 4000) {\n        setTimeout(reentrant, 100);\n        return;\n      }\n      if (writer.readyState === writer.WRITING) {\n        // console.error( \"Write operation taking too long, aborting!\n        // (current writer readyState is \" + writer.readyState + \")\");\n        writer.abort();\n      }\n      else {\n        callback();\n      }\n    };\n    setTimeout(reentrant, 100);\n  }\n\n  saveFileToIndexDB = (filePath, fileBlob, dataURL) => {\n    MessageHandler.callWebGL('emscriptenFSHandler', 'saveFile', [{filePath, fileBlob, dataURL}]);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ../chromeos_resources/src/components/Storage.js","export default class SyncError {\n    constructor(message, code, reason) {\n        this.message = message ? message : 'undefined';\n        this.code = code ? code : 0; // 0 means NOT an HTML error.\n        this.reason = reason ? reason : '';\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/SyncError.js","import MessageForwarder from 'MessageForwarder';\nimport MessageHandler from 'MessageHandler';\n\nexport default class ChromeApp {\n  addProfilingUtils() {\n    window.profileBegin = function(tag, ...args) {\n      Array.prototype.unshift.call(args, \"<A-\"+tag+\"> \");\n      console.log.apply(console, args);\n    }\n    window.profileEnd = function(tag, ...args) {\n      Array.prototype.unshift.call(args, \"<B-\"+tag+\"> \");\n      console.log.apply(console, args);\n    }\n  }\n\n  constructor($logger, $window) {\n    this.addProfilingUtils();\n    this.webgl = null;\n\n    // Dependencies\n    this.$logger = $logger;\n    this.$window = $window;\n\n    this.listeners = {};\n  }\n\n  initialize() {\n    return new Promise((resolve) => {\n      this.$logger.debug('[CoreChromeApp] Initialize');\n      var loadCompleted = () => {\n        this.$window.addEventListener('message', (event) => {\n          this.handleMessage.call(this, event);\n        });\n        this.webgl = this.attachListeners('webgl', (view) => {\n          this.sendHelloMessage(view);\n          MessageHandler.setWebGL(view);\n          resolve();\n        });\n      };\n      // Have the document already loaded?\n      if ( this.$window.document.readyState === 'complete') {\n        loadCompleted();\n      } else { // If not => listen for load event\n        this.$window.addEventListener('load', loadCompleted);\n      }\n    });\n  }\n\n  register(listenerName, listenerInstance) {\n    this.listeners[listenerName] = listenerInstance;\n\n    // Setup listener in webgl context\n    this.webgl.contentWindow.postMessage({\n      type: 'register',\n      name: listenerName,\n      methods: listenerInstance.getPublicFunctions(),\n    }, '*');\n  }\n\n  remove(listenerName) {\n    delete this.listeners[listenerName];\n  }\n\n  sendHelloMessage(webview) {\n    webview.contentWindow.postMessage({\n      sender: 'hello',\n    }, '*');\n    this.$logger.debug(`Sent hello message to ${webview.id}`);\n  }\n\n  attachListeners(id, afterLoadCallback) {\n    const view = document.getElementById(id);\n\n    view.addEventListener('dialog', (event) => {\n      this.$logger.debug(`[${id}] dialog of type ${event.messageType} : ${event.messageText}`);\n      event.dialog.ok('');\n    });\n\n    view.addEventListener('consolemessage', (event) => {\n      this.$logger.debug(`[${id}] ${event.message}`);\n    });\n\n    view.addEventListener('contentload', () => {\n      this.$logger.debug(`Finished loading ${id}`);\n      if (afterLoadCallback) {\n        afterLoadCallback(view);\n      }\n    });\n\n    view.addEventListener('message', (event) => {\n      this.$logger.debug(`[${id}] - EVENT[message] - `, event);\n    });\n\n    return view;\n  }\n\n  handleMessage($event) {\n    // this.$logger.log('ChromeApp - handleMessage - Received message:', $event);\n\n    this.$window.listeners = this.listeners;\n\n    try {\n      this.listeners[$event.data.target].handle($event.data);\n    } catch (error) {\n      this.$logger.error('ChromeApp - handleMessage - No listener registered!', error);\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ChromeApp.js","import BaseModule from 'components/BaseModule';\n\n/**\n * Component which allows for only running a method if on an approved OS or in development mode\n *\n * To set development mode add the following line to the manifest:\n *\n * \"developmentMode\" : true,\n *\n * NOTE: This will produce a warning about \"Unrecognized manifest key 'developmentMode'.\"\n */\nexport default class OSLimiter extends BaseModule {\n\n\t/**\n\t * Constructors the OSLimiter component\n\t * @param  {Array}   approvedList         The list of OS' that should be approved. Default []\n\t * @param  {Boolean} allowDevelopmentMode If limiter should look for development mode or not. Default true\n\t * @param  {String}  parentElementId      Optional parameter specifying the ID of the parent element to \n\t *                                        append error message to. If not set, will append to body\n\t */\n\tconstructor(approvedList = [], allowDevelopmentMode = true, parentElementId ) {\n\t\tsuper();\n\n\t\tthis.approvedList = approvedList;\n\t\tthis.allowDevelopmentMode = allowDevelopmentMode;\n\t\tthis.parentElementId = parentElementId;\n\t}\n\n  // PUBLIC API\n  runOnApprovedOS = ( approved ) => {\n  \tvar service = this;\n  \tvar approvedFn = approved;\n\n    chrome.runtime.getPlatformInfo(function(info) {\n    \tif ( service.isSupportedOS( info.os ) || service.inDevelopmentMode() ) {\n    \t\tif ( approvedFn && typeof approvedFn === 'function' ) {\n    \t\t\tapprovedFn();\n    \t\t}\n    \t} else {\n    \t\tconsole.log('Unsupported OS and not configured for development mode');\n    \n\t\t    // Add unsupported class for html element\n\t\t    document.documentElement.className = 'unsupported';\n\n\t\t    var unsupportedOS = document.createElement('div');\n\t\t    unsupportedOS.id = 'unsupported';\n\t\t    // Set text from i18n\n\t\t    unsupportedOS.appendChild(document.createTextNode(chrome.i18n.getMessage('unsupportedOSMessage')));\n\n\t\t    var closeLink = document.createElement('a');\n\t\t    closeLink.appendChild(document.createTextNode(chrome.i18n.getMessage('closeApp')));\n\t\t    closeLink.className = 'close-button';\n\t\t    closeLink.onclick = function() {\n\t\t        window.close();\n\t\t    };\n\n\t\t    unsupportedOS.appendChild(closeLink);\n\n\t\t    // Append unsupported message to parent\n\t\t    if ( service.parentElementId ) {\n\t\t    \tdocument.getElementById(service.parentElementId).appendChild(unsupportedOS);\n\t\t    } else {\n\t\t    \tdocument.body.appendChild(unsupportedOS);\n\t\t    }\n    \t}\n    });\n  }\n\n  // END PUBLIC API\n\n  /**\n\t * Check if app is in development mode. \n\t * \n\t * @return {boolean} true if in development mode, false otherwise\n\t */\n\tinDevelopmentMode = () => {\n\t    return this.allowDevelopmentMode && !!chrome.runtime.getManifest().developmentMode;\n\t}\n\n\tisSupportedOS = ( os ) => {\n\t    return this.approvedList.indexOf( os ) !== -1;\n\t}\n}\n\n\n// WEBPACK FOOTER //\n// ./src/components/OSLimiter.js","import BaseModule from 'components/BaseModule';\nimport MessageHandler from 'MessageHandler';\n\nexport default class Splashscreen extends BaseModule {\n\n  constructor(options) {\n    super();\n\n    options = options || {};\n    this.splashscreenTagId = options.splashscreenTagId || 'splashscreen';\n    this.loadingBarId = options.loadingBarId || 'loadingBar';\n    this.imageWidth = options.imageWidth || 2048;\n    // Initially 5% to show a little progress from the start. If changed, remember to update CSS\n    this.currentProgress = options.initialProgress || 0.05;\n\n    chrome.app.window.current().onBoundsChanged.addListener(this.onBoundsChanged.bind(this));\n        \n    this.onBoundsChanged();\n\n    this.unityProgress = 0;\n    this.syncProgress = 0;\n    this.unityDone = false;\n  }\n\n  mainElement = () => {\n    if ( !this.splashscreenElement ) {\n      this.splashscreenElement = document.getElementById(this.splashscreenTagId);\n    }\n    return this.splashscreenElement;\n  };\n\n  barElement = () => {\n    if ( !this.loadingBar ) {\n      this.loadingBar = document.getElementById(this.loadingBarId);\n    }\n    return this.loadingBar;\n  };\n\n  hide = () => {\n    console.debug('[CoreSplashScreen] Invoking hide()');\n    this.mainElement().style.display = 'none';\n  };\n\n  show = () => {\n    console.debug('[CoreSplashScreen] Invoking show()');\n    const style = this.mainElement().style || {};\n    if (style.removeProperty) {\n        style.removeProperty('display');\n    } else {\n      style.display = '';\n    }\n    this.mainElement().style = style;\n  };\n  \n  unityDoneLoading = () => {\n    console.debug('[CoreSplashScreen] Unity done message');\n    this.unityProgress = 1;\n    this.unityDone = true;\n    this.updateTotalProgress();\n  };\n\n  // Progress from unity\n  updateProgress = (progress) => {\n    console.debug('[CoreSplashScreen] Updating unity progress', progress);\n    this.unityProgress = progress;\n    this.updateTotalProgress();\n  };\n\n  updateSyncProgress = (progress) => {\n    console.debug('[CoreSplashScreen] Updating sync progress', progress);\n    this.syncProgress = progress;\n    this.updateTotalProgress();\n  };\n\n  updateTotalProgress = () => {\n    var totalProgress = (this.unityProgress + this.syncProgress) / 2;\n\n    this.currentProgress = Math.max(this.currentProgress, totalProgress);\n    console.log('[CoreSplashScreen] Updating total progress', this.currentProgress);\n    //The full width from CSS minus margin\n    var fullWidth = this.currentProgress * 100;\n    \n    if( this.barElement() ) {\n      this.loadingBar.style.width = fullWidth + '%'; \n    }\n\n    if ( this.syncProgress === 1 && this.unityDone ) {\n      // Inform unity that the loading is done and it can show lobby\n      console.log('[CoreSplashScreen] Both sync and unity is ready');\n      MessageHandler.callUnity(null, 'JSFinishedLoading');\n    }\n  };\n  \n  onBoundsChanged = () => {\n\n  };\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/Splashscreen.js","// NOTE(Catalin): API is still very fluid, things may change.\n\nimport BaseModule from 'components/BaseModule';\nimport MessageHandler from 'MessageHandler';\nimport GoogleDrive from 'components/GoogleDrive';\nimport SyncError from 'components/SyncError';\n\n// TODO: adapt for offline scenarios\n// TODO: refactor, remove unused code\n\n/**\n * The RESUMABLE_UPLOAD_SIZE_THRESHOLD value controls which strategy is used for\n * uploading the file to Google Drive.\n *\n * If the file size is less than the threshold a multipart upload with the entire file uploaded in one request.\n * Google Drive documentation (as of September 2017) specifies that multipart upload\n * should not be done for files larger than 5MB.\n *\n * If the file size is larger than or equal to the threshold we will upload to Google Drive\n * using the resumable upload method, and upload the file in multiple chunks.\n *\n * @type {number}\n */\nwindow.GD_RESUMABLE_UPLOAD_SIZE_THRESHOLD = 0.5 * 1024 * 1024;\n\nexport default class SyncFS extends BaseModule {\n\n    constructor($logger, $splashscreen) {\n        super();\n        this.$logger = $logger;\n        this.$splashscreen = $splashscreen;\n        this._setup();\n    }\n\n    // SyncFS can be in various states during the app lifetime. Note that states annotated with a +\n    // in this list will have additional information stored in a `reasons` field. Error states will\n    // `reasons` will only exit when all reasons are resolved.\n    // SyncFS status format: {state:<string>, reasons:[<string>, <string>...]}\n\n    // States:\n    // 'uninitialized'      // Initialization has yet to happen, unity can do nothing with us.\n    // 'synced'             // Default state when nothing is happening, and anything can happen\n    // 'synchronizing'      // Sync work in progress, show spinner.\n    // +'offline'           // Something went wrong during upstream sync. The app will recover, but\n                            // users should know their data is not being synced.\n    // 'doing_big_sync'     // Sync work in progress, show big sync progress bar.\n    // +'failed_big_sync'   // Something went wrong during initial sync, and the app requires user\n                            // interaction to resume sync (user must be in the lobby).\n    // 'big_sync_recovered' // The app recovered from failed_big_sync. This should signal to the\n                            // user they move into a spot where the app is safe to sync (probably\n                            // the lobby).\n\n    // Reasons:\n    // 'manual_unauth'      // Sync was manually disabled by rejecting the google drive\n                            // authentication dialog.\n    // 'local_offline'      // A sync operation failed because we went offline.\n    // 'gdrive_offline'     // Communication to google drive failed and all immediate recovery\n                            // failed. Assuming google is offline and doing further exponential\n                            // backoff until we re-establish connection.\n\n    _setup() {\n        profileBegin(\"SyncFSInit\", \"Call _setup on SyncFS\");\n        var _this = this;\n\n        this.status = { state: 'uninitialized', reasons: [] };\n\n        this.initialized = false;\n        this.fileSyncIsPaused = false; // Does not affect syncing metadata, just pauses file upload/download;\n        this.syncInProgress = false;\n        this.isOnline = navigator.onLine;\n        this.needsFlushing = true;\n        this.masterFlushPromise = undefined;\n        this.pushingChangeIdx = -1;\n\n        this.syncMetadataPath = \"/.SyncMetadata\"; // stored only locally, /idbfs prefix added internally\n        this.syncMetadata = undefined;\n        this.googleDrive = undefined;\n\n        this.ioActionImpl = {\n            \"writeFile\" : this._GD_writeFile,\n            \"deleteFile\" : this._GD_deleteFile\n        };\n\n        var onlineListener = function(event) {\n            _this._updateOnlineStatus();\n        }\n\n        // Fun fact, these events are not triggered when using throttling in the inspector, 2 year old bug\n        // and I doubt anyone will ever fix it. https://bugs.chromium.org/p/chromium/issues/detail?id=422956\n        // You gotta kill your internet connection at an OS level to test these.\n        window.addEventListener('online',  onlineListener);\n        window.addEventListener('offline', onlineListener);\n\n        // This will fail when offline due to errors thrown by gapi, but will create a GoogleDrive\n        // object and set up this.googleDrive properly.\n        profileBegin(\"GoogleAuth\", \"start Google authentication\");\n\n        this.initGoogleDrive()\n        .then(() => {\n            this._debugLog('Google Drive API initialized');\n            profileEnd(\"GoogleAuth\", \"Google authentication complete\");\n            this._completeInitializationStep();\n        }).catch((error) => {\n            console.error(`Failed to initialize Google Drive API: ${error}`);\n            profileEnd(\"GoogleAuth\", \"Google authentication failed\");\n            this._completeInitializationStep();\n        });\n\n        this.idbToken = 0;\n        this.idbPromises = {};\n    }\n\n    // Initialization\n    ////////////////////////////////////////////////////////////////////////////////////////////////\n\n    // Should be called once emscripten has been loaded.\n    initializeFileSystem = () => {\n        if (this.syncMetadata)\n            return;\n\n        profileEnd(\"SyncRequest\", \"Sync request received\");\n        profileBegin(\"ReadMetadata\", \"Start reading metadata for syncfs\");\n\n        this.idbfsReverseFlush()\n        .then(() => {\n            return this.readSyncMetadata();\n        })\n        .then((metadata) => {\n            this._debugLog('Done reading sync metadata');\n            this.syncMetadata = metadata;\n            profileEnd(\"ReadMetadata\", \"Metadata received\");\n            this._completeInitializationStep();\n        });\n    };\n\n    // Initialization is done in 2 separate phases. Google auth and loading metadata. This waits for\n    // both to be completed and notifies unity when done.\n    _completeInitializationStep() {\n        if (!this.syncMetadata || !this.googleDrive) {\n            this._debugLog(\"_completeInitializationStep - Not yet fully complete [this.syncMetadata: \" + (this.syncMetadata ? \"Complete\" : \"N/A\" ) + \" , this.googleDrive: \" + (this.googleDrive ? \"Complete\": \"N/A\") + \"]\" );\n            return;\n        } // Init not done yet.\n        if (this.initialized) return; // already initialized\n\n        this.initialized = true;\n        profileEnd(\"SyncFSInit\", \"SyncFS initialization fully complete\");\n        if (this.googleDrive.access_token) {\n            MessageHandler.callUnity(\"SyncFS\", \"JSInitializationResult\", '');\n            this.performBigSync();\n        } else {\n            var target_state = \"failed_big_sync\";\n            var reasons = [];\n            if (!this.isOnline) reasons.push(\"local_offline\");\n            if (this.googleDrive.hasUserDeclinedAuth)\n            {\n                // Users declined google access. Stay offline.\n                reasons.push(\"manual_unauth\");\n            }\n            else if (this.googleDrive.access_token == undefined && reasons.length == 0)\n            {\n                // Authentication error, we can try again right away whenever the user goes to the lobby.\n                target_state = \"big_sync_recovered\";\n            }\n            else if (reasons.length == 0)\n            {\n                // If we get here, it probably means this.isOnline is faulty, we already handle all\n                // authentication errors above, and reading syncMetadata failures should be solved by now.\n                console.error(\"Failure condition was not handled during auth\");\n            }\n\n            this.attemptStatusChange(target_state, reasons);\n            MessageHandler.callUnity(\"SyncFS\", \"JSInitializationResult\", 'Error authenticating with google.');\n            this.updateBigSyncSyncProgress(100); // Skip big sync and notify unity that it's complete.\n        }\n    }\n\n    initGoogleDrive = () => {\n        var _this = this;\n        return new Promise((resolve, reject) => {\n            this._debugLog('Initializing Google Drive API');\n            var drive = new GoogleDrive(this.timestamp);\n            drive.initialize(_this).then(() => {\n                _this.googleDrive = drive;\n                resolve();\n            }, (syncError) => {\n                _this.googleDrive = drive;\n                reject(syncError);\n            });\n        });\n    };\n\n    reauthenticate = () => {\n        if (this.reauthenticating)\n            return;\n        this.reauthenticating = true;\n        this._debugLog(\"Reauthenticating with Google Drive\");\n        this.googleDrive.reauthenticate().then(() => {\n            this._debugLog(\"Successfully reauthenticated with Google Drive\");\n            this.solveStatusReason(\"manual_unauth\");\n            MessageHandler.callUnity(\"SyncFS\", \"JSReauthenticateResult\", true);\n        }).catch((authError) => {\n            this._debugLog(\"Failed to reauthenticate with Google Drive\");\n            MessageHandler.callUnity(\"SyncFS\", \"JSReauthenticateResult\", false);\n        }).then(() => {\n            this.reauthenticating = false;\n        });\n    };\n\n    // Status management\n    ////////////////////////////////////////////////////////////////////////////////////////////////\n\n    requestStatusUpdate = () => {\n        this.sendStatus();\n    };\n\n    // This method may add reasons to the current status, but will not remove reasons.\n    // Returns if the transition was possible or if we are already in that state.\n    attemptStatusChange(newState, newReasons) {\n        // Handle transitioning to the same state\n        newReasons = newReasons ? newReasons : [];\n        var oldState = this.status.state;\n        if (oldState == newState) {\n            var changed = false;\n            for (var i = newReasons.length - 1; i >= 0; i--) {\n                var idx = this.status.reasons.indexOf(newReasons[i]);\n                if (idx == -1) {\n                    changed = true;\n                    this.status.reasons.push(newReasons[i]);\n                }\n            }\n            if (changed) this.sendStatus();\n            return true;\n        }\n\n        if (this.status.reasons.length > 0) return false;\n\n        // Auto-solve error states when no reasons are presented.\n        if (newReasons.length == 0) {\n            if (newState == 'failed_big_sync') newState = 'big_sync_recovered';\n        }\n\n        // Legal state transition checks:\n        var legal = false;\n        switch(newState) {\n            case 'uninitialized': {\n            } break;\n            case 'synced': {\n                if (oldState == 'synchronizing') legal = true;\n            } break;\n            case 'synchronizing': {\n                if (oldState == 'synced' || oldState == 'offline' || oldState == 'doing_big_sync') legal = true;\n            } break;\n            case 'offline': {\n                if (oldState == 'synced' || oldState == 'synchronizing') legal = true;\n            } break;\n            case 'doing_big_sync': {\n                if (oldState == 'uninitialized' || oldState == 'big_sync_recovered') legal = true;\n            } break;\n            case 'failed_big_sync': {\n                if (oldState == 'doing_big_sync' ||\n                    oldState == 'uninitialized' || oldState == 'big_sync_recovered') legal = true;\n            } break;\n            case 'big_sync_recovered': {\n                if (oldState == 'failed_big_sync' || oldState == 'uninitialized' ||\n                    oldState == 'doing_big_sync') legal = true;\n            } break;\n        }\n        if (legal == false) return false;\n\n        // Do actual transition.\n        this.status.state = newState;\n        this.status.reasons = newReasons;\n        this.sendStatus();\n        if (window.ENABLE_DEBUG) {\n            this._debugLog(\"attemptStatusChange - newState: '\" + newState + \"' - reasons: \" + JSON.stringify(newReasons) + \"\");\n        }\n\n        /* LECQA-179: This will start retrying reconnect - work in progress\n        if (newReasons.indexOf(\"gdrive_offline\") !== -1) {\n            this.googleDrive.attemptGoogleReconnect();\n        }\n        */\n        return true;\n    }\n\n    errorStateForStatus(status)\n    {\n        if (status == 'doing_big_sync' || status == 'failed_big_sync' ||\n            status == 'uninitialized' || status == 'big_sync_recovered') return 'failed_big_sync';\n        return 'offline';\n    }\n\n    solveStatusReason = (reason) => {\n        var idx = this.status.reasons.indexOf(reason);\n        if (idx == -1) return;\n        this.status.reasons[idx] = this.status.reasons[this.status.reasons.length-1];\n        this.status.reasons.pop();\n\n        if (this.status.reasons.length == 0) {\n            if (this.status.state == \"failed_big_sync\") this.attemptStatusChange(\"big_sync_recovered\");\n            if (this.status.state == \"offline\") {\n                this.attemptStatusChange(\"synchronizing\");\n                this.pushNextChange();\n            }\n        } else {\n            this.sendStatus();\n        }\n    };\n\n    _updateOnlineStatus() {\n        // if (this.isOnline == navigator.onLine) return;\n\n        console.log(\"CHANGE ONLINE STATUS\", navigator.onLine);\n        this.isOnline = navigator.onLine;\n        if (this.isOnline) {\n            this.solveStatusReason(\"local_offline\");\n        } else {\n            this.attemptStatusChange(this.errorStateForStatus(this.status.state), [\"local_offline\"]);\n        }\n    }\n\n    pauseFileSync = () => {\n        this.fileSyncIsPaused = true;\n    };\n\n    resumeFileSync = () => {\n        this.fileSyncIsPaused = false;\n        this.pushNextChange();\n    };\n\n    sendStatus = () => {\n        MessageHandler.callUnity(\"SyncFS\", \"JSSyncStatusChanged\", JSON.stringify(this.status));\n    };\n\n    // IO action registry\n    ////////////////////////////////////////////////////////////////////////////////////////////////\n\n    // Action types:\n    // writeFile, deleteFile\n    addIOAction = (actionType, paths) => {\n        if (actionType !== 'writeFile' && actionType !== 'deleteFile') {\n            this._debugLog(`Unrecognized sync action type ${actionType}!`);\n            return;\n        }\n\n        var fileId = this._getFileID(paths[0]);\n        if (actionType === 'deleteFile') {\n            this.removePendingWriteActions(paths[0]);\n            if (!fileId) {\n                this._debugLog(`Canceling remote delete action for file ${paths[0]} - the file does not exist on Google Drive thus the request would have resulted in 403/404`);\n                return;\n            }\n        }\n\n        var changes = this.syncMetadata.pendingLocalChanges;\n        // merge subsequent writes to the same file into one action;\n        // any different operation performed on the file breaks the chain of merged actions;\n        // [writeFile:A, writeFile:A] => [writeFile:A] (merged)\n        // [writeFile:A, deleteFile:A, writeFile:A] => [writeFile:A, deleteFile:A, writeFile:A] (no merging)\n        // we could do more robust change merging to minimize network traffic but it doesn't seem worth it for now\n        var action;\n        if (actionType === 'writeFile') {\n            // find the last action performed on the given file\n            for (var i = changes.length - 1; i >= 0; --i) {\n                // don't merge with changes being currently pushed\n                if (i == this.pushingChangeIdx)\n                    continue;\n\n                if (changes[i].paths[0] === paths[0]) {\n                    if (changes[i].type === 'writeFile') {\n                        changes[i].timestamp = this.timestamp();\n                        action = changes[i];\n                    }\n                    break;\n                }\n            }\n        }\n        if (!action) {\n            action = {\n                type: actionType,\n                paths: paths,\n                timestamp: this.timestamp(),\n                fileId: fileId\n            };\n            changes.push(action);\n\n            this._debugLog(`Added IO action: ${action.type} ${action.paths[0]} ${action.paths[1]} ${action.timestamp}`, this.syncMetadata.pendingLocalChanges);\n        }\n\n        this.writeSyncMetadata(this.syncMetadata);\n        if (this.pushingChangeIdx == -1 && !this.fileSyncIsPaused) {\n            this.pushNextChange();\n        }\n\n        this.signalFlushRequired();\n        this.ensureStateIsFlushed();\n\n        return action;\n    };\n\n    removePendingWriteActions = (path) => {\n        var pushingChange;\n        if (this.pushingChangeIdx != -1) {\n            pushingChange = this.syncMetadata.pendingLocalChanges[this.pushingChangeIdx];\n        }\n\n        this.syncMetadata.pendingLocalChanges = this.syncMetadata.pendingLocalChanges.filter((change) => {\n            // only remove pending write actions\n            if (change.type !== 'writeFile')\n                return true;\n            // don't remove the change currently being pushed\n            if (change == pushingChange)\n                return true;\n            // remove the write action if the path matches\n            if (change.paths[0] === path) {\n                this._debugLog(`Removing pending write action (file deleted): ${change.paths[0]}, ${change.timestamp}`);\n                return false;\n            }\n            // keep other writes in the queue\n            return true;\n        });\n\n        if (pushingChange) {\n            this.pushingChangeIdx = this.syncMetadata.pendingLocalChanges.indexOf(pushingChange);\n        }\n    };\n\n    // File operations\n    ////////////////////////////////////////////////////////////////////////////////////////////////\n\n    saveFile = (path) => {\n        if (!this._initializationCheck())\n            return;\n        path = this.removeIdbfsFromPath(this._normalizePath(path));\n        var action = this.addIOAction('writeFile', [path]);\n        this.updateFileModifiedTime(path, action.timestamp, true);\n    };\n\n    updateFileModifiedTime = (path, modifiedTime, saveMetadata) => {\n        var file = this.syncMetadata.files[path];\n        if (!file) {\n            file = {name: path};\n            this.syncMetadata.files[path] = file;\n        }\n        file.modifiedTime = modifiedTime;\n        if (saveMetadata) {\n            this.writeSyncMetadata(this.syncMetadata);\n        }\n        this._debugLog(`Updated modified time of file ${path} to ${modifiedTime}`);\n    };\n\n    createDirectoryTree = (path) => {\n        // Do nothing, directory structure is stored implicitly in file names, e.g. file.name=\"a/b/c/file.txt\"\n    };\n\n    deleteFile = (path) => {\n        if (!this._initializationCheck())\n            return;\n        path = this.removeIdbfsFromPath(this._normalizePath(path));\n        this._deleteFile(path);\n        this.writeSyncMetadata(this.syncMetadata);\n    };\n\n    copyFile = (sourcePath, destPath) => {\n        if (!this._initializationCheck())\n            return;\n        sourcePath = this.removeIdbfsFromPath(this._normalizePath(sourcePath));\n        destPath = this.removeIdbfsFromPath(this._normalizePath(destPath));\n        this._copyFile(sourcePath, destPath, true);\n    };\n\n    moveFile = (sourcePath, destPath) => {\n        if (!this._initializationCheck())\n            return;\n        sourcePath = this.removeIdbfsFromPath(this._normalizePath(sourcePath));\n        destPath = this.removeIdbfsFromPath(this._normalizePath(destPath));\n        this._moveFile(sourcePath, destPath, true);\n    };\n\n    deleteDirectory = (path) => {\n        if (!this._initializationCheck())\n            return;\n\n        path = this.removeIdbfsFromPath(this._normalizePath(path)) + \"/\";\n\n        var keys = Object.keys(this.syncMetadata.files);\n        for (var idx = 0; idx < keys.length; ++idx) {\n            var key = keys[idx];\n            if (key.startsWith(path)) {\n                this._deleteFile(key);\n            }\n        }\n\n        this.writeSyncMetadata(this.syncMetadata);\n    };\n\n    copyDirectory = (sourcePath, destPath) => {\n        if (!this._initializationCheck())\n            return;\n\n        sourcePath = this.removeIdbfsFromPath(this._normalizePath(sourcePath)) + \"/\";\n        destPath = this.removeIdbfsFromPath(this._normalizePath(destPath)) + \"/\";\n\n        var len = sourcePath.length;\n        var keys = Object.keys(this.syncMetadata.files);\n        for (var idx = 0; idx < keys.length; ++idx) {\n            var key = keys[idx];\n            if (key.startsWith(sourcePath)) {\n                var destFilePath = destPath + key.substr(len);\n                this._copyFile(key, destFilePath, false);\n            }\n        }\n\n        this.writeSyncMetadata(this.syncMetadata);\n    };\n\n    moveDirectory = (sourcePath, destPath) => {\n        if (!this._initializationCheck())\n            return;\n\n        sourcePath = this.removeIdbfsFromPath(this._normalizePath(sourcePath)) + \"/\";\n        destPath = this.removeIdbfsFromPath(this._normalizePath(destPath)) + \"/\";\n\n        var len = sourcePath.length;\n        var keys = Object.keys(this.syncMetadata.files);\n        for (var idx = 0; idx < keys.length; ++idx) {\n            var key = keys[idx];\n            if (key.startsWith(sourcePath)) {\n                var destFilePath = destPath + key.substr(len);\n                this._moveFile(key, destFilePath, false);\n            }\n        }\n\n        this.writeSyncMetadata(this.syncMetadata);\n    };\n\n    // Private helpers\n    ////////////////////////////////////////////////////////////////////////////////////////////////\n\n    _debugLog = (...args) => {\n        console.log(Array.from(args).map((a) => {\n            try {\n                return JSON.parse(JSON.stringify(a));\n            } catch (e) {\n                return a;\n            }\n        }));\n    };\n\n    _initializationCheck = () => {\n        if (this.initialized) {\n            return true;\n        } else {\n            this._debugLog('Google Drive API is not initialized yet! Ignoring the call.');\n            return false;\n        }\n    };\n\n    _normalizePath = (path) => {\n        if (typeof path !== 'string') {\n            return path; // silently fail and do nothing.\n        }\n        path = ('/' + path).replace(/[\\\\\\/]+/g, '/');\n        path = path.replace(/\\/$/, '');\n        return path;\n    };\n\n    _getFileID = (path) => {\n        return this.syncMetadata.files[path] ?\n            this.syncMetadata.files[path].id :\n            undefined;\n    };\n\n    fetchRemoteFileList = () => {\n        return new Promise((resolve, reject) => {\n            this._debugLog(`Fetching remote file list`);\n            this.googleDrive.getFileList(\"\").then((files) => {\n                var allFiles = {};\n                files.forEach(function(file) {\n                    if (file) {\n                        allFiles[file.name] = file;\n                    }\n                });\n                resolve(allFiles);\n            }, (syncError) => {\n                this._debugLog(`Failed to fetch remote file list: ${syncError}`);\n                reject(syncError);\n            });\n        });\n    };\n\n    _deleteFile = (path) => {\n        this.addIOAction('deleteFile', [path]);\n        delete this.syncMetadata.files[path];\n    };\n\n    _copyFile = (sourcePath, destPath, saveMetadata) => {\n        var action = this.addIOAction('writeFile', [destPath]);\n        // will create new File entry with destPath and given timestamp,\n        // id is going to be updated based on the response from Google Drive\n        this.updateFileModifiedTime(destPath, action.timestamp, saveMetadata);\n    };\n\n    _moveFile = (sourcePath, destPath, saveMetadata) => {\n        this.addIOAction('deleteFile', [sourcePath]);\n        var action = this.addIOAction('writeFile', [destPath]);\n\n        this.syncMetadata.files[destPath] = this.syncMetadata.files[sourcePath];\n        delete this.syncMetadata.files[sourcePath];\n        this.syncMetadata.files[destPath].name = destPath;\n        delete this.syncMetadata.files[destPath].id;\n        this.updateFileModifiedTime(destPath, action.timestamp, saveMetadata);\n    };\n\n    // Realtime synchronization to Google Drive\n    ////////////////////////////////////////////////////////////////////////////////////////////////\n\n    // TODO(Catalin): Error handling and quota checks.\n    _GD_writeFile = (timestamp, fileId, path) => {\n        return new Promise((resolve, reject) => {\n            this.idbfsReadRawFile(path).then((data) => {\n                var fileId = this._getFileID(path);\n                if (data.byteLength < window.GD_RESUMABLE_UPLOAD_SIZE_THRESHOLD) {\n                    if (window.ENABLE_DEBUG) {\n                        this._debugLog(`_GD_writeFile :: Uploading file ${path} (${data.byteLength} bytes) as multipart upload`);\n                    }\n                    return this.googleDrive.uploadFile(fileId, path, data, timestamp);\n                } else {\n                    if (window.ENABLE_DEBUG) {\n                        this._debugLog(`_GD_writeFile :: Uploading file ${path} (${data.byteLength} bytes) as resumable upload`);\n                    }\n                    return this.googleDrive.uploadFileResumable(fileId, path, data, timestamp);\n                }\n            }).then((metadata) => {\n                this._debugLog(`Uploaded file ${path}`, metadata);\n                this.syncMetadata.files[path] = metadata;\n                this.writeSyncMetadata(this.syncMetadata);\n                resolve(metadata);\n            }).catch((syncError) => {\n                this._debugLog(`Failed to upload file ${path}`, syncError);\n                reject(syncError);\n            });\n        });\n    };\n\n    _GD_deleteFile = (timestamp, fileId, path) => {\n        return new Promise((resolve, reject) => {\n            this._debugLog('Delete GD file: ', path, fileId);\n            this.googleDrive.deleteFile(fileId, true).then((metadata) => {\n                this._debugLog(`Deleted Google Drive file ${path} (${fileId})`, metadata);\n                resolve();\n            }, (syncError) => {\n                this._debugLog(`Failed to delete GD file ${path} (${fileId})`, syncError);\n                reject(syncError);\n            });\n        });\n    };\n\n    _GD_copyFile = (timestamp, fileId, sourcePath, destPath) => {\n        return this._GD_writeFile(timestamp, undefined, destPath);\n    };\n\n    _GD_moveFile = (timestamp, fileId, sourcePath, destPath) => {\n        return this._GD_deleteFile(timestamp, fileId, sourcePath).then(() => {\n            return this._GD_writeFile(timestamp, undefined, destPath);\n        }).then((metadata) => {\n            resolve(metadata);\n        }).catch((syncError) => {\n            reject(syncError);\n        });\n    };\n\n    pushNextChange = (changeIndex) => {\n        if (this.pushingChangeIdx != -1 || this.syncInProgress) return;\n        if (!this.attemptStatusChange(\"synchronizing\")) return; // If we can't get into a \"synchronizing\" state, bail.\n        if (this.syncMetadata.pendingLocalChanges.length === 0) {\n            this.attemptStatusChange(\"synced\");\n            return;\n        }\n\n        var _this = this;\n\n        _this.pushingChangeIdx = changeIndex ? changeIndex : 0;\n        var change = _this.syncMetadata.pendingLocalChanges[_this.pushingChangeIdx];\n\n        function doActualPush() {\n            _this._debugLog(`Pushing change: ${change.paths[0]}`, change);\n\n            // perform the remote IO action\n            var actionPromise = _this.ioActionImpl[change.type].apply(this, [change.timestamp, change.fileId].concat(change.paths));\n            actionPromise.then((result) => {\n                // remove the action from the queue and persist the queue\n                _this.syncMetadata.pendingLocalChanges.shift();\n                _this.writeSyncMetadata(_this.syncMetadata);\n                // proceed with the next pending change\n                _this.finishPushingChange(_this.pushingChangeIdx);\n            }, (syncError) => {\n                _this.abortPushingChanges(syncError);\n            });\n        }\n\n        _this.ensureStateIsFlushed().then(doActualPush);\n    };\n\n    finishPushingChange = (nextChangeIdx) => {\n        this.pushingChangeIdx = -1;\n        if (nextChangeIdx < this.syncMetadata.pendingLocalChanges.length) {\n            this.pushNextChange(nextChangeIdx);\n        } else {\n            this.idbfsFlushChanges().then(() => {\n                this.attemptStatusChange(\"synced\");\n            });\n        }\n    };\n\n    abortPushingChanges(syncError) {\n        this.pushingChangeIdx = -1;\n        console.log(\"abortPushingChanges: \" + syncError.message);\n        if (syncError.message == \"The user did not approve access.\")\n            this.attemptStatusChange(\"offline\", [\"manual_unauth\"]);\n        else\n            this.attemptStatusChange(\"offline\", [\"gdrive_offline\"]);\n    }\n\n    // Big sync\n    ////////////////////////////////////////////////////////////////////////////////////////////////\n\n    performBigSync = () => {\n        this._debugLog(\"performBigSync()\");\n        profileBegin(\"BigSync\", \"Big sync request received, starting\");\n\n        if (!this._initializationCheck())\n            return;\n\n        if (this.syncInProgress) {\n            this._debugLog(\"performBigSync(): sync is already in progress, ignoring...\");\n            return;\n        }\n\n        if (!this.attemptStatusChange(\"doing_big_sync\")) {\n            this.failBigSync(new SyncError(\"transition_impossible\"));\n            return;\n        }\n\n        this.syncInProgress = true;\n\n        this.updateBigSyncSyncProgress(0);\n\n        // hosts the sync state\n        var sync = {};\n\n        // get local file list (sync metadata should be already loaded at this point)\n        sync.localFiles = JSON.parse(JSON.stringify(this.syncMetadata.files)); // copy the files registry as localFiles is meant to be a temporary, local object\n        // this._debugLog(\"Local files:\", sync.localFiles);\n        // compute local delete list\n        sync.localDeleteList = this.computeLocalDeleteList(this.syncMetadata.pendingLocalChanges);\n        this._debugLog(\"Local delete list:\", sync.localDeleteList);\n\n        profileBegin(\"BS_Flush\", \"Flush to ensure correct state\");\n        // Ensure correct local state.\n        this.idbfsFlushChanges().then(() => {\n            profileEnd(\"BS_Flush\", \"End flush\");\n            MessageHandler.callUnity(\"SyncFS\", \"JSMetadataStepComplete\");\n            profileBegin(\"BS_RemoteList\", \"Get remote file list\");\n            return this.fetchRemoteFileList();\n        })\n        // fetch remote file list\n        .then((files) => {\n            profileEnd(\"BS_RemoteList\", \"End remote list\");\n            profileBegin(\"BS_RemoteChanges\", \"Get remote changes since last sync\");\n            this.updateBigSyncSyncProgress(10);\n            sync.remoteFiles = files;\n            this._debugLog(\"Remote file list fetched, fetching remote changes\");\n            return this.fetchRemoteChangesSinceLastSync();\n        })\n        // fetch remote change list since last sync\n        .then((changeResponse) => {\n            profileEnd(\"BS_RemoteChanges\", \"End remote changes\");\n            profileBegin(\"BS_Changes\", \"Write metadata and compute changes\");\n            this.updateBigSyncSyncProgress(20);\n            this._debugLog(\"Remote changes response:\", changeResponse);\n            // remember the current start page token for the next sync\n            this.syncMetadata.lastStartPageToken = changeResponse.newStartPageToken;\n            this.writeSyncMetadata(this.syncMetadata);\n            // generate remote delete list\n            sync.remoteDeleteList = this.computeRemoteDeleteList(changeResponse.changes);\n            this._debugLog(\"Remote delete list:\", sync.remoteDeleteList);\n        })\n        // calculate changes that need to be applied between file systems\n        .then(() => {\n            this._debugLog(\"Calculating differences between remote FS and local FS\");\n            sync.remoteToLocalOps = this.mergeFileSystems(sync.remoteFiles, sync.remoteDeleteList, sync.localFiles, sync.localDeleteList, true);\n            this._debugLog(\"Calculating differences between local FS and remote FS\");\n            sync.localToRemoteOps = this.mergeFileSystems(sync.localFiles, sync.localDeleteList, sync.remoteFiles, sync.remoteDeleteList, false);\n            // prepare progress data\n            var numTotalOps = sync.remoteToLocalOps.length + sync.localToRemoteOps.length;\n            var numCompletedOps = 0;\n            sync.completeSyncMergeOperation = () => {\n                ++numCompletedOps;\n                this.updateBigSyncSyncProgress(20 + Math.round(70 * numCompletedOps / numTotalOps));\n            }\n        })\n        // merge remote FS changes into local FS\n        .then(() => {\n            profileEnd(\"BS_Changes\", \"End computing changes\");\n            profileBegin(\"BS_MergeAndMeta\", \"Start merging, writing metadata and flush\"); // merging is really short, clutters the profier.\n            this._debugLog(\"Merging remote FS changes into local FS\");\n            return Promise.all(\n                    sync.remoteToLocalOps.map((op) => {\n                        return op.func.apply(this, op.params)\n                                .then(() => {\n                            sync.completeSyncMergeOperation();\n                        });\n                    }))\n                    .catch((e) => {\n                        this._debugLog(\"Merging remote FS changes into local FS FAILED!! -- \" + JSON.stringify(e));\n                    });\n        })\n        // merge local FS changes into remote FS\n        .then(() => {\n            this._debugLog(\"Merging local FS changes into remote FS\");\n            return Promise.all(\n                    sync.localToRemoteOps.map((op) => {\n                        return op.func.apply(this, op.params)\n                                .then(() => {\n                            sync.completeSyncMergeOperation();\n                        });\n                    }))\n                    .catch((e) => {\n                        this._debugLog(\"Merging local FS changes into remote FS FAILED!! -- \" + JSON.stringify(e));\n                    });\n        })\n        .catch((syncError) => {\n            this._debugLog(\"Sync failed\", syncError);\n            this.failBigSync(syncError, true);\n\n            throw new SyncError(\"skip_writing_metadata\"); // Skip the other methods in the promise.\n        })\n        .then(() => {\n            // update sync metadata with remote file list, the filesystems should be the same at this point\n            this.syncMetadata.files = sync.remoteFiles;\n            // clear local pending changes queue - at this points both filesystems should be the same\n            this.syncMetadata.pendingLocalChanges = [];\n            this.writeSyncMetadata(this.syncMetadata);\n\n            return this.idbfsFlushChanges();\n        })\n        .then(() => {\n            profileEnd(\"BS_MergeAndMeta\", \"End writing metadata and flush\");\n            this.finishBigSync();\n        })\n        .catch((syncError) => {\n            if (syncError.message != \"skip_writing_metadata\") {\n                this._debugLog(\"Failed to write metadata:\", syncError); // NOTE(Catalin): I don't know if this is possible, it should not be...\n                throw \"Sync succeded, but something failed while writing metadata.\";\n            }\n        });\n    };\n\n    failBigSync = (syncError, reverseFlushNeeded) => {\n        // Revert sync changes\n        var _this = this;\n        var revertChanges = function() {\n            _this._debugLog(\"Big sync failed! - \" + JSON.stringify(syncError));\n\n            _this.syncInProgress = false;\n            if (syncError.message != \"transition_impossible\")\n            {\n                // TODO(Catalin): Other reasons may occur here?\n                if (syncError.message == \"The user did not approve access.\")\n                    _this.attemptStatusChange(\"failed_big_sync\", [\"manual_unauth\"]);\n                else if (_this.googleDrive.access_token == undefined)\n                    // No automatic recovery mechanism, but users have to manually restart big sync,\n                    // as they have to do authentication again.\n                    _this.attemptStatusChange(\"big_sync_recovered\");\n                else\n                {\n                    _this.attemptStatusChange(\"failed_big_sync\", [\"gdrive_offline\"]);\n                }\n\n            }\n\n            // Unity expects a \"JSBigSyncFinished\" event to exit loading.\n            _this.updateBigSyncSyncProgress(100);\n        };\n\n        if (reverseFlushNeeded) {\n            this.idbfsReverseFlush().then(revertChanges);\n        } else {\n            revertChanges();\n        }\n    };\n\n    finishBigSync = () => {\n        profileEnd(\"BigSync\", \"Successfully completed big sync\");\n        this._debugLog(\"Finished big sync!\");\n\n        // finish big sync\n        this.syncInProgress = false;\n        this.updateBigSyncSyncProgress(100);\n\n        // activate realtime sync\n        MessageHandler.callWebGL('SyncFS_IDB', 'startTrackingFileChanges', []);\n        this.attemptStatusChange(\"synchronizing\"); // TODO(Catalin): ok, see if/how status changes should trigger synchronization.\n        this.pushNextChange();\n    };\n\n    updateBigSyncSyncProgress = (progress) => {\n        if (progress === 0) {\n            MessageHandler.callUnity(\"SyncFS\", \"JSBigSyncStarted\");\n        }\n        MessageHandler.callUnity(\"SyncFS\", \"JSBigSyncProgress\", progress);\n        if (progress === 100) {\n            MessageHandler.callUnity(\"SyncFS\", \"JSBigSyncFinished\");\n        }\n\n        if (this.$splashscreen) {\n            this.$splashscreen.updateSyncProgress(progress / 100);\n        }\n    };\n\n    // Flushing\n    ////////////////////////////////////////////////////////////////////////////////////////////////\n\n    signalFlushRequired = () => {\n        this.needsFlushing = true;\n        this.internalNeedsFlushing = true;\n    };\n\n    ensureStateIsFlushed = () => {\n        var _this = this;\n        if (!_this.internalNeedsFlushing) return Promise.resolve();\n\n        _this.flushPromises = _this.flushPromises ? _this.flushPromises : [];\n\n        var p = new Promise((resolve, reject) => {\n            _this.flushPromises.push({ resolve: resolve, reject: reject });\n        });\n\n        if (_this.masterFlushPromise == undefined)\n        {\n            _this.masterFlushPromise = new Promise((resolve, reject) => {\n                function doFlush() {\n                    _this.needsFlushing = false;\n                    _this.idbfsFlushChanges().then(() => {\n                        if (!_this.needsFlushing) {\n                            _this.internalNeedsFlushing = false;\n                            resolve();\n                        } else {\n                            window.setTimeout(doFlush, 50);\n                        }\n                    });\n                }\n\n                doFlush();\n            });\n        }\n\n        _this.masterFlushPromise.then(() => {\n            var len = _this.flushPromises.length;\n            for (var i = len - 1; i >= 0; i--) {\n                _this.flushPromises[i].resolve();\n            }\n            _this.flushPromises = [];\n            _this.masterFlushPromise = undefined;\n        });\n\n        return p;\n    };\n\n    // IndexedDB IO helpers\n\n    removeIdbfsFromPath(path) {\n        return path.replace(/^\\/idbfs/, '');\n    }\n\n    idbfsGetPromiseToken = (resolve, reject) => {\n        var token = this.idbToken++;\n        this.idbPromises[token] = {\n            resolve: resolve,\n            reject: reject\n        };\n        return token;\n    };\n\n    idbfsResolvePromise = (token, result) => {\n        this.idbPromises[token].resolve(result);\n        delete this.idbPromises[token];\n    };\n\n    idbfsRejectPromise = (token, error) => {\n        this.idbPromises[token].reject(error);\n        delete this.idbPromises[token];\n    };\n\n    idbfsCreateDirectory = (path) => {\n        var idbfsPath = \"/idbfs\" + path;\n        MessageHandler.callWebGL('SyncFS_IDB', 'createDirectory', [idbfsPath]);\n    };\n\n    idbfsReadRawFile = (path) => {\n        return new Promise((resolve, reject) => {\n            var token = this.idbfsGetPromiseToken(resolve, reject);\n            MessageHandler.callWebGL('SyncFS_IDB', 'readRawFile', ['/idbfs' + path, token]);\n        });\n    };\n\n    idbfsReadTextFile = (path) => {\n        return new Promise((resolve, reject) => {\n            var token = this.idbfsGetPromiseToken(resolve, reject);\n            MessageHandler.callWebGL('SyncFS_IDB', 'readTextFile', ['/idbfs' + path, token]);\n        });\n    };\n\n    idbfsWriteRawFile = (path, data) => {\n        return new Promise((resolve, reject) => {\n            var token = this.idbfsGetPromiseToken(resolve, reject);\n            MessageHandler.callWebGL('SyncFS_IDB', 'writeRawFile', ['/idbfs' + path, data, token]);\n        });\n    };\n\n    idbfsWriteTextFile = (path, contents) => {\n        return new Promise((resolve, reject) => {\n            var token = this.idbfsGetPromiseToken(resolve, reject);\n            MessageHandler.callWebGL('SyncFS_IDB', 'writeTextFile', ['/idbfs' + path, contents, token]);\n        });\n    };\n\n    idbfsRemoveFile = (path) => {\n        return new Promise((resolve, reject) => {\n            MessageHandler.callWebGL('SyncFS_IDB', 'removeFile', ['/idbfs' + path]);\n            resolve();\n        });\n    };\n\n    idbfsReverseFlush() {\n        return new Promise((resolve, reject) => {\n            var token = this.idbfsGetPromiseToken(resolve, reject);\n            MessageHandler.callWebGL('SyncFS_IDB', 'reverseFlush', [token]);\n        });\n    }\n\n    idbfsFlushChanges = () => {\n        return new Promise((resolve, reject) => {\n            var token = this.idbfsGetPromiseToken(resolve, reject);\n            MessageHandler.callWebGL('SyncFS_IDB', 'flushChanges', [token]);\n        });\n    };\n\n    // IndexedDB raw IO callbacks\n\n    IDB_OnWriteComplete = (path, context) => {\n        this.idbfsResolvePromise(context);\n    };\n\n    IDB_OnReadComplete = (path, result, context) => {\n        if (result) {\n            this.idbfsResolvePromise(context, result);\n        } else {\n            this.idbfsRejectPromise(context, new SyncError(`Failed to read file ${path}`));\n        }\n    };\n\n    IDB_OnFileRemoved = (path) => {\n    };\n\n    IDB_OnDirectoryCreated = (path) => {\n    };\n\n    IDB_OnDirectoryRemoved = (path) => {\n    };\n\n    IDB_OnTrackedFileModified = (path) => {\n        this.saveFile(path);\n    };\n\n    IDB_OnChangesFlushed = (context) => {\n        this.idbfsResolvePromise(context);\n    };\n\n    // Sync metadata\n\n    readSyncMetadata = () => {\n        return new Promise((resolve, reject) => {\n            this.idbfsReadTextFile(this.syncMetadataPath)\n                .then((fileContent) => {\n                    var metadata = JSON.parse(fileContent);\n                    resolve(metadata);\n                }).catch((error) => {\n                    console.warn(\"Failed to read sync metadata - doesn't exist or is unreadable. Assuming empty metadata.\", error);\n                    var defaultMetadata = {\n                        // last startPageToken returned from the GD changes service\n                        lastStartPageToken: \"\",\n                        // local changes (IO actions) awaiting to be synced with GD\n                        pendingLocalChanges: [],\n                        // file full path => File object\n                        files: {}\n                    };\n                    resolve(defaultMetadata);\n                });\n        });\n    };\n\n    writeSyncMetadata = (metadata) => {\n        var metadataContents = JSON.stringify(metadata);\n        // this._debugLog(\"Sync metadata:\", metadata, metadataContents);\n        return this.idbfsWriteTextFile(this.syncMetadataPath, metadataContents);\n    };\n\n    // Big sync operations\n\n    // generates RFC 3339 compliant timestamp used by Google Drive REST API;\n    // always returns values in UTC\n    timestamp = () => {\n        function dateStringRFC3339(date) {\n            function pad(n) {\n                return n < 10 ? '0' + n : n;\n            }\n            return date.getUTCFullYear() + '-' +\n                pad(date.getUTCMonth() + 1) + '-' +\n                pad(date.getUTCDate()) +\n                'T' +\n                pad(date.getUTCHours()) + ':' +\n                pad(date.getUTCMinutes()) + ':' +\n                pad(date.getUTCSeconds()) + 'Z';\n        }\n        return dateStringRFC3339(new Date());\n    };\n\n    fetchRemoteChangesSinceLastSync = () => {\n        if (this.syncMetadata.lastStartPageToken.length > 0) {\n            return this.googleDrive.getChangeList(this.syncMetadata.lastStartPageToken);\n        } else {\n            return this.googleDrive.getChangeStartPageToken().then((response) => {\n                return Promise.resolve({\n                    changes: [],\n                    newStartPageToken: response.startPageToken\n                });\n            });\n        }\n    };\n\n    computeLocalDeleteList = (changes) => {\n        var removedFileIds = [];\n        changes.forEach((change) => {\n            if (change.type === \"deleteFile\" && change.fileId) {\n                removedFileIds.push(change.fileId);\n            }\n        });\n        return removedFileIds;\n    };\n\n    computeRemoteDeleteList = (changes) => {\n        var removedFileIds = [];\n        changes.forEach((change) => {\n            if (change.removed) {\n                removedFileIds.push(change.fileId);\n            }\n        });\n        return removedFileIds;\n    };\n\n    // returns a list of merge operations\n    mergeFileSystems = (srcFiles, srcDeleteList, destFiles, destDeleteList, srcIsRemote) => {\n        var srcFilePaths = Object.keys(srcFiles);\n        var destFilePaths = Object.keys(destFiles);\n        var ops = [];\n        var filesToDelete = [];\n        srcFilePaths.forEach((srcFilePath) => {\n            var srcFile = srcFiles[srcFilePath];\n            var op;\n            if (destFilePaths.includes(srcFilePath)) {\n                // file exists in destination file system\n                var destFile = destFiles[srcFilePath];\n                var srcFileModifiedDate = Date.parse(srcFile.modifiedTime);\n                var destFileModifiedDate = Date.parse(destFile.modifiedTime);\n                if (srcFileModifiedDate !== destFileModifiedDate) {\n                    // files are different, overwrite the older one with the newer one\n                    if (srcFileModifiedDate > destFileModifiedDate) {\n                        // copy from src to dest\n                        op = {func: this.copyFileToFilesystem, params: [srcFile, srcIsRemote, srcIsRemote ? srcFile.id : destFile.id]};\n                        destFile.modifiedTime = srcFile.modifiedTime;\n                    } else {\n                        // copy from dest to src\n                        op = {func: this.copyFileToFilesystem, params: [srcFile, !srcIsRemote, srcIsRemote ? srcFile.id : destFile.id]};\n                        srcFile.modifiedTime = destFile.modifiedTime;\n                    }\n                }\n            } else {\n                // file doesn't exist in destination file system\n                if (destDeleteList.includes(srcFile.id)) {\n                    // file is in the destination FS deletion list - remove from source FS\n                    op = {func: this.deleteFileFromFilesystem, params: [srcFile, srcIsRemote]};\n                    filesToDelete.push(srcFilePath);\n                } else {\n                    // file is NOT in the destination FS deletion list - copy from source FS to destination FS\n                    op = {func: this.copyFileToFilesystem, params: [srcFile, srcIsRemote]};\n                    destFiles[srcFilePath] = srcFile;\n                }\n            }\n            if (op) {\n                ops.push(op);\n            }\n        });\n        filesToDelete.forEach((srcFilePath) => {\n            delete srcFiles[srcFilePath];\n        });\n        return ops;\n    };\n\n    copyFileToFilesystem = (file, download, remoteFileId) => {\n        if (download) {\n            // download file from remote into local\n            this._debugLog(`copyFileToFilesystem: downloading ${file.name}`);\n            // this._debugLog(`copyFileToFilesystem: downloading ${file.name}`, file);\n            return this.googleDrive.downloadFile(file.id, file.name)\n                .then((data) => {\n                    return this.idbfsWriteRawFile(file.name, data);\n                }).then(() => {\n                    // notify Unity that Chrome-app specific PlayerPrefs file has been changed\n                    if (file.name === \"/.ChromePlayerPrefs\") {\n                        MessageHandler.callUnity(\"SyncFS\", \"JSReloadPlayerPrefs\");\n                    }\n                });\n        } else {\n            // upload file from local to remote\n            this._debugLog(`copyFileToFilesystem: uploading ${file.name} (remote file ID: ${remoteFileId})`);\n            return this.idbfsReadRawFile(file.name)\n                .then((data) => {\n                    if (data.byteLength < window.GD_RESUMABLE_UPLOAD_SIZE_THRESHOLD) {\n                        if (window.ENABLE_DEBUG) {\n                            this._debugLog(`copyFileToFilesystem :: copyFileToFilesystem - download: '${download}' - ${file.name} (${data.byteLength} bytes) as multipart upload`);\n                        }\n                        return this.googleDrive.uploadFile(remoteFileId, file.name, data, file.modifiedTime);\n                    } else {\n                        if (window.ENABLE_DEBUG) {\n                            this._debugLog(`copyFileToFilesystem :: copyFileToFilesystem - download: '${download}' - ${file.name} (${data.byteLength} bytes) as resumable upload`);\n                        }\n                        return this.googleDrive.uploadFileResumable(remoteFileId, file.name, data, file.modifiedTime);\n                    }\n                });\n        }\n    };\n\n    deleteFileFromFilesystem = (file, isRemoteFS) => {\n        if (isRemoteFS) {\n            // perform delete request\n            this._debugLog(`deleteFileFromFilesystem: deleting remote file ${file.name}`);\n            return this.googleDrive.deleteFile(file.id, false);\n        } else {\n            // remove from IndexedDB\n            this._debugLog(`deleteFileFromFilesystem: deleting local file ${file.name}`);\n            return this.idbfsRemoveFile(file.name);\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/SyncFS.js","import BaseModule from 'components/BaseModule';\nimport MessageHandler from 'MessageHandler';\n\nexport default class Audio extends BaseModule {\n\n    constructor() {\n        super();\n\n        this.audioContext = null;\n\n        this.recorder = null;\n        this.isAudioRecording = false;\n        this.isListening = false;\n        this.enabled = false;\n        this.audioBufferSize = 0;\n        this.audioWorker = new Worker('js/audioWorker.js');\n        this.audioWorker.postMessage({\n            command: 'init',\n            config: {},\n        });\n        this.audioRecordRTC = null;\n        this.audioStream = null;\n\n        this.recorder = null;\n        this.inputPoint = null;\n        this.realAudioInput = null;\n        this.zeroGain = null;\n        this.audioIntervalID = -1;\n    }\n\n    initAudio = (bufferSize) => {\n        this.audioBufferSize = bufferSize;\n        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;\n\n        window.AudioContext = window.AudioContext || window.webkitAudioContext;\n\n        this.audioContext = new AudioContext();\n    };\n\n    enableDisableAudio = (enable) => {\n        this.enabled = (enable === 'True');\n\n        if (this.enabled) {\n            navigator.getUserMedia({\n                audio: true,\n            }, (audioStream) => {\n                this.audioStream = audioStream;\n                this.setupVolumeListening();\n                this.audioIntervalID = setInterval(() => { this.getVolume(); }, 1000);\n            }, (error) => {\n                console.log(`The following error occured: ${error}`);\n            });\n        }\n        else {\n\n            this.teardownAudioRecording();\n            this.teardownVolumeListening();\n\n            if (this.audioStream) {\n                this.audioStream.stop();\n                this.audioStream = null;\n            }\n            clearInterval(this.audioIntervalID);\n        }\n    };\n\n    startRecording = () => {\n\n        this.isListening = false;\n        this.teardownVolumeListening();\n\n        this.setupAudioRecording();\n        if (this.audioRecordRTC) {\n            // this.isAudioRecording = true;\n            this.audioRecordRTC.startRecording();\n        } else {\n            console.info('startRecording - No audioRecordRTC instance - Skipping startRecording call');\n        }\n\n    };\n\n    stopRecording = (resumeListening) => {\n        if (this.isAudioRecording && this.enabled) {\n            if (this.audioRecordRTC) {\n                this.audioRecordRTC.stopRecording(() => {\n                    this.handleAudio(this.audioRecordRTC.toURL());\n                });\n            } else {\n                console.info('stopRecording - No audioRecordRTC instance - Skipping stopRecording call');\n            }\n\n        }\n\n        const newIsListening = resumeListening;\n        if (this.isListening != newIsListening && this.enabled) {\n            if (newIsListening) {\n                this.setupVolumeListening();\n            }\n            else {\n                this.teardownVolumeListening();\n            }\n        }\n        this.isListening = newIsListening;\n    };\n\n    handleAudio = (audioURL) => {\n        if (this.audioRecordRTC) {\n            let dataURL = `uniwebview://AudioRecorded?AudioDataURL=${audioURL}`;\n            MessageHandler.callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n        } else {\n            console.debug('Audio :: handleAudio - this.audioRecordRTC is null or undefined');\n        }\n        this.teardownAudioRecording();\n    };\n\n    setupAudioRecording = () => {\n        this.audioRecordRTC = new RecordRTC(this.audioStream, {\n            recorderType: StereoAudioRecorder,\n            type: 'audio',\n            numberOfAudioChannels: 1,\n            mimeType: 'audio/wav',\n            bufferSize: 0,\n            disableLogs: false\n        });\n        this.audioRecordRTC.onStateChanged.call = (state) => {\n            console.log('Audio :: Audio Recorder state changed: ', state);\n            this.isAudioRecording = (state['state'] === 'recording');\n        };\n    };\n\n    teardownAudioRecording = () => {\n        this.audioRecordRTC = null;\n    };\n\n    setupVolumeListening = () => {\n        if (this.audioStream) {\n            this.audioWorker.onmessage = (e) => {\n                switch (e.data.command) {\n                    case 'volume':\n                        this.sendVolume(e.data.volume);\n                        break;\n                    default:\n                        console.log('AudioController Unknow message');\n                        break;\n                }\n            };\n\n            this.recorder = this.audioContext.createScriptProcessor(this.audioBufferSize, 1, 1);\n            this.recorder.onaudioprocess = (e) => {\n                if (!this.isListening || !this.enabled) {\n                    return;\n                }\n\n                const inputData = e.inputBuffer.getChannelData(0);\n\n                this.audioWorker.postMessage({\n                    command: 'record',\n                    buffer: [inputData],\n                });\n            };\n\n            this.inputPoint = this.audioContext.createGain();\n            this.inputPoint.gain.setTargetAtTime(1, this.audioContext.currentTime, 0.015);\n\n            // Create an AudioNode from the stream.\n            this.realAudioInput = this.audioContext.createMediaStreamSource(this.audioStream);\n            this.realAudioInput.connect(this.inputPoint);\n\n\n            this.zeroGain = this.audioContext.createGain();\n            this.zeroGain.gain.setTargetAtTime(0.0, this.audioContext.currentTime, 0.015);\n            this.inputPoint.connect(this.zeroGain);\n            this.zeroGain.connect(this.audioContext.destination);\n\n            this.inputPoint.connect(this.recorder);\n            this.recorder.connect(this.audioContext.destination);\n        }\n    };\n\n    teardownVolumeListening = () => {\n        if (this.recorder) {\n            this.recorder.onaudioprocess = null;\n            this.recorder = null;\n        }\n\n        if (this.realAudioInput) {\n            this.realAudioInput.disconnect();\n            this.realAudioInput = null;\n        }\n\n        if (this.inputPoint) {\n            this.inputPoint.disconnect();\n            this.inputPoint = null;\n        }\n\n        if (this.zeroGain) {\n            this.zeroGain.disconnect();\n            this.zeroGain = null;\n        }\n    };\n\n    getVolume = () => {\n        if (this.isListening) {\n            this.audioWorker.postMessage(\n                {\n                    command: 'getVolume',\n                }\n            );\n        }\n    };\n\n    sendVolume = (clipVolume) => {\n        const dataURL = `uniwebview://AudioVolume?AudioVolumeValue=${clipVolume}`;\n        MessageHandler.callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ../chromeos_resources/src/components/Audio.js","import BaseModule from 'components/BaseModule';\nimport MessageHandler from 'MessageHandler';\nimport {\n        LegoDeviceManagerImpl,\n        LegoDevice,\n        LegoMotor,\n        LegoPiezoTonePlayer,\n        LegoRGBLight,\n        LegoTiltSensor,\n        LDSDKLogger,\n        IOType,\n        InputFormat\n} from './lego.components.blesdk';\n\n\nlet instance = null;\nlet bleManagerInstance = null;\n\nif (window) {\n    window.LDSDKLogger = LDSDKLogger;\n    window.LDM = bleManagerInstance;\n}\n\n\nexport class Helper {\n\n    constructor() {\n        if (!instance) {\n            instance = this;\n        }\n        return instance;\n    }\n\n    static getInstance() {\n        if (!instance) {\n            instance = new Helper();\n        }\n\n        return instance;\n    }\n\n    static sendMessage(methodName, payload) {\n        MessageHandler.callWebGL('bluetoothHandler', 'sendData', [{method: methodName, data: JSON.stringify(payload)}]);\n    }\n\n}\n\n\n/****************************************************************************\n    Simple object functions for wrapping sdk data to simpler representations\n******************************************************************************/\nfunction getSimpleRevision(legoFirmwareRevision) {\n    if (!legoFirmwareRevision || legoFirmwareRevision === null) {\n        // HardwareRevision is usually null, this is a fallback for that case\n        return {\n            MajorVersion: 'N/A',\n            MinorVersion: 'N/A',\n            BugFixVersion: 'N/A',\n            BuildNumber: 'N/A'\n        };\n    }\n    return {\n        MajorVersion: legoFirmwareRevision.majorVersion,\n        MinorVersion: legoFirmwareRevision.minorVersion,\n        BugFixVersion: legoFirmwareRevision.bugFixVersion,\n        BuildNumber: legoFirmwareRevision.buildNumber\n    };\n}\n\nfunction getSimpleRevisionString(legoFirmwareRevision) {\n    var revisionObj = getSimpleRevision(legoFirmwareRevision);\n    return revisionObj.MajorVersion + '.' + revisionObj.MinorVersion + '.' + revisionObj.BugFixVersion + '.' + revisionObj.BuildNumber;\n}\n\nfunction getSimpleDeviceInfo(legoDeviceInfo) {\n    if (!legoDeviceInfo || legoDeviceInfo === null) {\n        // console.warn('WRAPPER :: legoDeviceInfo is not defined or null');\n        return {\n            FirmwareRevision: getSimpleRevisionString(),\n            HardwareRevision: getSimpleRevisionString(),\n            SoftwareRevision: getSimpleRevisionString(),\n            ManufacturerName: 'N/A'\n        };\n    }\n    return {\n        FirmwareRevision: getSimpleRevisionString(legoDeviceInfo.firmwareRevision),\n        HardwareRevision: getSimpleRevisionString(legoDeviceInfo.hardwareRevision),\n        SoftwareRevision: getSimpleRevisionString(legoDeviceInfo.softwareRevision),\n        ManufacturerName: legoDeviceInfo.manufacturerName && legoDeviceInfo.manufacturerName !== null ? legoDeviceInfo.manufacturerName : 'N/A'\n    };\n}\n\nfunction getSimpleLegoDevice(legoBluetoothDevice) {\n    if (!legoBluetoothDevice || legoBluetoothDevice === null) {\n        // console.warn('WRAPPER :: legoBluetoothDevice is not defined or null');\n        return {\n            DeviceID: 'N/A'\n        };\n    }\n\n    return {\n        DeviceID: legoBluetoothDevice.deviceId,\n        DeviceName: legoBluetoothDevice.deviceName,\n        ButtonState: legoBluetoothDevice.isButtonPressed,\n        BatteryLevel: legoBluetoothDevice.batteryLevel,\n        LowVoltageState: legoBluetoothDevice.isLowVoltage,\n        DeviceInfo: getSimpleDeviceInfo(legoBluetoothDevice.deviceInfo),\n        ConnectedState: legoBluetoothDevice.connectState - 1,\n        Category: legoBluetoothDevice.category,\n        SupportedFunctions: legoBluetoothDevice.supportedFunctions,\n        LastConnectedNetworkId: legoBluetoothDevice.lastConnectedNetworkId\n    };\n\n}\n\nfunction getSimpleInputFormat(inputFormat) {\n    if (!inputFormat || inputFormat === null) {\n        return {};\n    }\n\n    return {\n        Revision: inputFormat.revision,\n        ConnectID: inputFormat.connectId,\n        TypeID: inputFormat.typeId,\n        Mode: inputFormat.mode,\n        DeltaInterval: inputFormat.deltaInterval,\n        Unit: inputFormat.unit,\n        NotificationsEnabled: inputFormat.notificationsEnabled\n    };\n}\n\nfunction getSimpleConnectInfo(legoConnectInfo) {\n    if (!legoConnectInfo || legoConnectInfo === null) {\n        // console.warn('WRAPPER :: legoConnectInfo is not defined or null');\n        return {};\n    }\n    return {\n        ConnectID: legoConnectInfo.connectId,\n        HubIndex: legoConnectInfo.hubIndex,\n        Type: legoConnectInfo.type,\n        HardwareRevision: getSimpleRevisionString(legoConnectInfo.hardwareVersion),\n        SoftwareRevision: getSimpleRevisionString(),\n        FirmwareRevision: getSimpleRevisionString(legoConnectInfo.firmwareVersion)\n    };\n}\n\nfunction getSimpleServiceData(legoServiceData, serviceType) {\n    if (!legoServiceData || legoServiceData === null) {\n        console.warn('WRAPPER :: getSimpleServiceData legoService is not defined or null');\n        return {};\n    }\n\n    const result = {};\n    switch (serviceType) {\n        case(IOType.IO_TYPE_MOTOR):\n            result.Power = legoServiceData.power;\n            break;\n        case(IOType.IO_TYPE_VOLTAGE):\n            result.MilliVolts = legoServiceData.valueAsMilliVolts;\n            break;\n        case(IOType.IO_TYPE_CURRENT):\n            result.MilliAmp = legoServiceData.valueAsMilliAmps;\n            break;\n        case(IOType.IO_TYPE_PIEZO_TONE_PLAYER):\n            break;\n        case(IOType.IO_TYPE_RGB_LIGHT) :\n            result.RGBLightMode = legoServiceData.rgbMode;\n            var color = legoServiceData.color;\n            result.Color = {R: color.getRed(), G: color.getGreen(), B: color.getBlue(), A: 1};\n            var defaultColor = legoServiceData.defaultColor;\n            result.DefaultColor = {\n                R: defaultColor.getRed(),\n                G: defaultColor.getGreen(),\n                B: defaultColor.getBlue(),\n                A: 1\n            };\n            result.ColorIndex = legoServiceData.colorIndex;\n            result.DefaultColorIndex = legoServiceData.defaultColorIndex;\n            break;\n        case(IOType.IO_TYPE_TILT_SENSOR) :\n            result.Angle = getSimpleTiltSensorAngle(legoServiceData.angle);\n            result.Crash = getSimpleTiltSensorCrash(legoServiceData.crash);\n            result.TiltSensorDirection = legoServiceData.direction;\n            result.TiltSensorMode = legoServiceData.tiltSensorMode;\n            break;\n        case(IOType.IO_TYPE_MOTION_SENSOR) :\n            result.Count = legoServiceData.count;\n            result.Distance = legoServiceData.distance;\n            result.MotionSensorMode = legoServiceData.motionSensorMode;\n            break;\n        case(IOType.IO_TYPE_GENERIC) :\n            break;\n    }\n    return result;\n}\n\nfunction getSimpleService(legoService) {\n    if (!legoService || legoService === null) {\n        // console.warn('WRAPPER :: legoService is not defined or null');\n        return {};\n    }\n\n    return {\n        DeviceID: legoService.deviceId,\n        IsInternalService: legoService.isInternalService,\n        ServiceName: legoService.serviceName,\n        DefaultInputFormat: getSimpleInputFormat(legoService.defaultInputFormat),\n        InputFormat: getSimpleInputFormat(legoService.inputFormat),\n        ConnectInfo: getSimpleConnectInfo(legoService.connectInfo),\n        ServiceData: getSimpleServiceData(legoService.serviceData, legoService.connectInfo.type)\n    };\n}\n\nfunction getSimpleTiltSensorAngle(legoTiltSensorAngle) {\n    if (!legoTiltSensorAngle || legoTiltSensorAngle === null) {\n        // console.warn('WRAPPER :: legoTiltSensorAngle is not defined or null');\n        return {};\n    }\n    return {\n        X: legoTiltSensorAngle.x,\n        Y: legoTiltSensorAngle.y\n    };\n}\n\nfunction getSimpleTiltSensorCrash(legoTiltSensorCrash) {\n    if (!legoTiltSensorCrash || legoTiltSensorCrash === null) {\n        // console.warn('WRAPPER :: legoTiltSensorCrash is not defined or null');\n        return {};\n    }\n    return {\n        X: legoTiltSensorCrash.x,\n        Y: legoTiltSensorCrash.y,\n        Z: legoTiltSensorCrash.z\n    };\n}\n\n\n\nclass DevicesCallbackListenerImpl {\n\n    constructor(bluetooth) {\n        this.bluetooth = bluetooth;\n        this.deviceListeners = new Map();\n        this.deviceToListenerId = new Map();\n    }\n\n    checkAndRegisterDeviceCallback(address) {\n        if (!this.deviceListeners.has(address)) {\n            const listener = new DeviceCallbackListener();\n            this.deviceListeners.set(address, listener);\n            const listenerId = bleManagerInstance.registerDeviceCallbackListener(address, listener);\n            this.deviceToListenerId.set(address, listenerId);\n            LDSDKLogger.info(`WRAPPER :: checkAndRegisterDeviceCallback - registered Device callback listener for ${address} - with listenerId: ${listenerId}`);\n        }\n    }\n\n    /**\n     * This function is called whenever a new device not previously seen in a scan is discovered.\n     *\n     * @param legoBluetoothDevice\n     */\n    onDeviceAppeared(legoBluetoothDevice) {\n        LDSDKLogger.info(`WRAPPER :: onDeviceAppeared(${legoBluetoothDevice.deviceName} [${legoBluetoothDevice.deviceId}]`);\n        this.checkAndRegisterDeviceCallback(legoBluetoothDevice.deviceId);\n        var legoDevice = getSimpleLegoDevice(legoBluetoothDevice);\n        if (this.bluetooth.addDevice(legoBluetoothDevice)) {\n            Helper.sendMessage('OnDeviceAppeared', legoDevice);\n        }\n    }\n\n    /**\n     * If a device previously available during scanning no longer appears in scans, this function is called.\n     * @param legoBluetoothDevice\n     */\n    onDeviceDisappeared(legoBluetoothDevice) {\n        LDSDKLogger.info(`WRAPPER :: onDeviceDisappeared(${legoBluetoothDevice.deviceName} [${legoBluetoothDevice.deviceId}]`);\n        this.checkAndRegisterDeviceCallback(legoBluetoothDevice.deviceId);\n        var legoDevice = getSimpleLegoDevice(legoBluetoothDevice);\n        if (legoDevice.ConnectedState !== 1) {\n            if (LDSDKLogger.isDebugEnabled()) {\n                LDSDKLogger.debug('WRAPPER :: onDeviceDisappeared - Update connectedState to disconnected not' +\n                                  ' advertising when the device has disappeared');\n            }\n            legoDevice.ConnectedState = 1; // When the device disappears set the state to not advertising\n        }\n\n        Helper.sendMessage('OnDeviceDisappeared', legoDevice);\n        this.bluetooth.removeDevice(legoBluetoothDevice);\n    }\n\n    /**\n     * This function is called immediately before the sdk starts connecting to a device.\n     * If a scan is running, it will be stopped.\n     *\n     * @param legoBluetoothDevice\n     */\n    onWillStartConnectingToDevice(legoBluetoothDevice) {\n        LDSDKLogger.info(`WRAPPER :: onWillStartConnectingToDevice(${legoBluetoothDevice.deviceName} [${legoBluetoothDevice.deviceId}]`);\n        this.checkAndRegisterDeviceCallback(legoBluetoothDevice.deviceId);\n        var legoDevice = getSimpleLegoDevice(legoBluetoothDevice);\n        Helper.sendMessage('OnWillStartConnectingToDevice', legoDevice);\n    }\n\n    /**\n     * This function is called when the device has connected and the SDK starts querying the device for its\n     * services and characteristics. The device is not yet ready to be queried see @link\n     * onDidFinishInterrogatingDevice instead.\n     *\n     * @param legoBluetoothDevice\n     */\n    onDidStartInterrogatingDevice(legoBluetoothDevice) {\n        LDSDKLogger.info(`WRAPPER :: onDidStartInterrogatingDevice(${legoBluetoothDevice.deviceName} [${legoBluetoothDevice.deviceId}]`);\n        this.checkAndRegisterDeviceCallback(legoBluetoothDevice.deviceId);\n        if (backgroundPage) {\n            backgroundPage.addDeviceAddress(legoBluetoothDevice.deviceId);\n        }\n        var legoDevice = getSimpleLegoDevice(legoBluetoothDevice);\n        Helper.sendMessage('OnDidStartInterrogatingDevice', legoDevice);\n    }\n\n    /**\n     * When the device has connected, and its services and characteristics have been discovered the connect has\n     * completed and the device is ready for use.\n     *\n     * @param legoBluetoothDevice\n     */\n    onDidFinishInterrogatingDevice(legoBluetoothDevice) {\n        LDSDKLogger.info(`WRAPPER :: onDidFinishInterrogatingDevice(${legoBluetoothDevice.deviceName} [${legoBluetoothDevice.deviceId}]`);\n        this.checkAndRegisterDeviceCallback(legoBluetoothDevice.deviceId);\n        var legoDevice = getSimpleLegoDevice(legoBluetoothDevice);\n        bleManagerInstance.scan(); // TODO: Do this from Unity instead - and only if the connect\n        // dialog is shown\n        Helper.sendMessage('OnDidFinishInterrogatingDevice', legoDevice);\n    }\n\n    /**\n     * When we have successfully disconnected from a device (or the device disconnects).\n     *\n     * @param legoBluetoothDevice\n     */\n    onDidDisconnectFromDevice(legoBluetoothDevice) {\n        LDSDKLogger.info(`WRAPPER :: onDidDisconnectFromDevice(${legoBluetoothDevice.deviceName} [${legoBluetoothDevice.deviceId}]`);\n        this.checkAndRegisterDeviceCallback(legoBluetoothDevice.deviceId);\n        var legoDevice = getSimpleLegoDevice(legoBluetoothDevice);\n        if (backgroundPage) {\n            backgroundPage.removeDeviceAddress(legoBluetoothDevice.deviceId);\n        }\n        Helper.sendMessage('OnDidDisconnectFromDevice', legoDevice);\n    }\n\n    /**\n     * Called when a a connection attempt fails\n     *\n     * @param legoBluetoothDevice\n     */\n    onDidFailToConnectToDevice(legoBluetoothDevice) {\n        LDSDKLogger.info(`WRAPPER :: onDidFailToConnectToDevice(${legoBluetoothDevice.deviceName} [${legoBluetoothDevice.deviceId}]`);\n        this.checkAndRegisterDeviceCallback(legoBluetoothDevice.deviceId);\n        var legoDevice = getSimpleLegoDevice(legoBluetoothDevice);\n        bleManagerInstance.scan(); // TODO: Do this from Unity instead - and only if the connect\n        // dialog is shown\n        if (backgroundPage) {\n            backgroundPage.removeDeviceAddress(legoBluetoothDevice.deviceId);\n        }\n        Helper.sendMessage('OnDidFailToConnectToDevice', legoDevice);\n    }\n\n}\n\nclass DeviceCallbackListener {\n\n    constructor() {\n        this.serviceCallbackListener = new ServiceCallbackListener();\n        this.services = new Map();\n        this.serviceListeners = new Map();\n    }\n\n    didUpdateDeviceInfo(device, deviceInfo, error) {\n        if (LDSDKLogger.isTraceEnabled()) {\n            LDSDKLogger.trace('WRAPPER :: Bluetooth.js didUpdateDeviceInfo(device: ', device, ', deviceInfo:', deviceInfo, ', error:', error, ')');\n        }\n        var legoDevice = getSimpleLegoDevice(device);\n        legoDevice.DeviceInfo = getSimpleDeviceInfo(deviceInfo);\n        Helper.sendMessage('DidUpdateDeviceInfo', legoDevice);\n    }\n\n    didChangeButtonState(device, buttonPressed) {\n        if (LDSDKLogger.isTraceEnabled()) {\n            LDSDKLogger.trace('WRAPPER :: Bluetooth.js didChangeButtonState(device: ', device, ', buttonPressed:', buttonPressed);\n        }\n        var legoDevice = getSimpleLegoDevice(device);\n        Helper.sendMessage('DidChangeButtonState', legoDevice);\n    }\n\n    didUpdateLowVoltageState(device, lowVoltage) {\n        if (LDSDKLogger.isTraceEnabled()) {\n            LDSDKLogger.trace('WRAPPER :: Bluetooth.js didUpdateLowVoltageState(device: ', device, ', lowVoltage:', lowVoltage);\n        }\n        var legoDevice = getSimpleLegoDevice(device);\n        Helper.sendMessage('DidUpdateLowVoltageState', legoDevice);\n    }\n\n    didUpdateBatteryLevel(device, batteryLevel) {\n        if (LDSDKLogger.isTraceEnabled()) {\n            LDSDKLogger.trace('WRAPPER :: Bluetooth.js didUpdateBatteryLevel(device: ', device, ', batteryLevel:', batteryLevel);\n        }\n        var legoDevice = getSimpleLegoDevice(device);\n        Helper.sendMessage('DidUpdateBatteryLevel', legoDevice);\n    }\n\n    didChangeNameFrom(device, oldName, newName) {\n        if (LDSDKLogger.isTraceEnabled()) {\n            LDSDKLogger.trace('WRAPPER :: Bluetooth.js didChangeNameFrom(device: ', device, ', oldName:', oldName, 'newName:',newName);\n        }\n        var legoDevice = getSimpleLegoDevice(device);\n        Helper.sendMessage('DidChangeNameFrom', legoDevice);\n    }\n\n    didFailToAddServiceWithError(device, error) {\n        var legoDevice = getSimpleLegoDevice(device);\n        Helper.sendMessage('DidFailToAddServiceWithError', legoDevice);\n    }\n\n    didRemoveService(device, legoService) {\n        if (LDSDKLogger.isTraceEnabled()) {\n            LDSDKLogger.trace('WRAPPER :: Bluetooth.js didRemoveService(device: ', device, ', legoService:', legoService);\n        }\n        const connectId = legoService.connectInfo.connectId;\n        var simpleService = getSimpleService(legoService);\n        if (device === null || !device) {\n            LDSDKLogger.error('WRAPPER :: didRemoveService device is null');\n        }\n        simpleService.DeviceID = device.deviceId;\n        simpleService.ConnectID = connectId;\n\n        const listenerId = this.serviceListeners.get(connectId);\n        bleManagerInstance.unregisterServiceCallbackListener(device.deviceId, connectId, listenerId);\n        this.serviceListeners.delete(connectId);\n\n        Helper.sendMessage('DidRemoveService', simpleService);\n    }\n\n    didAddService(device, legoService) {\n        if (device === null || !device) {\n            LDSDKLogger.error('WRAPPER :: didAddService device is null');\n        }\n\n        const connectId = legoService.connectInfo.connectId;\n        if (this.services.has(connectId) && this.serviceListeners.has(connectId)) {\n            const listenerId = this.serviceListeners.get(connectId);\n            bleManagerInstance.unregisterServiceCallbackListener(device.deviceId, connectId, listenerId);\n            this.serviceListeners.delete(connectId);\n            this.services.delete(connectId);\n        }\n\n        this.services.set(connectId, legoService);\n        var simpleService = getSimpleService(legoService);\n        simpleService.DeviceID = device.deviceId;\n        if (LDSDKLogger.isInfoEnabled()) {\n            LDSDKLogger.info('WRAPPER :: Bluetooth.js didAddService(device: ' + device.deviceName + ' ['+ device.deviceId +'], legoService:' + legoService.serviceName + ', connectInfo: ' + legoService.connectInfo);\n        }\n        const listenerId = bleManagerInstance.registerServiceCallbackListener(device.deviceId, connectId, this.serviceCallbackListener);\n        this.serviceListeners.set(connectId, listenerId);\n        Helper.sendMessage('DidAddService', simpleService);\n    }\n}\n\n\n/**\n * Each connected LegoService (Motor, MotionSensor, TiltSensor, RGBLight etc) offers a callback interface so the client\n * can get notifications of value updates.\n *\n * They all have a registerCallbackListener(listener) that returns an id and a\n * unregisterCallbackListener(listenerId) function for unregistering.\n *\n * The ServiceCallbackListener is an example implementation of such a listener showing all the possible methods that\n * can be invoked.\n */\nclass ServiceCallbackListener {\n\n    didUpdateInputFormat(legoService, oldFormat, inputFormat) {\n        var simpleService = getSimpleService(legoService);\n        simpleService.OldInputFormat = getSimpleInputFormat(oldFormat);\n        simpleService.NewInputFormat = getSimpleInputFormat(inputFormat);\n        Helper.sendMessage('DidUpdateInputFormat', simpleService);\n    }\n\n    /**\n     *\n     * @param legoService\n     * @param oldData Previous value as an arraybuffer\n     * @param valueData New value as an arraybuffer\n     */\n    didUpdateValueData(legoService, oldData, valueData) {\n        var simpleService = getSimpleService(legoService);\n        simpleService.NewValue = legoService.numberValue;\n        Helper.sendMessage('DidUpdateValueData', simpleService);\n    }\n\n    // MotionSensor specific methods\n    didUpdateDistance(legoService, oldDistance, newDistance) {\n        var simpleService = getSimpleService(legoService);\n        simpleService.OldDistance = oldDistance;\n        simpleService.NewDistance = newDistance;\n        Helper.sendMessage('DidUpdateDistance', simpleService);\n    }\n\n    didUpdateCount(legoService, count) {\n        var simpleService = getSimpleService(legoService);\n        simpleService.Count = count;\n        Helper.sendMessage('DidUpdateCount', simpleService);\n    }\n\n    // RGB light specific methods\n    didReadInitialColor(legoService) {\n        var simpleService = getSimpleService(legoService);\n        Helper.sendMessage('DidReadInitialColor', simpleService);\n    }\n\n    didUpdateRGBValue(legoService, oldColor, color) {\n        var simpleService = getSimpleService(legoService);\n        simpleService.OldColor = oldColor;\n        simpleService.NewColor = color;\n        Helper.sendMessage('DidUpdateRGBValue', simpleService);\n    }\n\n    didUpdateRGBColorIndex(legoService, oldColorIndex, newColorIndex) {\n        var simpleService = getSimpleService(legoService);\n        simpleService.OldColorIndex = oldColorIndex;\n        simpleService.NewColorIndex = newColorIndex;\n        Helper.sendMessage('DidUpdateRGBColorIndex', simpleService);\n    }\n\n    // TiltSensor specific methods\n    didUpdateDirection(legoService, oldDirection, direction) {\n        var simpleService = getSimpleService(legoService);\n        simpleService.OldDirection = oldDirection;\n        simpleService.NewDirection = direction;\n        Helper.sendMessage('DidUpdateDirection', simpleService);\n    }\n\n    didUpdateAngle(legoService, oldAngle, angle) {\n        var simpleService = getSimpleService(legoService);\n        simpleService.OldAngle = oldAngle;\n        simpleService.NewAngle = angle;\n        Helper.sendMessage('DidUpdateAngle', simpleService);\n    }\n\n    didUpdateCrash(legoService, oldCrash, crash) {\n        var simpleService = getSimpleService(legoService);\n        simpleService.OldCrash = oldCrash;\n        simpleService.NewCrash = crash;\n        Helper.sendMessage('DidUpdateCrash', simpleService);\n    }\n\n    // VoltageSensor specific methods\n    didUpdateMilliVolts(legoService, milliVolts) {\n        var simpleService = getSimpleService(legoService);\n        simpleService.MilliVolts = milliVolts;\n        Helper.sendMessage('DidUpdateMilliVolts', simpleService);\n    }\n\n    // CurrentSensor specific methods\n    didUpdateMilliAmps(currentSensor, milliAmps) {\n        var simpleService = getSimpleService(currentSensor);\n        simpleService.MilliAmp = milliAmps;\n        Helper.sendMessage('DidUpdateMilliAmps', simpleService);\n    }\n}\n\n\nexport default class Bluetooth extends BaseModule {\n\n\n    constructor($logger) {\n        super();\n\n        this.$logger = $logger;\n        if (!bleManagerInstance || bleManagerInstance === null) {\n            $logger.log('WRAPPER :: Caching LegoDeviceManagerImpl.getInstance()');\n            bleManagerInstance = LegoDeviceManagerImpl.getInstance();\n            if (window) {\n                window.LDM = bleManagerInstance;\n            }\n            if (LDSDKLogger && LDSDKLogger !== null) {\n                LDSDKLogger.disable();\n            }\n            $logger.log('WRAPPER :: LegoDeviceManagerImpl.getInstance() - SDK Version: ' + bleManagerInstance.getSDKVersion());\n            bleManagerInstance.config.listenForConnectionsAllTheTime = true;\n            bleManagerInstance.config.fireDeviceInfoUpdateOnTheOnDeviceEvents = true;\n            bleManagerInstance.config.startStopScanningInterval = 2000;\n            bleManagerInstance.config.startStopRepeatedScanning = false;\n            bleManagerInstance.config.automaticReconnectOnConnectionLostEnabled = false;\n        }\n\n        this.helper = Helper.getInstance();\n        this.devices = [];\n        this.checkAndRegisterScanListener();\n    }\n\n    getDevicesCallbackListenerInstance() {\n        if (!this.devicesCallbackListener || this.devicesCallbackListener === null) {\n            this.devicesCallbackListener = new DevicesCallbackListenerImpl(this);\n        }\n        return this.devicesCallbackListener;\n    }\n\n    checkAndRegisterScanListener() {\n        if (!this.callbackListenerId || this.callbackListenerId === null) {\n            this.callbackListenerId = bleManagerInstance.registerCallbackListener(this.getDevicesCallbackListenerInstance()); // LECQA-82 - Register for\n            // scan callbacks as soon as wedo starts\n            this.$logger.info('WRAPPER :: Registered scan listener and connect listener: ', this.callbackListenerId);\n        }\n    }\n\n    addDevice = (legoDevice) => {\n        this.checkAndRegisterScanListener();\n        var found = false;\n        for (var i = 0; i < this.devices.length; i++) {\n            if (this.devices[i].deviceId === legoDevice.deviceId) {\n                found = true;\n            }\n        }\n        if (!found) {\n            this.devices.push(legoDevice);\n            return true;\n        }\n        return false;\n    }\n\n    removeDevice = (legoDevice) => {\n        this.checkAndRegisterScanListener();\n        let idxToRemove = -1;\n        for (let i = 0; i < this.devices.length; i++) {\n            if (this.devices[i].deviceId === legoDevice.deviceId) {\n                idxToRemove = i;\n            }\n        }\n        // const idx = this.simpleList.indexOf(item);\n        if (idxToRemove >= 0) {\n            this.devices.splice(idxToRemove, 1);\n        }\n    }\n\n//LegoDeviceManager\n    scan = () => {\n        this.checkAndRegisterScanListener();\n        return new Promise((resolve, reject) => {\n            this.$logger.log('WRAPPER :: Bluetooth.scan');\n            bleManagerInstance.scan()\n                    .then(() => {\n                        this.$logger.log('WRAPPER :: Scan started');\n                        return resolve();\n                    })\n                    .catch((error) => {\n                        this.$logger.error('WRAPPER :: Failed scanning: ', error);\n                        return resolve(); // We should probably reject\n                    });\n        });\n    }\n\n    stopScanning = () => {\n        this.checkAndRegisterScanListener();\n        return new Promise((resolve, reject) => {\n            this.$logger.log('WRAPPER :: Bluetooth.stopScanning');\n            bleManagerInstance.stopScanning()\n                    .catch((error) => {\n                        this.$logger.error('WRAPPER :: Failed stopScanning: ', error);\n                    })\n                    .then( () => {\n                        this.$logger.log('WRAPPER :: Resolving stopScanning');\n                        return resolve();\n                    });\n        });\n    }\n\n    connectToDevice = (legoDeviceId) => {\n        this.checkAndRegisterScanListener();\n        this.$logger.log('WRAPPER :: Bluetooth.connectToDevice -- bleManager.allDevices().length ' + bleManagerInstance.allDevices().length());\n        this.$logger.log('WRAPPER :: Bluetooth.connectToDevice: ', legoDeviceId);\n        bleManagerInstance.stopScanning()\n            .then(() => {\n                bleManagerInstance.connectToDevice(legoDeviceId)\n                        .then(() => {\n                            this.$logger.log('WRAPPER :: Bluetooth.connectToDevice Connected');\n                            // New scan will be started in the onDidFinishInterrogatingDevice callback, so\n                            // we don't interrupt the connect\n                        })\n                        .catch((error) => {\n                            this.$logger.error('WRAPPER :: Failed connecting: ', error);\n                            bleManagerInstance.scan();\n                        });\n\n                })\n                .catch((error) => {\n                    this.$logger.error('WRAPPER :: Failed stopScanning: ', error);\n                    bleManagerInstance.scan();\n                });\n\n    }\n\n    disconnectDevice = (legoDeviceId) => {\n        this.checkAndRegisterScanListener();\n        this.$logger.log('WRAPPER :: Bluetooth.disconnectDevice ' + legoDeviceId);\n        bleManagerInstance.cancelDeviceConnection(legoDeviceId);\n    }\n\n    allDevices = () => {\n        this.checkAndRegisterScanListener();\n        LDSDKLogger.debug('WRAPPER :: Bluetooth.allDevices');\n        var allDevices = [];\n        var allManagedDevices = bleManagerInstance.allDevices();\n        LDSDKLogger.debug('WRAPPER :: Bluetooth.allDevices - Got ' + allManagedDevices.length() + ' - Length of' +\n                         ' this.devices: ' + this.devices.length);\n        if (allManagedDevices.length() === 0) {\n            // Something is not in sync - make it sync\n            var devicesCopy = this.devices.slice();\n            for (var i = 0; i < devicesCopy.length; i++) {\n                var legoDevice = devicesCopy[i]; // Maybe replace the code below by simply setting ConnectedState: 1\n\n                LDSDKLogger.debug('WRAPPER :: Bluetooth.allDevices - sending message OnDeviceDisappeared ' + legoDevice.DeviceID + ' - Name: ' + legoDevice.DeviceName);\n                legoDevice.ConnectedState = 1; // Device has disappeared - so it should be shown like it is not\n                // advertising\n                Helper.sendMessage('OnDeviceDisappeared', legoDevice);\n                var proxyLegoBluetoothDevice = {\n                    deviceId: legoDevice.DeviceID\n                };\n                LDSDKLogger.debug('WRAPPER :: Bluetooth.allDevices - calling this.bluetooth.removeDevice ' + legoDevice.DeviceID + ' - Name: ' + legoDevice.DeviceName + ' this.devices length before: ' + this.devices.length);\n                this.bluetooth.removeDevice(proxyLegoBluetoothDevice);\n                LDSDKLogger.debug('WRAPPER :: Bluetooth.allDevices - calling this.bluetooth.removeDevice ' + legoDevice.DeviceID + ' - Name: ' + legoDevice.DeviceName + ' this.devices length after: ' + this.devices.length);\n            }\n            devicesCopy = null;\n            LDSDKLogger.debug('WRAPPER :: Bluetooth.allDevices - Truncating this.devices array - length before truncate: ' + this.devices.length);\n            this.devices.length = 0;\n            LDSDKLogger.debug('WRAPPER :: Bluetooth.allDevices - sending message OnAllDevicesUpdated - allDevices count: ' + allDevices.length);\n        } else {\n            for (var i = 0; i < allManagedDevices.size(); i++) {\n                LDSDKLogger.debug('WRAPPER :: Bluetooth.allDevices - appending ' + allManagedDevices.get(i).deviceId + ' - Name: ' + allManagedDevices.get(i).deviceName);\n                allDevices.push(getSimpleLegoDevice(allManagedDevices.get(i)));\n            }\n        }\n\n        Helper.sendMessage('OnAllDevicesUpdated', allDevices);\n    }\n\n\n    //LegoDevice\n    changeDeviceName = (legoDeviceId, name) => {\n        this.$logger.log(`WRAPPER :: Bluetooth.changeDeviceName for ${legoDeviceId} to new name: ${name}`);\n        bleManagerInstance.setDeviceName(legoDeviceId, name);\n    }\n\n\n// LegoService\n    updateServiceData = (legoDeviceId, connectId) => {\n        this.$logger.log('WRAPPER :: Bluetooth.updateServiceData');\n        var legoService = this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n        if (!legoService || legoService === null) {\n            this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n        } else {\n/*\n            this.$logger.warn('WRAPPER :: TODO: updateServiceData(' + legoDeviceId + ', ' + connectId + ') [' + legoService.serviceName + ', internal: ' + legoService.isInternalService + '] - not doing anything');\n            if (1 === 1) {\n                return;\n            }\n            var inputFormat = legoService.inputFormat;\n            if (!inputFormat || inputFormat === null) {\n                var defaultInputFormat = legoService.defaultInputFormat;\n                if (defaultInputFormat && defaultInputFormat !== null) {\n                    let fullInputFormat = InputFormat.fromSimpleInputFormat(defaultInputFormat);\n                    if (legoService.connectInfo.type === IOType.IO_TYPE_CURRENT || legoService.connectInfo.type === IOType.IO_TYPE_VOLTAGE) {\n                        if (defaultInputFormat.notificationsEnabled) {\n                            //LWC-1529: Make sure we do not receive Voltage and Current notifications in WeDo. We don't need them, and they put a lot of strain on the BLE comm\n                            fullInputFormat = InputFormat.fromSimpleInputFormat(defaultInputFormat).inputFormatBySettingNotificationsEnabled(false);\n                        }\n                    }\n                    legoService.updateInputFormat(fullInputFormat);\n                }\n            }\n*/\n        }\n    };\n\n    updateInputFormat = (legoDeviceId, connectId, mode, unit, deltaInterval, notificationsEnabled) => {\n        this.$logger.log('WRAPPER :: Bluetooth.updateInputFormat');\n\n        var legoService = this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n        if (!legoService || legoService === null) {\n            this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId + ', ' + notificationsEnabled);\n        } else {\n            var inputFormat = InputFormat.inputFormat(parseInt(connectId), parseInt(legoService.connectInfo.type), parseInt(mode), parseInt(deltaInterval), parseInt(unit), notificationsEnabled.toLowerCase());\n            this.$logger.log('WRAPPER :: updateInputFormat(' + legoDeviceId + ', ' + connectId + ', ' + mode + ', ' + unit + ', ' + deltaInterval + ', ' + notificationsEnabled + ') [' + legoService.serviceName + ', internal: ' + legoService.isInternalService + ']');\n            legoService.updateInputFormat(inputFormat);\n        }\n    };\n\n    // LegoMotor\n    run = (legoDeviceId, connectId, motorDirection, power) => {\n        this.$logger.log('WRAPPER :: Bluetooth.run');\n        var legoService = this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n        if (!legoService || legoService === null) {\n            this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n        } else {\n            legoService.run(parseInt(motorDirection), parseInt(power));\n        }\n    }\n\n    brake = (legoDeviceId, connectId) => {\n        this.$logger.log('WRAPPER :: Bluetooth.brake');\n        var legoService = this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n        if (!legoService || legoService === null) {\n            this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n        } else {\n            legoService.brake();\n        }\n    }\n\n    drift = (legoDeviceId, connectId) => {\n        this.$logger.log('WRAPPER :: Bluetooth.drift');\n        var legoService = this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n        if (!legoService || legoService === null) {\n            this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n        } else {\n            legoService.drift();\n        }\n    }\n\n    // LegoPiezoTonePlayer\n    playFrequency = (legoDeviceId, connectId, frequency, milliseconds) => {\n        this.$logger.log('WRAPPER :: Bluetooth.playFrequency');\n        var legoService = this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n        if (!legoService || legoService === null) {\n            this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n        } else {\n            legoService.playFrequency(parseInt(frequency), parseInt(milliseconds));\n        }\n    }\n\n    playNote = (legoDeviceId, connectId, note, octave, milliseconds) => {\n        this.$logger.log('WRAPPER :: Bluetooth.playNote');\n        var legoService = this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n        if (!legoService || legoService === null) {\n            this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n        } else {\n            legoService.playNote(parseInt(note), parseInt(octave), parseInt(milliseconds));\n        }\n    }\n\n    stopPlaying = (legoDeviceId, connectId) => {\n        this.$logger.log('WRAPPER :: Bluetooth.stopPlaying');\n        var legoService = this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n        if (!legoService || legoService === null) {\n            this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n        } else {\n            legoService.stopPlaying();\n        }\n    }\n\n    // LegoRGBLight\n    setRGBLightMode = (legoDeviceId, connectId, rgbLightMode) => {\n        this.$logger.log('WRAPPER :: Bluetooth.setRGBLightMode ' + rgbLightMode);\n        var legoService = this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n        if (!legoService || legoService === null) {\n            this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n        } else {\n            legoService.setRGBMode(parseInt(rgbLightMode));\n        }\n    }\n\n    changeColor = (legoDeviceId, connectId, jsonColor) => {\n        this.$logger.log('WRAPPER :: Bluetooth.changeColor ' + jsonColor);\n        var legoService = this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n        if (!legoService || legoService === null) {\n            this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n        } else {\n            legoService.setColor(jsonColor);\n        }\n    }\n\n    changeColorIndex = (legoDeviceId, connectId, colorIndex) => {\n        this.$logger.log('WRAPPER :: Bluetooth.changeColorIndex ' + colorIndex);\n        var legoService = this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n        if (!legoService || legoService === null) {\n            this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n        } else {\n            legoService.setColorIndex(parseInt(colorIndex));\n        }\n    }\n\n    switchOff = (legoDeviceId, connectId) => {\n        this.$logger.log('WRAPPER :: Bluetooth.switchOff');\n        var legoService = this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n        if (!legoService || legoService === null) {\n            this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n        } else {\n            legoService.switchOff();\n        }\n    }\n\n    changeColorToDefault = (legoDeviceId, connectId) => {\n        this.$logger.log('WRAPPER :: Bluetooth.changeColorToDefault');\n        var legoService = this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n        if (!legoService || legoService === null) {\n            this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n        } else {\n            legoService.switchToDefaultColor();\n        }\n    }\n\n    // LegoTiltSensor\n    setTiltSensorMode = (legoDeviceId, connectId, tiltSensorMode) => {\n        this.$logger.log('WRAPPER :: Bluetooth.setTiltSensorMode ' + tiltSensorMode);\n        var legoService = this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n        if (!legoService || legoService === null) {\n            this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n        } else {\n            legoService.setTiltSensorMode(parseInt(tiltSensorMode));\n        }\n    }\n\n    // LegoMotionSensor\n    setMotionSensorMode = (legoDeviceId, connectId, motionSensorMode) => {\n        this.$logger.log('WRAPPER :: Bluetooth.setMotionSensorMode ' + motionSensorMode);\n        var legoService = this.findServiceOnDevice(legoDeviceId, parseInt(connectId));\n        if (!legoService || legoService === null) {\n            this.$logger.error('WRAPPER :: Did not find service: ' + legoDeviceId + ', ' + connectId);\n        } else {\n            legoService.setMotionSensorMode(parseInt(motionSensorMode));\n        }\n    }\n\n    // helper\n\n    findDeviceFromId = (legoDeviceId) => {\n        this.$logger.log('WRAPPER :: Bluetooth.findDeviceFromId ' + legoDeviceId);\n        var device = bleManagerInstance.getDevice(legoDeviceId);\n        if (device === null || !device) {\n            this.$logger.error('WRAPPER :: Did not find device: ' + legoDeviceId);\n            this.$logger.error('WRAPPER :: allDevices count: ' + bleManagerInstance.allDevices().size());\n        }\n        return device;\n    }\n\n    findServiceOnDevice = (legoDeviceId, connectId) => {\n        var device = this.findDeviceFromId(legoDeviceId);\n        if (device === null || !device) {\n            this.$logger.error('WRAPPER :: Did not find device: ' + legoDeviceId);\n        } else {\n            var service = bleManagerInstance.getDeviceServiceWithConnectId(legoDeviceId, connectId);\n            if (service === null || !service) {\n                this.$logger.error('WRAPPER :: findServiceOnDevice: Did not find service: ' + legoDeviceId + ', ' + connectId);\n            }\n            return service;\n        }\n    }\n\n    setUnityObjectName = (unityObjectName) => {\n        MessageHandler.callWebGL('bluetoothHandler', 'setUnityObjectName', [unityObjectName]);\n    }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ../chromeos_resources/src/components/Bluetooth.js","import Webview from 'components/Webview';\nimport MessageHandler from 'MessageHandler';\n\nimport Storage from 'components/Storage';\n\nexport default class ContentViewerWebview extends Webview {\n  constructor(options) {\n    super(options, false);\n    this.eventHandlers['contentload'] = this.event_contentload.bind(this);\n\n    this.unityMethodToInvoke = 'OnRecieveMessageFromChromeOS';\n\n    this.setup(options);\n    setTimeout(() => {\n      this.webview.setZoomMode('disabled');\n    }, 20000);\n    this.storage = new Storage();\n\n    this.webview.addEventListener('permissionrequest', function(e) {\n      if (e.permission === 'fullscreen') {\n        e.request.allow();\n      }\n    });\n  }\n\n  event_contentload() {\n    // Welcome message\n    this.sendMessage({\n      sender: 'hello'\n    });\n\n    MessageHandler.callUnity('content', this.unityMethodToInvoke, '');\n  }\n\n  setTransparentBackground = enabled => {\n    this.webview.style.height = enabled === 'True' ? '400px' : '200px';\n  };\n\n  setInsets = (top, left, bottom, right, width, height) => {\n    this.webview.style.top = `${top}px`;\n    this.webview.style.left = `${left}px`;\n    this.webview.style.bottom = `${bottom}px`;\n    this.webview.style.right = `${right}px`;\n    this.webview.style.width = `unset`;\n    this.webview.style.height = `unset`;\n  };\n\n  setVisible = visible => {\n    this.webview.style.display = visible === 'True' ? 'inherit' : 'none';\n  };\n\n  invokeUnity = data => {\n    MessageHandler.callUnity('content', this.unityMethodToInvoke, data);\n  };\n\n  handleExportImage = dataURI => {\n    this.handleExport(dataURI, 'image/jpg', 'jpg');\n  };\n\n  handleExportPdf = dataURI => {\n    this.handleExport(dataURI, 'application/pdf', 'pdf');\n  };\n\n  handleExport(dataURI, mimeType, extension) {\n    const splitString = dataURI.split(';base64,');\n    const dataBase64 = splitString.length > 1 ? splitString[1] : splitString[0];\n\n    this.storage.saveFile(\n      this.b64toBlob(dataBase64, mimeType),\n      extension,\n      () => {\n        this.evaluatingJavaScript('ExportDone()');\n      },\n      err => {\n        this.evaluatingJavaScript('ExportDone()');\n      }\n    );\n  }\n\n  handleSaveSDT = data => {\n    MessageHandler.callUnity('content', 'OnEvalJavaScriptFinished', data);\n  };\n\n  b64toBlob(b64Data, contentType = '', sliceSize = 512) {\n    const byteCharacters = atob(b64Data);\n    const byteArrays = [];\n\n    for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {\n      const slice = byteCharacters.slice(offset, offset + sliceSize);\n\n      const byteNumbers = new Array(slice.length);\n      for (let i = 0; i < slice.length; i++) {\n        byteNumbers[i] = slice.charCodeAt(i);\n      }\n\n      const byteArray = new Uint8Array(byteNumbers);\n\n      byteArrays.push(byteArray);\n    }\n\n    const blob = new Blob(byteArrays, { type: contentType });\n    return blob;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ../chromeos_resources/src/components/ContentViewerWebview.js","import BaseModule from 'components/BaseModule';\n\nexport default class ExternalLink extends BaseModule {\n\n  constructor() {\n    super();\n  }\n\n  open = (url) => {\n    window.open( url );\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ../chromeos_resources/src/components/ExternalLink.js","import BaseModule from 'components/BaseModule';\nimport MessageHandler from 'MessageHandler';\n\nexport default class Killswitch extends BaseModule {\n\n  constructor() {\n    super();\n  }\n\n  request = (url) =>\n  {\n    var request = new XMLHttpRequest();\n    request.onreadystatechange = function()\n    {\n        if (request.readyState == 4) //Response recieved and ready\n        {\n            let dataURL = 'uniwebview://KillswitchResponse';\n            if(request.status == 200) //ok\n            {\n                dataURL += `?ReponseError=undefined`;\n                dataURL += `&Data=${encodeURIComponent(request.responseText)}`;\n                dataURL += `&ResponseHeader=${encodeURIComponent(request.getAllResponseHeaders())}`;\n                MessageHandler.callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n            }\n            else //404 not found\n            {\n              dataURL += `?ReponseError=Error`;\n              dataURL += `&Data=Error`;\n              dataURL += `&ResponseHeader=None}`;\n              MessageHandler.callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n            }\n        }\n    };\n    request.error = function() {\n\n    };\n\n    request.open(\"GET\", url, true);\n    request.send();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ../chromeos_resources/src/components/Killswitch.js","import BaseModule from 'components/BaseModule';\nimport MessageHandler from 'MessageHandler';\n\nexport default class PlatformInfo extends BaseModule {\n\n    constructor(logger = console) {\n        super();\n    }\n\n    requestSystemCpuInfo = () => {\n        const dataURL = 'uniwebview://PlatformInfo?systemCpu=';\n        if (chrome && chrome.system && chrome.system.cpu.getInfo && typeof chrome.system.cpu.getInfo === 'function') {\n            chrome.system.cpu.getInfo((info) => {\n                MessageHandler.callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL + this.getObjAsBase64Json(info));\n            });\n        }\n    };\n\n    requestPlatformInfo = () => {\n\n        const dataURL = 'uniwebview://PlatformInfo?platformInfo=';\n\n        if (chrome && chrome.runtime && chrome.runtime.getPlatformInfo && typeof chrome.runtime.getPlatformInfo === 'function') {\n            chrome.runtime.getPlatformInfo((platformInfo) => {\n                MessageHandler.callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL + this.getObjAsBase64Json({\n                    nativePlatformInfo: platformInfo,\n                    isArmArchitecture: platformInfo.arch.indexOf('arm') != -1,\n                    is64bit: platformInfo.arch.indexOf('x86-64') != -1,\n                    platformOS: platformInfo.os, /* \"mac\", \"win\", \"android\", \"cros\", \"linux\", or \"openbsd\" */\n                    platformOSDetails: navigator.appVersion.match(/\\(.*; ([^\\)]+)\\)/)[1],\n                    chromeVersion: navigator.appVersion.match(/.*Chrome\\/([0-9\\.]+)/)[1]\n                }));\n            });\n        } else {\n            MessageHandler.callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL + this.getObjAsBase64Json({\n                    nativePlatformInfo: navigator.platform,\n                    isArmArchitecture: this.isArmArchitecture(),\n                    is64bit: this.is64BitArchitecture(),\n                    platformOS: navigator.appVersion.match(/\\(.*; ([^\\)]+)\\)/)[1],\n                    platformOSDetails: navigator.appVersion.match(/\\(.*; ([^\\)]+)\\)/)[1],\n                    chromeVersion: navigator.appVersion.match(/.*Chrome\\/([0-9\\.]+)/)[1]\n          }));\n        }\n    };\n\n    requestSystemMemoryInfo = () => {\n        const dataURL = 'uniwebview://PlatformInfo?systemMemory=';\n\n        if (chrome && chrome.system && chrome.system.memory && typeof chrome.system.memory.getInfo === 'function') {\n            chrome.system.memory.getInfo((info) => {\n                MessageHandler.callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL + this.getObjAsBase64Json(info));\n            });\n        }\n    };\n\n    requestLanguageInfo = () => {\n        const dataURL = 'uniwebview://PlatformInfo?language=';\n\n        if (chrome && chrome.i18n && typeof chrome.i18n.getAcceptLanguages === 'function') {\n            chrome.i18n.getAcceptLanguages((languageList) => {\n                var languages = languageList.join(\",\");\n                var uiLanguage = (typeof chrome.i18n.getUILanguage === 'function' ? chrome.i18n.getUILanguage() : languageList[0]);\n                console.log('Accept Languages: ' + languages + ', UI language: ' + uiLanguage);\n\n                MessageHandler.callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL + this.getObjAsBase64Json({\n                    acceptLanguage: languageList[0],\n                    acceptLanguages: languages,\n                    uiLanguage: uiLanguage\n                }));\n            });\n\n        }\n    };\n\n    getObjAsBase64Json(obj) {\n        return window.btoa(window.unescape(window.encodeURIComponent(JSON.stringify(obj))));\n    }\n\n    getBitSystemArchitecture() {\n        var _to_check = [] ;\n        if ( window.navigator.cpuClass ) _to_check.push( ( window.navigator.cpuClass + \"\" ).toLowerCase() ) ;\n        if ( window.navigator.platform ) _to_check.push( ( window.navigator.platform + \"\" ).toLowerCase() ) ;\n        if ( navigator.userAgent ) _to_check.push( ( navigator.userAgent + \"\" ).toLowerCase() ) ;\n\n        var _64bits_signatures = [ \"x86_64\", \"x86-64\", \"Win64\", \"x64;\", \"amd64\", \"AMD64\", \"WOW64\", \"x64_64\", \"ia64\", \"sparc64\", \"ppc64\", \"IRIX64\" ] ;\n        var _bits = 32, _i, _c ;\n        outer_loop:\n                for( var _c = 0 ; _c < _to_check.length ; _c++ )\n                {\n                    for( _i = 0 ; _i < _64bits_signatures.length ; _i++ )\n                    {\n                        if ( _to_check[_c].indexOf( _64bits_signatures[_i].toLowerCase() ) != -1 )\n                        {\n                            _bits = 64 ;\n                            break outer_loop;\n                        }\n                    }\n                }\n        return _bits ;\n    }\n\n    is32BitArchitecture() { return this.getBitSystemArchitecture() == 32 ? 1 : 0 ; }\n    is64BitArchitecture() { return this.getBitSystemArchitecture() == 64 ? 1 : 0 ; }\n\n    isArmArchitecture() {\n        var _to_check = [] ;\n        if ( window.navigator.cpuClass ) _to_check.push( ( window.navigator.cpuClass + \"\" ).toLowerCase() ) ;\n        if ( window.navigator.platform ) _to_check.push( ( window.navigator.platform + \"\" ).toLowerCase() ) ;\n        if ( navigator.userAgent ) _to_check.push( ( navigator.userAgent + \"\" ).toLowerCase() ) ;\n\n        var _arm_signatures = [ \"arm\" ] ;\n        var _arm = false, _i, _c ;\n        outer_loop:\n                for( var _c = 0 ; _c < _to_check.length ; _c++ )\n                {\n                    for( _i = 0 ; _i < _arm_signatures.length ; _i++ )\n                    {\n                        if ( _to_check[_c].indexOf( _arm_signatures[_i].toLowerCase() ) != -1 )\n                        {\n                            _arm = true ;\n                            break outer_loop;\n                        }\n                    }\n                }\n        return _arm;\n    }\n\n}\n\n\n// WEBPACK FOOTER //\n// ../chromeos_resources/src/components/PlatformInfo.js","import BaseModule from 'components/BaseModule';\nimport MessageHandler from 'MessageHandler';\n\nexport default class VideoController extends BaseModule {\n    constructor($storage) {\n        super();\n        this.storage = $storage;\n        this.videoStream = null;\n        this.videoElement = null;\n        this.videoContainerElement = null;\n        this.snapshotCanvas = null;\n        this.snapshotCanvasContext = null;\n        this.videoRecordRTC = null;\n        this.previewFilePath = null;\n\n        this.previewImageExt = 'jpg';\n        this.previewVideoExt = 'webm';\n\n        this.livePreviewPosition = {};\n\n        window.requestAnimationFrame = window.requestAnimationFrame ||\n            window.webkitRequestAnimationFrame;\n\n        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;\n    }\n\n    playVideo = (url, bgColor) => {\n        const videoContainer = document.createElement('div');\n        videoContainer.style.backgroundColor = bgColor;\n        videoContainer.style.position = 'fixed';\n        videoContainer.style.top = '0';\n        videoContainer.style.left = '0';\n        videoContainer.style.width = '100%';\n        videoContainer.style.height = '100%';\n\n        const video = document.createElement('video');\n        video.className = 'lobbyvideo'\n        video.src = url;\n        video.preload = 'auto';\n        video.autoplay = true;\n        video.controls = true;\n        video.onended = () => {\n            document.body.removeChild(videoContainer);\n        };\n        video.onclick = () => {\n            document.body.removeChild(videoContainer);\n        };\n        videoContainer.appendChild(video);\n        document.body.appendChild(videoContainer);\n    };\n\n    setupVideoElements = () => {\n        if (!this.videoContainerElement) {\n            this.videoContainerElement = document.createElement('div');\n            document.body.appendChild(this.videoContainerElement);\n\n            this.videoElement = document.createElement('video');\n            this.videoElement.autoplay = true;\n            this.videoContainerElement.appendChild(this.videoElement);\n            this.videoElement.style.position = 'relative';\n            this.videoElement.style.marginLeft = 'auto';\n            this.videoElement.style.marginRight = 'auto';\n            this.videoElement.style.top = '50%';\n            this.videoElement.style.transform = 'translateY(-50%)';\n            this.videoElement.style.display = 'block';\n            this.videoElement.style.width = '100%';\n            this.videoElement.style.height = '100%';\n\n            this.videoElement.volume = 0;\n\n            this.videoElement.srcObject = this.videoStream;\n        }\n\n        if (!this.snapshotCanvas) {\n            this.snapshotCanvas = document.createElement('canvas');\n            this.snapshotCanvas.style.display = 'none';\n            this.snapshotCanvas.style.width = '100%';\n            this.snapshotCanvas.style.height = '100%';\n            this.snapshotCanvasContext = this.snapshotCanvas.getContext('2d');\n            document.body.appendChild(this.snapshotCanvas);\n        }\n\n        if (!this.videoRecordRTC) {\n            this.videoRecordRTC = new RecordRTC(this.videoStream, {type: 'video'});\n            this.videoRecordRTC.mimeType = {\n                video: 'video/webm',\n                audio: 'audio/wav',\n            };\n\n            this.videoRecordRTC.onStateChanged.call = (state) => {\n                console.log('Video :: Video Recorder state changed to: ' + state['state']);\n            };\n\n        } else {\n            console.debug('Video :: setupVideoElements - videoRecordRTC already set - resetting it');\n            this.videoRecordRTC.reset();\n        }\n\n        this.updateLivePreviewPosition();\n    };\n\n    teardownVideoElements = () => {\n        if (this.videoContainerElement) {\n            if (this.videoElement) {\n                URL.revokeObjectURL(this.videoElement.src);\n            }\n            document.body.removeChild(this.videoContainerElement);\n            this.videoElement = null;\n            this.videoContainerElement = null;\n        }\n\n        if (this.snapshotCanvas) {\n            document.body.removeChild(this.snapshotCanvas);\n            this.snapshotCanvasContext = null;\n            this.snapshotCanvas = null;\n        }\n\n        if (this.videoStream) {\n            this.videoStream.stop();\n            this.videoStream = null;\n        }\n\n        if (this.videoRecordRTC) {\n            this.videoRecordRTC.reset();\n            this.videoRecordRTC = null;\n        }\n    };\n\n    updateLivePreviewPosition = () => {\n        if (this.videoContainerElement) {\n            this.videoContainerElement.style.position = this.livePreviewPosition.position;\n            this.videoContainerElement.style.top = this.livePreviewPosition.top;\n            this.videoContainerElement.style.left = this.livePreviewPosition.left;\n            this.videoContainerElement.style.width = this.livePreviewPosition.widthPX;\n            this.videoContainerElement.style.height = this.livePreviewPosition.heightPX;\n        }\n\n        if (this.snapshotCanvas) {\n            this.snapshotCanvas.width = this.livePreviewPosition.width;\n            this.snapshotCanvas.height = this.livePreviewPosition.height;\n        }\n    };\n\n    startCaptureSession = () => {\n        if (!this.videoContainerElement) {\n            let width = this.livePreviewPosition.width;\n            width /= 10.0;\n            width = Math.floor(width) * 10;\n\n            let height = this.livePreviewPosition.height;\n            height /= 10.0;\n            height = Math.floor(height) * 10;\n\n            console.log('Video :: startCaptureSession - this.livePreviewPosition.width:  ' + this.livePreviewPosition.width + ' --> ' + width + ', this.livePreviewPosition.height: ' + this.livePreviewPosition.height + ' --> ' + height);\n            navigator.getUserMedia(\n                {\n                    video: {\n                        width: { /*min: width,*/ ideal: width/*, max: width */},\n                        height: { /*min: height, */ideal: height/*, max: height*/ },\n                    },\n                    audio: true,\n                }, (videoStream) => {\n                    this.videoStream = videoStream;\n                    this.setupVideoElements();\n                }, (e) => {\n                    console.error('Video :: startCaptureSession - failed getting videostream, tearing down video elements', e);\n                    this.teardownVideoElements();\n                });\n        }\n        else {\n            this.videoElement.style.display = 'block';\n        }\n    };\n\n    setLivePreviewPosition = (x, y, width, height) => {\n        if (this.livePreviewPosition) {\n            this.livePreviewPosition.position = 'fixed';\n            this.livePreviewPosition.top = `${y}px`;\n            this.livePreviewPosition.left = `${x}px`;\n            this.livePreviewPosition.widthPX = `${width}px`;\n            this.livePreviewPosition.heightPX = `${height}px`;\n            this.livePreviewPosition.width = width;\n            this.livePreviewPosition.height = height;\n        }\n\n        this.updateLivePreviewPosition();\n    };\n\n    startRecording = () => {\n        if (!this.videoRecordRTC) {\n            console.debug('Video :: startRecording - videoRecordRTC is not set, invoking setupVideoElements');\n            this.setupVideoElements();\n        }\n        if (this.videoRecordRTC) {\n            this.videoRecordRTC.startRecording();\n        } else {\n            console.info('Video :: Unable to start recording as no recordRTC instance available');\n        }\n    };\n\n    stopRecording = (filePath) => {\n        this.previewFilePath = filePath;\n        if (this.videoRecordRTC) {\n            this.videoRecordRTC.stopRecording(() => {\n                this.handleVideo(this.videoRecordRTC.toURL(), this.videoRecordRTC.getBlob())\n            });\n        } else {\n            console.info('Video :: stopRecording - No videoRecordRTC instance - Skipping stopRecording call');\n        }\n    };\n\n    handleVideo = (videoURL, videoBlob) => {\n        const width = this.videoContainerElement.style.width.replace('px', '');\n        const height = this.videoContainerElement.style.height.replace('px', '');\n        this.snapshotCanvasContext.drawImage(this.videoElement, 0, 0, width, height);\n        const dataString = this.snapshotCanvas.toDataURL('image/jpeg', 1);\n        const imageBlob = this.dataURItoBlob(dataString);\n\n        this.storage.saveFile(videoBlob, this.previewVideoExt, () => {\n            this.saveLocalPreviewFile(videoBlob, this.previewVideoExt, 'StopVideoRecording?VideoFilePath=');\n            this.saveLocalPreviewFile(imageBlob, this.previewImageExt, 'CaptureImage?ImageFilePath=');\n        }, (error) => {\n            console.log(`Video :: handleVideo - Unable to save file: ${error}`);\n            const dataURL = 'uniwebview://StopVideoRecording?VideoRecordingCancelled=true';\n            MessageHandler.callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL)\n        });\n    };\n\n    stopCaptureSession = (currentlyCapturing) => {\n        if (currentlyCapturing === 'True') {\n            this.videoElement.style.display = 'none';\n        } else {\n            if (this.videoRecordRTC) {\n                this.videoRecordRTC.stopRecording((videoURL) => {\n                    console.debug('Video :: stopCaptureSession - stopRecording completed');\n                });\n            }\n\n            try {\n                this.teardownVideoElements();\n            } catch (err) {\n                console.error('Video :: stopCaptureSession: Failed teardownVideoElements', err);\n            }\n\n        }\n    };\n\n    captureImage = (filePath) => {\n        this.previewFilePath = filePath;\n        const width = this.videoContainerElement.style.width.replace('px', '');\n        const height = this.videoContainerElement.style.height.replace('px', '');\n        this.snapshotCanvasContext.drawImage(this.videoElement, 0, 0, width, height);\n        const dataString = this.snapshotCanvas.toDataURL('image/jpeg', 1);\n\n        const imageBlob = this.dataURItoBlob(dataString);\n        this.storage.saveFile(imageBlob, this.previewImageExt, () => {\n            this.saveLocalPreviewFile(imageBlob, this.previewImageExt, 'CaptureImage?ImageFilePath=');\n        }, (error) => {\n            console.log(`Video :: Unable to save captured image file: ${error}`);\n            const dataURL = 'uniwebview://CaptureImage?CaptureImageCancelled=true';\n            MessageHandler.callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n        });\n    };\n\n    captureCanvasImage = (imageData, filePath) => {\n        this.previewFilePath = filePath;\n        const imageBlob = this.dataURItoBlob(imageData);\n        this.storage.saveFile(imageBlob, this.previewImageExt, () => {\n            this.saveLocalPreviewFile(imageBlob, this.previewImageExt, 'CaptureImage?ImageFilePath=');\n        }, (error) => {\n            console.log(`Video :: Unable to save captured canvas image file: ${error}`);\n            const dataURL = 'uniwebview://CaptureImage?CaptureImageCancelled=true';\n            MessageHandler.callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n        });\n    };\n\n    saveLocalPreviewFile = (fileBlob, extension, dataURL) => {\n        const filePath = `${this.previewFilePath}.${extension}`;\n        const newDataURL = `uniwebview://${dataURL}${filePath}`;\n        console.log(`Video :: Saving file to index db filepath: ${filePath} - newDataUrl: ${newDataURL}`);\n        this.storage.saveFileToIndexDB(filePath, fileBlob, newDataURL);\n    };\n\n    dataURItoBlob = (dataURI) => {\n        const data = atob(dataURI.split(',')[1]);\n        const mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\n        const array = new Uint8Array(data.length);\n        for (let i = 0; i < data.length; i++) {\n            array[i] = data.charCodeAt(i);\n        }\n        return new Blob([array], {type: mimeString});\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ../chromeos_resources/src/components/Video.js","import MessageHandler from 'MessageHandler';\n\nexport default class WindowController {\n\n    initialize($storage) {\n        this.storage = $storage;\n\n        chrome.app.window.current().onBoundsChanged.addListener(this.onBoundsChanged.bind(this));\n\n        document.addEventListener('visibilitychange', () => {\n            // Page Visibility Level 2 - https://www.w3.org/TR/page-visibility/\n            if (document.visibilityState !== 'visible') {\n                console.debug('pause - Document is hidden - invoking pause. document.visibilityState: ' + document.visibilityState);\n                if (!this.storage.isSavingFile()) {\n                    this.pause();\n                }\n            } else {\n                console.debug('pause - Document is visible - invoking unpause. document.visibilityState: ' + document.visibilityState);\n                if (!this.storage.isSavingFile()) {\n                    this.unpause();\n                }\n            }\n        });\n\n        this.onBoundsChanged();\n    }\n\n    onBoundsChanged() {\n        this.webviewElement = document.getElementById('webgl'); //webview element from chromecore\n        this.parentDiv = document.getElementById('parent'); //parent div from chromecore\n\n        // let width = chrome.app.window.current().innerBounds.width;\n        // let height = chrome.app.window.current().innerBounds.height;\n        let width = Math.min(chrome.app.window.current().outerBounds.width, chrome.app.window.current().innerBounds.width);\n        let height = Math.min(chrome.app.window.current().outerBounds.height, chrome.app.window.current().innerBounds.height);\n\n\n\n        // this.webviewElement.style.width = `${width}px`;\n        // this.webviewElement.style.height = `${height}px`;\n        //\n        // this.parentDiv.style.width = `${width}px`;\n        // this.parentDiv.style.height = `${height}px`;\n\n        console.log('onBoundsChanged: setting width: ' + width + 'px, height: ' + height + 'px - innerBounds: [ width: ' + chrome.app.window.current().innerBounds.width +', height: ' + chrome.app.window.current().innerBounds.height + '] - outerBounds: [ width: ' + chrome.app.window.current().outerBounds.width + ', height: ' + chrome.app.window.current().outerBounds.height + '] - document: [ width: ' + document.body.clientWidth + ', height: ' + document.body.clientHeight + '] ');\n        if (this.webviewElement && this.webviewElement.style && this.webviewElement.style.width) {\n            console.log('webviewElement style: [width: ' + this.webviewElement.style.width + ', height: ' + this.webviewElement.style.height + ']');\n        }\n        MessageHandler.callWebGL('window', 'resize', [{width, height}]);\n    }\n\n    pause() {\n        const dataURL = 'uniwebview://PauseUnpause?Pause=true';\n        MessageHandler.callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n    }\n\n    unpause() {\n        const dataURL = 'uniwebview://PauseUnpause?Pause=false';\n        MessageHandler.callUnity(null, 'OnRecieveMessageFromChromeOS', dataURL);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ../chromeos_resources/src/components/Window.js","import BaseModule from 'components/BaseModule';\nimport SyncError from 'components/SyncError';\nimport { configureGoogleAPI } from 'gapi_chrome_apps';\nimport { StringView } from 'stringview';\n\n/* Google Drive API documentation specifies that the value\n   should be a multiple of 256KB */\nwindow.GD_RESUMABLE_UPLOAD_CHUNK_SIZE = 2 * 256 * 1024;\n\nexport default class GoogleDrive extends BaseModule {\n\n    constructor(timestampFunc) {\n        super();\n        this.hasUserDeclinedAuth = false;\n        this.access_token = undefined;\n        this.pendingRequests = {};\n        this.reqIdx = 0;\n        this.maxAttempts = 5;\n        const maxRequestsPerSecond = 10;\n        // slightly increase the interval to decrease the chance of actually making too many requests per second\n        this.requestInterval = Math.ceil(1.1 * (1000 / maxRequestsPerSecond));\n        this.requestQueue = [];\n        this._syncfsTimestamp = timestampFunc;\n    }\n\n    initialize = (SyncFS) => {\n        var _this = this;\n        _this.SyncFS = SyncFS;\n        return new Promise((resolve, reject) => {\n            console.log('loadGoogleAPI');\n            configureGoogleAPI(function() {\n                console.log('Google API loaded');\n                _this._authenticate(resolve, reject);\n            });\n        });\n    };\n\n    _authenticate(resolve, reject) {\n        var _this = this;\n        var success = function(token) {\n            _this.access_token = token;\n            _this.hasUserDeclinedAuth = false;\n            resolve();\n            _this.startPerformingRequests();\n        };\n        var failure = function(error) {\n            _this.access_token = undefined;\n            // NOTE: Ask google about this. There's no guarantee this message is not localized.\n            // Ok, we asked google, they said it's not localized, but the guy who answered was not 100% sure.\n            _this.hasUserDeclinedAuth = (error.message === \"The user did not approve access.\");\n            reject(new SyncError(error.message, error.code, error.reason));\n            _this.startPerformingRequests();\n        };\n        // try to use the cached auth. token first\n        gapi.auth.authorize({immediate: true}, function(result) {\n            console.log('Received authorization result (immediate = true)', result);\n            if (!result.error) {\n                success(result.access_token);\n            } else {\n                // show the GD authorization popup to the user\n                _this._checkIfURLReachable(\"https://www.googleapis.com/drive/v3/about\").then(() => {\n                    gapi.auth.authorize({immediate: false}, function(result) {\n                        console.log('Received authorization result (immediate = false)', result);\n                        if (!result.error) {\n                            success(result.access_token);\n                        } else {\n                            failure(result.error);\n                        }\n                    });\n                }).catch((e) => {\n                    console.log(\"Google Drive not reachable.\", e);\n                    failure(\"Google Drive not reachable\");\n                });\n            }\n        });\n    }\n\n    _checkIfURLReachable = (url) => {\n        return new Promise((resolve, reject) => {\n            var xhr = new XMLHttpRequest();\n            xhr.open(\"GET\", url);\n            xhr.timeout = 10000;\n            xhr.onload = function() {\n                console.log(\"_checkIfURLReachable: onload\", xhr);\n                resolve();\n            };\n            xhr.onerror = function() {\n                console.log(\"_checkIfURLReachable: onerror\", xhr);\n                reject();\n            };\n            xhr.ontimeout = function() {\n                console.log(\"_checkIfURLReachable: ontimeout\", xhr);\n                reject();\n            };\n            xhr.send();\n        });\n    };\n\n    revokeCredentials() {\n        // do not stop performing requests - we need to make the next request and try reauthenticating if it ends with 401\n        //this.stopPerformingRequests();\n        if (this.access_token) {\n            chrome.identity.removeCachedAuthToken({token: this.access_token});\n            this.access_token = undefined;\n        }\n    }\n\n    reauthenticate = () => {\n        return new Promise((resolve, reject) => {\n            this.revokeCredentials();\n            this._authenticate(resolve, reject);\n        });\n    };\n\n    attemptGoogleReconnect() {\n        if (this.isAttemptingReconnect) return;\n        var _this = this;\n        _this.isAttemptingReconnect = true;\n        var reconnectAttempt = 0;\n\n        // Set up some bogus but legit parameters that google can actually respond to.\n        var rArgs = {\n            path: \"/drive/v3/files\",\n            params: {\n                \"q\": \"\",\n                \"pageSize\": 2,\n                \"spaces\": \"appDataFolder\",\n            }\n        };\n\n        var doRequest = function() {\n            gapi.client.request(rArgs);\n        };\n\n        var retryRequest = function() {\n            var to = 1000 * reconnectAttempt * reconnectAttempt;\n            console.log('retryRequest executing - to: ' + to + ', reconnectAttempt: ' + reconnectAttempt + ', rArgs: ' + JSON.stringify(rArgs));\n            if (to > 10 * 60 * 1000) {\n                to = 10 * 60 * 1000;\n            } // max 10 minutes interval;\n            reconnectAttempt++;\n            window.setTimeout(doRequest, to);\n        };\n\n        var reconnectSuccessful = function() {\n            _this.SyncFS.solveStatusReason(\"gdrive_offline\");\n            _this.isAttemptingReconnect = false;\n        };\n\n        rArgs.callback = function(response, rawResponse) {\n            if (typeof rawResponse === 'string') {\n                rawResponse = JSON.parse(rawResponse);\n            }\n            var rawResponseSuccess = (\n                    rawResponse\n                    && rawResponse.gapiRequest\n                    && rawResponse.gapiRequest.data\n                    && rawResponse.gapiRequest.data.status\n                    && rawResponse.gapiRequest.data.status === 200) || false;\n            var hasStatus = (\n                    rawResponse\n                    && rawResponse.gapiRequest\n                    && rawResponse.gapiRequest.data\n                    && rawResponse.gapiRequest.data.responseHeaders\n                    && rawResponse.gapiRequest.data.responseHeaders.status) || false;\n            var status = hasStatus ? rawResponse.gapiRequest.data.responseHeaders.status : -1;\n\n            if (rawResponseSuccess || status === 200 || status === 401 || response === null || response.error === null ||\n                    (response.error && response.error.code === 401)\n            ) { // Don't worry about not being authenticated, that gets handled somewhere else. Here we just try to regain a connection to google.\n                // console.log('Google Drive :: Callback for doRequest ==> reconnectSuccessful');\n                reconnectSuccessful();\n            } else {\n                // console.log('Google Drive :: Callback for doRequest ==> retryRequest -[rawResponseSuccess: ' + rawResponseSuccess +']', rawResponse);\n                retryRequest();\n            }\n        };\n        rArgs.errorCallback = retryRequest;\n\n        doRequest();\n    }\n\n    handleGoogleError(requestIdx, syncError) {\n        var _this = this;\n        var req = _this.pendingRequests[requestIdx];\n\n        var retryRequest = () => {\n            _this.enqueueRequest(req.args);\n        };\n\n        // There's a likely bug in our code somewhere where we create the calls to google apis if we got here.\n        var failWithThrow = function(throwMessage) {\n            req.reject(syncError);\n            throw new Error(throwMessage);\n        };\n\n        // The request failed for external reasons and we could not sync. Start pinging google so we know when it's back online.\n        var failSimple = function(newError) {\n            req.reject(newError ? newError : syncError);\n            delete _this.pendingRequests[requestIdx];\n\n            if (newError === null || newError.message !== \"The user did not approve access.\") {\n                _this.attemptGoogleReconnect();\n            }\n        };\n\n        var immediateReattempt = function() {\n            retryRequest();\n        };\n\n        var tryReatempt = function() {\n            if (req.attempt < _this.maxAttempts) {\n                req.attempt++;\n                // Reattempt the request after 0.5, 2, 4.5, 8 and 12.5 seconds.\n                window.setTimeout(retryRequest, 500 * req.attempt * req.attempt);\n            } else {\n                failSimple(new SyncError(\"timeout\", syncError.code));\n            }\n        };\n\n        switch (syncError.code) {\n            // 400: Bad Request\n            //      --- Should never happen for us, this means there's a bug in our code, fix it!\n            case 400: {\n                failWithThrow('Bad request! ' + req.args.path);\n            } break;\n\n            // 401: Invalid Credentials\n            //      --- Try re-authentication. If it fails then users should not be able to use the app?\n            case 401: {\n                if (_this.hasUserDeclinedAuth) {\n                    failSimple();\n                } else {\n                    _this.reauthenticate().then(() => {\n                        immediateReattempt();\n                    }).catch((syncError) => {\n                        failSimple(syncError);\n                    });\n                }\n            } break;\n\n            // 403: Daily Limit Exceeded\n            //      --- Solution involves politics, buy additional quota.\n            // 403: User Rate Limit Exceeded\n            // 403: Rate Limit Exceeded (these 2 are caused by doing too many requests in a short amount of time)\n            //      --- Raise per-user quota\n            //      --- Batch requests\n            //      --- Exponential backoff\n            // 403: The user has not granted the app {appId} {verb} access to the file {fileId}\n            // 403: The user does not have sufficient permissions for file {fileId}\n            // 403: App with id {appId} cannot be used within the authenticated user's domain\n            //      --- Should never happen for us. It means we're trying to access a file outside\n            //          of appData, that is a bug.\n            case 403: {\n                var reason = syncError.reason;\n                if (reason === \"dailyLimitExceeded\") {\n                    // Buy more quota!\n                } else if (reason === \"userRateLimitExceeded\") {\n                    tryReatempt();\n                } else if (reason === \"rateLimitExceeded\") {\n                    tryReatempt();\n                } else if (reason === \"appNotAuthorizedToFile\") {\n                    failWithThrow('No access to file! ' + req.args.path);\n                } else if (reason === \"insufficientFilePermissions\") {\n                    failWithThrow('Insufficient file permissions! ' + req.args.path);\n                } else if (reason === \"domainPolicy\") {\n                    failWithThrow('App cannot be used from this domain! ' + req.args.path);\n                }\n            } break;\n\n            // 404: File not found: {fileId}\n            //      --- Should never happen in production, this means there's a bug in our code.\n            case 404: {\n                failWithThrow('Bad request! ' + req.args.path);\n            } break;\n\n            // 500: Backend Error\n            //      --- Exponential backoff\n            case 500: {\n                console.debug('handleError - reqIdx: ' + requestIdx + '(' + req.args.path +') - [code: ' + syncError.code + ', message: ' + syncError.message + ', reason: ' + syncError.reason +']. Retrying #attempt: ' + req.attempt);\n                tryReatempt();\n            } break;\n        }\n    }\n\n    // Figure out when to use response and when and how to use rawResponse.\n    handleGoogleResponse(requestIdx, response, rawResponse) {\n        var req = this.pendingRequests[requestIdx];\n        req.resolve(req.okPreprocess(response, rawResponse));\n        delete this.pendingRequests[requestIdx];\n        this.SyncFS.solveStatusReason(\"gdrive_offline\");\n    }\n\n    startRequest(requestArgs, okPreprocess, errorHandler) {\n        var _this = this;\n        var idx = _this.reqIdx++;\n        okPreprocess = okPreprocess ? okPreprocess : function(response, rawResponse) { return response; }; // by default return response unmodified\n        errorHandler = errorHandler ? errorHandler : function(error) { return false; }; // don't handle any errors by default\n        var rArgs = requestArgs;\n\n        return new Promise((resolve, reject) => {\n            rArgs.callback = function(response, rawResponse) {\n                if (typeof rawResponse === 'string') {\n                    rawResponse = JSON.parse(rawResponse);\n                }\n                var rawResponseSuccess = (rawResponse !== undefined && rawResponse.hasOwnProperty('gapiRequest') && rawResponse.gapiRequest.hasOwnProperty('data') && rawResponse.gapiRequest.data.hasOwnProperty('status') && rawResponse.gapiRequest.data.status === 200) || false;\n                var responseHasFiles = (response && response.hasOwnProperty('files') && Array.isArray(response.files)) || false;\n                var responseHasChanges = (response && response.hasOwnProperty('changes') && Array.isArray(response.changes)) || false;\n                if (rawResponseSuccess\n                        || responseHasFiles\n                        || responseHasChanges\n                        || (\n                                (!response || response === null)\n                                || (!response.error || response.error === null)\n                                || errorHandler(response.error)\n                        )\n                ) {\n                    _this.handleGoogleResponse(idx, response, rawResponse);\n                } else {\n                    if (response && response.error) {\n                        var e = response.error;\n                        _this.handleGoogleError(idx, new SyncError(e.message, e.code, e.errors[0].reason));  // TODO(Catalin): Is this reliable? Documentation doesn't explain why an error contains a list of errors, but a single message and a single error code...\n                    } else {\n                        console.warn('Non successful response ' + idx + ' has no error property: ', response, 'rawResponse: ', rawResponse);\n                    }\n                }\n            };\n\n            rArgs.errorCallback = function(errorMessage) {\n                if (errorMessage !== \"timeout\")\n                {\n                    console.error(\"Failed to execute google request:\", chrome.runtime.lastError);\n                    reject(new SyncError(chrome.runtime.lastError));\n                } else {\n                    // If we get a 5 sec timeout, assume google is down, and start pinging.\n                    reject(new SyncError(\"timeout\", 500));\n                }\n                _this.attemptGoogleReconnect();\n            };\n\n            _this.pendingRequests[idx] = {\n                args: rArgs,\n                attempt: 0,\n                okPreprocess: okPreprocess,\n                resolve: resolve,\n                reject: reject,\n            };\n\n            this.enqueueRequest(rArgs);\n        });\n\n    }\n\n    enqueueRequest(args) {\n        this.requestQueue.push(args);\n    }\n\n    startPerformingRequests() {\n        var _this = this;\n        if (_this.intervalID !== undefined) return;\n        _this.intervalID = window.setInterval(() => { _this.performNextRequest(); }, _this.requestInterval);\n    }\n\n    stopPerformingRequests() {\n        if (this.intervalID === undefined) return;\n        window.clearInterval(this.intervalID);\n        this.intervalID = undefined;\n    }\n\n    performNextRequest() {\n        var _this = this;\n        if (this.requestQueue.length > 0) {\n            var requestArgs = this.requestQueue.shift();\n            gapi.client.request(requestArgs);\n        }\n    }\n\n    // Query format: https://developers.google.com/drive/v3/web/search-parameters, use empty string for all files/directories\n    getFileList = (query) => {\n        return new Promise((resolve, reject) => {\n            var _this = this;\n            var files = [];\n            var fetchNextPage = function(pageToken) {\n                _this._fetchFileListPage(query, pageToken, function(response) {\n                    files = files.concat(response.files);\n                    if (\"nextPageToken\" in response) {\n                        fetchNextPage(response.nextPageToken);\n                    } else {\n                        resolve(files);\n                    }\n                }, function(error) {\n                    reject(error);\n                });\n            };\n            // fetch the first page\n            fetchNextPage(null);\n        });\n    };\n\n    downloadFile = (fileId, name) => {\n        var responseType = 'arraybuffer';\n        if (name && typeof name === 'string') {\n            if (name.lastIndexOf('.') !== -1) {\n                var extension = name.substr(name.lastIndexOf('.')).toLowerCase();\n                if (extension === '.txt' || extension === '.json' || extension === '.proj') {\n                    responseType = 'text';\n                }\n            }\n        }\n\n        var args = {\n            path: \"/drive/v3/files/\" + fileId,\n            params: {\n                alt: \"media\"\n            },\n            responseType: responseType,\n        };\n\n        if (window.ENABLE_DEBUG) {\n            console.debug('Starting download of ' + name + '('+fileId+') using xhr responseType: ' + responseType);\n        }\n        if (responseType === 'arraybuffer') {\n            return this.startRequest(args, (response, rawResponse) => {\n                    if ('ArrayBuffer' === response.constructor.name) {\n                        var responseArr = new Uint8Array(response);\n\n                        try {\n                            let base64 = StringView.bytesToBase64(responseArr); // Make b64 string from typed array\n                            if (!this._isBase64(base64)) {\n                                return response;\n                            }\n                            console.log('downloadFile :: got base64 ArrayBuffer response payload for file \"' + args.path + '\" - decoding the response');\n                            return this._base64Decode(base64);\n                        } catch (e) {\n                            return response;\n                        }\n                    } else {\n                        console.log('downloadFile :: got ' + response.constructor.name + ' response payload for file \"' + args.path + '\"');\n                        if (this._isBase64(response)) {\n                            console.log('downloadFile :: got base64 encoded ' + response.constructor.name + ' response payload for file \"' + args.path + '\" - decoding the response');\n                            const decodedResponse = this._base64Decode(response);\n                            return decodedResponse;\n                        }\n                    }\n                return response;\n            });\n        } else {\n            return this.startRequest(args, this._base64Decode);\n        }\n\n    };\n\n    uploadFile = (fileId, name, data, timestamp) => {\n        var method = fileId ? \"PATCH\" : \"POST\";\n        var path = \"/upload/drive/v3/files\" + (fileId ? \"/\" + fileId : \"\");\n\n        var metadata = {\n            \"name\": name,\n            \"modifiedTime\": timestamp\n        };\n\n        if (!fileId) {\n            metadata.parents = [\"appDataFolder\"];\n            metadata.createdTime = timestamp;\n        }\n\n        var boundary = \"#g4RJCrhHMbzaPtxpNSAw#\";\n        var dataStr = this._base64Encode(new Uint8Array(data));\n        var body = \"\";\n        body += \"--\" + boundary + \"\\n\";\n        body += \"Content-Type: application/json; charset=UTF-8\\n\\n\";\n        body += JSON.stringify(metadata) + \"\\n\\n\";\n        body += \"--\" + boundary + \"\\n\";\n        body += \"Content-Type: application/octet-stream\\n\\n\";\n        body += dataStr + \"\\n\";\n        body += \"--\" + boundary + \"--\";\n\n        return this.startRequest({\n            path: path,\n            params: {\n                uploadType: \"multipart\",\n                fields: \"id,name,modifiedTime\"\n            },\n            method: method,\n            bodyType: \"multipart/related; boundary=\" + boundary,\n            body: body,\n        });\n    };\n\n    /**\n     * Implementation that can upload a file using resumable method\n     * https://developers.google.com/drive/v3/web/resumable-upload\n     *\n     * The steps are:\n     *  1) Initiate the resumable upload session\n     *  2) Receive the response and extract the Location header that contains the resumable session uri\n     *  3) Upload the file to the resumable session uri. This can either be done as 'single request' or as 'multiple chunks'\n     *  3a) Single request:\n     *      - Create a PUT request to the resumable session uri\n     *      - Add the file data to the request body\n     *      - Add a Content-Length header, with the number of bytes in the file (body)\n     *      - Send the request\n     *  3b) Multiple Chunks:\n     *      1) Create a PUT request to the resumable session uri\n     *      2) Add chunk data to request body. Create chunks in multiples of 256KB (256*1024 bytes) in size, except for the final chunk that completes the upload.\n     *          (Keep the chunk size as large as possible so that the upload is efficient)\n     *      3) Add two headers:\n     *          - Content-Length: Set to the number of bytes in the current chunk\n     *          - Content-Range: Set to show which bytes in the file you are uploading.\n     *            For example, Content-Range: bytes 0-524287/2000000 shows that you are uploading the first 524,288 bytes (256 x 1024 x 2) in a 2,000,000 byte file.\n     *      4) Send the request, and process the response\n     *      5) Repeat steps 1-4 for each remaining chunk in the file.\n     *         Use the 'Range' header in the response to determine where to start the next chunk.\n     *         Do NOT assume that the server received all bytes sent in the previous request\n     *\n     * @param fileId\n     * @param name\n     * @param data\n     * @param timestamp\n     * @return {*}\n     */\n    uploadFileResumable = (fileId, name, data, timestamp) => {\n        var initMethod = fileId ? 'PATCH' : 'POST';\n        var path = \"/upload/drive/v3/files\" + (fileId ? \"/\" + fileId : \"\");\n        console.log(`${initMethod} ${data.byteLength} bytes to ${path}`);\n\n        var metadata = {\n            \"name\": name,\n            \"modifiedTime\": timestamp,\n            \"type\": 'arraybuffer'\n        };\n\n        if (!fileId) {\n            metadata.parents = [\"appDataFolder\"];\n            metadata.createdTime = timestamp;\n        }\n\n        var body = JSON.stringify(metadata);\n\n        var initResumableParams = {\n            'path': path,\n            'method': initMethod,\n            'params': {\n                'uploadType': 'resumable',\n                'fields': 'id,name,modifiedTime'\n            },\n            'headers': {\n                'Content-Type': 'application/json; charset=UTF-8',\n                'X-Upload-Content-Type' : 'application/octet-stream',\n                'X-Body-Content-Length' : body.length,\n                'X-Upload-Content-Length' : data.byteLength,\n            },\n            'bodyType': 'application/json; charset=UTF-8',\n            'body': body,\n        };\n\n        var processInitResumableResponseHandler = function(response, rawResponse) {\n            var responseHeaders = rawResponse && rawResponse.gapiRequest && rawResponse.gapiRequest.data ? rawResponse.gapiRequest.data.responseHeaders : null;\n            if (responseHeaders !== null) {\n                if (responseHeaders.hasOwnProperty('location')) {\n                    return responseHeaders['location'];\n                } else if (responseHeaders.hasOwnProperty('Location')) {\n                    return responseHeaders['Location'];\n                }\n            }\n            console.error('uploadFileResumable :: Failed Initializing resumable upload and getting session url. InitResumableParams: ', initResumableParams ,' RawResponse', rawResponse);\n            throw 'Failed initializing uploadResumable for file ' + name + ' (fileId: ' + fileId + ')';\n        };\n\n        return this.startRequest(initResumableParams, processInitResumableResponseHandler)\n                .then((resumableSessionUri) => {\n\n                    var chunkSize = window.GD_RESUMABLE_UPLOAD_CHUNK_SIZE;\n\n                    /**\n                     * Calculates the number of chunks still needed before completing the upload.\n                     * We cannot rely on the values we use in the Content-Range header of the request, instead we use the Range header in the response to get the number of bytes that was actually received by the server.\n                     *\n                     * @param range\n                     * @return {Number} The number of chunk requests needed (at least) before the upload can be considered to be complete.\n                     * @private\n                     */\n                    var _getRemainingChunkCount = (range) => {\n                        var chunkCount = parseInt(((data.byteLength - range) / chunkSize).toFixed(0));\n                        if (((data.byteLength - range) / chunkCount) > chunkSize) {\n                            chunkCount += 1;\n                        }\n                        return chunkCount;\n                    };\n\n                    /**\n                     * This function can prepare parameters for the multiple-chunk resumable uploads to google drive\n                     * @param startByte - The offset from where to start the range selection of the file bytes\n                     * @return {*} Returns an object that can be used as 1st argument for startRequest\n                     * @private\n                     */\n                    var _prepareParams = (startByte) => {\n                        var endByte = Math.min(startByte + chunkSize - 1, data.byteLength -1);\n                        var remainingChunkCount = _getRemainingChunkCount(startByte);\n                        // console.log(`uploadFileResumable :: prepareParams: ${startByte}-${endByte}/${data.byteLength} (chunkSize: ${chunkSize}, remainingChunkCount: ${remainingChunkCount}) - (${fileId}-${name})`);\n                        if (startByte >= (data.byteLength-1) || startByte >= endByte) {\n                            // Signal error by returning null\n                            return null;\n                        }\n\n                        var requestParams = {\n                            'path' : resumableSessionUri.substr('https://www.googleapis.com'.length),\n                            'method' : 'PUT', /* PATCH? */\n                            'headers' : {\n                                'Content-Range': `bytes ${startByte}-${endByte}/${data.byteLength}`,\n                                'X-Chunk' : `${remainingChunkCount} chunks remaining of size ${chunkSize} bytes`,\n                            },\n                            'bodyType': initResumableParams['headers']['X-Upload-Content-Type'],\n                            'body' : new Uint8Array(data).subarray(startByte, endByte + 1)\n                        };\n                        return requestParams;\n\n                    };\n\n                    /**\n                     * This is a custom okPreprocess handler that can be used as 2nd argument to startRequest for the chunk upload requests.\n                     *\n                     * The value returned by this handler can be used as the next 'start offset' for the subsequent Content-Range header, or to consider the upload complete, or to consider it failed.\n                     *\n                     * @param response\n                     * @param rawResponse\n                     * @return {number|string|null} If status of the rawResponse is 308 and the Range header is present, the \"endbyte\" + 1 is returned (range: bytes 512-2048 ==> 2049 would be returned).\n                     * If the status is 200 or 201 - the string 'resumable_upload_complete' is returned, and if the status is neither 200/201 and no Range header is present - null is returned.\n                     * @private\n                     */\n                    var _chunkResponseHandler = function(response, rawResponse) {\n                        if (typeof rawResponse === 'string') {\n                            rawResponse = JSON.parse(rawResponse);\n                        }\n                        var responseHeaders = rawResponse && rawResponse.gapiRequest && rawResponse.gapiRequest.data ? rawResponse.gapiRequest.data.responseHeaders : null;\n                        if (responseHeaders) {\n                            var rangeHeaderValue;\n                            if (responseHeaders.hasOwnProperty('range')) {\n                                rangeHeaderValue = responseHeaders['range'];\n                            } else if (responseHeaders.hasOwnProperty('Range')) {\n                                rangeHeaderValue = responseHeaders['Range'];\n                            }\n                            if (rangeHeaderValue) {\n                                //Expected Range header value: 'bytes=0-524287'\n                                if (rangeHeaderValue.startsWith('bytes=')) {\n                                    var byteParts = rangeHeaderValue.substr('bytes='.length).split('-');\n                                    if (byteParts.length === 2) {\n                                        var startByte=byteParts[0];\n                                        var endByte = byteParts[1];\n                                        return parseInt(endByte) + 1;\n                                    } else {\n                                        console.warn('Unsupported \"Range\" header value: ' + rangeHeaderValue);\n                                    }\n                                }\n                            } else if (responseHeaders.status === 200 || responseHeaders.status === 201) {\n                                // Upload complete\n                                return 'resumable_upload_complete';\n                            } else if (responseHeaders.status === 404) {\n                                console.log('uploadFileResumable :: _chunkResponseHandler :: Got a \"not found\" response');\n                            } else if (responseHeaders.status === 403) {\n                                console.log('uploadFileResumable :: _chunkResponseHandler :: Got a \"403\" response', rawResponse);\n                                return null;//'resumable_upload_timeout'\n                            } else if (responseHeaders.status === 500) {\n                                console.log('uploadFileResumable :: _chunkResponseHandler :: Got a \"' + responseHeaders.status + '\" response', rawResponse);\n                                return null;//'resumable_upload_timeout';\n                            } else {\n                                console.log('uploadFileResumable :: _chunkResponseHandler :: No \"Range\" header. Response status: ' + responseHeaders.status, responseHeaders);\n                            }\n                        }\n                        console.warn('uploadFileResumable :: _chunkResponseHandler - Not a valid rawResponse', rawResponse);\n                        return null;\n                    };\n\n                    var _this = this;\n                    var _promiseHandler = function(range) {\n                        if (range === null) {\n                            return Promise.reject('Range was null');\n                        }\n                        if (range === 'resumable_upload_complete') {\n                            return Promise.resolve(range);\n                        }\n\n                        var remainingChunkCount = _getRemainingChunkCount(range);\n                        if (remainingChunkCount >= 0) {\n                            var nextRequestParams = _prepareParams(range);\n                            if (nextRequestParams && nextRequestParams !== null) {\n                                console.debug('uploadFileResumable :: Continuing resumable upload - [remainingChunks: ' + remainingChunkCount + ' - Content-Range: ' + nextRequestParams['headers']['Content-Range'] + ', chunkSize: ' + chunkSize+']');\n                                return _this.startRequest(nextRequestParams, _chunkResponseHandler) //TODO: Add errorResponseHandler (and implement retry logic)\n                                        .then(_promiseHandler);\n                            }\n                        } else {\n                            // console.log('uploadFileResumable :: resolving _promiseHandler - remainingChunkCount: ' + remainingChunkCount);\n                            return Promise.resolve('resumable_upload_complete');\n                        }\n                    };\n\n                    var firstRangeParams = _prepareParams(0);\n                    return this.startRequest(firstRangeParams, _chunkResponseHandler)\n                            .then(_promiseHandler)\n                            .then((result) => {\n                                console.log('uploadFileResumable :: Resumable upload of '+ name +' (id: '+ fileId +') done!', result);\n                                return Promise.resolve();\n                            });\n                });\n\n    };\n\n    moveFile = (fileId, newPath, timestamp) => {\n        return this.startRequest({\n            'path': '/drive/v3/files/' + fileId,\n            'params': {\n                fields: \"id,name,modifiedTime\"\n            },\n            'method': \"PATCH\",\n            body: {\n                name: newPath,\n                modifiedTime: timestamp\n            },\n        });\n    };\n\n    copyFile = (fileId, newPath, timestamp) => {\n        return this.startRequest({\n            path: \"/drive/v3/files/\" + fileId + \"/copy\",\n            params: {\n                fields: \"id,name,modifiedTime\"\n            },\n            method: \"POST\",\n            body: {\n                name: newPath,\n                parents: [\"appDataFolder\"],\n                modifiedTime: timestamp\n            },\n        });\n    };\n\n    deleteFile = (fileId, ignoreFileNotFound) => {\n        return this.startRequest({\n            path: \"/drive/v3/files/\" + fileId,\n            method: \"DELETE\",\n            callback: function(metadata, rawResponse) {\n                return metadata;\n            },\n            errorCallback: function(metadata, rawResponse) {\n                return rawResponse;\n            }\n        }, undefined, function(error) {\n            // Don't treat 404: File Not Found as errors when deleting files -\n            // sometimes we cannot really tell whether a file would exist on Google Drive\n            // and it doesn't make sense to execute an additional request to check that.\n            return ignoreFileNotFound && error.code === 404;\n        });\n    };\n\n    getChangeStartPageToken = () => {\n        return this.startRequest({\n            path: \"/drive/v3/changes/startPageToken\",\n            callback: function(response, rawResponse) {\n                return response.startPageToken;\n            },\n            errorCallback: function(response, rawResponse) {\n                return rawResponse;\n            }\n        });\n    };\n\n    getChangeList = (startPageToken) => {\n        return new Promise((resolve, reject) => {\n            var _this = this;\n            var changes = [];\n            var fetchNextPage = function(pageToken) {\n                _this._fetchChangesPage(pageToken, function(response) {\n                    changes = changes.concat(response.changes);\n                    if (\"nextPageToken\" in response) {\n                        fetchNextPage(response.nextPageToken);\n                    } else {\n                        resolve({\n                            changes: changes,\n                            newStartPageToken: response.newStartPageToken\n                        });\n                    }\n                }, function(error) {\n                    reject(error);\n                });\n            };\n            // fetch the first page\n            fetchNextPage(startPageToken);\n        });\n    };\n\n    _fetchFileListPage = (query, pageToken, okCallback, errorCallback) => {\n        console.log(\"fetching page with token \" + pageToken);\n        var params = {\n            \"q\": query,\n            \"pageSize\": 1000,\n            \"spaces\": \"appDataFolder\",\n            \"fields\": \"nextPageToken,files(id,name,modifiedTime)\"\n        };\n        if (pageToken) {\n            params.pageToken = pageToken;\n        }\n\n        this.startRequest({\n            path: \"/drive/v3/files\",\n            params: params,\n        })\n        .then(okCallback)\n        .catch(errorCallback);\n    };\n\n    _fetchChangesPage = (pageToken, okCallback, errorCallback) => {\n        var params = {\n            \"pageToken\": pageToken,\n            \"includeRemoved\": true,\n            \"pageSize\": 1000,\n            \"restrictToMyDrive\": false,\n            \"spaces\": \"appDataFolder\"\n        };\n\n        this.startRequest({\n            path: \"/drive/v3/changes\",\n            params: params,\n        })\n        .then(okCallback)\n        .catch(errorCallback);\n    };\n\n    _base64Encode = (bytes) => {\n        if (!this._hasByteLengthProperty(bytes)) {\n            if (this._isBase64(bytes)) {\n                //Input is already base64 encoded\n                return bytes;\n            }\n            console.warn('Cannot encode input - it does not have a byteLength property which is required');\n            return bytes;\n        }\n        var binary = '';\n        var len = bytes.byteLength;\n        for (var i = 0; i < len; i++) {\n            binary += String.fromCharCode(bytes[i]);\n        }\n        return window.btoa(binary);\n    };\n\n    _base64Decode = (encodedDataStr) => {\n        if (!this._isBase64(encodedDataStr) && this._hasByteLengthProperty(encodedDataStr)) {\n            // input is not base64, and has a byteLength property - skip decoding\n            return encodedDataStr;\n        }\n        var binary = window.atob(encodedDataStr);\n        if (this._isBase64(binary)) {\n            /// Workaround for bad sync behavior - Some files have been uploaded as b64 that was encoded more than once... in those cases we will have to decode more than once to get the original binary :-/\n            return this._base64Decode(binary);\n        }\n        var buffer = new ArrayBuffer(binary.length);\n        var view = new Uint8Array(buffer);\n        for (var i = 0; i < binary.length; i++) {\n            view[i] = binary.charCodeAt(i);\n        }\n        return buffer;\n    };\n\n    _hasByteLengthProperty = (input) => {\n        if (input && input !== null) {\n            return (typeof input.byteLength === 'number');\n        }\n        return false;\n    };\n\n    _isBase64 = (input) => {\n        if (!input || (typeof input !== 'string')) {\n            return false;\n        }\n\n        const base64CharRegex = /^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;\n        /*\n            ^                          # Start of input\n            ([0-9a-zA-Z+/]{4})*        # Groups of 4 valid characters decode\n                                       # to 24 bits of data for each group\n            (                          # Either ending with:\n                ([0-9a-zA-Z+/]{2}==)   # two valid characters followed by ==\n                |                      # , or\n                ([0-9a-zA-Z+/]{3}=)    # three valid characters followed by =\n            )?                         # , or nothing\n            $                          # End of input\n         */\n        return base64CharRegex.test(input);\n    };\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/GoogleDrive.js","import BaseModule from 'components/BaseModule';\n\nexport default class Webview extends BaseModule {\n\n  constructor(settings, autosetup = true) {\n    super();\n\n    this.webview = null;\n    this.eventHandlers = {};\n\n    if (autosetup) {\n      this.setup(settings);\n    }\n  }\n\n  setup(settings) {\n    this.createWebview();\n    this.configureWebview(this.webview, settings);\n    this.append();\n\n    if (this.eventHandlers['contentload']) {\n      this.webview.addEventListener('contentload', this.eventHandlers['contentload']);\n    }\n  }\n\n  createWebview() {\n    this.webview = document.createElement('webview');\n  }\n\n  configureWebview(parentObject, settings) {\n    const parent = parentObject;\n    for (const setting in settings) {\n      if (settings.hasOwnProperty(setting)) {\n        if (typeof settings[setting] === 'object') {\n          this.configureWebview(parent[setting], settings[setting]);\n        } else {\n          parent[setting] = settings[setting];\n        }\n      }\n    }\n  }\n\n  append() {\n    document.body.appendChild(this.webview);\n  }\n\n  sendMessage(data) {\n    this.webview.contentWindow.postMessage(data, '*');\n  }\n\n  // PUBLIC FUNCTIONS\n\n  load = (url) => {\n    this.webview.src = url;\n  }\n\n  evaluatingJavaScript = (js) => {\n    this.sendMessage({\n      code: js,\n    });\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/Webview.js","/**\n * Copyright 2013 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n/**\n * gapi-chrome-apps version 0.001\n *\n * Provides the Google API javascript client 'gapi' as\n * appropriate for hosted websites, or if in a Chrome packaged\n * app implement a minimal set of functionality that is Content\n * Security Policy compliant and uses the chrome identity api.\n *\n * https://github.com/GoogleChrome/chrome-app-samples/tree/master/gapi-chrome-apps-lib\n *\n */\n\"use strict\";\n\nexport function configureGoogleAPI(gapiLoadedCallback) {\n  if (typeof gapi !== 'undefined')\n    throw new Error('gapi already defined.');\n  if (typeof gapiLoadedCallback !== 'function')\n    throw new Error('gapiLoadedCallback function must be defined');\n\n  // If not running in a chrome packaged app, load web gapi:\n  if (!(chrome && chrome.app && chrome.app.runtime)) {\n    window.gapiIsLoaded = function() {\n      gapiLoadedCallback();\n    };\n    // Load web gapi.\n    var script = document.createElement('script');\n    script.src = 'https://apis.google.com/js/client.js?onload=gapiIsLoaded';\n    document.documentElement.appendChild(script);\n    return;\n  }\n\n  window.gapi = {};\n  window.gapi.auth = {};\n  window.gapi.client = {};\n\n  window.ENABLE_DEBUG = false;\n\n  var access_token = undefined;\n\n  gapi.auth.authorize = function (params, callback) {\n    if (typeof callback !== 'function')\n      throw new Error('callback required');\n\n    var details = {};\n    details.interactive = params.immediate === false || false;\n    if (params.accountHint) {\n      // Specifying this prevents the account chooser from appearing on Android.\n      details.accountHint = params.accountHint;\n    }\n    console.assert(!params.response_type || params.response_type == 'token');\n\n    var callbackWrapper = function (getAuthTokenCallbackParam) {\n      access_token = getAuthTokenCallbackParam;\n      if (typeof access_token !== 'undefined')\n        callback({ access_token: access_token });\n      else\n        callback({ error: chrome.runtime.lastError });\n    };\n\n    chrome.identity.getAuthToken(details, callbackWrapper);\n  };\n\n\n  gapi.client.request = function (args) {\n    if (typeof args !== 'object')\n      throw new Error('args required');\n    if (typeof args.callback !== 'function')\n      throw new Error('callback required');\n    if (typeof args.errorCallback !== 'function')\n      throw new Error('errorCallback required');\n    if (typeof args.path !== 'string')\n      throw new Error('path required');\n\n    if (args.root && args.root === 'string') {\n      var path = args.root + args.path;\n    } else {\n      var path = 'https://www.googleapis.com' + args.path;\n    }\n\n    if (typeof args.params === 'object') {\n      for (var paramName in args.params) {\n        if (path.indexOf(encodeURIComponent(paramName)) !== -1) {\n          continue;\n        }\n        var deliminator = path.indexOf('?') === -1 ? '?' : '&';\n        path += deliminator + encodeURIComponent(paramName) + \"=\"\n          + encodeURIComponent(args.params[paramName]);\n      }\n    }\n\n    var method = args.method || 'GET';\n\n    var xhrReadyStates = [];\n    xhrReadyStates[XMLHttpRequest.UNSENT] = 'UNSENT';\n    xhrReadyStates[XMLHttpRequest.OPENED] = 'OPENED';\n    xhrReadyStates[XMLHttpRequest.HEADERS_RECEIVED] = 'HEADERS_RECEIVED';\n    xhrReadyStates[XMLHttpRequest.LOADING] = 'LOADING';\n    xhrReadyStates[XMLHttpRequest.DONE] = 'DONE';\n\n    var xhr = new XMLHttpRequest();\n    xhr.onreadystatechange = () => {\n\n      if (window.ENABLE_DEBUG && typeof console.debug === 'function') {\n        console.debug('XHR :: onreadystatechange - new readyState: ' + xhr.readyState + ' ('+ xhrReadyStates[xhr.readyState] +') - path: ' + path);\n      }\n    };\n\n    xhr.ontimeout = (timeout) => {\n        if (window.ENABLE_DEBUG && typeof console.warn === 'function') {\n          console.warn('XHR :: Browser timeout occurred: ' + JSON.stringify(timeout) + ', readyState: ' + xhr.readyState + ' ('+ xhrReadyStates[xhr.readyState] +') - path: ' + path);\n        }\n        handleTimeout();\n    };\n\n  // Enable this to get logging of the request urls that we invoke during GAPI use\n    if (window.ENABLE_DEBUG && typeof console.debug === 'function') {\n      console.debug('XHR :: xhr.open(' + path + ')');\n    }\n\n    xhr.open(method, path);\n    xhr.setRequestHeader('Authorization', 'Bearer ' + access_token);\n\n    if (typeof args.headers === 'object') {\n        for (var headerName in args.headers) {\n          if (headerName.toLowerCase() !== 'content-length') { // content-length is considered 'unsafe'\n            xhr.setRequestHeader(headerName, args.headers[headerName]);\n          }\n        }\n    }\n\n    var clearResponseTimeout = function() {\n      if (args.responseTimeout) {\n        window.clearTimeout(args.responseTimeout);\n        delete args.responseTimeout;\n      }\n    };\n\n    var setResponseTimeout = function() {\n      clearResponseTimeout();\n      args.responseTimeout = window.setTimeout(handleTimeout, 5000);\n    };\n    var handleTimeout = function() {\n      if (window.ENABLE_DEBUG && typeof console.log === 'function') {\n          console.log('XHR :: Request timeout - aborting request - readyState: ' + xhr.readyState + ' ('+ xhrReadyStates[xhr.readyState] +') - path: ' + path);\n      }\n      clearResponseTimeout();\n      xhr.abort();\n      args.errorCallback(\"timeout\");\n    };\n\n    xhr.onerror = function (event) {\n      if (window.ENABLE_DEBUG && typeof console.debug === 'function') {\n          console.debug('XHR :: Request error - readyState: ' + xhr.readyState + ' ('+ xhrReadyStates[xhr.readyState] + ') - aborting - path: ' + path, 'errorEvent: ', event);\n      }\n      clearResponseTimeout();\n      args.errorCallback();\n    };\n\n    xhr.onabort = function (event) {\n      if (window.ENABLE_DEBUG && typeof console.debug === 'function') {\n          console.debug('XHR :: Request aborted - readyState: ' + xhr.readyState + ' ('+ xhrReadyStates[xhr.readyState] + ') - aborted - path: ' + path, 'abortEvent: ', event);\n      }\n    };\n\n    var getHeadersAsObj = function (headersString) {\n        if (headersString === null) return null;\n        if (headersString === '') return '';\n\n        var headers = {};\n        var headerElements = headersString.split('\\r\\n');\n        for (var i=0; i < headerElements.length ; i++) {\n          var headerElement = headerElements[i];\n          if (headerElement && headerElement.trim().length > 0) {\n            var headerNameSeparatorIdx = headerElement.indexOf(':');\n            var headerName = headerElement.substr(0, headerNameSeparatorIdx).trim();\n            var headerValue = headerElement.substr(headerNameSeparatorIdx + 1).trim();\n            if (!isNaN(parseFloat(headerValue)) && isFinite(headerValue)) {\n              // If value is numeric, replace the value with the numeric representation\n              headerValue = parseFloat(headerValue);\n            }\n            headers[headerName] = headerValue;\n          }\n        }\n        return headers;\n    };\n\n    xhr.onload = function() {\n      clearResponseTimeout();\n\n      var rawResponseObject = {\n        // TODO: body.\n        // TODO: error handling; this function is called if a protocol-level error occurs (e.g. HTTP 404, 500)\n        gapiRequest: {\n          data: {\n            status: this.status,\n            statusText: this.statusText,\n            responseHeaders: getHeadersAsObj(this.getAllResponseHeaders()),\n          }\n        }\n      };\n\n      if (this.response) {\n        var respObject = this.response;\n        if (typeof this.response === 'string') {\n          var contentType = xhr.getResponseHeader('Content-Type');\n          if (typeof contentType === 'string' && contentType.startsWith('application/json')) {\n            try {\n              respObject = JSON.parse(respObject);\n            } catch (err) {\n              var fallbackParsingSuccess = false;\n              if (err instanceof SyntaxError) {\n                try {\n                  respObject = JSON.parse(respObject);\n                } catch (err) {\n                  try {\n                    // Audio recorder bug could have been adding json files with base64 encoded content - handle this properly.\n                    respObject = respObject.replace(/={1,2}$/, ''); // Strip base64 '='' padding at the end\n                  } catch (decodeErr) {\n                    if (console && console !== null && console.warn && console.warn !== null) {\n                      console.warn('Failed parsing json string - raw response: ', this.response, 'Error: ', err, ' Callback will be called with the raw response');\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n        args.callback(respObject, rawResponseObject);// Send the rawwResponseObject instead of the string\n      } else {\n        args.callback(null, rawResponseObject);// Send the rawwResponseObject instead of the string\n      }\n    };\n\n    var progressObj = (method === 'PUT' || method === 'PATCH' ? xhr.upload : xhr);\n    progressObj.onprogress = function (event) {\n      // restart progress timeout for the next chunk of data\n      if (window.ENABLE_DEBUG) {\n          console.debug(`XHR :: onprogress: ${event.lengthComputable ? ((event.loaded/event.total)*100).toFixed(0) : '?'}% - ${method}: ${path} (${event.loaded}/${event.total} bytes)`);\n      }\n      setResponseTimeout();\n    };\n\n    // send the request\n    if (typeof args.responseType === 'string') {\n      xhr.responseType = args.responseType;\n    }\n    if (args.bodyType && args.bodyType !== null) {\n      xhr.setRequestHeader('Content-Type', args.bodyType);\n      xhr.send(args.body);\n    } else if (typeof args.body !== 'undefined') {\n      xhr.setRequestHeader('Content-Type', 'application/json');\n      xhr.send(JSON.stringify(args.body));\n    } else {\n      xhr.send();\n    }\n\n    setResponseTimeout();\n  };\n\n  // Call client handler when gapi is ready.\n  setTimeout(function () { gapiLoadedCallback(); }, 0);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/gapi_chrome_apps.js","\"use strict\";\n\n/*\\\n|*|\n|*|\t:: Number.isInteger() polyfill ::\n|*|\n|*|\thttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isInteger\n|*|\n\\*/\n\nif (!Number.isInteger) {\n\tNumber.isInteger = function isInteger (nVal) {\n\t\treturn typeof nVal === \"number\" && isFinite(nVal) && nVal > -9007199254740992 && nVal < 9007199254740992 && Math.floor(nVal) === nVal;\n\t};\n}\n\n/*\\\n|*|\n|*|\tStringView - Mozilla Developer Network\n|*|\n|*|\tRevision #12, March 21st, 2017\n|*|\n|*|\thttps://developer.mozilla.org/en-US/Add-ons/Code_snippets/StringView\n|*|\thttps://developer.mozilla.org/en-US/docs/User:fusionchess\n|*|\thttps://github.com/madmurphy/stringview.js\n|*|\n|*|\tThis framework is released under the GNU Lesser General Public License, version 3 or later.\n|*|\thttp://www.gnu.org/licenses/lgpl-3.0.html\n|*|\n\\*/\n\nexport function StringView (vInput, sEncoding /* optional (default: UTF-8) */, nOffset /* optional */, nLength /* optional */) {\n\n\tvar fTAView, aWhole, aRaw, fPutOutptCode, fGetOutptChrSize, nInptLen, nStartIdx = isFinite(nOffset) ? nOffset : 0, nTranscrType = 15;\n\n\tif (sEncoding) { this.encoding = sEncoding.toString(); }\n\n\tencSwitch: switch (this.encoding) {\n\t\tcase \"UTF-8\":\n\t\t\tfPutOutptCode = StringView.putUTF8CharCode;\n\t\t\tfGetOutptChrSize = StringView.getUTF8CharLength;\n\t\t\tfTAView = Uint8Array;\n\t\t\tbreak encSwitch;\n\t\tcase \"UTF-16\":\n\t\t\tfPutOutptCode = StringView.putUTF16CharCode;\n\t\t\tfGetOutptChrSize = StringView.getUTF16CharLength;\n\t\t\tfTAView = Uint16Array;\n\t\t\tbreak encSwitch;\n\t\tcase \"UTF-32\":\n\t\t\tfTAView = Uint32Array;\n\t\t\tnTranscrType &= 14;\n\t\t\tbreak encSwitch;\n\t\tdefault:\n\t\t\t/* case \"ASCII\", or case \"BinaryString\" or unknown cases */\n\t\t\tfTAView = Uint8Array;\n\t\t\tnTranscrType &= 14;\n\t}\n\n\ttypeSwitch: switch (typeof vInput) {\n\t\tcase \"string\":\n\t\t\t/* the input argument is a primitive string: a new buffer will be created. */\n\t\t\tnTranscrType &= 7;\n\t\t\tbreak typeSwitch;\n\t\tcase \"object\":\n\t\t\tclassSwitch: switch (vInput.constructor) {\n\t\t\t\tcase StringView:\n\t\t\t\t\t/* the input argument is a stringView: a new buffer will be created. */\n\t\t\t\t\tnTranscrType &= 3;\n\t\t\t\t\tbreak typeSwitch;\n\t\t\t\tcase String:\n\t\t\t\t\t/* the input argument is an objectified string: a new buffer will be created. */\n\t\t\t\t\tnTranscrType &= 7;\n\t\t\t\t\tbreak typeSwitch;\n\t\t\t\tcase ArrayBuffer:\n\t\t\t\t\t/* the input argument is an arrayBuffer: the buffer will be shared. */\n\t\t\t\t\taWhole = new fTAView(vInput);\n\t\t\t\t\tnInptLen = this.encoding === \"UTF-32\" ?\n\t\t\t\t\t\t\tvInput.byteLength >>> 2\n\t\t\t\t\t\t: this.encoding === \"UTF-16\" ?\n\t\t\t\t\t\t\tvInput.byteLength >>> 1\n\t\t\t\t\t\t:\n\t\t\t\t\t\t\tvInput.byteLength;\n\t\t\t\t\taRaw = nStartIdx === 0 && (!isFinite(nLength) || nLength === nInptLen) ?\n\t\t\t\t\t\taWhole\n\t\t\t\t\t\t: new fTAView(vInput, nStartIdx, !isFinite(nLength) ? nInptLen - nStartIdx : nLength);\n\n\t\t\t\t\tbreak typeSwitch;\n\t\t\t\tcase Uint32Array:\n\t\t\t\tcase Uint16Array:\n\t\t\t\tcase Uint8Array:\n\t\t\t\t\t/* the input argument is a typedArray: the buffer, and possibly the array itself, will be shared. */\n\t\t\t\t\tfTAView = vInput.constructor;\n\t\t\t\t\tnInptLen = vInput.length;\n\t\t\t\t\taWhole = vInput.byteOffset === 0 && vInput.length === (\n\t\t\t\t\t\tfTAView === Uint32Array ?\n\t\t\t\t\t\t\tvInput.buffer.byteLength >>> 2\n\t\t\t\t\t\t: fTAView === Uint16Array ?\n\t\t\t\t\t\t\tvInput.buffer.byteLength >>> 1\n\t\t\t\t\t\t:\n\t\t\t\t\t\t\tvInput.buffer.byteLength\n\t\t\t\t\t) ? vInput : new fTAView(vInput.buffer);\n\t\t\t\t\taRaw = nStartIdx === 0 && (!isFinite(nLength) || nLength === nInptLen) ?\n\t\t\t\t\t\tvInput\n\t\t\t\t\t\t: vInput.subarray(nStartIdx, isFinite(nLength) ? nStartIdx + nLength : nInptLen);\n\n\t\t\t\t\tbreak typeSwitch;\n\t\t\t\tdefault:\n\t\t\t\t\t/* the input argument is an array or another serializable object: a new typedArray will be created. */\n\t\t\t\t\taWhole = new fTAView(vInput);\n\t\t\t\t\tnInptLen = aWhole.length;\n\t\t\t\t\taRaw = nStartIdx === 0 && (!isFinite(nLength) || nLength === nInptLen) ?\n\t\t\t\t\t\taWhole\n\t\t\t\t\t\t: aWhole.subarray(nStartIdx, isFinite(nLength) ? nStartIdx + nLength : nInptLen);\n\t\t\t}\n\t\t\tbreak typeSwitch;\n\t\tdefault:\n\t\t\t/* the input argument is a number, a boolean or a function: a new typedArray will be created. */\n\t\t\taWhole = aRaw = new fTAView(Number(vInput) || 0);\n\n\t}\n\n\tif (nTranscrType < 8) {\n\n\t\tvar vSource, nOutptLen, nCharStart, nCharEnd, nEndIdx, fGetInptChrSize, fGetInptChrCode;\n\n\t\tif (nTranscrType & 4) { /* input is string */\n\n\t\t\tvSource = vInput;\n\t\t\tnOutptLen = nInptLen = vSource.length;\n\t\t\tnTranscrType ^= this.encoding === \"UTF-32\" ? 0 : 2;\n\t\t\t/* ...or...: nTranscrType ^= Number(this.encoding !== \"UTF-32\") << 1; */\n\t\t\tnStartIdx = nCharStart = nOffset ? Math.max((nOutptLen + nOffset) % nOutptLen, 0) : 0;\n\t\t\tnEndIdx = nCharEnd = (Number.isInteger(nLength) ? Math.min(Math.max(nLength, 0) + nStartIdx, nOutptLen) : nOutptLen) - 1;\n\n\t\t} else { /* input is stringView */\n\n\t\t\tvSource = vInput.rawData;\n\t\t\tnInptLen = vInput.makeIndex();\n\t\t\tnStartIdx = nCharStart = nOffset ? Math.max((nInptLen + nOffset) % nInptLen, 0) : 0;\n\t\t\tnOutptLen = Number.isInteger(nLength) ? Math.min(Math.max(nLength, 0), nInptLen - nCharStart) : nInptLen;\n\t\t\tnEndIdx = nCharEnd = nOutptLen + nCharStart;\n\n\t\t\tif (vInput.encoding === \"UTF-8\") {\n\t\t\t\tfGetInptChrSize = StringView.getUTF8CharLength;\n\t\t\t\tfGetInptChrCode = StringView.loadUTF8CharCode;\n\t\t\t} else if (vInput.encoding === \"UTF-16\") {\n\t\t\t\tfGetInptChrSize = StringView.getUTF16CharLength;\n\t\t\t\tfGetInptChrCode = StringView.loadUTF16CharCode;\n\t\t\t} else {\n\t\t\t\tnTranscrType &= 1;\n\t\t\t}\n\n\t\t}\n\n\t\tif (nOutptLen === 0 || nTranscrType < 4 && vSource.encoding === this.encoding && nCharStart === 0 && nOutptLen === nInptLen) {\n\n\t\t\t/* the encoding is the same, the length too and the offset is 0... or the input is empty! */\n\n\t\t\tnTranscrType = 7;\n\n\t\t}\n\n\t\tconversionSwitch: switch (nTranscrType) {\n\n\t\t\tcase 0:\n\n\t\t\t/* both the source and the new StringView have a fixed-length encoding... */\n\n\t\t\t\taWhole = new fTAView(nOutptLen);\n\t\t\t\tfor (var nOutptIdx = 0; nOutptIdx < nOutptLen; aWhole[nOutptIdx] = vSource[nStartIdx + nOutptIdx++]);\n\t\t\t\tbreak conversionSwitch;\n\n\t\t\tcase 1:\n\n\t\t\t/* the source has a fixed-length encoding but the new StringView has a variable-length encoding... */\n\n\t\t\t\t/* mapping... */\n\n\t\t\t\tnOutptLen = 0;\n\n\t\t\t\tfor (var nInptIdx = nStartIdx; nInptIdx < nEndIdx; nInptIdx++) {\n\t\t\t\t\tnOutptLen += fGetOutptChrSize(vSource[nInptIdx]);\n\t\t\t\t}\n\n\t\t\t\taWhole = new fTAView(nOutptLen);\n\n\t\t\t\t/* transcription of the source... */\n\n\t\t\t\tfor (var nInptIdx = nStartIdx, nOutptIdx = 0; nOutptIdx < nOutptLen; nInptIdx++) {\n\t\t\t\t\tnOutptIdx = fPutOutptCode(aWhole, vSource[nInptIdx], nOutptIdx);\n\t\t\t\t}\n\n\t\t\t\tbreak conversionSwitch;\n\n\t\t\tcase 2:\n\n\t\t\t/* the source has a variable-length encoding but the new StringView has a fixed-length encoding... */\n\n\t\t\t\t/* mapping... */\n\n\t\t\t\tnStartIdx = 0;\n\n\t\t\t\tvar nChrCode;\n\n\t\t\t\tfor (nChrIdx = 0; nChrIdx < nCharStart; nChrIdx++) {\n\t\t\t\t\tnChrCode = fGetInptChrCode(vSource, nStartIdx);\n\t\t\t\t\tnStartIdx += fGetInptChrSize(nChrCode);\n\t\t\t\t}\n\n\t\t\t\taWhole = new fTAView(nOutptLen);\n\n\t\t\t\t/* transcription of the source... */\n\n\t\t\t\tfor (var nInptIdx = nStartIdx, nOutptIdx = 0; nOutptIdx < nOutptLen; nInptIdx += fGetInptChrSize(nChrCode), nOutptIdx++) {\n\t\t\t\t\tnChrCode = fGetInptChrCode(vSource, nInptIdx);\n\t\t\t\t\taWhole[nOutptIdx] = nChrCode;\n\t\t\t\t}\n\n\t\t\t\tbreak conversionSwitch;\n\n\t\t\tcase 3:\n\n\t\t\t/* both the source and the new StringView have a variable-length encoding... */\n\n\t\t\t\t/* mapping... */\n\n\t\t\t\tnOutptLen = 0;\n\n\t\t\t\tvar nChrCode;\n\n\t\t\t\tfor (var nChrIdx = 0, nInptIdx = 0; nChrIdx < nCharEnd; nInptIdx += fGetInptChrSize(nChrCode)) {\n\t\t\t\t\tnChrCode = fGetInptChrCode(vSource, nInptIdx);\n\t\t\t\t\tif (nChrIdx === nCharStart) { nStartIdx = nInptIdx; }\n\t\t\t\t\tif (++nChrIdx > nCharStart) { nOutptLen += fGetOutptChrSize(nChrCode); }\n\t\t\t\t}\n\n\t\t\t\taWhole = new fTAView(nOutptLen);\n\n\t\t\t\t/* transcription... */\n\n\t\t\t\tfor (var nInptIdx = nStartIdx, nOutptIdx = 0; nOutptIdx < nOutptLen; nInptIdx += fGetInptChrSize(nChrCode)) {\n\t\t\t\t\tnChrCode = fGetInptChrCode(vSource, nInptIdx);\n\t\t\t\t\tnOutptIdx = fPutOutptCode(aWhole, nChrCode, nOutptIdx);\n\t\t\t\t}\n\n\t\t\t\tbreak conversionSwitch;\n\n\t\t\tcase 4:\n\n\t\t\t/* DOMString to ASCII or BinaryString or other unknown encodings */\n\n\t\t\t\taWhole = new fTAView(nOutptLen);\n\n\t\t\t\t/* transcription... */\n\n\t\t\t\tfor (var nIdx = 0; nIdx < nOutptLen; nIdx++) {\n\t\t\t\t\taWhole[nIdx] = vSource.charCodeAt(nIdx) & 0xff;\n\t\t\t\t}\n\n\t\t\t\tbreak conversionSwitch;\n\n\t\t\tcase 5:\n\n\t\t\t/* DOMString to UTF-8 or to UTF-16 */\n\n\t\t\t\t/* mapping... */\n\n\t\t\t\tnOutptLen = 0;\n\n\t\t\t\tfor (var nMapIdx = 0; nMapIdx < nInptLen; nMapIdx++) {\n\t\t\t\t\tif (nMapIdx === nCharStart) { nStartIdx = nOutptLen; }\n\t\t\t\t\tnOutptLen += fGetOutptChrSize(vSource.charCodeAt(nMapIdx));\n\t\t\t\t\tif (nMapIdx === nCharEnd) { nEndIdx = nOutptLen; }\n\t\t\t\t}\n\n\t\t\t\taWhole = new fTAView(nOutptLen);\n\n\t\t\t\t/* transcription... */\n\n\t\t\t\tfor (var nOutptIdx = 0, nChrIdx = 0; nOutptIdx < nOutptLen; nChrIdx++) {\n\t\t\t\t\tnOutptIdx = fPutOutptCode(aWhole, vSource.charCodeAt(nChrIdx), nOutptIdx);\n\t\t\t\t}\n\n\t\t\t\tbreak conversionSwitch;\n\n\t\t\tcase 6:\n\n\t\t\t/* DOMString to UTF-32 */\n\n\t\t\t\taWhole = new fTAView(nOutptLen);\n\n\t\t\t\t/* transcription... */\n\n\t\t\t\tfor (var nIdx = 0; nIdx < nOutptLen; nIdx++) {\n\t\t\t\t\taWhole[nIdx] = vSource.charCodeAt(nIdx);\n\t\t\t\t}\n\n\t\t\t\tbreak conversionSwitch;\n\n\t\t\tcase 7:\n\n\t\t\t\taWhole = new fTAView(nOutptLen ? vSource : 0);\n\t\t\t\tbreak conversionSwitch;\n\n\t\t}\n\n\t\taRaw = nTranscrType > 3 && (nStartIdx > 0 || nEndIdx < aWhole.length - 1) ? aWhole.subarray(nStartIdx, nEndIdx) : aWhole;\n\n\t}\n\n\tthis.buffer = aWhole.buffer;\n\tthis.bufferView = aWhole;\n\tthis.rawData = aRaw;\n\n\tObject.freeze(this);\n\n}\n\n/* CONSTRUCTOR'S METHODS */\n\nStringView.loadUTF8CharCode = function (aChars, nIdx) {\n\t/* The ISO 10646 view of UTF-8 considers valid codepoints encoded by 1-6 bytes, \n\t * while the Unicode view of UTF-8 in 2003 has limited them to 1-4 bytes in order to \n\t * match UTF-16's codepoints. In front of a 5/6-byte sequence StringView tries to \n\t * encode it in any case.\n\t */\n\tvar nLen = aChars.length, nPart = aChars[nIdx];\n\treturn nPart > 251 && nPart < 254 && nIdx + 5 < nLen ?\n\t\t\t/* (nPart - 252 << 30) may be not safe in ECMAScript! So...: */\n\t\t\t/* six bytes */ (nPart - 252) * 1073741824 + (aChars[nIdx + 1] - 128 << 24) + (aChars[nIdx + 2] - 128 << 18) + (aChars[nIdx + 3] - 128 << 12) + (aChars[nIdx + 4] - 128 << 6) + aChars[nIdx + 5] - 128\n\t\t: nPart > 247 && nPart < 252 && nIdx + 4 < nLen ?\n\t\t\t/* five bytes */ (nPart - 248 << 24) + (aChars[nIdx + 1] - 128 << 18) + (aChars[nIdx + 2] - 128 << 12) + (aChars[nIdx + 3] - 128 << 6) + aChars[nIdx + 4] - 128\n\t\t: nPart > 239 && nPart < 248 && nIdx + 3 < nLen ?\n\t\t\t/* four bytes */(nPart - 240 << 18) + (aChars[nIdx + 1] - 128 << 12) + (aChars[nIdx + 2] - 128 << 6) + aChars[nIdx + 3] - 128\n\t\t: nPart > 223 && nPart < 240 && nIdx + 2 < nLen ?\n\t\t\t/* three bytes */ (nPart - 224 << 12) + (aChars[nIdx + 1] - 128 << 6) + aChars[nIdx + 2] - 128\n\t\t: nPart > 191 && nPart < 224 && nIdx + 1 < nLen ?\n\t\t\t/* two bytes */ (nPart - 192 << 6) + aChars[nIdx + 1] - 128\n\t\t:\n\t\t\t/* one byte */ nPart;\n\n};\n\nStringView.putUTF8CharCode = function (aTarget, nChar, nPutAt) {\n\n\tvar nIdx = nPutAt;\n\n\tif (nChar < 0x80 /* 128 */) {\n\t\t/* one byte */\n\t\taTarget[nIdx++] = nChar;\n\t} else if (nChar < 0x800 /* 2048 */) {\n\t\t/* two bytes */\n\t\taTarget[nIdx++] = 0xc0 /* 192 */ + (nChar >>> 6);\n\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar & 0x3f /* 63 */);\n\t} else if (nChar < 0x10000 /* 65536 */) {\n\t\t/* three bytes */\n\t\taTarget[nIdx++] = 0xe0 /* 224 */ + (nChar >>> 12);\n\t\taTarget[nIdx++] = 0x80 /* 128 */ + ((nChar >>> 6) & 0x3f /* 63 */);\n\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar & 0x3f /* 63 */);\n\t} else if (nChar < 0x200000 /* 2097152 */) {\n\t\t/* four bytes */\n\t\taTarget[nIdx++] = 0xf0 /* 240 */ + (nChar >>> 18);\n\t\taTarget[nIdx++] = 0x80 /* 128 */ + ((nChar >>> 12) & 0x3f /* 63 */);\n\t\taTarget[nIdx++] = 0x80 /* 128 */ + ((nChar >>> 6) & 0x3f /* 63 */);\n\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar & 0x3f /* 63 */);\n\t} else if (nChar < 0x4000000 /* 67108864 */) {\n\t\t/* five bytes */\n\t\taTarget[nIdx++] = 0xf8 /* 248 */ + (nChar >>> 24);\n\t\taTarget[nIdx++] = 0x80 /* 128 */ + ((nChar >>> 18) & 0x3f /* 63 */);\n\t\taTarget[nIdx++] = 0x80 /* 128 */ + ((nChar >>> 12) & 0x3f /* 63 */);\n\t\taTarget[nIdx++] = 0x80 /* 128 */ + ((nChar >>> 6) & 0x3f /* 63 */);\n\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar & 0x3f /* 63 */);\n\t} else /* if (nChar <= 0x7fffffff) */ { /* 2147483647 */\n\t\t/* six bytes */\n\t\taTarget[nIdx++] = 0xfc /* 252 */ + /* (nChar >>> 30) may be not safe in ECMAScript! So...: */ (nChar / 1073741824);\n\t\taTarget[nIdx++] = 0x80 /* 128 */ + ((nChar >>> 24) & 0x3f /* 63 */);\n\t\taTarget[nIdx++] = 0x80 /* 128 */ + ((nChar >>> 18) & 0x3f /* 63 */);\n\t\taTarget[nIdx++] = 0x80 /* 128 */ + ((nChar >>> 12) & 0x3f /* 63 */);\n\t\taTarget[nIdx++] = 0x80 /* 128 */ + ((nChar >>> 6) & 0x3f /* 63 */);\n\t\taTarget[nIdx++] = 0x80 /* 128 */ + (nChar & 0x3f /* 63 */);\n\t}\n\n\treturn nIdx;\n\n};\n\nStringView.getUTF8CharLength = function (nChar) {\n\treturn nChar < 0x80 ? 1 : nChar < 0x800 ? 2 : nChar < 0x10000 ? 3 : nChar < 0x200000 ? 4 : nChar < 0x4000000 ? 5 : 6;\n};\n\nStringView.loadUTF16CharCode = function (aChars, nIdx) {\n\n\t/* UTF-16 to DOMString decoding algorithm */\n\tvar nFrstChr = aChars[nIdx];\n\n\treturn nFrstChr > 0xD7BF /* 55231 */ && nIdx + 1 < aChars.length ?\n\t\t(nFrstChr - 0xD800 /* 55296 */ << 10) + aChars[nIdx + 1] + 0x2400 /* 9216 */\n\t\t: nFrstChr;\n\n};\n\nStringView.putUTF16CharCode = function (aTarget, nChar, nPutAt) {\n\n\tvar nIdx = nPutAt;\n\n\tif (nChar < 0x10000 /* 65536 */) {\n\t\t/* one element */\n\t\taTarget[nIdx++] = nChar;\n\t} else {\n\t\t/* two elements */\n\t\taTarget[nIdx++] = 0xD7C0 /* 55232 */ + (nChar >>> 10);\n\t\taTarget[nIdx++] = 0xDC00 /* 56320 */ + (nChar & 0x3FF /* 1023 */);\n\t}\n\n\treturn nIdx;\n\n};\n\nStringView.getUTF16CharLength = function (nChar) {\n\treturn nChar < 0x10000 ? 1 : 2;\n};\n\n/* Array of bytes to base64 string decoding */\n\nStringView.b64ToUint6 = function (nChr) {\n\n\treturn nChr > 64 && nChr < 91 ?\n\t\t\tnChr - 65\n\t\t: nChr > 96 && nChr < 123 ?\n\t\t\tnChr - 71\n\t\t: nChr > 47 && nChr < 58 ?\n\t\t\tnChr + 4\n\t\t: nChr === 43 ?\n\t\t\t62\n\t\t: nChr === 47 ?\n\t\t\t63\n\t\t:\n\t\t\t0;\n\n};\n\nStringView.uint6ToB64 = function (nUint6) {\n\n\treturn nUint6 < 26 ?\n\t\t\tnUint6 + 65\n\t\t: nUint6 < 52 ?\n\t\t\tnUint6 + 71\n\t\t: nUint6 < 62 ?\n\t\t\tnUint6 - 4\n\t\t: nUint6 === 62 ?\n\t\t\t43\n\t\t: nUint6 === 63 ?\n\t\t\t47\n\t\t:\n\t\t\t65;\n\n};\n\n/* Base64 string to array encoding */\n\nStringView.bytesToBase64 = function (aBytes) {\n\n\tvar eqLen = (3 - (aBytes.length % 3)) % 3, sB64Enc = \"\";\n\n\tfor (var nMod3, nLen = aBytes.length, nUint24 = 0, nIdx = 0; nIdx < nLen; nIdx++) {\n\t\tnMod3 = nIdx % 3;\n\t\t/* Uncomment the following line in order to split the output in lines 76-character long: */\n\t\t/*\n\t\tif (nIdx > 0 && (nIdx * 4 / 3) % 76 === 0) { sB64Enc += \"\\r\\n\"; }\n\t\t*/\n\t\tnUint24 |= aBytes[nIdx] << (16 >>> nMod3 & 24);\n\t\tif (nMod3 === 2 || aBytes.length - nIdx === 1) {\n\t\t\tsB64Enc += String.fromCharCode(StringView.uint6ToB64(nUint24 >>> 18 & 63), StringView.uint6ToB64(nUint24 >>> 12 & 63), StringView.uint6ToB64(nUint24 >>> 6 & 63), StringView.uint6ToB64(nUint24 & 63));\n\t\t\tnUint24 = 0;\n\t\t}\n\t}\n\n\treturn\teqLen === 0 ?\n\t\t\tsB64Enc\n\t\t:\n\t\t\tsB64Enc.substring(0, sB64Enc.length - eqLen) + (eqLen === 1 ? \"=\" : \"==\");\n\n\n};\n\n\nStringView.base64ToBytes = function (sBase64, nBlockBytes) {\n\n\tvar\n\t\tsB64Enc = sBase64.replace(/[^A-Za-z0-9\\+\\/]/g, \"\"), nInLen = sB64Enc.length,\n\t\tnOutLen = nBlockBytes ? Math.ceil((nInLen * 3 + 1 >>> 2) / nBlockBytes) * nBlockBytes : nInLen * 3 + 1 >>> 2, aBytes = new Uint8Array(nOutLen);\n\n\tfor (var nMod3, nMod4, nUint24 = 0, nOutIdx = 0, nInIdx = 0; nInIdx < nInLen; nInIdx++) {\n\t\tnMod4 = nInIdx & 3;\n\t\tnUint24 |= StringView.b64ToUint6(sB64Enc.charCodeAt(nInIdx)) << 18 - 6 * nMod4;\n\t\tif (nMod4 === 3 || nInLen - nInIdx === 1) {\n\t\t\tfor (nMod3 = 0; nMod3 < 3 && nOutIdx < nOutLen; nMod3++, nOutIdx++) {\n\t\t\t\taBytes[nOutIdx] = nUint24 >>> (16 >>> nMod3 & 24) & 255;\n\t\t\t}\n\t\t\tnUint24 = 0;\n\t\t}\n\t}\n\n\treturn aBytes;\n\n};\n\nStringView.makeFromBase64 = function (sB64Inpt, sEncoding, nByteOffset, nLength) {\n\n\treturn new StringView(sEncoding === \"UTF-16\" || sEncoding === \"UTF-32\" ? StringView.base64ToBytes(sB64Inpt, sEncoding === \"UTF-16\" ? 2 : 4).buffer : StringView.base64ToBytes(sB64Inpt), sEncoding, nByteOffset, nLength);\n\n};\n\n/* DEFAULT VALUES */\n\nStringView.prototype.encoding = \"UTF-8\"; /* Default encoding... */\n\n/* INSTANCES' METHODS */\n\nStringView.prototype.makeIndex = function (nChrLength, nStartFrom) {\n\n\tvar\n\n\t\taTarget = this.rawData, nChrEnd, nRawLength = aTarget.length,\n\t\tnStartIdx = nStartFrom || 0, nIdxEnd = nStartIdx, nStopAtChr = isNaN(nChrLength) ? Infinity : nChrLength;\n\n\tif (nChrLength + 1 > aTarget.length) { throw new RangeError(\"StringView.prototype.makeIndex - The offset can\\'t be major than the length of the array - 1.\"); }\n\n\tswitch (this.encoding) {\n\n\t\tcase \"UTF-8\":\n\n\t\t\tvar nPart;\n\n\t\t\tfor (nChrEnd = 0; nIdxEnd < nRawLength && nChrEnd < nStopAtChr; nChrEnd++) {\n\t\t\t\tnPart = aTarget[nIdxEnd];\n\t\t\t\tnIdxEnd += nPart > 251 && nPart < 254 && nIdxEnd + 5 < nRawLength ? 6\n\t\t\t\t\t: nPart > 247 && nPart < 252 && nIdxEnd + 4 < nRawLength ? 5\n\t\t\t\t\t: nPart > 239 && nPart < 248 && nIdxEnd + 3 < nRawLength ? 4\n\t\t\t\t\t: nPart > 223 && nPart < 240 && nIdxEnd + 2 < nRawLength ? 3\n\t\t\t\t\t: nPart > 191 && nPart < 224 && nIdxEnd + 1 < nRawLength ? 2\n\t\t\t\t\t: 1;\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase \"UTF-16\":\n\n\t\t\tfor (nChrEnd = nStartIdx; nIdxEnd < nRawLength && nChrEnd < nStopAtChr; nChrEnd++) {\n\t\t\t\tnIdxEnd += aTarget[nIdxEnd] > 0xD7BF /* 55231 */ && nIdxEnd + 1 < aTarget.length ? 2 : 1;\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tnIdxEnd = nChrEnd = isFinite(nChrLength) ? nChrLength : nRawLength - 1;\n\n\t}\n\n\tif (nChrLength) { return nIdxEnd; }\n\n\treturn nChrEnd;\n\n};\n\nStringView.prototype.toBase64 = function (bWholeBuffer) {\n\n\treturn StringView.bytesToBase64(\n\t\tbWholeBuffer ?\n\t\t\t(\n\t\t\t\tthis.bufferView.constructor === Uint8Array ?\n\t\t\t\t\tthis.bufferView\n\t\t\t\t:\n\t\t\t\t\tnew Uint8Array(this.buffer)\n\t\t\t)\n\t\t: this.rawData.constructor === Uint8Array ?\n\t\t\tthis.rawData\n\t\t:\n\t\t\tnew Uint8Array(this.buffer, this.rawData.byteOffset, this.rawData.length << (this.rawData.constructor === Uint16Array ? 1 : 2))\n\t\t);\n\n};\n\nStringView.prototype.subview = function (nCharOffset /* optional */, nCharLength /* optional */) {\n\n\tvar\n\n\t\tnRawSubLen, nRawSubOffset, nSubOffset, nSubLen, bVariableLen = this.encoding === \"UTF-8\" || this.encoding === \"UTF-16\",\n\t\tnThisLen, nRawLen = this.rawData.length;\n\n\tif (nRawLen === 0) {\n\t\treturn new StringView(this.buffer, this.encoding);\n\t}\n\n\tnThisLen = bVariableLen ? this.makeIndex() : nRawLen;\n\tnSubOffset = nCharOffset ? nCharOffset + 1 > nThisLen ? nThisLen : Math.max((nThisLen + nCharOffset) % nThisLen, 0) : 0;\n\tnSubLen = Number.isInteger(nCharLength) ? Math.max(nCharLength, 0) + nSubOffset > nThisLen ? nThisLen - nSubOffset : nCharLength : nThisLen - nSubOffset;\n\n\tif (nSubOffset === 0 && nSubLen === nThisLen) { return this; }\n\n\tif (bVariableLen) {\n\t\tnRawSubOffset = nSubOffset < nThisLen ? this.makeIndex(nSubOffset) : nThisLen;\n\t\tnRawSubLen = nSubLen ? this.makeIndex(nSubLen, nRawSubOffset) - nRawSubOffset : 0;\n\t} else {\n\t\tnRawSubOffset = nSubOffset;\n\t\tnRawSubLen = nSubLen;\n\t}\n\n\tif (this.encoding === \"UTF-16\") {\n\t\tnRawSubOffset <<= 1;\n\t} else if (this.encoding === \"UTF-32\") {\n\t\tnRawSubOffset <<= 2;\n\t}\n\n\treturn new StringView(this.buffer, this.encoding, this.rawData.byteOffset + nRawSubOffset, nRawSubLen);\n\n};\n\nStringView.prototype.forEachChar = function (fCallback, oThat, nChrOffset, nChrLen) {\n\n\tvar aSource = this.rawData, nRawEnd, nRawIdx;\n\n\tif (this.encoding === \"UTF-8\" || this.encoding === \"UTF-16\") {\n\n\t\tvar fGetInptChrSize, fGetInptChrCode;\n\n\t\tif (this.encoding === \"UTF-8\") {\n\t\t\tfGetInptChrSize = StringView.getUTF8CharLength;\n\t\t\tfGetInptChrCode = StringView.loadUTF8CharCode;\n\t\t} else if (this.encoding === \"UTF-16\") {\n\t\t\tfGetInptChrSize = StringView.getUTF16CharLength;\n\t\t\tfGetInptChrCode = StringView.loadUTF16CharCode;\n\t\t}\n\n\t\tnRawIdx = isFinite(nChrOffset) ? this.makeIndex(nChrOffset) : 0;\n\t\tnRawEnd = isFinite(nChrLen) ? this.makeIndex(nChrLen, nRawIdx) : aSource.length;\n\n\t\tfor (var nChrCode, nChrIdx = 0; nRawIdx < nRawEnd; nChrIdx++) {\n\t\t\tnChrCode = fGetInptChrCode(aSource, nRawIdx);\n\t\t\tif (!oThat) {\n\t\t\t\tfCallback(nChrCode, nChrIdx, nRawIdx, aSource);\n\t\t\t} else {\n\t\t\t\tfCallback.call(oThat, nChrCode, nChrIdx, nRawIdx, aSource);\n\t\t\t}\n\t\t\tnRawIdx += fGetInptChrSize(nChrCode);\n\t\t}\n\n\t} else {\n\n\t\tnRawIdx = isFinite(nChrOffset) ? nChrOffset : 0;\n\t\tnRawEnd = isFinite(nChrLen) ? nChrLen + nRawIdx : aSource.length;\n\n\t\tfor (nRawIdx; nRawIdx < nRawEnd; nRawIdx++) {\n\t\t\tif (!oThat) {\n\t\t\t\tfCallback(aSource[nRawIdx], nRawIdx, nRawIdx, aSource);\n\t\t\t} else {\n\t\t\t\tfCallback.call(oThat, aSource[nRawIdx], nRawIdx, nRawIdx, aSource);\n\t\t\t}\n\t\t}\n\n\t}\n\n};\n\nStringView.prototype.valueOf = StringView.prototype.toString = function () {\n\n\tif (this.encoding !== \"UTF-8\" && this.encoding !== \"UTF-16\") {\n\t\t/* ASCII, UTF-32 or BinaryString to DOMString */\n\t\treturn String.fromCharCode.apply(null, this.rawData);\n\t}\n\n\tvar fGetCode, fGetIncr, sView = \"\";\n\n\tif (this.encoding === \"UTF-8\") {\n\t\tfGetIncr = StringView.getUTF8CharLength;\n\t\tfGetCode = StringView.loadUTF8CharCode;\n\t} else if (this.encoding === \"UTF-16\") {\n\t\tfGetIncr = StringView.getUTF16CharLength;\n\t\tfGetCode = StringView.loadUTF16CharCode;\n\t}\n\n\tfor (var nChr, nLen = this.rawData.length, nIdx = 0; nIdx < nLen; nIdx += fGetIncr(nChr)) {\n\t\tnChr = fGetCode(this.rawData, nIdx);\n\t\tsView += String.fromCharCode(nChr);\n\t}\n\n\treturn sView;\n\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/stringview.js","import ChromeApp from 'ChromeApp';\n// import Logger from 'Logger';\nimport Splashscreen from 'components/Splashscreen';\nimport WindowController from 'components/Window';\nimport Storage from 'components/Storage';\nimport PlatformInfo from 'components/PlatformInfo';\nimport Video from 'components/Video';\nimport Audio from 'components/Audio';\nimport Bluetooth from 'components/Bluetooth';\nimport ContentViewerWebview from 'components/ContentViewerWebview';\nimport SyncFS from 'components/SyncFS';\nimport ExternalLink from 'components/ExternalLink';\nimport Killswitch from 'components/Killswitch';\nimport OSLimiter from 'components/OSLimiter';\n//import UpdateChecker from 'components/UpdateChecker';\n\n// Timestamps in console - start\nif (!Date.now) {\n  Date.now = function() {\n    return new Date().getTime();\n  };\n}\nvar startTime = Date.now();\nfunction tstamp() {\n  var t = (Date.now() - startTime) / 1000.0;\n  return '[' + t + '] ';\n}\n\nfunction getArgString(args) {\n  if (typeof args === 'string') {\n    return args;\n  }\n  // return JSON.stringify(args);\n  return concatArgs(args);\n}\n\n/**\n * @ignore\n * Get a message to print by the logger\n *\n * @param {object|Array} args - The arguments to log\n * @param {number} [offset = 0] - The number of arguments to skip - by default no arguments are skipped\n * @param {string} [separator = ' '] The separator to use between the args - by default a space is used\n * @return {string}\n */\nfunction concatArgs(args, offset = 0, separator = ' ') {\n  var message = '';\n  for (var i = offset; i < args.length; i++) {\n    if (i > offset) {\n      message += separator;\n    }\n    var type = typeof args[i];\n    if (args[i] !== null) {\n      if (type === 'object') {\n        var o = {};\n        o.o = args[i];\n        var cache = [];\n        if (\n          args[i].hasOwnProperty('toString') &&\n          typeof args[i].toString === 'function'\n        ) {\n          message += args[i].toString();\n        } else {\n          // message += JSON.stringify(args[i]);\n          message += JSON.stringify(\n            o,\n            function(key, value) {\n              if (typeof value === 'object' && value !== null) {\n                if (cache.indexOf(value) !== -1) {\n                  // Circular reference found, ignore key\n                  return;\n                }\n                // Store value in our collection\n                cache.push(value);\n              }\n              return value;\n            },\n            '\\t'\n          );\n        }\n        cache = null;\n      } else {\n        message += args[i];\n      }\n    } else {\n      message += 'null';\n    }\n  }\n\n  return message;\n}\n\nvar oldConsole = console;\nwindow.console = {\n  log: function() {\n    var args = [getArgString(arguments)];\n    Array.prototype.unshift.call(args, tstamp());\n    oldConsole.log.apply(oldConsole, args);\n  },\n  trace: function() {\n    var args = [getArgString(arguments)];\n    Array.prototype.unshift.call(args, tstamp());\n    oldConsole.trace.apply(oldConsole, args);\n  },\n  info: function() {\n    var args = [getArgString(arguments)];\n    Array.prototype.unshift.call(args, tstamp());\n    oldConsole.info.apply(oldConsole, args);\n  },\n  error: function() {\n    var args = [getArgString(arguments)];\n    Array.prototype.unshift.call(args, tstamp());\n    oldConsole.error.apply(oldConsole, args);\n  },\n  debug: function() {\n      const argString = getArgString(arguments);\n      if (argString.indexOf('Screen position out of view frustum') !== -1) {\n        return;\n      }\n      var args = [argString];\n    Array.prototype.unshift.call(args, tstamp());\n    oldConsole.debug.apply(oldConsole, args);\n  },\n  assert: function() {\n    var args = [getArgString(arguments)];\n    Array.prototype.unshift.call(args, tstamp());\n    oldConsole.assert.apply(oldConsole, args);\n  },\n  warn: function() {\n    var args = [getArgString(arguments)];\n    Array.prototype.unshift.call(args, tstamp());\n    oldConsole.warn.apply(oldConsole, args);\n  },\n  time: function() {\n    var args = [getArgString(arguments)];\n    oldConsole.time.apply(oldConsole, args);\n  },\n  timeStamp: function() {\n    var args = [getArgString(arguments)];\n    oldConsole.timeStamp.apply(oldConsole, args);\n  },\n  timeEnd: function() {\n    var args = [getArgString(arguments)];\n    oldConsole.timeEnd.apply(oldConsole, args);\n  }\n};\n// Timestamps in console - end\n\nconst $logger = console;\n\nconst storage = new Storage();\n\nconst windowController = new WindowController();\n\nconst chromeApp = new ChromeApp($logger, window);\n\nvar syncFSLogger = {\n  log: function(...args) {\n    $logger.log('[SyncFS] ', args);\n  }\n};\n\nconst splashscreen = new Splashscreen();\nwindow.addEventListener('load', () => {\n  splashscreen.onBoundsChanged();\n});\n\nconst osLimiter = new OSLimiter(['cros'], true, 'splashscreen');\n\n//const updateChecker = new UpdateChecker($logger);\n\nvar initApp = function() {\n  $logger.debug('[App.js] On supported platform');\n\n  // Create the webview to hold the webGL\n  //<webview id=\"webgl\" src=\"webgl/index.html\" partition=\"persist:webgl\"></webview>\n  var webGLwebview = document.createElement('webview');\n  webGLwebview.id = 'webgl';\n  webGLwebview.setAttribute('src', 'webgl/index.html');\n  webGLwebview.setAttribute('partition', 'persist:webgl');\n\n  // Append webview to parent element\n  document.getElementById('parent').appendChild(webGLwebview);\n\n  setTimeout(() => {\n    document.getElementById('webgl').setZoomMode('disabled');\n  }, 1000);\n\n  document.getElementById('webgl').addEventListener('dialog', function(e) {\n    $logger.debug('[App.js] Dialog from webgl webview', e.messageText);\n  });\n\n  document.addEventListener('mousewheel', function(e) {\n    if (e.ctrlKey === true) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  });\n\n  chromeApp\n    .initialize()\n    .then(() => {\n      chrome.runtime.getPlatformInfo(platformInfo => {\n        $logger.debug(\n          chrome.runtime.getManifest().name +\n            ' manifest version: ' +\n            chrome.runtime.getManifest().version +\n            ' starting on ' +\n            platformInfo.os +\n            ' ' +\n            platformInfo.arch +\n            ' - Chrome details(' +\n            navigator.appVersion +\n            ') - onLine: ' +\n            navigator.onLine\n        );\n      });\n\n      windowController.initialize(storage);\n\n      chromeApp.register('Killswitch', new Killswitch());\n      chromeApp.register('ExternalLink', new ExternalLink());\n      chromeApp.register('Splashscreen', splashscreen);\n      chromeApp.register('Storage', storage);\n      chromeApp.register('PlatformInfo', new PlatformInfo());\n      chromeApp.register('Audio', new Audio());\n      chromeApp.register('Video', new Video(storage));\n      chromeApp.register(\n        'Content',\n        new ContentViewerWebview({\n          id: 'contentViewer',\n          style: {\n            width: '600px',\n            position: 'absolute',\n            display: 'none'\n          },\n          partition: 'persist:webgl'\n        })\n      );\n      chromeApp.register('Bluetooth', new Bluetooth($logger, window));\n      chromeApp.register('SyncFS', new SyncFS(syncFSLogger, splashscreen));\n    })\n    // .then( () => {\n    // setTimeout(() => {\n    //     updateChecker.checkForUpdates();\n    // }, 15000); // set some delay so we minimize the chance of interfering with the normal startup flow\n    // })\n    .catch(err => {\n      console.error('ChromeApp failed registration of libraries', err);\n    });\n};\n\n// Check if OS is supported\nosLimiter.runOnApprovedOS(initApp);\n\n\n\n// WEBPACK FOOTER //\n// ../chromeos_resources/src/app.js","module.exports = LEGO_BLE_SDK;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"LEGO_BLE_SDK\"\n// module id = 29\n// module chunks = 0"],"sourceRoot":""}