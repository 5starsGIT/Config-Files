!function(e,t){if("function"==typeof define&&define.amd)define([],t);else if("undefined"!=typeof exports)t();else{t(),e.unknown={}}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,(function(){const e=35,t=36,n=37,r=38,a=39,i=40,s=77,o=89,c=4,d=5,h=6,m=7;class y{constructor(){return y.instance?y.instance:(y.instance=this,this.initEventHandlers(),this)}initEventHandlers(){const e=document.querySelector(".docs-texteventtarget-iframe");this.m_textEventIFrameDoc=e.contentDocument,this.m_textEventIFrameWindow=e.contentWindow,this.m_editorWindow=document.querySelector(".kix-appview-editor"),this.m_eventHandlers=[],this.m_eventHandlers.keydown=this._getEventHandlers("keydown",this.m_textEventIFrameDoc),this.m_eventHandlers.keyup=this._getEventHandlers("keyup",this.m_textEventIFrameDoc),this.m_eventHandlers.keypress=this._getEventHandlers("keypress",this.m_textEventIFrameDoc)}fireKeyEvent(e,t,n=!1,r=!1,a=!1,i=!1,s=1){"string"==typeof t&&(t=t.charCodeAt(0));var o={altGraphKey:!1,altKey:a,bubbles:!0,cancelBubble:!1,cancelable:!0,charCode:t,clipboardData:void 0,ctrlKey:r,currentTarget:this.m_textEventIFrameDoc,defaultPrevented:!0,detail:0,eventPhase:0,keyCode:t,keyLocation:0,layerX:0,layerY:0,metaKey:i,pageX:0,pageY:0,returnValue:!0,shiftKey:n,srcElement:this.m_textEventIFrameDoc.body,target:this.m_textEventIFrameDoc.body,timeStamp:(new Date).getTime(),type:e,view:this.m_textEventIFrameWindow,which:t};let c=0;this.m_eventHandlers[e].forEach((e=>{for(c=0;c<s;c++)e.eventHandler(o)}))}_getEventHandlers(e,t){try{var n=[];for(var r in t)if(r.match(/^closure/)&&"number"!=typeof t[r]){var a=t[r];if(!a)continue;if(!this.m_eventListKeyName)for(var i in a){var s=a[i];if(s&&s!=t)for(var o in s){var c=s[o];c&&(null!=c.length&&c[0].src==t&&(this.m_eventListKeyName=i,n.concat(c)))}}for(var d in a[this.m_eventListKeyName])if(d==e)for(var h=a[this.m_eventListKeyName][d],m=0;m<h.length;m++){if(!this.m_eventHandlerKeyName&&h[m].src==t)for(var y in h[m])if(h[m][y].src==t){this.m_eventHandlerKeyName=y;break}n.push({eventObject:h[m],eventHandler:h[m][this.m_eventHandlerKeyName]})}}return n}catch(e){}}}class f{constructor(){this.m_OS=this._detectOS(),this.m_dispatcher=new y}set type(e){e.split("").forEach((e=>{this.m_dispatcher.fireKeyEvent("keypress",e)})),document.dispatchEvent(new CustomEvent("th-type-finished"))}_detectOS(){let e=m;return-1!=window.navigator.userAgent.indexOf("CrOS")?e=c:-1!=window.navigator.userAgent.indexOf("Windows")?e=d:-1!=window.navigator.userAgent.indexOf("Mac")&&(e=h),e}caretMoveLeft(e=1,t=!1){this.m_dispatcher.fireKeyEvent("keydown",n,t,!1,!1,!1,e)}caretMoveRight(e=1,t=!1,n=!1){n&&this.m_OS!==h||this.m_dispatcher.fireKeyEvent("keydown",a,t,!1,!1,!1,e)}caretToStartOfWord(e=!1){this.m_OS!=h?this.m_dispatcher.fireKeyEvent("keydown",n,e,!0):this.m_dispatcher.fireKeyEvent("keydown",n,e,!1,!0)}caretToEndOfWord(e=!1){this.m_OS!=h?this.m_dispatcher.fireKeyEvent("keydown",a,e,!0):this.m_dispatcher.fireKeyEvent("keydown",a,e,!1,!0)}initEventHandlers(){this.m_dispatcher.initEventHandlers()}caretToStartOfNextWord(e=!1){this.m_dispatcher.fireKeyEvent("keydown",a,e,!0)}caretToStartOfLine(e=!1){this.m_OS!=h?this.m_dispatcher.fireKeyEvent("keydown",t,e):this.m_dispatcher.fireKeyEvent("keydown",n,e,!1,!1,!0)}caretToEndOfLine(t=!1){this.m_OS!=h?this.m_dispatcher.fireKeyEvent("keydown",e,t):this.m_dispatcher.fireKeyEvent("keydown",a,t,!1,!1,!0)}caretToStartOfDocument(e=!1){this.m_OS!=h?this.m_dispatcher.fireKeyEvent("keydown",t,e,!0):this.m_dispatcher.fireKeyEvent("keydown",r,e,!1,!1,!0)}caretToEndOfDocument(t=!1){this.m_OS!=h?this.m_dispatcher.fireKeyEvent("keydown",e,t,!0):this.m_dispatcher.fireKeyEvent("keydown",i,t,!1,!1,!0)}async openAltTextDialog(){return new Promise(((e,t)=>{this.m_OS==h?(this.m_dispatcher.fireKeyEvent("keydown",o,!1,!1,!0,!0),this.m_dispatcher.fireKeyEvent("keyup",o,!1,!1,!0,!0)):(this.m_dispatcher.fireKeyEvent("keydown",o,!1,!0,!0),this.m_dispatcher.fireKeyEvent("keyup",o,!1,!0,!0)),e()}))}async openCommentBox(){return new Promise(((e,t)=>{this.m_OS==h?(this.m_dispatcher.fireKeyEvent("keydown",s,!1,!1,!0,!0),this.m_dispatcher.fireKeyEvent("keyup",s,!1,!1,!0,!0)):(this.m_dispatcher.fireKeyEvent("keydown",s,!1,!0,!0),this.m_dispatcher.fireKeyEvent("keyup",s,!1,!0,!0)),e()}))}}window.addEventListener("message",(async e=>{if(e.data&&e.data.action&&"TH_DOCS_PARSER_SEND_RW4GC"===e.data.action&&e.origin===window.location.origin&&e.data.th_type&&"TH_DOCS_PARSER_SEND_RW4GC"===e.data.action){let t=new f;const n=e.data.params;switch(e.data.th_type){case"type":t.type=e.data.params.textToType;break;case"caretMoveLeft":t.caretMoveLeft(n.numberOFCharacters,n.select);break;case"caretMoveRight":t.caretMoveRight(n.numberOFCharacters,n.select);break;case"caretToStartOfNextWord":t.caretToStartOfNextWord(n.select);break;case"caretToStartOfLine":t.caretToStartOfLine(n.select);break;case"caretToEndOfLine":t.caretToEndOfLine(n.select);break;case"caretToStartOfDocument":t.caretToStartOfDocument(n.select);break;case"caretToEndOfDocument":t.caretToEndOfDocument(n.select);break;case"caretToStartOfWord":t.caretToStartOfWord(n.select);break;case"caretToEndOfWord":t.caretToEndOfWord(n.select);break;case"openAltTextDialog":await t.openAltTextDialog();break;case"openCommentBox":if(0!==document.querySelectorAll(".docos-input-textarea").length)break;await t.openCommentBox();break;case"initEventHandlers":t.initEventHandlers()}e.data.action="TH_DOCS_PARSER_RESPONSE_RW4GC",window.postMessage(e.data,e.origin)}}),!1),window.addEventListener("message",(e=>{if(e.data&&e.origin===window.location.origin&&e.data.th_type&&(e.data.params,"kxresize"===e.data.th_type)){if(window.KX_kixApp)return void window.KX_kixApp.resize();let e=document.querySelector("#workspace-container");if(e){let t=e.style.overflow;return void(t&&(e.style.overflow="scroll",e.scrollTop=e.scrollTop++,requestAnimationFrame((()=>{e.scrollTop=e.scrollTop--,e.style.overflow=t}))))}}}))}));
